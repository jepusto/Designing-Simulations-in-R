<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.40.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2024-07-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exp-design.html"/>
<link rel="next" href="case-study-comparing-different-estimators.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.4</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#why-r"><i class="fa fa-check"></i><b>2.1</b> Why R?</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.2</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.3</b> Functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.3.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.3.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.3.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.3.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.3.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.3.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.3.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.3.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.3.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.4</b> <code>%&gt;%</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.5</b> Recipes versus Patterns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#exercises-1"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing Test Performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-Generating Processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-statistical-model-is-a-recipe-for-data-generation"><i class="fa fa-check"></i><b>6.1</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>6.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.3</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.3.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.3.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.3.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#converting-our-model-to-code"><i class="fa fa-check"></i><b>6.3.3</b> Converting our model to code</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-2"><i class="fa fa-check"></i><b>6.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ex_dgp"><i class="fa fa-check"></i><b>6.4.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.4.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#checking-and-extending-the-cluster-rct-dgp"><i class="fa fa-check"></i><b>6.4.2</b> Checking and extending the Cluster RCT DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#extension-standardization-in-a-data-generating-process"><i class="fa fa-check"></i><b>6.5</b> Extension: Standardization in a data generating process</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-estimation-procedures"><i class="fa fa-check"></i><b>7.1</b> Validating Estimation Procedures</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-via-simulation"><i class="fa fa-check"></i><b>7.2</b> Checking via simulation</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#including-multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.3</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-3"><i class="fa fa-check"></i><b>7.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#more-welch-and-adding-the-bff-test"><i class="fa fa-check"></i><b>7.4.1</b> More Welch and adding the BFF test</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#more-estimators-for-cluster-randomized-trials"><i class="fa fa-check"></i><b>7.4.2</b> More estimators for Cluster Randomized Trials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-4"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-vs.-estimation"><i class="fa fa-check"></i><b>9.1</b> Inference vs. Estimation</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#ways-of-assessing-and-comparing-estimation-procedures"><i class="fa fa-check"></i><b>9.2</b> Ways of Assessing and Comparing Estimation Procedures</a></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.3.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#handling-estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.3.2</b> Handling Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.4</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.4.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.5</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.5.1</b> Validity</a></li>
<li class="chapter" data-level="9.5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.5.2</b> Power</a></li>
<li class="chapter" data-level="9.5.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.5.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.5.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.5.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.6</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.6.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.7</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.7.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.7.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.7.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-mcse"><i class="fa fa-check"></i><b>9.8</b> Uncertainty in Performance Estimates (the MCSE)</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.8.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.8.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.8.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.8.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.8.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-5"><i class="fa fa-check"></i><b>9.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercices-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercices (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-6"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html"><i class="fa fa-check"></i><b>11</b> Case study: Attrition in a simple randomized experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#the-data-generating-process"><i class="fa fa-check"></i><b>11.1</b> The data generating process</a></li>
<li class="chapter" data-level="11.2" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#estimators"><i class="fa fa-check"></i><b>11.2</b> Estimators</a></li>
<li class="chapter" data-level="11.3" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#performance-criteria-1"><i class="fa fa-check"></i><b>11.3</b> Performance criteria</a></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="12" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>12</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="12.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>12.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>12.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>12.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="12.3" data-path="exp-design.html"><a href="exp-design.html#ways-of-repeating-oneself"><i class="fa fa-check"></i><b>12.3</b> Ways of repeating oneself</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>12.3.1</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>12.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>12.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html"><i class="fa fa-check"></i><b>13</b> Analyzing the multifactor experiment</a>
<ul>
<li class="chapter" data-level="13.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#bundling"><i class="fa fa-check"></i><b>13.1</b> Bundling</a></li>
<li class="chapter" data-level="13.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregation"><i class="fa fa-check"></i><b>13.2</b> Aggregation</a></li>
<li class="chapter" data-level="13.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#regression-summarization"><i class="fa fa-check"></i><b>13.3</b> Regression Summarization</a></li>
<li class="chapter" data-level="13.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focus-on-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>13.4</b> Focus on subset, kick rest to supplement</a></li>
<li class="chapter" data-level="13.5" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>13.5</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="13.6" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#a-demonstration-of-visualization"><i class="fa fa-check"></i><b>13.6</b> A demonstration of visualization</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#the-initial-analysis"><i class="fa fa-check"></i><b>13.6.1</b> The initial analysis</a></li>
<li class="chapter" data-level="13.6.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focusing-on-validity"><i class="fa fa-check"></i><b>13.6.2</b> Focusing on validity</a></li>
<li class="chapter" data-level="13.6.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#looking-at-main-effects"><i class="fa fa-check"></i><b>13.6.3</b> Looking at main effects</a></li>
<li class="chapter" data-level="13.6.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#recap"><i class="fa fa-check"></i><b>13.6.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#exercises-7"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>14.1</b> The data generating process</a></li>
<li class="chapter" data-level="14.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>14.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="14.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>14.3</b> The simulation itself</a></li>
<li class="chapter" data-level="14.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>14.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="14.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>14.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="14.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>14.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>15</b> Presentation of simulation results</a>
<ul>
<li class="chapter" data-level="15.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>15.1</b> Tabulation</a></li>
<li class="chapter" data-level="15.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>15.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>15.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="15.2.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>15.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="15.2.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>15.2.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>15.3</b> Modeling</a></li>
</ul></li>
<li class="part"><span><b>IV Common Challenges with Large-Scale Simulations</b></span></li>
<li class="chapter" data-level="16" data-path="sec-reproducability.html"><a href="sec-reproducability.html"><i class="fa fa-check"></i><b>16</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="16.1" data-path="sec-reproducability.html"><a href="sec-reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>16.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="16.2" data-path="sec-reproducability.html"><a href="sec-reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>16.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="16.3" data-path="sec-reproducability.html"><a href="sec-reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>16.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>17</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="17.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>17.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="17.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>17.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="17.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>17.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>18</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="18.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>18.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#making-a-safe-function-call"><i class="fa fa-check"></i><b>18.1.1</b> Making a safe function call</a></li>
<li class="chapter" data-level="18.1.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>18.1.2</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#about-stopifnot"><i class="fa fa-check"></i><b>18.2</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>19</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="19.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>19.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="19.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>19.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="19.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>19.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="19.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>19.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>20</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="20.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>20.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="20.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>20.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>20.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="20.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>20.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="20.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>20.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="20.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>20.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="20.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>20.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="20.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>20.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>21</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="21.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-extensive-multi-factor-simulations"><i class="fa fa-check"></i><b>21.1</b> Use extensive multi-factor simulations</a></li>
<li class="chapter" data-level="21.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#beat-them-at-their-own-game"><i class="fa fa-check"></i><b>21.2</b> Beat them at their own game</a></li>
<li class="chapter" data-level="21.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrated-simulations"><i class="fa fa-check"></i><b>21.3</b> Calibrated simulations</a></li>
</ul></li>
<li class="part"><span><b>V Specialized Use-Cases</b></span></li>
<li class="chapter" data-level="22" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>22</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="22.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>22.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="22.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-2"><i class="fa fa-check"></i><b>22.2</b> The data generating process</a></li>
<li class="chapter" data-level="22.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-1"><i class="fa fa-check"></i><b>22.3</b> Running the simulation</a></li>
<li class="chapter" data-level="22.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>22.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>22.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="22.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>22.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="22.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>22.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="22.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>22.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html"><i class="fa fa-check"></i><b>23</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="23.1" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>23.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="23.2" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>23.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="23.3" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>23.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="23.4" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>23.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="24.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>24.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="on-functions.html"><a href="on-functions.html"><i class="fa fa-check"></i><b>A</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="A.1" data-path="on-functions.html"><a href="on-functions.html#repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> Other ways of repeating yourself</a></li>
<li class="chapter" data-level="A.2" data-path="on-functions.html"><a href="on-functions.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="on-functions.html"><a href="on-functions.html#testing-and-debugging-code-in-your-scripts"><i class="fa fa-check"></i><b>A.3</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="A.4" data-path="on-functions.html"><a href="on-functions.html#keep-multiple-files-of-code"><i class="fa fa-check"></i><b>A.4</b> Keep multiple files of code</a></li>
<li class="chapter" data-level="A.5" data-path="on-functions.html"><a href="on-functions.html#the-source-command-and-keeping-things-organized"><i class="fa fa-check"></i><b>A.5</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="A.6" data-path="on-functions.html"><a href="on-functions.html#debugging-with-browser"><i class="fa fa-check"></i><b>A.6</b> Debugging with browser</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyzing-the-multifactor-experiment" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> Analyzing the multifactor experiment<a href="analyzing-the-multifactor-experiment.html#analyzing-the-multifactor-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Once we have performance measures for all our simulation scenarios, how do we explore them?
For our Cluster RCT simulation, we have 270 different simulation runs across our factors (with three rows per simulation run, one for each method).
How can we visualize and understand trends across this complex domain?</p>
<p>There are several techniques for summarizing across the data that one might use.</p>
<div id="bundling" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Bundling<a href="analyzing-the-multifactor-experiment.html#bundling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As a first step, we might bundle the simulations by the primary factors of interest.
We would then plot these bundles as box plots to see central tendency along with variation.
With bundling, we would need a good number of simulation runs per scenario, so that the MCSE in the performance measures does not make our boxplots look substantially more variable than the truth.</p>
<p>For example, as a first step to understanding bias, we might bundle our results by ICC.
In this code we are making groups of method by ICC level so we get side-by-side boxplots for each ICC level considered:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="analyzing-the-multifactor-experiment.html#cb289-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">&quot;results/simulation_CRT.rds&quot;</span> )</span>
<span id="cb289-2"><a href="analyzing-the-multifactor-experiment.html#cb289-2" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb289-3"><a href="analyzing-the-multifactor-experiment.html#cb289-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span> size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb289-4"><a href="analyzing-the-multifactor-experiment.html#cb289-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb289-5"><a href="analyzing-the-multifactor-experiment.html#cb289-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb289-6"><a href="analyzing-the-multifactor-experiment.html#cb289-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb289-7"><a href="analyzing-the-multifactor-experiment.html#cb289-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( sres<span class="sc">$</span>ICC) )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v1-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Each box is a collection of simulation trials. E.g., for <code>ICC = 0.6</code>, <code>size_coef = 0.2</code>, and <code>alpha = 0.8</code> we have 9 scenarios representing the varying level 1 and level 2 sample sizes:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="analyzing-the-multifactor-experiment.html#cb290-1" tabindex="-1"></a><span class="fu">filter</span>( sres, ICC <span class="sc">==</span> <span class="fl">0.6</span>, size_coef <span class="sc">==</span> <span class="fl">0.2</span>,</span>
<span id="cb290-2"><a href="analyzing-the-multifactor-experiment.html#cb290-2" tabindex="-1"></a>        alpha <span class="sc">==</span> <span class="fl">0.8</span>, method<span class="sc">==</span><span class="st">&quot;Agg&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb290-3"><a href="analyzing-the-multifactor-experiment.html#cb290-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( n_bar<span class="sc">:</span>alpha, bias )</span></code></pre></div>
<pre><code>## # A tibble: 9 × 7
##   n_bar     J   ATE size_coef   ICC alpha     bias
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1    20     5   0.2       0.2   0.6   0.8  0.00799
## 2    20    20   0.2       0.2   0.6   0.8 -0.0445 
## 3    20    80   0.2       0.2   0.6   0.8  0.0206 
## 4    80     5   0.2       0.2   0.6   0.8  0.111  
## 5    80    20   0.2       0.2   0.6   0.8 -0.0144 
## 6    80    80   0.2       0.2   0.6   0.8  0.0132 
## 7   320     5   0.2       0.2   0.6   0.8  0.151  
## 8   320    20   0.2       0.2   0.6   0.8  0.0361 
## 9   320    80   0.2       0.2   0.6   0.8  0.0394</code></pre>
<p>We are seeing a few outliers for some of the boxplots, suggesting that there are other factors driving bias. We could try bundling along different aspects to see:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="analyzing-the-multifactor-experiment.html#cb292-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(n_bar), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(n_bar,method) ) ) <span class="sc">+</span></span>
<span id="cb292-2"><a href="analyzing-the-multifactor-experiment.html#cb292-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb292-3"><a href="analyzing-the-multifactor-experiment.html#cb292-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb292-4"><a href="analyzing-the-multifactor-experiment.html#cb292-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb292-5"><a href="analyzing-the-multifactor-experiment.html#cb292-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v2-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>No progress there. Perhaps it is instability or MCSE.
We make a note to investigate further, later on.</p>
</div>
<div id="aggregation" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Aggregation<a href="analyzing-the-multifactor-experiment.html#aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The boxplots are hard for seeing trends.
Instead of bundling, we can therefore aggregate, to look at overall trends rather than individual simulation variation.
This is especially important if the number of replicates within each scenario is small, because then each scenario’s performance is measured with a lot of error.</p>
<p>With aggregation, we average over some of the factors, collapsing our simulation results down to fewer moving parts.
This is better than having not had those factors in the first place!
Averaging over a factor is a more general answer than having not varied the factor at all.</p>
<p>For example, if we average across ICC and site variation, and see how the methods change performance as a function of <span class="math inline">\(J\)</span>, we would know that this is a general trend across a range of scenarios defined by different ICC and site variation levels.
Our conclusions would then be more general than if we picked a single ICC and amount of site variation: in this latter case we would not know if we would see our trend more broadly.</p>
<p>Also, with aggregation, we can have a smaller number of replications per factor combination.
The averaging will, in effect, give a lot more reps per aggregated performance measure.</p>
<p>A caution with aggregation is that it can be deceitful if you have scaling issues or extreme outliers.
With bias, our scale is fairly well set, so we are good!
But if we were aggregating standard errors over sample size, then the larger standard errors of the smaller sample size simulations (and the greater variability in estimating those standard errors) would swamp the standard errors of the larger sample sizes.
Usually, with aggregation, we want to average over something we believe will not change massively over the marginalized-out factors.
Alternatively, we can average over a relative measure, which tend to be more invariant and comparable across scenarios.</p>
<p>For our cluster RCT, we might aggregate as follows:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="analyzing-the-multifactor-experiment.html#cb293-1" tabindex="-1"></a>ssres <span class="ot">&lt;-</span> </span>
<span id="cb293-2"><a href="analyzing-the-multifactor-experiment.html#cb293-2" tabindex="-1"></a>  sres <span class="sc">%&gt;%</span> </span>
<span id="cb293-3"><a href="analyzing-the-multifactor-experiment.html#cb293-3" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, method, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb293-4"><a href="analyzing-the-multifactor-experiment.html#cb293-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">bias =</span> <span class="fu">mean</span>( bias ) )</span>
<span id="cb293-5"><a href="analyzing-the-multifactor-experiment.html#cb293-5" tabindex="-1"></a></span>
<span id="cb293-6"><a href="analyzing-the-multifactor-experiment.html#cb293-6" tabindex="-1"></a><span class="fu">ggplot</span>( ssres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb293-7"><a href="analyzing-the-multifactor-experiment.html#cb293-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb293-8"><a href="analyzing-the-multifactor-experiment.html#cb293-8" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span> </span>
<span id="cb293-9"><a href="analyzing-the-multifactor-experiment.html#cb293-9" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span></span>
<span id="cb293-10"><a href="analyzing-the-multifactor-experiment.html#cb293-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb293-11"><a href="analyzing-the-multifactor-experiment.html#cb293-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-156-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>This shows that site variation leads to greater bias, but only if the coefficient for size is nonzero.
We also see that all the estimators must be the same if site variation is 0, with the overplotted lines on the top row of the figure.</p>
</div>
<div id="regression-summarization" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Regression Summarization<a href="analyzing-the-multifactor-experiment.html#regression-summarization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One can treat the simulation results as a dataset in its own right.
In this case we can regress a performance measure against the methods and various factor levels to get “main effects” of how the different levels impact performance holding the other levels constant.
The main effect of the method will tell us if a method is, on average, higher or lower than the baseline method.
The main effect of the factors will tell us if that factor impacts the performance measure.</p>
<p>These regressions can also include interactions between method and factor, to see if some factors impact different methods differently.
They can also include interactions between factors, which allows us to explore how the impact of a factor can matter more or less, depending on other aspects of the context.</p>
<p>For our cluster RCT, we might have, for example:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="analyzing-the-multifactor-experiment.html#cb294-1" tabindex="-1"></a>sres_f <span class="ot">=</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="analyzing-the-multifactor-experiment.html#cb294-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="fu">across</span>( <span class="fu">c</span>( n_bar, J, size_coef, ICC, alpha ), factor ) )</span>
<span id="cb294-3"><a href="analyzing-the-multifactor-experiment.html#cb294-3" tabindex="-1"></a></span>
<span id="cb294-4"><a href="analyzing-the-multifactor-experiment.html#cb294-4" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>( bias <span class="sc">~</span> (n_bar <span class="sc">+</span> J <span class="sc">+</span> size_coef <span class="sc">+</span> ICC <span class="sc">+</span> alpha) <span class="sc">*</span> method, </span>
<span id="cb294-5"><a href="analyzing-the-multifactor-experiment.html#cb294-5" tabindex="-1"></a>         <span class="at">data =</span> sres_f )</span>
<span id="cb294-6"><a href="analyzing-the-multifactor-experiment.html#cb294-6" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(M, <span class="at">type =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb294-7"><a href="analyzing-the-multifactor-experiment.html#cb294-7" tabindex="-1"></a>                     <span class="at">single.row =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## 
## ==================================================
##                            Dependent variable:    
##                        ---------------------------
##                                   bias            
## --------------------------------------------------
## n_bar80                      -0.009 (0.007)       
## n_bar320                     -0.006 (0.007)       
## J20                           0.004 (0.007)       
## J80                           0.006 (0.007)       
## size_coef0.2                -0.035*** (0.006)     
## ICC0.2                       -0.004 (0.009)       
## ICC0.4                       -0.002 (0.009)       
## ICC0.6                       -0.003 (0.009)       
## ICC0.8                        0.001 (0.009)       
## alpha0.5                    0.055*** (0.007)      
## alpha0.8                    0.053*** (0.007)      
## methodLR                     -0.007 (0.014)       
## methodMLM                     0.006 (0.014)       
## n_bar80:methodLR             -0.001 (0.010)       
## n_bar320:methodLR             0.001 (0.010)       
## n_bar80:methodMLM            -0.001 (0.010)       
## n_bar320:methodMLM           -0.002 (0.010)       
## J20:methodLR                  0.006 (0.010)       
## J80:methodLR                  0.005 (0.010)       
## J20:methodMLM                 0.002 (0.010)       
## J80:methodMLM                 0.002 (0.010)       
## size_coef0.2:methodLR       0.030*** (0.008)      
## size_coef0.2:methodMLM        0.006 (0.008)       
## ICC0.2:methodLR               0.003 (0.013)       
## ICC0.4:methodLR              0.0004 (0.013)       
## ICC0.6:methodLR               0.005 (0.013)       
## ICC0.8:methodLR               0.002 (0.013)       
## ICC0.2:methodMLM             -0.006 (0.013)       
## ICC0.4:methodMLM             -0.008 (0.013)       
## ICC0.6:methodMLM             -0.008 (0.013)       
## ICC0.8:methodMLM             -0.008 (0.013)       
## alpha0.5:methodLR            -0.007 (0.010)       
## alpha0.8:methodLR             0.004 (0.010)       
## alpha0.5:methodMLM           -0.002 (0.010)       
## alpha0.8:methodMLM           -0.0003 (0.010)      
## Constant                    -0.034*** (0.010)     
## --------------------------------------------------
## Observations                       810            
## R2                                0.302           
## Adjusted R2                       0.270           
## Residual Std. Error         0.046 (df = 774)      
## F Statistic              9.547*** (df = 35; 774)  
## ==================================================
## Note:                  *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<p>We can quickly get a lot of features, and this approach can be hard to interpret. But picking out the significant coefficents does provide a lot of clues, rather rapidly.
E.g., many features interact with the LR method for bias. The other methods seem less impacted.</p>
</div>
<div id="focus-on-subset-kick-rest-to-supplement" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Focus on subset, kick rest to supplement<a href="analyzing-the-multifactor-experiment.html#focus-on-subset-kick-rest-to-supplement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Frequently researchers might simply filter the simulation results to a single factor level for some nuisance parameter.
For example, we might examine ICC of 0.20 only, as this is a “reasonable” value given substance matter knowledge.
We would then consider the other levels as a “sensitivity” analysis vaguely alluded to in our main report and placed elsewhere, such as an online supplemental appendix.</p>
<p>It would be our job, in this case, to verify that our reported findings on the main results indeed were echoed in our other, set-aside, simulation runs.</p>
</div>
<div id="analyzing-results-when-some-trials-have-failed" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">13.5</span> Analyzing results when some trials have failed<a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If methods fail, then this is something to investigate in its own right.
Ideally, failure is not too common, so we can drop those trials, or keep them, without really impacting our overall results.
But one should at least know what one is ignoring.</p>
<p>For example, in our cluster RCT, we know we have, at least sometimes, convergence issues.
We know that ICC is an important feature, so we can explore how often we get a convergence message by ICC level:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="analyzing-the-multifactor-experiment.html#cb296-1" tabindex="-1"></a>res <span class="sc">%&gt;%</span> </span>
<span id="cb296-2"><a href="analyzing-the-multifactor-experiment.html#cb296-2" tabindex="-1"></a>  <span class="fu">group_by</span>( method, ICC ) <span class="sc">%&gt;%</span></span>
<span id="cb296-3"><a href="analyzing-the-multifactor-experiment.html#cb296-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">message =</span> <span class="fu">mean</span>( message ) ) <span class="sc">%&gt;%</span></span>
<span id="cb296-4"><a href="analyzing-the-multifactor-experiment.html#cb296-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>( <span class="at">names_from =</span> <span class="st">&quot;method&quot;</span>, <span class="at">values_from=</span><span class="st">&quot;message&quot;</span> )</span></code></pre></div>
<pre><code>## Warning: There were 15 warnings in `summarise()`.
## The first warning was:
## ℹ In argument: `message = mean(message)`.
## ℹ In group 1: `method = &quot;Agg&quot;` and `ICC = 0`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
## ℹ Run `dplyr::last_dplyr_warnings()` to see the
##   14 remaining warnings.</code></pre>
<pre><code>## # A tibble: 5 × 4
##     ICC   Agg    LR   MLM
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0      NA    NA    NA
## 2   0.2    NA    NA    NA
## 3   0.4    NA    NA    NA
## 4   0.6    NA    NA    NA
## 5   0.8    NA    NA    NA</code></pre>
<p>We see that when the ICC is 0 we get a lot of convergence issues, but as soon as we pull away from 0 it drops off considerably.
At this point we might decide to drop those runs with a message or keep them.
In this case, we decide to keep.
It shouldn’t matter much in any case except the ICC = 0 case, and we know the convergence is due to trying to estimate a 0 variance, and thus is in some sense expected.
Furthermore, we know people using these methods would likely ignore these messages, and thus we are faithfully capturing how these methods would be used in practice.
We might eventually, however, want to do a separate analysis of the ICC = 0 context to see if the MLM approach actually falls apart, or if it is just throwing error messages.</p>
</div>
<div id="a-demonstration-of-visualization" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> A demonstration of visualization<a href="analyzing-the-multifactor-experiment.html#a-demonstration-of-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We next explore a case study comparing different visualizations of the same performance metric (in this case, power).
The goal is to see how to examine a metric from several perspectives, and to see how to explore simulation results across scenarios.</p>
<p>For this example, we are going to look at a randomized experiment.
We will generate control potential outcomes, and then add a treatment effect to the treated units.
We assume the control group is normally distributed.
We will generate a random data set, estimate the
treatment effect by taking the difference in means and calculating the
associated standard error, and generating a <span class="math inline">\(p\)</span>-value using the normal
approximation. (As we will see, this is not a good idea for small sample
size since we should be using a <span class="math inline">\(t\)</span>-test style approach.)</p>
<p>Violating our usual modular approach, we ae going to have a single function that does an entire step: it generates two groups of the given sizes, one treatment and
one control, and then calculates the difference in means. It will then test
this difference using the normal approximation.</p>
<p>The function also calculates and returns the true effect size of the DGP as the true treatment
effect divided by the control standard deviation (useful for understanding
power, shown later on).</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="analyzing-the-multifactor-experiment.html#cb299-1" tabindex="-1"></a>run.one <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sdC, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">sdTau =</span> <span class="dv">0</span> ) {</span>
<span id="cb299-2"><a href="analyzing-the-multifactor-experiment.html#cb299-2" tabindex="-1"></a>  Y0 <span class="ot">=</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>( nC, <span class="at">sd=</span>sdC )</span>
<span id="cb299-3"><a href="analyzing-the-multifactor-experiment.html#cb299-3" tabindex="-1"></a>  Y1 <span class="ot">=</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>( nT, <span class="at">sd=</span>sdC ) <span class="sc">+</span> tau <span class="sc">+</span> <span class="fu">rnorm</span>( nT, <span class="at">sd=</span>sdTau )</span>
<span id="cb299-4"><a href="analyzing-the-multifactor-experiment.html#cb299-4" tabindex="-1"></a></span>
<span id="cb299-5"><a href="analyzing-the-multifactor-experiment.html#cb299-5" tabindex="-1"></a>  tau.hat <span class="ot">=</span> <span class="fu">mean</span>( Y1 ) <span class="sc">-</span> <span class="fu">mean</span>( Y0 )</span>
<span id="cb299-6"><a href="analyzing-the-multifactor-experiment.html#cb299-6" tabindex="-1"></a>  SE.hat <span class="ot">=</span> <span class="fu">sqrt</span>( <span class="fu">var</span>( Y0 ) <span class="sc">/</span> ( nC ) <span class="sc">+</span> <span class="fu">var</span>( Y1 ) <span class="sc">/</span> ( nT ) )</span>
<span id="cb299-7"><a href="analyzing-the-multifactor-experiment.html#cb299-7" tabindex="-1"></a></span>
<span id="cb299-8"><a href="analyzing-the-multifactor-experiment.html#cb299-8" tabindex="-1"></a>  z <span class="ot">=</span> tau.hat <span class="sc">/</span> SE.hat</span>
<span id="cb299-9"><a href="analyzing-the-multifactor-experiment.html#cb299-9" tabindex="-1"></a>  pv <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>( <span class="fu">abs</span>( z ) ))</span>
<span id="cb299-10"><a href="analyzing-the-multifactor-experiment.html#cb299-10" tabindex="-1"></a></span>
<span id="cb299-11"><a href="analyzing-the-multifactor-experiment.html#cb299-11" tabindex="-1"></a>  <span class="fu">data.frame</span>( <span class="at">tau.hat =</span> tau.hat, <span class="at">SE.hat =</span> SE.hat, <span class="at">z=</span>z, <span class="at">p.value=</span>pv )</span>
<span id="cb299-12"><a href="analyzing-the-multifactor-experiment.html#cb299-12" tabindex="-1"></a>}</span></code></pre></div>
<p>Our function generates a data set, analyzes it, and give us back a variety
of results as a one-row dataframe, as per usual:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="analyzing-the-multifactor-experiment.html#cb300-1" tabindex="-1"></a><span class="fu">run.one</span>( <span class="at">nT=</span><span class="dv">5</span>, <span class="at">nC=</span><span class="dv">10</span>, <span class="at">sdC=</span><span class="dv">1</span>, <span class="at">tau=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##     tau.hat    SE.hat          z   p.value
## 1 -0.246767 0.6607213 -0.3734812 0.7087903</code></pre>
<p>In this case, our results are a mix of the parameters and estimated quantities.</p>
<p>We then write a function that runs our single trial multiple times and
summarizes the results:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="analyzing-the-multifactor-experiment.html#cb302-1" tabindex="-1"></a>run.experiment <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sdC, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">sdTau =</span> <span class="dv">0</span>, <span class="at">R =</span> <span class="dv">500</span> ) {</span>
<span id="cb302-2"><a href="analyzing-the-multifactor-experiment.html#cb302-2" tabindex="-1"></a></span>
<span id="cb302-3"><a href="analyzing-the-multifactor-experiment.html#cb302-3" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">replicate</span>( R, <span class="fu">run.one</span>( nC, nT, sdC, tau, <span class="at">sdTau=</span>sdTau, <span class="at">mu=</span>mu ), </span>
<span id="cb302-4"><a href="analyzing-the-multifactor-experiment.html#cb302-4" tabindex="-1"></a>                    <span class="at">simplify=</span><span class="cn">FALSE</span> )</span>
<span id="cb302-5"><a href="analyzing-the-multifactor-experiment.html#cb302-5" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">bind_rows</span>( eres )</span>
<span id="cb302-6"><a href="analyzing-the-multifactor-experiment.html#cb302-6" tabindex="-1"></a>  eres <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">E.tau.hat =</span> <span class="fu">mean</span>( tau.hat ),</span>
<span id="cb302-7"><a href="analyzing-the-multifactor-experiment.html#cb302-7" tabindex="-1"></a>                      <span class="at">E.SE.hat =</span> <span class="fu">mean</span>( SE.hat ),</span>
<span id="cb302-8"><a href="analyzing-the-multifactor-experiment.html#cb302-8" tabindex="-1"></a>                      <span class="at">power =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb302-9"><a href="analyzing-the-multifactor-experiment.html#cb302-9" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sdC=</span>sdC, <span class="at">tau=</span>tau, <span class="at">mu=</span>mu, <span class="at">sdTau=</span>sdTau, <span class="at">R=</span>R )</span>
<span id="cb302-10"><a href="analyzing-the-multifactor-experiment.html#cb302-10" tabindex="-1"></a>}</span></code></pre></div>
<p>For performance, we have the average average treatment effect estimate <code>E.tau.hat</code>,
the average Standard Error estimate <code>E.SE.hat</code>,
and the power <code>power</code> (defined as the percent of time we reject at
alpha=0.05, i.e., the percent of times our <span class="math inline">\(p\)</span>-value was less than our 0.05
threshold):</p>
<p>Our function also adds in the details of the simulation (the parameters we passed
to the <code>run.one()</code> call). This is an easy way to keep track of things.</p>
<p>We test our function to see what we get:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="analyzing-the-multifactor-experiment.html#cb303-1" tabindex="-1"></a><span class="fu">run.experiment</span>( <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.2</span> )</span></code></pre></div>
<pre><code>##   E.tau.hat  E.SE.hat power nC nT sdC tau mu
## 1  0.497077 0.6284977 0.218 10  3   1 0.5  5
##   sdTau   R
## 1   0.2 500</code></pre>
<p>We next use the above to run a <em>multi-factor simulation experiment</em>. We are
going to vary four factors: control group size, treatment group size,
standard deviation of the units, and the treatment effect.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="analyzing-the-multifactor-experiment.html#cb305-1" tabindex="-1"></a>nC <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb305-2"><a href="analyzing-the-multifactor-experiment.html#cb305-2" tabindex="-1"></a>nT <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb305-3"><a href="analyzing-the-multifactor-experiment.html#cb305-3" tabindex="-1"></a>sdC <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">1</span> )</span>
<span id="cb305-4"><a href="analyzing-the-multifactor-experiment.html#cb305-4" tabindex="-1"></a>tau <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span> )</span>
<span id="cb305-5"><a href="analyzing-the-multifactor-experiment.html#cb305-5" tabindex="-1"></a>sdTau <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span> )</span>
<span id="cb305-6"><a href="analyzing-the-multifactor-experiment.html#cb305-6" tabindex="-1"></a></span>
<span id="cb305-7"><a href="analyzing-the-multifactor-experiment.html#cb305-7" tabindex="-1"></a>experiments <span class="ot">=</span> <span class="fu">expand_grid</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sdC=</span>sdC, <span class="at">tau=</span>tau, <span class="at">sdTau =</span> sdTau )</span>
<span id="cb305-8"><a href="analyzing-the-multifactor-experiment.html#cb305-8" tabindex="-1"></a>experiments</span></code></pre></div>
<pre><code>## # A tibble: 216 × 5
##       nC    nT   sdC   tau sdTau
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     2     2     1   0     0  
##  2     2     2     1   0     0.5
##  3     2     2     1   0.5   0  
##  4     2     2     1   0.5   0.5
##  5     2     2     1   1     0  
##  6     2     2     1   1     0.5
##  7     2     4     1   0     0  
##  8     2     4     1   0     0.5
##  9     2     4     1   0.5   0  
## 10     2     4     1   0.5   0.5
## # ℹ 206 more rows</code></pre>
<p>We next run an experiment for each row of our dataframe of experiment factor
combinations, and save the results.
Note our method of adding the design parametes into our results makes this step arguably moe clean than some of the other templates we have seen.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="analyzing-the-multifactor-experiment.html#cb307-1" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span> <span class="fu">pmap_df</span>( run.experiment, <span class="at">R=</span><span class="dv">2000</span> )</span>
<span id="cb307-2"><a href="analyzing-the-multifactor-experiment.html#cb307-2" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb307-3"><a href="analyzing-the-multifactor-experiment.html#cb307-3" tabindex="-1"></a><span class="fu">saveRDS</span>( exp.res, <span class="at">file=</span><span class="st">&quot;results/Neyman_RCT_results.rds&quot;</span> )</span></code></pre></div>
<p>The <code>R=500</code> after <code>run.experiment</code> passes the <em>same</em> parameter of <span class="math inline">\(R=500\)</span> to each
run (we run the same number of trials for each experiment).
We can put it there rather than have it be a column in our list of factors to run.</p>
<p>Here is a peek at our results:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="analyzing-the-multifactor-experiment.html#cb308-1" tabindex="-1"></a><span class="fu">head</span>( exp.res )</span></code></pre></div>
<pre><code>##      E.tau.hat  E.SE.hat  power nC nT sdC tau mu
## 1 -0.001525155 0.8818917 0.1975  2  2   1 0.0  5
## 2 -0.026286662 0.9307269 0.1915  2  2   1 0.0  5
## 3  0.485430674 0.8861287 0.2185  2  2   1 0.5  5
## 4  0.452375661 0.9363909 0.2095  2  2   1 0.5  5
## 5  1.029038283 0.8915091 0.3120  2  2   1 1.0  5
## 6  0.957434064 0.9347139 0.3025  2  2   1 1.0  5
##   sdTau    R
## 1   0.0 2000
## 2   0.5 2000
## 3   0.0 2000
## 4   0.5 2000
## 5   0.0 2000
## 6   0.5 2000</code></pre>
<div id="the-initial-analysis" class="section level3 hasAnchor" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> The initial analysis<a href="analyzing-the-multifactor-experiment.html#the-initial-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are ready to analyze.</p>
<p>We start with plotting.
Plotting is always a good way to vizualize simulation results.
We first make
our tau into a factor, so <code>ggplot</code> behaves, and then plot all our
experiments as two rows based on one factor (<code>sdTau</code>) with the columns being
another (<code>nT</code>). (This style of plotting a bunch of small plots is called
“many multiples” and is beloved by Tufte.) Within each plot we have the
x-axis for one factor (<code>nC</code>) and multiple lines for the final factor (<code>tau</code>).
The <span class="math inline">\(y\)</span>-axis is our outcome of interest, power. We add a 0.05 line to show
when we are rejecting at rates above our nominal <span class="math inline">\(\alpha\)</span>. This plot shows
the relationship of 5 variables.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="analyzing-the-multifactor-experiment.html#cb310-1" tabindex="-1"></a>exp.res <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">tau =</span> <span class="fu">as.factor</span>( tau ) )</span>
<span id="cb310-2"><a href="analyzing-the-multifactor-experiment.html#cb310-2" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb310-3"><a href="analyzing-the-multifactor-experiment.html#cb310-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>( sdTau <span class="sc">~</span> nT, <span class="at">labeller=</span>label_both ) <span class="sc">+</span></span>
<span id="cb310-4"><a href="analyzing-the-multifactor-experiment.html#cb310-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb310-5"><a href="analyzing-the-multifactor-experiment.html#cb310-5" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb310-6"><a href="analyzing-the-multifactor-experiment.html#cb310-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-164-1.png" width="75%" style="display: block; margin: auto;" />
We ae looking at power for different control and treatment group sizes. The tau is our treatment effect, and so for <span class="math inline">\(\tau = 0\)</span> we are looking at validity (false rejection of the null) and for the other <span class="math inline">\(\tau\)</span> power (noticing an effect when it is there).
Notice that we are seeing elevated rejection rates under the null for small and even moderate sample sizes!</p>
</div>
<div id="focusing-on-validity" class="section level3 hasAnchor" number="13.6.2">
<h3><span class="header-section-number">13.6.2</span> Focusing on validity<a href="analyzing-the-multifactor-experiment.html#focusing-on-validity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can zoom in on specific simulations run, to get some more detail
such as estimated power under the null for larger groups. Here we check
and we are seeing rejection rates (<code>power</code>) of around 0.05, which is what we want.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="analyzing-the-multifactor-experiment.html#cb311-1" tabindex="-1"></a><span class="fu">filter</span>( exp.res, tau<span class="sc">==</span><span class="dv">0</span>, nT <span class="sc">&gt;=</span> <span class="dv">50</span>, nC <span class="sc">&gt;=</span> <span class="dv">50</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="analyzing-the-multifactor-experiment.html#cb311-2" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">E.tau.hat</th>
<th align="right">E.SE.hat</th>
<th align="right">power</th>
<th align="right">nC</th>
<th align="right">nT</th>
<th align="right">sdC</th>
<th align="left">tau</th>
<th align="right">mu</th>
<th align="right">sdTau</th>
<th align="right">R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.20</td>
<td align="right">0.06</td>
<td align="right">50</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.21</td>
<td align="right">0.05</td>
<td align="right">50</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">50</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.05</td>
<td align="right">50</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.05</td>
<td align="right">500</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.16</td>
<td align="right">0.06</td>
<td align="right">500</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.07</td>
<td align="right">0.06</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
</tbody>
</table>
<p>We can get fancy and look at rejection rate (power under <code>tau = 0</code>) as a
function of both nC and nT using an interaction-style plot where we average over the other variables:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="analyzing-the-multifactor-experiment.html#cb312-1" tabindex="-1"></a>exp.res.rej <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">filter</span>( tau <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb312-2"><a href="analyzing-the-multifactor-experiment.html#cb312-2" tabindex="-1"></a>  <span class="fu">group_by</span>( nC, nT ) <span class="sc">%&gt;%</span></span>
<span id="cb312-3"><a href="analyzing-the-multifactor-experiment.html#cb312-3" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ) )</span>
<span id="cb312-4"><a href="analyzing-the-multifactor-experiment.html#cb312-4" tabindex="-1"></a></span>
<span id="cb312-5"><a href="analyzing-the-multifactor-experiment.html#cb312-5" tabindex="-1"></a>exp.res.rej <span class="ot">=</span> <span class="fu">mutate</span>( exp.res.rej, <span class="at">power =</span> <span class="fu">round</span>( power <span class="sc">*</span> <span class="dv">100</span> ) )</span>
<span id="cb312-6"><a href="analyzing-the-multifactor-experiment.html#cb312-6" tabindex="-1"></a></span>
<span id="cb312-7"><a href="analyzing-the-multifactor-experiment.html#cb312-7" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.rej, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>nT, <span class="at">col=</span><span class="fu">as.factor</span>(nT) ) ) <span class="sc">+</span></span>
<span id="cb312-8"><a href="analyzing-the-multifactor-experiment.html#cb312-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb312-9"><a href="analyzing-the-multifactor-experiment.html#cb312-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb312-10"><a href="analyzing-the-multifactor-experiment.html#cb312-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">40</span> ) ) <span class="sc">+</span></span>
<span id="cb312-11"><a href="analyzing-the-multifactor-experiment.html#cb312-11" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( exp.res.rej<span class="sc">$</span>nC ) ) <span class="sc">+</span></span>
<span id="cb312-12"><a href="analyzing-the-multifactor-experiment.html#cb312-12" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;# C&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Power&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;# T&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plot_interaction_Results-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>This plot focuses on the validity of our test.
It shows that we have massively elevated rates when either the number of treated or control units is small (10 or below).
It also shows that as the size of one group increases, if the other is small our rejection rates climb! Note how for 4 control units, the <span class="math inline">\(n_T = 500\)</span> line is above the others (except for the <span class="math inline">\(n_T = 2\)</span> line).</p>
</div>
<div id="looking-at-main-effects" class="section level3 hasAnchor" number="13.6.3">
<h3><span class="header-section-number">13.6.3</span> Looking at main effects<a href="analyzing-the-multifactor-experiment.html#looking-at-main-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can ignore all the other factors while we look at one specific factor of interest.
This is looking at the <strong>main effect</strong> or <strong>marginal effect</strong> of the factor.</p>
<p>The easy way to do this is to let <code>ggplot</code> smooth our individual points on a
plot. Be sure to also plot the individual points to see variation, however.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="analyzing-the-multifactor-experiment.html#cb313-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb313-2"><a href="analyzing-the-multifactor-experiment.html#cb313-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.02</span>, <span class="at">height=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb313-3"><a href="analyzing-the-multifactor-experiment.html#cb313-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb313-4"><a href="analyzing-the-multifactor-experiment.html#cb313-4" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb313-5"><a href="analyzing-the-multifactor-experiment.html#cb313-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotPool-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note how we see our individual runs that we marginalize over as the dots.</p>
<p>To look at our main effects we can also summarize our results, averaging our
experimental runs across other factor levels. For example, in the code below
we average over the different treatment group sizes and standard deviations,
and plot the marginalized results.</p>
<p>To marginalize, we group by the things we want to keep. <code>summarise()</code> then
averages over the things we want to get rid of.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="analyzing-the-multifactor-experiment.html#cb314-1" tabindex="-1"></a>exp.res.sum <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( nC, tau ) <span class="sc">%&gt;%</span></span>
<span id="cb314-2"><a href="analyzing-the-multifactor-experiment.html#cb314-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ) )</span>
<span id="cb314-3"><a href="analyzing-the-multifactor-experiment.html#cb314-3" tabindex="-1"></a><span class="fu">head</span>( exp.res.sum )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   nC [2]
##      nC tau   power
##   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
## 1     2 0     0.205
## 2     2 0.5   0.254
## 3     2 1     0.395
## 4     4 0     0.114
## 5     4 0.5   0.204
## 6     4 1     0.427</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="analyzing-the-multifactor-experiment.html#cb316-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.sum, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb316-2"><a href="analyzing-the-multifactor-experiment.html#cb316-2" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb316-3"><a href="analyzing-the-multifactor-experiment.html#cb316-3" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb316-4"><a href="analyzing-the-multifactor-experiment.html#cb316-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotCollapse-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We can try to get clever and look at other aspects of our experimental runs.
The above suggests that the smaller of the two groups is dictating things
going awry, in terms of elevated rejection rates under the null. We can also
look at things in terms of some other more easily interpretable parameter
(here we switch to effect size instead of raw treatment effect).</p>
<p>Given this, we might decide to look at total sample size or the smaller of
the two groups sample size and make plots that way (we are also subsetting to
just the <code>sd=1</code> cases as there is nothing really different about the two
options; we probably should average across but this could reduce clarity of
the presentation of results):</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="analyzing-the-multifactor-experiment.html#cb317-1" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">n =</span> nC <span class="sc">+</span> nT,</span>
<span id="cb317-2"><a href="analyzing-the-multifactor-experiment.html#cb317-2" tabindex="-1"></a>                               <span class="at">n.min =</span> <span class="fu">pmin</span>( nC, nT ) )</span></code></pre></div>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="analyzing-the-multifactor-experiment.html#cb318-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>n, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb318-2"><a href="analyzing-the-multifactor-experiment.html#cb318-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb318-3"><a href="analyzing-the-multifactor-experiment.html#cb318-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb318-4"><a href="analyzing-the-multifactor-experiment.html#cb318-4" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb318-5"><a href="analyzing-the-multifactor-experiment.html#cb318-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb318-6"><a href="analyzing-the-multifactor-experiment.html#cb318-6" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Total sample size&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotA-1.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="analyzing-the-multifactor-experiment.html#cb319-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>n.min, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb319-2"><a href="analyzing-the-multifactor-experiment.html#cb319-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb319-3"><a href="analyzing-the-multifactor-experiment.html#cb319-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb319-4"><a href="analyzing-the-multifactor-experiment.html#cb319-4" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb319-5"><a href="analyzing-the-multifactor-experiment.html#cb319-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb319-6"><a href="analyzing-the-multifactor-experiment.html#cb319-6" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Minimum group size&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotB-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note the few observations out in the high <code>n.min</code> region for the second
plot—this plot is a bit strange in that the different levels along the
x-axis are assymetric with respect to each other. It is not balanced.</p>
</div>
<div id="recap" class="section level3 hasAnchor" number="13.6.4">
<h3><span class="header-section-number">13.6.4</span> Recap<a href="analyzing-the-multifactor-experiment.html#recap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Overall, this exploration demonstrates the process of looking at a single performance metric (power) and refining a series of plots to get a sense of what the simulation is taking us.
There are many different plots we might choose, and this depends on the messages we are trying to convey.</p>
<p>The key is to explore, and see what you can learn!</p>
</div>
</div>
<div id="exercises-7" class="section level2 hasAnchor" number="13.7">
<h2><span class="header-section-number">13.7</span> Exercises<a href="analyzing-the-multifactor-experiment.html#exercises-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>For our cluster RCT, use the simulation results to assess how much better (or worse) the different methods are to each other in terms of confidence interval coverage. What scenarios tend to result in the worst coverage?</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exp-design.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-study-comparing-different-estimators.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/071-experimental-design-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
