<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Analyzing the multifactor experiment | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exp-design.html"/>
<link rel="next" href="case-study-comparing-different-estimators.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#standardization-in-the-dgp"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#different-kinds-of-performance"><i class="fa fa-check"></i><b>9.1</b> Different kinds of performance</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.2</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.2.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.2.2</b> Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.3.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.4</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.5</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.5.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.6</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.6.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.6.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.6.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-monte-carlo-standard-error"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercises (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-7"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="11" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>11</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>11.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="11.3" data-path="exp-design.html"><a href="exp-design.html#when-to-aggregate-results-across-multiple-simulations"><i class="fa fa-check"></i><b>11.3</b> When to aggregate results across multiple simulations</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>11.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="11.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>11.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="11.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>11.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>11.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html"><i class="fa fa-check"></i><b>12</b> Analyzing the multifactor experiment</a>
<ul>
<li class="chapter" data-level="12.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#ways-of-analyzing-simulation-results"><i class="fa fa-check"></i><b>12.1</b> Ways of analyzing simulation results</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#plot-everything-with-many-small-multiples"><i class="fa fa-check"></i><b>12.1.1</b> Plot everything with many small multiples</a></li>
<li class="chapter" data-level="12.1.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#bundling"><i class="fa fa-check"></i><b>12.1.2</b> Bundling</a></li>
<li class="chapter" data-level="12.1.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregation"><i class="fa fa-check"></i><b>12.1.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.1.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#regression-summarization"><i class="fa fa-check"></i><b>12.1.4</b> Regression Summarization</a></li>
<li class="chapter" data-level="12.1.5" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focus-on-a-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>12.1.5</b> Focus on a subset, kick rest to supplement</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>12.2</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="12.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#case-study-power-for-a-randomized-trial"><i class="fa fa-check"></i><b>12.3</b> Case study: power for a randomized trial</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#the-initial-analysis"><i class="fa fa-check"></i><b>12.3.1</b> The initial analysis</a></li>
<li class="chapter" data-level="12.3.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focusing-on-validity"><i class="fa fa-check"></i><b>12.3.2</b> Focusing on validity</a></li>
<li class="chapter" data-level="12.3.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregate-to-look-at-main-effects"><i class="fa fa-check"></i><b>12.3.3</b> Aggregate to look at main effects</a></li>
<li class="chapter" data-level="12.3.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#recap"><i class="fa fa-check"></i><b>12.3.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#exercises-8"><i class="fa fa-check"></i><b>12.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>13</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="13.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process"><i class="fa fa-check"></i><b>13.1</b> The data generating process</a></li>
<li class="chapter" data-level="13.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>13.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="13.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>13.3</b> The simulation itself</a></li>
<li class="chapter" data-level="13.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>13.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="13.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>13.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="13.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>13.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Presentation of simulation results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>14.1</b> Tabulation</a></li>
<li class="chapter" data-level="14.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>14.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>14.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="14.2.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>14.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="14.2.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>14.2.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>14.3</b> Modeling</a></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="15" data-path="sec-reproducability.html"><a href="sec-reproducability.html"><i class="fa fa-check"></i><b>15</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sec-reproducability.html"><a href="sec-reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>15.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="15.2" data-path="sec-reproducability.html"><a href="sec-reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>15.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="15.3" data-path="sec-reproducability.html"><a href="sec-reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>15.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>16</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="16.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>16.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="16.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>16.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="16.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>16.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>17</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="17.0.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>17.0.1</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>18</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="18.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>18.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="18.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>18.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="18.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>18.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="18.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>18.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>19</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>19.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="19.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>19.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>19.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="19.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>19.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="19.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>19.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="19.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>19.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="19.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>19.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="19.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>19.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>20</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="20.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>20.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>20.1.1</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="20.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>20.1.2</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="20.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>20.1.3</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="20.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>20.1.4</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="20.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>20.1.5</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="21" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>21</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="21.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>21.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="21.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>21.2</b> The data generating process</a></li>
<li class="chapter" data-level="21.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-1"><i class="fa fa-check"></i><b>21.3</b> Running the simulation</a></li>
<li class="chapter" data-level="21.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>21.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>21.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="21.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>21.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="21.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>21.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="21.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>21.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>22</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="22.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>22.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="22.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>22.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="22.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>22.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="22.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>22.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>23</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="23.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>23.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-source-command"><i class="fa fa-check"></i><b>A.3</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>A.4</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="A.5" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-browser-debugging"><i class="fa fa-check"></i><b>A.5</b> Debugging with browser</a></li>
<li class="chapter" data-level="A.6" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-stopifnot"><i class="fa fa-check"></i><b>A.6</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyzing-the-multifactor-experiment" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> Analyzing the multifactor experiment<a href="analyzing-the-multifactor-experiment.html#analyzing-the-multifactor-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="ways-of-analyzing-simulation-results" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Ways of analyzing simulation results<a href="analyzing-the-multifactor-experiment.html#ways-of-analyzing-simulation-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once we have performance measures for all our simulation scenarios, how do we explore them?
For our Cluster RCT simulation, we have 270 different simulation runs across our factors (with three rows per simulation run, one for each method).
How can we visualize and understand trends across this complex domain?</p>
<p>There are several techniques for summarizing across the data that one might use.</p>
<div id="plot-everything-with-many-small-multiples" class="section level3 hasAnchor" number="12.1.1">
<h3><span class="header-section-number">12.1.1</span> Plot everything with many small multiples<a href="analyzing-the-multifactor-experiment.html#plot-everything-with-many-small-multiples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you do not have too many different kinds of factor, you can simply plot all of your results at once.
For example, say we only ran simulations for our Cluster RCT simulation with <code>n_bar = 320</code> and <code>J = 20</code>.
Then we could plot everything like so:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="analyzing-the-multifactor-experiment.html#cb392-1" tabindex="-1"></a>sres_sub <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb392-2"><a href="analyzing-the-multifactor-experiment.html#cb392-2" tabindex="-1"></a>  <span class="fu">filter</span>( n_bar <span class="sc">==</span> <span class="dv">320</span>, J <span class="sc">==</span> <span class="dv">20</span> )</span>
<span id="cb392-3"><a href="analyzing-the-multifactor-experiment.html#cb392-3" tabindex="-1"></a><span class="fu">ggplot</span>( sres_sub, <span class="fu">aes</span>( alpha, bias, <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb392-4"><a href="analyzing-the-multifactor-experiment.html#cb392-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> ICC, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb392-5"><a href="analyzing-the-multifactor-experiment.html#cb392-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb392-6"><a href="analyzing-the-multifactor-experiment.html#cb392-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb392-7"><a href="analyzing-the-multifactor-experiment.html#cb392-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb392-8"><a href="analyzing-the-multifactor-experiment.html#cb392-8" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( sres<span class="sc">$</span>alpha) )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-268-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Each point is one of our methods in one of our simulation scenarios.
We are looking at the raw results.
We connect the points with lines to help us see trends within each of the mini-plots.
It also helps us visually track which group of points goes with which.</p>
<p>As a side note, this style of plotting, with a bunch of small plots, is called
“many small multiples” and is beloved by Tufte.
He likes it, in part, because in a single plot we can display 5 variables: our facets are organized by two (ICC and the size coefficient), and within each facet we have three (alpha, our outcome of bias, and the methods themselves).
Unfortunately, we quickly reach our limits of this approach if we have more factors than 5, which, in this case, we do.
We next present bundling, a way of using this core idea of showing raw results, but in a semi-aggregated way.</p>
</div>
<div id="bundling" class="section level3 hasAnchor" number="12.1.2">
<h3><span class="header-section-number">12.1.2</span> Bundling<a href="analyzing-the-multifactor-experiment.html#bundling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As a first step, we can bundle the simulations into groups defined by a selected primary factor of interest, and then plot each bundle with a boxplot of a selected performance criteria.
Each boxplot then shows the central measure of how well an estimator worked across those simulations, along with a sense of how much that performance varied across those simulations.
If the boxes are narrow, then we know that the variation across simulations within the box did not impact performance much.
If the boxes are wide, then we know that the factors that vary within the box matter a lot for performance.</p>
<p>With bundling, we would need a good number of simulation runs per scenario, so that the MCSE in the performance measures does not make our boxplots look substantially more variable (wider) than the truth.
(Consider a case where the simulations within a box all would have the same performance, but the MCSE is large; in this case we would see a wide boxplot when we should not.)</p>
<p>To illustrate, we next investigate bias in our running example on cluster RCTs.
We are going to group our results by method, ICC, the size coefficent (how strong the cluster size to treatment impact relationship is), and alpha (how much the site sizes vary).
For a specific ICC, size, and alpha, we will put the boxes for the three methods side-by-side to directly compare the methods in terms of bias.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="analyzing-the-multifactor-experiment.html#cb393-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb393-2"><a href="analyzing-the-multifactor-experiment.html#cb393-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span> size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb393-3"><a href="analyzing-the-multifactor-experiment.html#cb393-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb393-4"><a href="analyzing-the-multifactor-experiment.html#cb393-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb393-5"><a href="analyzing-the-multifactor-experiment.html#cb393-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb393-6"><a href="analyzing-the-multifactor-experiment.html#cb393-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( sres<span class="sc">$</span>ICC) )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v1-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>From our plot we see, for example, that there is virtually no bias for any method when the size coefficient is 0 and the ICC is 0.
It is a bit more unclear, but it seems there is also virtually no bias when the size coefficient is 0 regardless of ICC, but the boxes are wider making us wonder if something else is potentially going on.
When alpha is 0 and the size coefficient is 0.2, all methods have a negative bias for most scenarios considered, as all boxes and almost all of the whiskers are below the 0 line (when ICC is 0.6 or 0.8 we may have some instances of 0 or positive bias, if that is not MCSE giving long tails).</p>
<p>Each box is a collection of simulation trials. E.g., for <code>ICC = 0.6</code>, <code>size_coef = 0.2</code>, and <code>alpha = 0.8</code> each box contains 9 scenarios representing the varying level 1 and level 2 sample sizes.
Here are the 9 for the Aggregation method:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="analyzing-the-multifactor-experiment.html#cb394-1" tabindex="-1"></a><span class="fu">filter</span>( sres, ICC <span class="sc">==</span> <span class="fl">0.6</span>, size_coef <span class="sc">==</span> <span class="fl">0.2</span>,</span>
<span id="cb394-2"><a href="analyzing-the-multifactor-experiment.html#cb394-2" tabindex="-1"></a>        alpha <span class="sc">==</span> <span class="fl">0.8</span>, method<span class="sc">==</span><span class="st">&quot;Agg&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb394-3"><a href="analyzing-the-multifactor-experiment.html#cb394-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( n_bar<span class="sc">:</span>alpha, bias )</span></code></pre></div>
<pre><code>## # A tibble: 9 × 7
##   n_bar     J   ATE size_coef   ICC alpha     bias
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1    20     5   0.2       0.2   0.6   0.8 -6.60e-2
## 2    20    20   0.2       0.2   0.6   0.8  1.68e-2
## 3    20    80   0.2       0.2   0.6   0.8  1.02e-2
## 4    80     5   0.2       0.2   0.6   0.8  2.09e-3
## 5    80    20   0.2       0.2   0.6   0.8  2.98e-2
## 6    80    80   0.2       0.2   0.6   0.8 -9.26e-3
## 7   320     5   0.2       0.2   0.6   0.8  2.42e-2
## 8   320    20   0.2       0.2   0.6   0.8  9.93e-4
## 9   320    80   0.2       0.2   0.6   0.8  1.97e-3</code></pre>
<p>The apparent outliers (long tails) for some of the boxplots suggest that the other factors (cluster size and number of clusters) also relate to degree of bias. We could try bundling along different aspects to see:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="analyzing-the-multifactor-experiment.html#cb396-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(n_bar), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(n_bar,method) ) ) <span class="sc">+</span></span>
<span id="cb396-2"><a href="analyzing-the-multifactor-experiment.html#cb396-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb396-3"><a href="analyzing-the-multifactor-experiment.html#cb396-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb396-4"><a href="analyzing-the-multifactor-experiment.html#cb396-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb396-5"><a href="analyzing-the-multifactor-experiment.html#cb396-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v2-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>No progress there. Perhaps it is instability or MCSE.
In an actual analysis, we might then make a note to investigate these anomalies a bit further, later on.</p>
</div>
<div id="aggregation" class="section level3 hasAnchor" number="12.1.3">
<h3><span class="header-section-number">12.1.3</span> Aggregation<a href="analyzing-the-multifactor-experiment.html#aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The boxplots make seeing trends more difficult.
Instead of bundling, we can therefore aggregate, where we average all the scenarios within a box to get a single number of average performance, to look at overall trends rather than individual simulation variation.
Aggregation is especially important if the number of replicates within each scenario is small, because then each indiviua scenario’s performance is measured with a lot of error.</p>
<p>With aggregation, we average over some of the factors, collapsing our simulation results down to fewer moving parts.
Aggregation across factors is better than having not had those factors in the first place!
A performance measure averaged over a factor is a more general answer of how things work in pratice than having not varied the factor at all.</p>
<p>For example, if we average across ICC and site variation, and see how the methods change performance as a function of <span class="math inline">\(J\)</span>, we would know that this is a general trend across a range of scenarios defined by different ICC and site variation levels.
Our conclusions would then be more general than if we picked a single ICC and amount of site variation: in this latter case we would not know if we would see our trend more broadly.</p>
<p>Also, with aggregation, we can have a smaller number of replications per factor combination.
The averaging will, in effect, give a lot more replications per aggregated performance measure.</p>
<p>A caution with aggregation is that aggregated results can be misleading if you have scaling issues or extreme outliers.
With bias, our scale is fairly well set, so we are good.
But if we were aggregating standard errors over different sample sizes, then the larger standard errors of the smaller sample size simulations (and the greater variability in estimating those standard errors) would swamp the standard errors of the larger sample sizes.
Usually, with aggregation, we want to average over something we believe will not change massively over the marginalized-out factors.
Alternatively, we can average over a relative measure (such as standard error divided by the standard error of some baseline method), which tend to be more invariant and comparable across scenarios.</p>
<p>For our cluster RCT, we might aggregate our bias across some of our simulation factors as follows:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="analyzing-the-multifactor-experiment.html#cb397-1" tabindex="-1"></a>ssres <span class="ot">&lt;-</span> </span>
<span id="cb397-2"><a href="analyzing-the-multifactor-experiment.html#cb397-2" tabindex="-1"></a>  sres <span class="sc">%&gt;%</span> </span>
<span id="cb397-3"><a href="analyzing-the-multifactor-experiment.html#cb397-3" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, method, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb397-4"><a href="analyzing-the-multifactor-experiment.html#cb397-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">bias =</span> <span class="fu">mean</span>( bias ) )</span>
<span id="cb397-5"><a href="analyzing-the-multifactor-experiment.html#cb397-5" tabindex="-1"></a></span>
<span id="cb397-6"><a href="analyzing-the-multifactor-experiment.html#cb397-6" tabindex="-1"></a><span class="fu">ggplot</span>( ssres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb397-7"><a href="analyzing-the-multifactor-experiment.html#cb397-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb397-8"><a href="analyzing-the-multifactor-experiment.html#cb397-8" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span> </span>
<span id="cb397-9"><a href="analyzing-the-multifactor-experiment.html#cb397-9" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span></span>
<span id="cb397-10"><a href="analyzing-the-multifactor-experiment.html#cb397-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb397-11"><a href="analyzing-the-multifactor-experiment.html#cb397-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-270-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We see more clearly that site variation leads to greater bias, but only if the coefficient for size is nonzero (which makes sense given our theoretical understanding of the problem–if size is not related to treatment effect, it is hard to imagine how it would bias it).
We also see that all the estimators have near zero bias when thee is no variation in cluster size, with the overplotted lines on the top row of the figure.</p>
<p>We can also let ggplot aggregate directly by taking advantage of the smoothing options:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="analyzing-the-multifactor-experiment.html#cb398-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb398-2"><a href="analyzing-the-multifactor-experiment.html#cb398-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb398-3"><a href="analyzing-the-multifactor-experiment.html#cb398-3" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.25</span>,</span>
<span id="cb398-4"><a href="analyzing-the-multifactor-experiment.html#cb398-4" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.04</span>) ) <span class="sc">+</span></span>
<span id="cb398-5"><a href="analyzing-the-multifactor-experiment.html#cb398-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se=</span><span class="cn">FALSE</span> ) <span class="sc">+</span> </span>
<span id="cb398-6"><a href="analyzing-the-multifactor-experiment.html#cb398-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb398-7"><a href="analyzing-the-multifactor-experiment.html#cb398-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and
## formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-271-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>In the above, we let the original points show as well, to give a sense of the variation across simulation trials.</p>
</div>
<div id="regression-summarization" class="section level3 hasAnchor" number="12.1.4">
<h3><span class="header-section-number">12.1.4</span> Regression Summarization<a href="analyzing-the-multifactor-experiment.html#regression-summarization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One can treat the simulation results as a dataset in its own right.
In this case we can regress a performance measure against the methods and various factor levels to get “main effects” of how the different levels impact performance, holding the other levels constant.
This type of regression is called a “meta regression” (<span class="citation">Kleijnen (<a href="#ref-kleijnen1981regression">1981</a>)</span>,<span class="citation">Friedman and Pressman (<a href="#ref-friedman1988metamodel">1988</a>)</span>,<span class="citation">Gilbert and Miratrix (<a href="#ref-gilbert2024multilevel">2024</a>)</span>), as we are regressing on already processed results.
It also has ties to meta analysis (see, e.g., <span class="citation">Borenstein et al. (<a href="#ref-borenstein2021introduction">2021</a>)</span>), where we look for trends across sets of experiments.</p>
<p>In a meta regression, the main effect estimated for each method will tell us if a method is, on average, higher or lower than the baseline method, averaging across all the simulation scenarios.
The main effect of the factors will tell us if that factor impacts the performance measure.</p>
<p>These regressions can also include interactions between method and factor, to see if some factors impact different methods differently.
They can also include interactions between factors, which allows us to explore how the impact of a factor can matter more or less, depending on other aspects of the context.</p>
<p>For our cluster RCT, we might have, for example:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="analyzing-the-multifactor-experiment.html#cb400-1" tabindex="-1"></a><span class="co"># Make our simulation factors factors rather tha numeric values</span></span>
<span id="cb400-2"><a href="analyzing-the-multifactor-experiment.html#cb400-2" tabindex="-1"></a>sres_f <span class="ot">=</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb400-3"><a href="analyzing-the-multifactor-experiment.html#cb400-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="fu">across</span>( <span class="fu">c</span>( n_bar, J, size_coef, ICC, alpha ), factor ) )</span>
<span id="cb400-4"><a href="analyzing-the-multifactor-experiment.html#cb400-4" tabindex="-1"></a></span>
<span id="cb400-5"><a href="analyzing-the-multifactor-experiment.html#cb400-5" tabindex="-1"></a><span class="co"># Run the regression</span></span>
<span id="cb400-6"><a href="analyzing-the-multifactor-experiment.html#cb400-6" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lm</span>( bias <span class="sc">~</span> (n_bar <span class="sc">+</span> J <span class="sc">+</span> size_coef <span class="sc">+</span> ICC <span class="sc">+</span> alpha) <span class="sc">*</span> method, </span>
<span id="cb400-7"><a href="analyzing-the-multifactor-experiment.html#cb400-7" tabindex="-1"></a>         <span class="at">data =</span> sres_f )</span>
<span id="cb400-8"><a href="analyzing-the-multifactor-experiment.html#cb400-8" tabindex="-1"></a></span>
<span id="cb400-9"><a href="analyzing-the-multifactor-experiment.html#cb400-9" tabindex="-1"></a><span class="co"># View the results</span></span>
<span id="cb400-10"><a href="analyzing-the-multifactor-experiment.html#cb400-10" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(M, <span class="at">type =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb400-11"><a href="analyzing-the-multifactor-experiment.html#cb400-11" tabindex="-1"></a>                     <span class="at">single.row =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## 
## ==================================================
##                            Dependent variable:    
##                        ---------------------------
##                                   bias            
## --------------------------------------------------
## n_bar80                      -0.001 (0.006)       
## n_bar320                      0.003 (0.006)       
## J20                          -0.005 (0.006)       
## J80                          -0.006 (0.006)       
## size_coef0.2                  0.005 (0.005)       
## ICC0.2                        0.008 (0.008)       
## ICC0.4                        0.003 (0.008)       
## ICC0.6                        0.004 (0.008)       
## ICC0.8                        0.005 (0.008)       
## alpha0.5                     -0.003 (0.006)       
## alpha0.8                      0.006 (0.006)       
## methodLR                     -0.014 (0.012)       
## methodMLM                     0.002 (0.012)       
## n_bar80:methodLR              0.003 (0.009)       
## n_bar320:methodLR             0.001 (0.009)       
## n_bar80:methodMLM            -0.0003 (0.009)      
## n_bar320:methodMLM           -0.001 (0.009)       
## J20:methodLR                  0.005 (0.009)       
## J80:methodLR                  0.006 (0.009)       
## J20:methodMLM                 0.001 (0.009)       
## J80:methodMLM                 0.001 (0.009)       
## size_coef0.2:methodLR        0.018** (0.007)      
## size_coef0.2:methodMLM        0.003 (0.007)       
## ICC0.2:methodLR               0.002 (0.011)       
## ICC0.4:methodLR               0.001 (0.011)       
## ICC0.6:methodLR              -0.0004 (0.011)      
## ICC0.8:methodLR              -0.0001 (0.011)      
## ICC0.2:methodMLM             -0.005 (0.011)       
## ICC0.4:methodMLM             -0.005 (0.011)       
## ICC0.6:methodMLM             -0.006 (0.011)       
## ICC0.8:methodMLM             -0.006 (0.011)       
## alpha0.5:methodLR             0.006 (0.009)       
## alpha0.8:methodLR            0.019** (0.009)      
## alpha0.5:methodMLM            0.001 (0.009)       
## alpha0.8:methodMLM            0.003 (0.009)       
## Constant                     -0.002 (0.009)       
## --------------------------------------------------
## Observations                       810            
## R2                                0.075           
## Adjusted R2                       0.033           
## Residual Std. Error         0.041 (df = 774)      
## F Statistic              1.781*** (df = 35; 774)  
## ==================================================
## Note:                  *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<p>We can quickly get a lot of features, making a meta-regression somewhat hard to interpret.
But picking out the significant coefficents is a quick way to obtain a lot of clues as to what is driving performance.
E.g., many features interact with the LR method for bias.
The other two methods seem less impacted.</p>
</div>
<div id="focus-on-a-subset-kick-rest-to-supplement" class="section level3 hasAnchor" number="12.1.5">
<h3><span class="header-section-number">12.1.5</span> Focus on a subset, kick rest to supplement<a href="analyzing-the-multifactor-experiment.html#focus-on-a-subset-kick-rest-to-supplement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Frequently researchers might simply filter the simulation results to a single factor level for some nuisance parameter.
For example, we might examine ICC of 0.20 only, as this is a “reasonable” value that, given our substance matter knowledge, we know is frequently found in empirical data.
We would then consider the other levels as a “sensitivity” analysis vaguely alluded to in our main report and placed elsewhere, such as an online supplemental appendix.</p>
<p>It would be our job, in this case, to verify that our reported findings on the main results indeed were echoed in our other, set-aside, simulation runs.</p>
</div>
</div>
<div id="analyzing-results-when-some-trials-have-failed" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Analyzing results when some trials have failed<a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If methods fail, then this is something to investigate in its own right.
Ideally, failure is not too common, so we can drop those trials, or keep them, without really impacting our overall results.
But one should at least know what one is ignoring.</p>
<p>For example, in our cluster RCT, we know we have, at least sometimes, convergence issues.
We also know that ICC is an important feature, so we can explore how often we get a convergence message by ICC level:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="analyzing-the-multifactor-experiment.html#cb402-1" tabindex="-1"></a>res <span class="sc">%&gt;%</span> </span>
<span id="cb402-2"><a href="analyzing-the-multifactor-experiment.html#cb402-2" tabindex="-1"></a>  <span class="fu">group_by</span>( method, ICC ) <span class="sc">%&gt;%</span></span>
<span id="cb402-3"><a href="analyzing-the-multifactor-experiment.html#cb402-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">message =</span> <span class="fu">mean</span>( message ) ) <span class="sc">%&gt;%</span></span>
<span id="cb402-4"><a href="analyzing-the-multifactor-experiment.html#cb402-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>( <span class="at">names_from =</span> <span class="st">&quot;method&quot;</span>, <span class="at">values_from=</span><span class="st">&quot;message&quot;</span> )</span></code></pre></div>
<pre><code>## Warning: There were 15 warnings in `summarise()`.
## The first warning was:
## ℹ In argument: `message = mean(message)`.
## ℹ In group 1: `method = &quot;Agg&quot;` `ICC = 0`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
## ℹ Run `dplyr::last_dplyr_warnings()` to see the
##   14 remaining warnings.</code></pre>
<pre><code>## # A tibble: 5 × 4
##     ICC   Agg    LR   MLM
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0      NA    NA    NA
## 2   0.2    NA    NA    NA
## 3   0.4    NA    NA    NA
## 4   0.6    NA    NA    NA
## 5   0.8    NA    NA    NA</code></pre>
<p>We see that when the ICC is 0 we get a lot of convergence issues, but as soon as we pull away from 0 it drops off considerably.
At this point we might decide to drop those runs with a message or keep them.
In this case, we decide to keep.
It shouldn’t matter much in any case except the ICC = 0 case, and we know the convergence issues are driven by trying to estimate a 0 variance, and thus is in some sense expected.
Furthermore, we know people using these methods would likely ignore these messages, and thus we are faithfully capturing how these methods would be used in practice.
We might eventually, however, want to do a separate analysis of the ICC = 0 context to see if the MLM approach is actually falling apart, or if it is just throwing warnings.</p>
</div>
<div id="case-study-power-for-a-randomized-trial" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Case study: power for a randomized trial<a href="analyzing-the-multifactor-experiment.html#case-study-power-for-a-randomized-trial" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We next walk through a case study where we compare different visualizations of the same performance metric (in this case, power).
The goal is to see how to examine a metric from several perspectives, and to see how to explore simulation results across scenarios.</p>
<p>For this example, we are going to look at a randomized experiment.
We will generate control potential outcomes with a normal distribution, and then add a treatment effect to the treated units.</p>
<p>For our analytic approach, we will estimate the
treatment effect by taking the difference in means.
We will calculate the associated standard error and generate <span class="math inline">\(p\)</span>-values using the normal
approximation.
(As we will see, this is not a good idea for small sample sizes since we should be using a <span class="math inline">\(t\)</span>-test style approach.)</p>
<p>Violating our usual modular approach, we are going to have a single function that does an entire step: our function will generate the data and then analyze it all in one go.
Our function also calculates and returns the true effect size of the DGP as the true treatment
effect divided by the control standard deviation (this true effect size will be useful for understanding power, as we show later on).</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="analyzing-the-multifactor-experiment.html#cb405-1" tabindex="-1"></a>run.one <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sdC, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">sdTau =</span> <span class="dv">0</span> ) {</span>
<span id="cb405-2"><a href="analyzing-the-multifactor-experiment.html#cb405-2" tabindex="-1"></a>  Y0 <span class="ot">=</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>( nC, <span class="at">sd=</span>sdC )</span>
<span id="cb405-3"><a href="analyzing-the-multifactor-experiment.html#cb405-3" tabindex="-1"></a>  Y1 <span class="ot">=</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>( nT, <span class="at">sd=</span>sdC ) <span class="sc">+</span> tau <span class="sc">+</span> <span class="fu">rnorm</span>( nT, <span class="at">sd=</span>sdTau )</span>
<span id="cb405-4"><a href="analyzing-the-multifactor-experiment.html#cb405-4" tabindex="-1"></a></span>
<span id="cb405-5"><a href="analyzing-the-multifactor-experiment.html#cb405-5" tabindex="-1"></a>  tau.hat <span class="ot">=</span> <span class="fu">mean</span>( Y1 ) <span class="sc">-</span> <span class="fu">mean</span>( Y0 )</span>
<span id="cb405-6"><a href="analyzing-the-multifactor-experiment.html#cb405-6" tabindex="-1"></a>  SE.hat <span class="ot">=</span> <span class="fu">sqrt</span>( <span class="fu">var</span>( Y0 ) <span class="sc">/</span> ( nC ) <span class="sc">+</span> <span class="fu">var</span>( Y1 ) <span class="sc">/</span> ( nT ) )</span>
<span id="cb405-7"><a href="analyzing-the-multifactor-experiment.html#cb405-7" tabindex="-1"></a></span>
<span id="cb405-8"><a href="analyzing-the-multifactor-experiment.html#cb405-8" tabindex="-1"></a>  z <span class="ot">=</span> tau.hat <span class="sc">/</span> SE.hat</span>
<span id="cb405-9"><a href="analyzing-the-multifactor-experiment.html#cb405-9" tabindex="-1"></a>  pv <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>( <span class="fu">abs</span>( z ) ))</span>
<span id="cb405-10"><a href="analyzing-the-multifactor-experiment.html#cb405-10" tabindex="-1"></a></span>
<span id="cb405-11"><a href="analyzing-the-multifactor-experiment.html#cb405-11" tabindex="-1"></a>  <span class="fu">data.frame</span>( <span class="at">tau.hat =</span> tau.hat, <span class="at">SE.hat =</span> SE.hat, </span>
<span id="cb405-12"><a href="analyzing-the-multifactor-experiment.html#cb405-12" tabindex="-1"></a>              <span class="at">z =</span> z, <span class="at">p.value =</span> pv )</span>
<span id="cb405-13"><a href="analyzing-the-multifactor-experiment.html#cb405-13" tabindex="-1"></a>}</span></code></pre></div>
<p>Our function generates a data set, analyzes it, and give us back a variety
of results as a one-row dataframe, as per usual:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="analyzing-the-multifactor-experiment.html#cb406-1" tabindex="-1"></a><span class="fu">run.one</span>( <span class="at">nT=</span><span class="dv">5</span>, <span class="at">nC=</span><span class="dv">10</span>, <span class="at">sdC=</span><span class="dv">1</span>, <span class="at">tau=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##     tau.hat    SE.hat          z   p.value
## 1 -0.246767 0.6607213 -0.3734812 0.7087903</code></pre>
<p>In this case, our results are a mix of the parameters and estimated quantities.</p>
<p>We then write a function that runs our single trial multiple times and
summarizes the results:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="analyzing-the-multifactor-experiment.html#cb408-1" tabindex="-1"></a>run.experiment <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sdC, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">sdTau =</span> <span class="dv">0</span>, <span class="at">R =</span> <span class="dv">500</span> ) {</span>
<span id="cb408-2"><a href="analyzing-the-multifactor-experiment.html#cb408-2" tabindex="-1"></a>  </span>
<span id="cb408-3"><a href="analyzing-the-multifactor-experiment.html#cb408-3" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">replicate</span>( R, </span>
<span id="cb408-4"><a href="analyzing-the-multifactor-experiment.html#cb408-4" tabindex="-1"></a>                    <span class="fu">run.one</span>( nC, nT, sdC, tau, <span class="at">sdTau=</span>sdTau, <span class="at">mu=</span>mu ), </span>
<span id="cb408-5"><a href="analyzing-the-multifactor-experiment.html#cb408-5" tabindex="-1"></a>                    <span class="at">simplify=</span><span class="cn">FALSE</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb408-6"><a href="analyzing-the-multifactor-experiment.html#cb408-6" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb408-7"><a href="analyzing-the-multifactor-experiment.html#cb408-7" tabindex="-1"></a>  </span>
<span id="cb408-8"><a href="analyzing-the-multifactor-experiment.html#cb408-8" tabindex="-1"></a>  eres <span class="sc">%&gt;%</span> </span>
<span id="cb408-9"><a href="analyzing-the-multifactor-experiment.html#cb408-9" tabindex="-1"></a>    <span class="fu">summarise</span>( <span class="at">E.tau.hat =</span> <span class="fu">mean</span>( tau.hat ),</span>
<span id="cb408-10"><a href="analyzing-the-multifactor-experiment.html#cb408-10" tabindex="-1"></a>               <span class="at">E.SE.hat =</span> <span class="fu">mean</span>( SE.hat ),</span>
<span id="cb408-11"><a href="analyzing-the-multifactor-experiment.html#cb408-11" tabindex="-1"></a>               <span class="at">power =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb408-12"><a href="analyzing-the-multifactor-experiment.html#cb408-12" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sdC=</span>sdC, <span class="at">tau=</span>tau, <span class="at">mu=</span>mu, <span class="at">sdTau=</span>sdTau, <span class="at">R=</span>R )</span>
<span id="cb408-13"><a href="analyzing-the-multifactor-experiment.html#cb408-13" tabindex="-1"></a>}</span></code></pre></div>
<p>For performance, we have the average average treatment effect estimate <code>E.tau.hat</code>,
the average Standard Error estimate <code>E.SE.hat</code>,
and the power <code>power</code> (defined as the percent of time we reject at
alpha=0.05, i.e., the percent of times our <span class="math inline">\(p\)</span>-value was less than our 0.05
threshold):</p>
<p>Our function also adds in the details of the simulation (the parameters we passed
to the <code>run.one()</code> call). This is an easy way to keep track of things.</p>
<p>We test our function to see what we get:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="analyzing-the-multifactor-experiment.html#cb409-1" tabindex="-1"></a><span class="fu">run.experiment</span>( <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.2</span> )</span></code></pre></div>
<pre><code>##   E.tau.hat  E.SE.hat power nC nT sdC tau mu
## 1  0.497077 0.6284977 0.218 10  3   1 0.5  5
##   sdTau   R
## 1   0.2 500</code></pre>
<p>We next use the above to run our multi-factor simulation experiment.
We are going to vary four factors: control group size, treatment group size,
standard deviation of the units, and the treatment effect.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="analyzing-the-multifactor-experiment.html#cb411-1" tabindex="-1"></a>nC <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb411-2"><a href="analyzing-the-multifactor-experiment.html#cb411-2" tabindex="-1"></a>nT <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb411-3"><a href="analyzing-the-multifactor-experiment.html#cb411-3" tabindex="-1"></a>sdC <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">1</span> )</span>
<span id="cb411-4"><a href="analyzing-the-multifactor-experiment.html#cb411-4" tabindex="-1"></a>tau <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span> )</span>
<span id="cb411-5"><a href="analyzing-the-multifactor-experiment.html#cb411-5" tabindex="-1"></a>sdTau <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span> )</span>
<span id="cb411-6"><a href="analyzing-the-multifactor-experiment.html#cb411-6" tabindex="-1"></a></span>
<span id="cb411-7"><a href="analyzing-the-multifactor-experiment.html#cb411-7" tabindex="-1"></a>experiments <span class="ot">=</span> <span class="fu">expand_grid</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sdC=</span>sdC, <span class="at">tau=</span>tau, <span class="at">sdTau =</span> sdTau )</span>
<span id="cb411-8"><a href="analyzing-the-multifactor-experiment.html#cb411-8" tabindex="-1"></a>experiments</span></code></pre></div>
<pre><code>## # A tibble: 216 × 5
##       nC    nT   sdC   tau sdTau
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     2     2     1   0     0  
##  2     2     2     1   0     0.5
##  3     2     2     1   0.5   0  
##  4     2     2     1   0.5   0.5
##  5     2     2     1   1     0  
##  6     2     2     1   1     0.5
##  7     2     4     1   0     0  
##  8     2     4     1   0     0.5
##  9     2     4     1   0.5   0  
## 10     2     4     1   0.5   0.5
## # ℹ 206 more rows</code></pre>
<p>We next run an experiment for each row of our dataframe of experiment factor
combinations, and save the results.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="analyzing-the-multifactor-experiment.html#cb413-1" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span> </span>
<span id="cb413-2"><a href="analyzing-the-multifactor-experiment.html#cb413-2" tabindex="-1"></a>  <span class="fu">pmap_df</span>( run.experiment, <span class="at">R=</span><span class="dv">2000</span> )</span>
<span id="cb413-3"><a href="analyzing-the-multifactor-experiment.html#cb413-3" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb413-4"><a href="analyzing-the-multifactor-experiment.html#cb413-4" tabindex="-1"></a><span class="fu">saveRDS</span>( exp.res, <span class="at">file=</span><span class="st">&quot;results/Neyman_RCT_results.rds&quot;</span> )</span></code></pre></div>
<p>The <code>R=2000</code> after <code>run.experiment</code> passes the <em>same</em> parameter of <span class="math inline">\(R=2000\)</span> to each
run (we run the same number of trials for each experiment).
We can put it there rather than have it be a column in our list of factors to run.</p>
<p>Here is a peek at our results:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="analyzing-the-multifactor-experiment.html#cb414-1" tabindex="-1"></a><span class="fu">head</span>( exp.res )</span></code></pre></div>
<pre><code>##      E.tau.hat  E.SE.hat  power nC nT sdC tau mu
## 1 -0.001525155 0.8818917 0.1975  2  2   1 0.0  5
## 2 -0.026286662 0.9307269 0.1915  2  2   1 0.0  5
## 3  0.485430674 0.8861287 0.2185  2  2   1 0.5  5
## 4  0.452375661 0.9363909 0.2095  2  2   1 0.5  5
## 5  1.029038283 0.8915091 0.3120  2  2   1 1.0  5
## 6  0.957434064 0.9347139 0.3025  2  2   1 1.0  5
##   sdTau    R
## 1   0.0 2000
## 2   0.5 2000
## 3   0.0 2000
## 4   0.5 2000
## 5   0.0 2000
## 6   0.5 2000</code></pre>
<div id="the-initial-analysis" class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> The initial analysis<a href="analyzing-the-multifactor-experiment.html#the-initial-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are ready to analyze, and we start with plotting.
Plotting is always a good way to visualize simulation results.
We first make our tau into a factor, so <code>ggplot</code> behaves, and then plot all our
experiments as two rows based on one factor (<code>sdTau</code>) with the columns being
another (<code>nT</code>).
Unlike our Cluster RCT, we only have one method, so we can use our color for a different simulation factor.
Within each plot we have the x-axis for one factor (<code>nC</code>) and multiple lines for the final factor (<code>tau</code>).
The <span class="math inline">\(y\)</span>-axis is our outcome of interest, power. We add a 0.05 line to show
when we are rejecting at rates above our nominal <span class="math inline">\(\alpha\)</span>. This plot shows
the relationship of five variables.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="analyzing-the-multifactor-experiment.html#cb416-1" tabindex="-1"></a>exp.res <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> </span>
<span id="cb416-2"><a href="analyzing-the-multifactor-experiment.html#cb416-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">tau =</span> <span class="fu">as.factor</span>( tau ) )</span>
<span id="cb416-3"><a href="analyzing-the-multifactor-experiment.html#cb416-3" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb416-4"><a href="analyzing-the-multifactor-experiment.html#cb416-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>( sdTau <span class="sc">~</span> nT, <span class="at">labeller=</span>label_both ) <span class="sc">+</span></span>
<span id="cb416-5"><a href="analyzing-the-multifactor-experiment.html#cb416-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb416-6"><a href="analyzing-the-multifactor-experiment.html#cb416-6" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb416-7"><a href="analyzing-the-multifactor-experiment.html#cb416-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-279-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We are looking at power for different control and treatment group sizes. The tau is our treatment effect, and so for <span class="math inline">\(\tau = 0\)</span> we are looking at validity (false rejection of the null) and for the other <span class="math inline">\(\tau\)</span> power (noticing an effect when it is there).
Notice that we are seeing elevated rejection rates (the tau=0 line is well above 0.05) under the null for small and even moderate sample sizes!</p>
</div>
<div id="focusing-on-validity" class="section level3 hasAnchor" number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> Focusing on validity<a href="analyzing-the-multifactor-experiment.html#focusing-on-validity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Especially when considering power, we might want to separate rejection rates under the null vs. rejection rates when there is a true thing to reject.
In particular, we can subset to specific simulation runs with no treatment impact to assess the validity.</p>
<p>First, we can filter our simulations to large samples to make sure we are seeing rejection rates (<code>power</code>) of around 0.05, which is what we want:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="analyzing-the-multifactor-experiment.html#cb417-1" tabindex="-1"></a><span class="fu">filter</span>( exp.res, tau<span class="sc">==</span><span class="dv">0</span>, nT <span class="sc">&gt;=</span> <span class="dv">50</span>, nC <span class="sc">&gt;=</span> <span class="dv">50</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb417-2"><a href="analyzing-the-multifactor-experiment.html#cb417-2" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">E.tau.hat</th>
<th align="right">E.SE.hat</th>
<th align="right">power</th>
<th align="right">nC</th>
<th align="right">nT</th>
<th align="right">sdC</th>
<th align="left">tau</th>
<th align="right">mu</th>
<th align="right">sdTau</th>
<th align="right">R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.20</td>
<td align="right">0.06</td>
<td align="right">50</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.21</td>
<td align="right">0.05</td>
<td align="right">50</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">50</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.05</td>
<td align="right">50</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.15</td>
<td align="right">0.05</td>
<td align="right">500</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.16</td>
<td align="right">0.06</td>
<td align="right">500</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="right">2000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.07</td>
<td align="right">0.06</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="left">0</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">2000</td>
</tr>
</tbody>
</table>
<p>This does check out, which is a nice sanity check that we have implemented everything correctly.
It is ok to use simulation of simple, known, cases to check that our methods are implemented correctly and working as expected.</p>
<p>We can then get fancy and look at false rejection rate (power under <code>tau = 0</code>) as a
function of both nC and nT using an interaction-style plot where we average over the other variables:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="analyzing-the-multifactor-experiment.html#cb418-1" tabindex="-1"></a>exp.res.rej <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> </span>
<span id="cb418-2"><a href="analyzing-the-multifactor-experiment.html#cb418-2" tabindex="-1"></a>  <span class="fu">filter</span>( tau <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb418-3"><a href="analyzing-the-multifactor-experiment.html#cb418-3" tabindex="-1"></a>  <span class="fu">group_by</span>( nC, nT ) <span class="sc">%&gt;%</span></span>
<span id="cb418-4"><a href="analyzing-the-multifactor-experiment.html#cb418-4" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ),</span>
<span id="cb418-5"><a href="analyzing-the-multifactor-experiment.html#cb418-5" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">n</span>() )</span>
<span id="cb418-6"><a href="analyzing-the-multifactor-experiment.html#cb418-6" tabindex="-1"></a></span>
<span id="cb418-7"><a href="analyzing-the-multifactor-experiment.html#cb418-7" tabindex="-1"></a>exp.res.rej <span class="ot">=</span> <span class="fu">mutate</span>( exp.res.rej, <span class="at">power =</span> <span class="fu">round</span>( power <span class="sc">*</span> <span class="dv">100</span> ) )</span>
<span id="cb418-8"><a href="analyzing-the-multifactor-experiment.html#cb418-8" tabindex="-1"></a></span>
<span id="cb418-9"><a href="analyzing-the-multifactor-experiment.html#cb418-9" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.rej, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>nT, <span class="at">col=</span><span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(nT)) ) ) <span class="sc">+</span></span>
<span id="cb418-10"><a href="analyzing-the-multifactor-experiment.html#cb418-10" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>( <span class="at">size=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb418-11"><a href="analyzing-the-multifactor-experiment.html#cb418-11" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb418-12"><a href="analyzing-the-multifactor-experiment.html#cb418-12" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">40</span> ) ) <span class="sc">+</span></span>
<span id="cb418-13"><a href="analyzing-the-multifactor-experiment.html#cb418-13" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( exp.res.rej<span class="sc">$</span>nC ) ) <span class="sc">+</span></span>
<span id="cb418-14"><a href="analyzing-the-multifactor-experiment.html#cb418-14" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>( <span class="at">low =</span> <span class="st">&quot;black&quot;</span>, <span class="at">high=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb418-15"><a href="analyzing-the-multifactor-experiment.html#cb418-15" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">unique</span>( exp.res.rej<span class="sc">$</span>nT ) ) <span class="sc">+</span></span>
<span id="cb418-16"><a href="analyzing-the-multifactor-experiment.html#cb418-16" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;# C&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Power&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;# T&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plot_interaction_Results-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>This plot focuses on the validity of our test.
It shows that we can have massively elevated rates when either the number of treated or control units is small (below 7).
It also shows that as the size of one group increases, if the other is small our rejection rates climb! Note how for 4 control units, the <span class="math inline">\(n_T = 500\)</span> line is above the others (except for the <span class="math inline">\(n_T = 2\)</span> line).</p>
</div>
<div id="aggregate-to-look-at-main-effects" class="section level3 hasAnchor" number="12.3.3">
<h3><span class="header-section-number">12.3.3</span> Aggregate to look at main effects<a href="analyzing-the-multifactor-experiment.html#aggregate-to-look-at-main-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can ignore all the other factors while we look at one specific factor of interest.
This is looking at the <strong>main effect</strong> or <strong>marginal effect</strong> of the factor.</p>
<p>The easy way to do this is to aggregate, letting <code>ggplot</code> smooth our individual points on a
plot.
Be sure to also plot the individual points to see variation, however.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="analyzing-the-multifactor-experiment.html#cb419-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb419-2"><a href="analyzing-the-multifactor-experiment.html#cb419-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.02</span>, <span class="at">height=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb419-3"><a href="analyzing-the-multifactor-experiment.html#cb419-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb419-4"><a href="analyzing-the-multifactor-experiment.html#cb419-4" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb419-5"><a href="analyzing-the-multifactor-experiment.html#cb419-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotPool-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note how we see our individual runs that we marginalize over as the dots.</p>
<p>To look at our main effects we can also summarize our results, averaging our
experimental runs across other factor levels. For example, in the code below
we average over the different treatment group sizes and standard deviations,
and plot the marginalized results.</p>
<p>To marginalize, we group by the things we want to keep and let <code>summarise()</code>
average over the things we want to get rid of.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="analyzing-the-multifactor-experiment.html#cb420-1" tabindex="-1"></a>exp.res.sum <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( nC, tau ) <span class="sc">%&gt;%</span></span>
<span id="cb420-2"><a href="analyzing-the-multifactor-experiment.html#cb420-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ) )</span>
<span id="cb420-3"><a href="analyzing-the-multifactor-experiment.html#cb420-3" tabindex="-1"></a><span class="fu">head</span>( exp.res.sum )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   nC [2]
##      nC tau   power
##   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
## 1     2 0     0.205
## 2     2 0.5   0.254
## 3     2 1     0.395
## 4     4 0     0.114
## 5     4 0.5   0.204
## 6     4 1     0.427</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="analyzing-the-multifactor-experiment.html#cb422-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.sum, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb422-2"><a href="analyzing-the-multifactor-experiment.html#cb422-2" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb422-3"><a href="analyzing-the-multifactor-experiment.html#cb422-3" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb422-4"><a href="analyzing-the-multifactor-experiment.html#cb422-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotCollapse-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We can try to get clever and look at other aspects of our experimental runs.
The above suggests that the smaller of the two groups is dictating when things
going awry, in terms of elevated rejection rates under the null.</p>
<p>We can also look at our results in terms of some more easily interpretable parameters, such as effect size instead of raw treatment effect.</p>
<p>To try and simplify the story, we can try and look at total sample size and the smaller of
the two groups sample size and make two different plots that way.
<!--We also subset to just the `sd=1` cases as there is nothing really different about the two
options; we probably should average across but this could reduce clarity of
the presentation of results:--></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="analyzing-the-multifactor-experiment.html#cb423-1" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> </span>
<span id="cb423-2"><a href="analyzing-the-multifactor-experiment.html#cb423-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">n =</span> nC <span class="sc">+</span> nT,</span>
<span id="cb423-3"><a href="analyzing-the-multifactor-experiment.html#cb423-3" tabindex="-1"></a>          <span class="at">n.min =</span> <span class="fu">pmin</span>( nC, nT ) )</span></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="analyzing-the-multifactor-experiment.html#cb424-1" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>n, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb424-2"><a href="analyzing-the-multifactor-experiment.html#cb424-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb424-3"><a href="analyzing-the-multifactor-experiment.html#cb424-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb424-4"><a href="analyzing-the-multifactor-experiment.html#cb424-4" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb424-5"><a href="analyzing-the-multifactor-experiment.html#cb424-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-6"><a href="analyzing-the-multifactor-experiment.html#cb424-6" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Total sample size&quot;</span> )</span>
<span id="cb424-7"><a href="analyzing-the-multifactor-experiment.html#cb424-7" tabindex="-1"></a></span>
<span id="cb424-8"><a href="analyzing-the-multifactor-experiment.html#cb424-8" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>n.min, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb424-9"><a href="analyzing-the-multifactor-experiment.html#cb424-9" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb424-10"><a href="analyzing-the-multifactor-experiment.html#cb424-10" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb424-11"><a href="analyzing-the-multifactor-experiment.html#cb424-11" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb424-12"><a href="analyzing-the-multifactor-experiment.html#cb424-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-13"><a href="analyzing-the-multifactor-experiment.html#cb424-13" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Minimum group size&quot;</span> )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plotA"></span>
<img src="Designing-Simulations-in-R_files/figure-html/plotA-1.png" alt="Power as a function of total sample size." width="45%" /><img src="Designing-Simulations-in-R_files/figure-html/plotA-2.png" alt="Power as a function of total sample size." width="45%" />
<p class="caption">
Figure 12.1: Power as a function of total sample size.
</p>
</div>
<p>Note the few observations out in the high <code>n.min</code> region for the second
plot—this plot is a bit strange in that the different levels along the
x-axis are assymetric with respect to each other. It is not balanced.</p>
</div>
<div id="recap" class="section level3 hasAnchor" number="12.3.4">
<h3><span class="header-section-number">12.3.4</span> Recap<a href="analyzing-the-multifactor-experiment.html#recap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Overall, this exploration demonstrates the process of looking at a single performance metric (power) and refining a series of plots to get a sense of what the simulation is taking us.
There are many different plots we might choose, and this depends on the messages we are trying to convey.</p>
<p>The key is to explore, and see what you can learn!</p>
</div>
</div>
<div id="exercises-8" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Exercises<a href="analyzing-the-multifactor-experiment.html#exercises-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>For our cluster RCT, use the simulation results to assess how much better (or worse) the different methods are to each other in terms of confidence interval coverage. What scenarios tend to result in the worst coverage?</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-borenstein2021introduction" class="csl-entry">
Borenstein, Michael, Larry V. Hedges, Julian P. T. Higgins, and Hannah R. Rothstein. 2021. <em>Introduction to Meta-Analysis</em>. 3rd ed. Chichester, UK: John Wiley &amp; Sons.
</div>
<div id="ref-friedman1988metamodel" class="csl-entry">
Friedman, Linda Weiser, and Israel Pressman. 1988. <span>“The Metamodel in Simulation Analysis: Can It Be Trusted?”</span> <em>Journal of the Operational Research Society</em> 39 (10): 939–48.
</div>
<div id="ref-gilbert2024multilevel" class="csl-entry">
Gilbert, Joshua, and Luke Miratrix. 2024. <span>“Multilevel Metamodels: A Novel Approach to Enhance Efficiency and Generalizability in Monte Carlo Simulation Studies.”</span> <em>arXiv Preprint arXiv:2401.07294</em>.
</div>
<div id="ref-kleijnen1981regression" class="csl-entry">
Kleijnen, Jack PC. 1981. <span>“Regression Analysis for Simulation Practitioners.”</span> <em>Journal of the Operational Research Society</em> 32 (1): 35–43.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exp-design.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-study-comparing-different-estimators.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/071-experimental-design-analysis.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
