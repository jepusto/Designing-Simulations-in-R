<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Estimation procedures | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Estimation procedures | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Estimation procedures | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="James E. Pustejovsky and Luke W. Miratrix" />


<meta name="date" content="2022-05-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-generating-models.html"/>
<link rel="next" href="performance-criteria.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="index.html"><a href="index.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.3</b> Why R and RStudio?</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#functions"><i class="fa fa-check"></i><b>1.3.1</b> Functions</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#a-dangerous-function"><i class="fa fa-check"></i><b>1.3.2</b> A dangerous function</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#function-skeletons"><i class="fa fa-check"></i><b>1.3.3</b> Function skeletons</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#pipe-dreams"><i class="fa fa-check"></i><b>1.3.4</b> <code>%&gt;%</code> (Pipe) dreams</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html"><i class="fa fa-check"></i><b>2</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulation-for-a-single-scenario"><i class="fa fa-check"></i><b>2.1</b> Simulation for a single scenario</a></li>
<li class="chapter" data-level="2.2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>2.2</b> Simulating across different scenarios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>3</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>3.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-simulations"><i class="fa fa-check"></i><b>3.2</b> Tidy simulations</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-model"><i class="fa fa-check"></i><b>3.2.1</b> Data-generating model</a></li>
<li class="chapter" data-level="3.2.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-methods"><i class="fa fa-check"></i><b>3.2.2</b> Estimation methods</a></li>
<li class="chapter" data-level="3.2.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>3.2.3</b> Repetition</a></li>
<li class="chapter" data-level="3.2.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>3.2.4</b> Performance summaries</a></li>
<li class="chapter" data-level="3.2.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#results"><i class="fa fa-check"></i><b>3.2.5</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multiple-scenarios"><i class="fa fa-check"></i><b>3.3</b> Multiple Scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#keeping-the-pieces-organized"><i class="fa fa-check"></i><b>3.4</b> Keeping the pieces organized</a></li>
<li class="chapter" data-level="3.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#further-readings-resources"><i class="fa fa-check"></i><b>3.5</b> Further readings &amp; resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="case_ANOVA.html"><a href="case_ANOVA.html"><i class="fa fa-check"></i><b>4</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>4.1</b> The data-generating model</a></li>
<li class="chapter" data-level="4.2" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-estimation-procedures"><i class="fa fa-check"></i><b>4.2</b> The estimation procedures</a></li>
<li class="chapter" data-level="4.3" data-path="case_ANOVA.html"><a href="case_ANOVA.html#replication"><i class="fa fa-check"></i><b>4.3</b> Replication</a></li>
<li class="chapter" data-level="4.4" data-path="case_ANOVA.html"><a href="case_ANOVA.html#calculating-rejection-rates"><i class="fa fa-check"></i><b>4.4</b> Calculating rejection rates</a></li>
<li class="chapter" data-level="4.5" data-path="case_ANOVA.html"><a href="case_ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-generating-models.html"><a href="data-generating-models.html"><i class="fa fa-check"></i><b>5</b> Data-generating models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-generating-models.html"><a href="data-generating-models.html#computational-efficiency-versus-simplicity"><i class="fa fa-check"></i><b>5.1</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="5.2" data-path="data-generating-models.html"><a href="data-generating-models.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>5.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="5.3" data-path="data-generating-models.html"><a href="data-generating-models.html#exercises"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-generating-models.html"><a href="data-generating-models.html#shifted-and-scaled-t-distribution"><i class="fa fa-check"></i><b>5.3.1</b> Shifted-and-scaled t distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="estimation-procedures.html"><a href="estimation-procedures.html"><i class="fa fa-check"></i><b>6</b> Estimation procedures</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estimation-procedures.html"><a href="estimation-procedures.html#further-notes-on-computational-efficiency"><i class="fa fa-check"></i><b>6.1</b> Further notes on computational efficiency</a></li>
<li class="chapter" data-level="6.2" data-path="estimation-procedures.html"><a href="estimation-procedures.html#checking-the-estimation-function"><i class="fa fa-check"></i><b>6.2</b> Checking the estimation function</a></li>
<li class="chapter" data-level="6.3" data-path="estimation-procedures.html"><a href="estimation-procedures.html#exercises-1"><i class="fa fa-check"></i><b>6.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="estimation-procedures.html"><a href="estimation-procedures.html#adding-the-bff-test"><i class="fa fa-check"></i><b>6.3.1</b> Adding the BFF* test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>7</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-vs.-estimation"><i class="fa fa-check"></i><b>7.1</b> Inference vs. Estimation</a></li>
<li class="chapter" data-level="7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#evaluation-of-estimation-methods"><i class="fa fa-check"></i><b>7.2</b> Evaluation of Estimation Methods</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-actual-properties"><i class="fa fa-check"></i><b>7.2.1</b> Assessing actual properties</a></li>
<li class="chapter" data-level="7.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-estimated-properties"><i class="fa fa-check"></i><b>7.2.2</b> Assessing estimated properties</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>7.3</b> Assessing a point estimator</a></li>
<li class="chapter" data-level="7.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>7.4</b> Assessing a standard error estimator</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-widehatse-directly"><i class="fa fa-check"></i><b>7.4.1</b> Why not assess <span class="math inline">\(widehat{SE}\)</span> directly?</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-hypothesis-testing-procedure"><i class="fa fa-check"></i><b>7.5</b> Assessing a hypothesis testing procedure</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>7.5.1</b> Validity</a></li>
<li class="chapter" data-level="7.5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>7.5.2</b> Power</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>7.6</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="7.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-our-performance-estimates-the-mcse"><i class="fa fa-check"></i><b>7.7</b> Uncertainty in our performance estimates (the MCSE)</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-variance-estimators"><i class="fa fa-check"></i><b>7.7.1</b> MCSE for variance estimators</a></li>
<li class="chapter" data-level="7.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#the-simhelpers-package-and-mcses"><i class="fa fa-check"></i><b>7.7.2</b> The simhelpers package and MCSEs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="performance-criteria.html"><a href="performance-criteria.html#absolute-vs.-relative-performance-measures"><i class="fa fa-check"></i><b>7.8</b> Absolute vs. relative performance measures</a></li>
<li class="chapter" data-level="7.9" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-simulating-cronbachs-alpha"><i class="fa fa-check"></i><b>7.9</b> Exercises: Simulating Cronbach’s alpha</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#the-data-generating-function"><i class="fa fa-check"></i><b>7.9.1</b> The data-generating function</a></li>
<li class="chapter" data-level="7.9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#the-estimation-function"><i class="fa fa-check"></i><b>7.9.2</b> The estimation function</a></li>
<li class="chapter" data-level="7.9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#replicates"><i class="fa fa-check"></i><b>7.9.3</b> Replicates</a></li>
<li class="chapter" data-level="7.9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#estimator-performance"><i class="fa fa-check"></i><b>7.9.4</b> Estimator performance</a></li>
<li class="chapter" data-level="7.9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-interval-coverage"><i class="fa fa-check"></i><b>7.9.5</b> Confidence interval coverage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>8</b> Case study: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#data-generating-model-1"><i class="fa fa-check"></i><b>8.1</b> Data-generating model</a></li>
<li class="chapter" data-level="8.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimation-procedures-1"><i class="fa fa-check"></i><b>8.2</b> Estimation procedures</a></li>
<li class="chapter" data-level="8.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#performance-calculations"><i class="fa fa-check"></i><b>8.3</b> Performance calculations</a></li>
<li class="chapter" data-level="8.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#simulation-driver"><i class="fa fa-check"></i><b>8.4</b> Simulation driver</a></li>
<li class="chapter" data-level="8.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#running-the-simulation"><i class="fa fa-check"></i><b>8.5</b> Running the simulation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html"><i class="fa fa-check"></i><b>9</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>9.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="9.2" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>9.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="9.3" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>9.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="index.html"><a href="index.html#functions"><i class="fa fa-check"></i><b>10</b> More on functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10.1</b> Default arguments for functions</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="case_cluster.html"><a href="case_cluster.html"><i class="fa fa-check"></i><b>11</b> Case study: A simulation with clustered data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="case_cluster.html"><a href="case_cluster.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>11.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="11.2" data-path="case_cluster.html"><a href="case_cluster.html#a-mathematical-model-for-cluster-randomized-data"><i class="fa fa-check"></i><b>11.2</b> A mathematical model for cluster-randomized data</a></li>
<li class="chapter" data-level="11.3" data-path="case_cluster.html"><a href="case_cluster.html#multilevel-data-generation-is-a-recipe-using-a-statistical-model"><i class="fa fa-check"></i><b>11.3</b> Multilevel data generation is a recipe using a statistical model</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="case_cluster.html"><a href="case_cluster.html#generating-the-multisite-data"><i class="fa fa-check"></i><b>11.3.1</b> Generating the multisite data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="case_cluster.html"><a href="case_cluster.html#analyzing-our-data"><i class="fa fa-check"></i><b>11.4</b> Analyzing our data</a></li>
<li class="chapter" data-level="11.5" data-path="case_cluster.html"><a href="case_cluster.html#the-simulation"><i class="fa fa-check"></i><b>11.5</b> The simulation</a></li>
<li class="chapter" data-level="11.6" data-path="case_cluster.html"><a href="case_cluster.html#analysis-of-our-single-scenario"><i class="fa fa-check"></i><b>11.6</b> Analysis of our single scenario</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="case_cluster.html"><a href="case_cluster.html#are-the-estimators-biased"><i class="fa fa-check"></i><b>11.6.1</b> Are the estimators biased?</a></li>
<li class="chapter" data-level="11.6.2" data-path="case_cluster.html"><a href="case_cluster.html#which-method-has-the-smallest-standard-error"><i class="fa fa-check"></i><b>11.6.2</b> Which method has the smallest standard error?</a></li>
<li class="chapter" data-level="11.6.3" data-path="case_cluster.html"><a href="case_cluster.html#which-method-has-the-smallest-root-mean-squared-error"><i class="fa fa-check"></i><b>11.6.3</b> Which method has the smallest Root Mean Squared Error?</a></li>
<li class="chapter" data-level="11.6.4" data-path="case_cluster.html"><a href="case_cluster.html#do-the-methods-have-correctly-estimated-standard-errors"><i class="fa fa-check"></i><b>11.6.4</b> Do the methods have correctly estimated standard errors?</a></li>
<li class="chapter" data-level="11.6.5" data-path="case_cluster.html"><a href="case_cluster.html#did-we-have-enough-simulation-trials"><i class="fa fa-check"></i><b>11.6.5</b> Did we have enough simulation trials?</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="case_cluster.html"><a href="case_cluster.html#extending-to-a-multifactor-simulation"><i class="fa fa-check"></i><b>11.7</b> Extending to a multifactor simulation</a></li>
<li class="chapter" data-level="11.8" data-path="case_cluster.html"><a href="case_cluster.html#standardization-in-a-data-generating-process"><i class="fa fa-check"></i><b>11.8</b> Standardization in a data generating process</a></li>
<li class="chapter" data-level="11.9" data-path="case_cluster.html"><a href="case_cluster.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.9</b> Making analyze_data() quiet</a></li>
<li class="chapter" data-level="11.10" data-path="case_cluster.html"><a href="case_cluster.html#where-to-compute-performance-measures-inside-vs.-outside"><i class="fa fa-check"></i><b>11.10</b> Where to compute performance measures: inside vs. outside?</a></li>
<li class="chapter" data-level="11.11" data-path="case_cluster.html"><a href="case_cluster.html#run-the-simulation"><i class="fa fa-check"></i><b>11.11</b> Run the simulation</a></li>
<li class="chapter" data-level="11.12" data-path="case_cluster.html"><a href="case_cluster.html#analyzing-our-results"><i class="fa fa-check"></i><b>11.12</b> Analyzing our results</a>
<ul>
<li class="chapter" data-level="11.12.1" data-path="case_cluster.html"><a href="case_cluster.html#checking-on-convergence-issues"><i class="fa fa-check"></i><b>11.12.1</b> Checking on convergence issues</a></li>
<li class="chapter" data-level="11.12.2" data-path="case_cluster.html"><a href="case_cluster.html#calculating-standard-metrics"><i class="fa fa-check"></i><b>11.12.2</b> Calculating standard metrics</a></li>
<li class="chapter" data-level="11.12.3" data-path="case_cluster.html"><a href="case_cluster.html#bias-analysis"><i class="fa fa-check"></i><b>11.12.3</b> Bias analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.13" data-path="case_cluster.html"><a href="case_cluster.html#exercises-2"><i class="fa fa-check"></i><b>11.13</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>12</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="12.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>12.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings"><i class="fa fa-check"></i><b>12.1.1</b> What to do with warnings</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#saving-files-and-results"><i class="fa fa-check"></i><b>12.2</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>12.2.1</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="12.2.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#dynamically-making-directories"><i class="fa fa-check"></i><b>12.2.2</b> Dynamically making directories</a></li>
<li class="chapter" data-level="12.2.3" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>12.2.3</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="exp_design.html"><a href="exp_design.html"><i class="fa fa-check"></i><b>13</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="13.1" data-path="exp_design.html"><a href="exp_design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>13.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="13.2" data-path="exp_design.html"><a href="exp_design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>13.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="13.3" data-path="exp_design.html"><a href="exp_design.html#keeping-things-organized-and-the-source-command"><i class="fa fa-check"></i><b>13.3</b> Keeping things organized and the source command</a></li>
<li class="chapter" data-level="13.4" data-path="exp_design.html"><a href="exp_design.html#analyzing-results-from-a-multifactor-experiment"><i class="fa fa-check"></i><b>13.4</b> Analyzing results from a multifactor experiment</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="exp_design.html"><a href="exp_design.html#bundling"><i class="fa fa-check"></i><b>13.4.1</b> Bundling</a></li>
<li class="chapter" data-level="13.4.2" data-path="exp_design.html"><a href="exp_design.html#aggregation"><i class="fa fa-check"></i><b>13.4.2</b> Aggregation</a></li>
<li class="chapter" data-level="13.4.3" data-path="exp_design.html"><a href="exp_design.html#regression-summarization"><i class="fa fa-check"></i><b>13.4.3</b> Regression Summarization</a></li>
<li class="chapter" data-level="13.4.4" data-path="exp_design.html"><a href="exp_design.html#focus-on-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>13.4.4</b> Focus on subset, kick rest to supplement</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: A simulation to compare different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-data-generating-process"><i class="fa fa-check"></i><b>14.1</b> The data generating process</a></li>
<li class="chapter" data-level="14.2" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>14.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="14.3" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>14.3</b> The simulation itself</a></li>
<li class="chapter" data-level="14.4" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>14.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="14.5" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>14.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="14.6" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>14.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>15</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="15.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>15.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="15.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>15.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>15.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="15.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>15.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="15.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>15.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="15.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>15.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="15.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>15.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="15.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements"><i class="fa fa-check"></i><b>15.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><i class="fa fa-check"></i><b>16</b> Case study: The Power and Validity of Neyman’s ATE Estimate</a>
<ul>
<li class="chapter" data-level="16.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-1-write-a-function-for-a-specific-simulation-given-specific-parameters."><i class="fa fa-check"></i><b>16.1</b> Step 1: Write a function for a specific simulation given specific parameters.</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#running-our-single-trial-more-than-once"><i class="fa fa-check"></i><b>16.1.1</b> Running our single trial more than once</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-2-make-a-dataframe-of-all-experimental-combinations-desired"><i class="fa fa-check"></i><b>16.2</b> Step 2: Make a dataframe of all experimental combinations desired</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-3-explore-results"><i class="fa fa-check"></i><b>16.3</b> Step 3: Explore results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#visualizing-experimental-results"><i class="fa fa-check"></i><b>16.3.1</b> Visualizing experimental results</a></li>
<li class="chapter" data-level="16.3.2" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#looking-at-main-effects"><i class="fa fa-check"></i><b>16.3.2</b> Looking at main effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#addendum-saving-more-details"><i class="fa fa-check"></i><b>16.4</b> Addendum: Saving more details</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#getting-results-ready-for-analysis"><i class="fa fa-check"></i><b>16.4.1</b> Getting results ready for analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>17</b> Design, analysis, and presentation of simulation results</a>
<ul>
<li class="chapter" data-level="17.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#designing-the-simulation-experiment"><i class="fa fa-check"></i><b>17.1</b> Designing the simulation experiment</a></li>
<li class="chapter" data-level="17.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#choosing-parameter-levels"><i class="fa fa-check"></i><b>17.2</b> Choosing parameter levels</a></li>
<li class="chapter" data-level="17.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation"><i class="fa fa-check"></i><b>17.3</b> Presentation</a></li>
<li class="chapter" data-level="17.4" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>17.4</b> Tabulation</a></li>
<li class="chapter" data-level="17.5" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>17.5</b> Visualization</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>17.5.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="17.5.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>17.5.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="17.5.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>17.5.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>17.6</b> Modeling</a></li>
<li class="chapter" data-level="17.7" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation-1"><i class="fa fa-check"></i><b>17.7</b> Presentation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html"><i class="fa fa-check"></i><b>18</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="18.1" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>18.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="18.2" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>18.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="18.3" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>18.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="18.4" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>18.4</b> Nested finite simulation procedure</a></li>
<li class="chapter" data-level="18.5" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#calibrated-simulations-and-the-potential-outcomes-framework"><i class="fa fa-check"></i><b>18.5</b> Calibrated simulations and the potential outcomes framework</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>19</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="19.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-extensive-multi-factor-simulations"><i class="fa fa-check"></i><b>19.1</b> Use extensive multi-factor simulations</a></li>
<li class="chapter" data-level="19.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#beat-them-at-their-own-game"><i class="fa fa-check"></i><b>19.2</b> Beat them at their own game</a></li>
<li class="chapter" data-level="19.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrated-simulations"><i class="fa fa-check"></i><b>19.3</b> Calibrated simulations</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>20</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="20.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>20.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimation-procedures" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Estimation procedures<a href="estimation-procedures.html#estimation-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the abstract, a function that implements an estimation procedure should have the following form:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="estimation-procedures.html#cb104-1" aria-hidden="true" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_data) {</span>
<span id="cb104-2"><a href="estimation-procedures.html#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="estimation-procedures.html#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculations/model-fitting/estimation procedures</span></span>
<span id="cb104-4"><a href="estimation-procedures.html#cb104-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-5"><a href="estimation-procedures.html#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estimates)</span>
<span id="cb104-6"><a href="estimation-procedures.html#cb104-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The function takes a set of data as input, fits a model or otherwise calculates an estimate, possibly with associated standard errors and so forth, and produces as output these estimates.
In principle, you should be able to run your function on real data as well as simulated.</p>
<p>The estimates could be point-estimates of parameters, standard errors, confidence intervals, etc.
Depending on the research question, this function might involve a combination of several procedures (e.g., a diagnostic test for heteroskedasticity, followed by the conventional formula or heteroskedasticity-robust formula for standard errors).
Also depending on the research question, we might need to create <em>several</em> functions that implement different estimation procedures to be compared.</p>
<p>In Chapter @ref(case_ANOVA), for example, we saw different functions for some of the methods Brown and Forsythe considered for heteroskedastic ANOVA.
We re-print them here, taking full advantage of our digital-bookness:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="estimation-procedures.html#cb105-1" aria-hidden="true" tabindex="-1"></a>ANOVA_F <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_data) {</span>
<span id="cb105-2"><a href="estimation-procedures.html#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="estimation-procedures.html#cb105-3" aria-hidden="true" tabindex="-1"></a>  x_bar <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, mean))</span>
<span id="cb105-4"><a href="estimation-procedures.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  s_sq <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, var))</span>
<span id="cb105-5"><a href="estimation-procedures.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">table</span>(sim_data<span class="sc">$</span>group)</span>
<span id="cb105-6"><a href="estimation-procedures.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">length</span>(x_bar)</span>
<span id="cb105-7"><a href="estimation-procedures.html#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="estimation-procedures.html#cb105-8" aria-hidden="true" tabindex="-1"></a>  df1 <span class="ot">&lt;-</span> g <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb105-9"><a href="estimation-procedures.html#cb105-9" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(n) <span class="sc">-</span> g</span>
<span id="cb105-10"><a href="estimation-procedures.html#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="estimation-procedures.html#cb105-11" aria-hidden="true" tabindex="-1"></a>  msbtw <span class="ot">&lt;-</span> <span class="fu">sum</span>(n <span class="sc">*</span> (x_bar <span class="sc">-</span> <span class="fu">mean</span>(sim_data<span class="sc">$</span>x))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> df1</span>
<span id="cb105-12"><a href="estimation-procedures.html#cb105-12" aria-hidden="true" tabindex="-1"></a>  mswn <span class="ot">&lt;-</span> <span class="fu">sum</span>((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> s_sq) <span class="sc">/</span> df2</span>
<span id="cb105-13"><a href="estimation-procedures.html#cb105-13" aria-hidden="true" tabindex="-1"></a>  fstat <span class="ot">&lt;-</span> msbtw <span class="sc">/</span> mswn</span>
<span id="cb105-14"><a href="estimation-procedures.html#cb105-14" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">pf</span>(fstat, df1, df2, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-15"><a href="estimation-procedures.html#cb105-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-16"><a href="estimation-procedures.html#cb105-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pval)</span>
<span id="cb105-17"><a href="estimation-procedures.html#cb105-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-18"><a href="estimation-procedures.html#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="estimation-procedures.html#cb105-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-20"><a href="estimation-procedures.html#cb105-20" aria-hidden="true" tabindex="-1"></a>Welch_F <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_data) {</span>
<span id="cb105-21"><a href="estimation-procedures.html#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="estimation-procedures.html#cb105-22" aria-hidden="true" tabindex="-1"></a>  x_bar <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, mean))</span>
<span id="cb105-23"><a href="estimation-procedures.html#cb105-23" aria-hidden="true" tabindex="-1"></a>  s_sq <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, var))</span>
<span id="cb105-24"><a href="estimation-procedures.html#cb105-24" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">table</span>(sim_data<span class="sc">$</span>group)</span>
<span id="cb105-25"><a href="estimation-procedures.html#cb105-25" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">length</span>(x_bar)</span>
<span id="cb105-26"><a href="estimation-procedures.html#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="estimation-procedures.html#cb105-27" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> n <span class="sc">/</span> s_sq</span>
<span id="cb105-28"><a href="estimation-procedures.html#cb105-28" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">sum</span>(w)</span>
<span id="cb105-29"><a href="estimation-procedures.html#cb105-29" aria-hidden="true" tabindex="-1"></a>  x_tilde <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> x_bar) <span class="sc">/</span> u</span>
<span id="cb105-30"><a href="estimation-procedures.html#cb105-30" aria-hidden="true" tabindex="-1"></a>  msbtw <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> (x_bar <span class="sc">-</span> x_tilde)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (g <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb105-31"><a href="estimation-procedures.html#cb105-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-32"><a href="estimation-procedures.html#cb105-32" aria-hidden="true" tabindex="-1"></a>  G <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="dv">1</span> <span class="sc">-</span> w <span class="sc">/</span> u)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb105-33"><a href="estimation-procedures.html#cb105-33" aria-hidden="true" tabindex="-1"></a>  denom <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span>  G <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> (g <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> (g<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb105-34"><a href="estimation-procedures.html#cb105-34" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> msbtw <span class="sc">/</span> denom</span>
<span id="cb105-35"><a href="estimation-procedures.html#cb105-35" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> (g<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> G)</span>
<span id="cb105-36"><a href="estimation-procedures.html#cb105-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-37"><a href="estimation-procedures.html#cb105-37" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">pf</span>(W, <span class="at">df1 =</span> g <span class="sc">-</span> <span class="dv">1</span>, <span class="at">df2 =</span> f, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-38"><a href="estimation-procedures.html#cb105-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-39"><a href="estimation-procedures.html#cb105-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pval)</span>
<span id="cb105-40"><a href="estimation-procedures.html#cb105-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="further-notes-on-computational-efficiency" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Further notes on computational efficiency<a href="estimation-procedures.html#further-notes-on-computational-efficiency" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Computational and programming efficiency is usually a secondary consideration when you’re starting to design a simulation study. It’s better to produce accurate code, even if it’s a bit slow, than to write code that is speedy but hard to follow (or even worse, that produces incorrect results). All that said, there is some glaring redundancy in the two functions above.
Both of them start by taking the simulated data and calculating summary statistics for each group, using the following code:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="estimation-procedures.html#cb106-1" aria-hidden="true" tabindex="-1"></a>x_bar <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, mean))</span>
<span id="cb106-2"><a href="estimation-procedures.html#cb106-2" aria-hidden="true" tabindex="-1"></a>s_sq <span class="ot">&lt;-</span> <span class="fu">with</span>(sim_data, <span class="fu">tapply</span>(x, group, var))</span>
<span id="cb106-3"><a href="estimation-procedures.html#cb106-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">table</span>(sim_data<span class="sc">$</span>group)</span>
<span id="cb106-4"><a href="estimation-procedures.html#cb106-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">length</span>(x_bar)</span></code></pre></div>
<p>In the interest of not repeating ourselves, it would better to pull this code out as a separate function and then re-write the <code>ANOVA_F</code> and <code>Welch_F</code> functions to take the summary statistics as input. Here is a function that takes simulated data and returns a list of summary statistics:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="estimation-procedures.html#cb107-1" aria-hidden="true" tabindex="-1"></a>summarize_data <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_data) {</span>
<span id="cb107-2"><a href="estimation-procedures.html#cb107-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-3"><a href="estimation-procedures.html#cb107-3" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( group ) <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="estimation-procedures.html#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>( <span class="at">x_bar =</span> <span class="fu">mean</span>( x ),</span>
<span id="cb107-5"><a href="estimation-procedures.html#cb107-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">s_sq =</span> <span class="fu">var</span>( x ),</span>
<span id="cb107-6"><a href="estimation-procedures.html#cb107-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">n =</span> <span class="fu">n</span>() )</span>
<span id="cb107-7"><a href="estimation-procedures.html#cb107-7" aria-hidden="true" tabindex="-1"></a>  res</span>
<span id="cb107-8"><a href="estimation-procedures.html#cb107-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We just packaged the code from above, and puts our results in a nice table (and thus pivoted to using tidyverse to calculate these things):</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="estimation-procedures.html#cb108-1" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">=</span> <span class="fu">generate_data</span>(<span class="at">mu=</span>mu, <span class="at">sigma_sq=</span>sigma_sq, <span class="at">sample_size=</span>sample_size)</span>
<span id="cb108-2"><a href="estimation-procedures.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_data</span>(sim_data)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   group  x_bar  s_sq     n
##   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     1 -0.959 1.92      3
## 2     2  2.05  0.611     6
## 3     3  5.07  0.986     2
## 4     4  6.20  0.964     4</code></pre>
<p>Now we can re-write both <span class="math inline">\(F\)</span>-test functions to use the output of this function:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="estimation-procedures.html#cb110-1" aria-hidden="true" tabindex="-1"></a>ANOVA_F_agg <span class="ot">&lt;-</span> <span class="cf">function</span>(x_bar, s_sq, n) {</span>
<span id="cb110-2"><a href="estimation-procedures.html#cb110-2" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> <span class="fu">length</span>(x_bar)</span>
<span id="cb110-3"><a href="estimation-procedures.html#cb110-3" aria-hidden="true" tabindex="-1"></a>  df1 <span class="ot">&lt;-</span> g <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb110-4"><a href="estimation-procedures.html#cb110-4" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(n) <span class="sc">-</span> g</span>
<span id="cb110-5"><a href="estimation-procedures.html#cb110-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-6"><a href="estimation-procedures.html#cb110-6" aria-hidden="true" tabindex="-1"></a>  msbtw <span class="ot">&lt;-</span> <span class="fu">sum</span>(n <span class="sc">*</span> (x_bar <span class="sc">-</span> <span class="fu">weighted.mean</span>(x_bar, <span class="at">w =</span> n))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> df1</span>
<span id="cb110-7"><a href="estimation-procedures.html#cb110-7" aria-hidden="true" tabindex="-1"></a>  mswn <span class="ot">&lt;-</span> <span class="fu">sum</span>((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> s_sq) <span class="sc">/</span> df2</span>
<span id="cb110-8"><a href="estimation-procedures.html#cb110-8" aria-hidden="true" tabindex="-1"></a>  fstat <span class="ot">&lt;-</span> msbtw <span class="sc">/</span> mswn</span>
<span id="cb110-9"><a href="estimation-procedures.html#cb110-9" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">pf</span>(fstat, df1, df2, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb110-10"><a href="estimation-procedures.html#cb110-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb110-11"><a href="estimation-procedures.html#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pval)</span>
<span id="cb110-12"><a href="estimation-procedures.html#cb110-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-13"><a href="estimation-procedures.html#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="estimation-procedures.html#cb110-14" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">summarize_data</span>(sim_data)</span>
<span id="cb110-15"><a href="estimation-procedures.html#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(summary_stats, <span class="fu">ANOVA_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span></code></pre></div>
<pre><code>## [1] 6.671062e-06</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="estimation-procedures.html#cb112-1" aria-hidden="true" tabindex="-1"></a>Welch_F_agg <span class="ot">&lt;-</span> <span class="cf">function</span>(x_bar, s_sq, n) {</span>
<span id="cb112-2"><a href="estimation-procedures.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> <span class="fu">length</span>(x_bar)</span>
<span id="cb112-3"><a href="estimation-procedures.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> n <span class="sc">/</span> s_sq</span>
<span id="cb112-4"><a href="estimation-procedures.html#cb112-4" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">sum</span>(w)</span>
<span id="cb112-5"><a href="estimation-procedures.html#cb112-5" aria-hidden="true" tabindex="-1"></a>  x_tilde <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> x_bar) <span class="sc">/</span> u</span>
<span id="cb112-6"><a href="estimation-procedures.html#cb112-6" aria-hidden="true" tabindex="-1"></a>  msbtw <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> (x_bar <span class="sc">-</span> x_tilde)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (g <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb112-7"><a href="estimation-procedures.html#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="estimation-procedures.html#cb112-8" aria-hidden="true" tabindex="-1"></a>  G <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="dv">1</span> <span class="sc">-</span> w <span class="sc">/</span> u)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb112-9"><a href="estimation-procedures.html#cb112-9" aria-hidden="true" tabindex="-1"></a>  denom <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span>  G <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> (g <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> (g<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb112-10"><a href="estimation-procedures.html#cb112-10" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> msbtw <span class="sc">/</span> denom</span>
<span id="cb112-11"><a href="estimation-procedures.html#cb112-11" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> (g<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">3</span> <span class="sc">*</span> G)</span>
<span id="cb112-12"><a href="estimation-procedures.html#cb112-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-13"><a href="estimation-procedures.html#cb112-13" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">pf</span>(W, <span class="at">df1 =</span> g <span class="sc">-</span> <span class="dv">1</span>, <span class="at">df2 =</span> f, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb112-14"><a href="estimation-procedures.html#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="estimation-procedures.html#cb112-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pval)</span>
<span id="cb112-16"><a href="estimation-procedures.html#cb112-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-17"><a href="estimation-procedures.html#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="estimation-procedures.html#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(summary_stats, <span class="fu">ANOVA_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span></code></pre></div>
<pre><code>## [1] 6.671062e-06</code></pre>
<p>The results are the same as before.</p>
<p>We then put all these pieces in our revised <code>one_run()</code> method as so:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="estimation-procedures.html#cb114-1" aria-hidden="true" tabindex="-1"></a>one_run_fast <span class="ot">&lt;-</span> <span class="cf">function</span>( mu, sigma_sq, sample_size ) {</span>
<span id="cb114-2"><a href="estimation-procedures.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq,</span>
<span id="cb114-3"><a href="estimation-procedures.html#cb114-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sample_size =</span> sample_size)</span>
<span id="cb114-4"><a href="estimation-procedures.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> <span class="fu">summarize_data</span>(sim_data)</span>
<span id="cb114-5"><a href="estimation-procedures.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  anova_p <span class="ot">&lt;-</span> <span class="fu">with</span>(summary_stats, </span>
<span id="cb114-6"><a href="estimation-procedures.html#cb114-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ANOVA_F_agg</span>(<span class="at">x_bar =</span> x_bar,<span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span>
<span id="cb114-7"><a href="estimation-procedures.html#cb114-7" aria-hidden="true" tabindex="-1"></a>  Welch_p <span class="ot">&lt;-</span> <span class="fu">with</span>(summary_stats, </span>
<span id="cb114-8"><a href="estimation-procedures.html#cb114-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">Welch_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span>
<span id="cb114-9"><a href="estimation-procedures.html#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">ANOVA =</span> anova_p, <span class="at">Welch =</span> Welch_p)</span>
<span id="cb114-10"><a href="estimation-procedures.html#cb114-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-11"><a href="estimation-procedures.html#cb114-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-12"><a href="estimation-procedures.html#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="fu">one_run_fast</span>( <span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq,</span>
<span id="cb114-13"><a href="estimation-procedures.html#cb114-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">sample_size =</span> sample_size )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##    ANOVA Welch
##    &lt;dbl&gt; &lt;dbl&gt;
## 1 0.0209 0.107</code></pre>
<p>The reason this is important is we are now doing our group aggregation only once, rather than once per method. We can use our microbenchmark to see our speedup:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="estimation-procedures.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb116-2"><a href="estimation-procedures.html#cb116-2" aria-hidden="true" tabindex="-1"></a>timings <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(<span class="at">noagg =</span> <span class="fu">one_run</span>(<span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq, </span>
<span id="cb116-3"><a href="estimation-procedures.html#cb116-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sample_size =</span> sample_size),</span>
<span id="cb116-4"><a href="estimation-procedures.html#cb116-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">agg =</span> <span class="fu">one_run_fast</span>(<span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq, </span>
<span id="cb116-5"><a href="estimation-procedures.html#cb116-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">sample_size =</span> sample_size) )</span>
<span id="cb116-6"><a href="estimation-procedures.html#cb116-6" aria-hidden="true" tabindex="-1"></a>timings</span></code></pre></div>
<pre><code>## Unit: milliseconds
##   expr      min       lq     mean   median       uq     max neval
##  noagg 1.234400 1.278151 1.770700 1.320701 1.413050 31.9139   100
##    agg 4.163301 4.395401 4.990016 4.611251 5.120551 10.9817   100</code></pre>
<p>And our relative speedup is:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="estimation-procedures.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">summary</span>(timings), <span class="fu">round</span>(mean[<span class="dv">1</span>] <span class="sc">/</span> mean[<span class="dv">2</span>], <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<p>To recap, there are two advantages of this kind of coding:</p>
<ol style="list-style-type: decimal">
<li><p>Code reuse is generally good because when you have the same code in multiple places it can make it harder to read and understand your code. If you see two blocks of code you might worry they are only mostly similar, not exactly similar, and waste time trying to differentiate. If you have a single, well-named function, you immediately know what a block of code is doing.</p></li>
<li><p>Saving the results of calculations can speed up your computation since you are saving your partial work. This can be useful to reduce calculations that are particularly time intensive.</p></li>
</ol>
</div>
<div id="checking-the-estimation-function" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Checking the estimation function<a href="estimation-procedures.html#checking-the-estimation-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Just as with the data-generating function, it is important to verify the accuracy of the estimation functions. For the ANOVA-F test, this can be done simply by checking the result of our <code>ANOVA_F</code> against the built-in <code>oneway.test</code> function. Let’s do that with a fresh set of data:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="estimation-procedures.html#cb120-1" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq,</span>
<span id="cb120-2"><a href="estimation-procedures.html#cb120-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sample_size =</span> sample_size)</span>
<span id="cb120-3"><a href="estimation-procedures.html#cb120-3" aria-hidden="true" tabindex="-1"></a>aov_results <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(x <span class="sc">~</span> <span class="fu">factor</span>(group), <span class="at">data =</span> sim_data, </span>
<span id="cb120-4"><a href="estimation-procedures.html#cb120-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb120-5"><a href="estimation-procedures.html#cb120-5" aria-hidden="true" tabindex="-1"></a>aov_results</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means
## 
## data:  x and factor(group)
## F = 5.8048, num df = 3, denom df = 11, p-value = 0.01251</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="estimation-procedures.html#cb122-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">summarize_data</span>(sim_data)</span>
<span id="cb122-2"><a href="estimation-procedures.html#cb122-2" aria-hidden="true" tabindex="-1"></a>F_results <span class="ot">&lt;-</span> <span class="fu">with</span>(summary_stats,</span>
<span id="cb122-3"><a href="estimation-procedures.html#cb122-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ANOVA_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span>
<span id="cb122-4"><a href="estimation-procedures.html#cb122-4" aria-hidden="true" tabindex="-1"></a>F_results</span></code></pre></div>
<pre><code>## [1] 0.01251098</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="estimation-procedures.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(aov_results<span class="sc">$</span>p.value, F_results)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We use <code>all.equal()</code> because it will check equality up to a tolerance in R, which can avoid some weird floating point errors due to rounding in R.</p>
<p>We can follow the same approach to check the results of the Welch test because it is also implemented in <code>oneway.test</code>:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="estimation-procedures.html#cb126-1" aria-hidden="true" tabindex="-1"></a>aov_results <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(x <span class="sc">~</span> <span class="fu">factor</span>(group), <span class="at">data =</span> sim_data, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb126-2"><a href="estimation-procedures.html#cb126-2" aria-hidden="true" tabindex="-1"></a>aov_results</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means (not assuming equal variances)
## 
## data:  x and factor(group)
## F = 6.3506, num df = 3.0000, denom df = 3.1795, p-value = 0.07507</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="estimation-procedures.html#cb128-1" aria-hidden="true" tabindex="-1"></a>W_results <span class="ot">&lt;-</span> <span class="fu">with</span>(summary_stats, <span class="fu">Welch_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n))</span>
<span id="cb128-2"><a href="estimation-procedures.html#cb128-2" aria-hidden="true" tabindex="-1"></a>W_results</span></code></pre></div>
<pre><code>## [1] 0.07507405</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="estimation-procedures.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(aov_results<span class="sc">$</span>p.value, W_results)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Checking estimation functions can be a bit more difficult for procedures that are not already implemented in R. For example, the two other procedures examined by Brown and Forsythe, the James’ test and Brown and Forsythe’s <span class="math inline">\(F*\)</span> test, are not available in base R. They are, however, available in the user-contributed package <code>onewaytests</code> (I found this by searching for “Brown-Forsythe” at <a href="http://rseek.org/" class="uri">http://rseek.org/</a>). We could benchmark our calculations against this package, but of course there is some risk that the package might not be correct. Another route is to verify your results on numerical examples reported in authoritative papers, on the assumption that there’s less risk of an error there. In the original paper that proposed the test, Welch (1951) provides a worked numerical example of the procedure. He reports the following summary statistics:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="estimation-procedures.html#cb132-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb132-2"><a href="estimation-procedures.html#cb132-2" aria-hidden="true" tabindex="-1"></a>x_bar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">27.8</span>, <span class="fl">24.1</span>, <span class="fl">22.2</span>)</span>
<span id="cb132-3"><a href="estimation-procedures.html#cb132-3" aria-hidden="true" tabindex="-1"></a>s_sq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">60.1</span>, <span class="fl">6.3</span>, <span class="fl">15.4</span>)</span>
<span id="cb132-4"><a href="estimation-procedures.html#cb132-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>He also reports <span class="math inline">\(W = 3.35\)</span> and <span class="math inline">\(f = 22.6\)</span>. Replicating the calculations with our <code>Welch_F</code> function:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="estimation-procedures.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Welch_F_agg</span>(<span class="at">x_bar =</span> x_bar, <span class="at">s_sq =</span> s_sq, <span class="at">n =</span> n)</span></code></pre></div>
<pre><code>## [1] 0.05479049</code></pre>
<p>We get slightly different results! But we know that our function is correct—or at least consistent with <code>oneway.test</code>—so what’s going on? It turns out that there was an error in some of Welch’s intermediate calculations, which can only be spotted because he reported all of his work in the paper.</p>
</div>
<div id="exercises-1" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Exercises<a href="estimation-procedures.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following exercises involve exploring and tweaking the simulation code we’ve developed to replicate the results of Brown and Forsythe (1974).
Below is the key functions for the data-generating process (taken from the prior chapter).
The estimation procedures are above.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="estimation-procedures.html#cb135-1" aria-hidden="true" tabindex="-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma_sq, sample_size) {</span>
<span id="cb135-2"><a href="estimation-procedures.html#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="estimation-procedures.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">sum</span>(sample_size) </span>
<span id="cb135-4"><a href="estimation-procedures.html#cb135-4" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">length</span>(sample_size) </span>
<span id="cb135-5"><a href="estimation-procedures.html#cb135-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-6"><a href="estimation-procedures.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>g, <span class="at">times =</span> sample_size) </span>
<span id="cb135-7"><a href="estimation-procedures.html#cb135-7" aria-hidden="true" tabindex="-1"></a>  mu_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu, <span class="at">times =</span> sample_size)</span>
<span id="cb135-8"><a href="estimation-procedures.html#cb135-8" aria-hidden="true" tabindex="-1"></a>  sigma_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">sqrt</span>(sigma_sq), <span class="at">times =</span> sample_size) </span>
<span id="cb135-9"><a href="estimation-procedures.html#cb135-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-10"><a href="estimation-procedures.html#cb135-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> mu_long, <span class="at">sd =</span> sigma_long)</span>
<span id="cb135-11"><a href="estimation-procedures.html#cb135-11" aria-hidden="true" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">group =</span> group, <span class="at">x =</span> x)</span>
<span id="cb135-12"><a href="estimation-procedures.html#cb135-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-13"><a href="estimation-procedures.html#cb135-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_data)</span>
<span id="cb135-14"><a href="estimation-procedures.html#cb135-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="adding-the-bff-test" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Adding the BFF* test<a href="estimation-procedures.html#adding-the-bff-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write a function that implements the Brown-Forsythe F*-test (the BFF* test!) as described on p. 130 of Brown and Forsythe (1974). Incorporate the function into the <code>one_run()</code> function from the previous question, and use it to estimate rejection rates of the BFF* test for the parameter values in the fifth line of Table 1 (which are the same as those used in the previous question).</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="estimation-procedures.html#cb136-1" aria-hidden="true" tabindex="-1"></a>BF_F <span class="ot">&lt;-</span> <span class="cf">function</span>(x_bar, s_sq, n, g) {</span>
<span id="cb136-2"><a href="estimation-procedures.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-3"><a href="estimation-procedures.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fill in the guts here</span></span>
<span id="cb136-4"><a href="estimation-procedures.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-5"><a href="estimation-procedures.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="at">pval =</span> pval)</span>
<span id="cb136-6"><a href="estimation-procedures.html#cb136-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-7"><a href="estimation-procedures.html#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="estimation-procedures.html#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Further R code here</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-generating-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="performance-criteria.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/030-Estimation-procedures.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
