<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Data-Generating Processes (DGPs) | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Data-Generating Processes (DGPs) | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Data-Generating Processes (DGPs) | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2024-06-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case_ANOVA.html"/>
<link rel="next" href="estimation-procedures-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.3</b> Why R and RStudio?</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#templates-vs.-patterns"><i class="fa fa-check"></i><b>1.3.1</b> Templates vs. Patterns</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#the-tidyverse-and-a-recommended-text"><i class="fa fa-check"></i><b>1.3.2</b> The tidyverse and a recommended text</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>1.3.3</b> Functions</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#a-dangerous-function"><i class="fa fa-check"></i><b>1.3.4</b> A dangerous function</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#function-skeletons"><i class="fa fa-check"></i><b>1.3.5</b> Function skeletons</a></li>
<li class="chapter" data-level="1.3.6" data-path="introduction.html"><a href="introduction.html#pipe-dreams"><i class="fa fa-check"></i><b>1.3.6</b> <code>%&gt;%</code> (Pipe) dreams</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html"><i class="fa fa-check"></i><b>2</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulation-for-a-single-scenario"><i class="fa fa-check"></i><b>2.1</b> Simulation for a single scenario</a></li>
<li class="chapter" data-level="2.2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>2.2</b> Simulating across different scenarios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>3</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>3.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-simulations"><i class="fa fa-check"></i><b>3.2</b> Tidy simulations</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#the-data-generating-process-dgp"><i class="fa fa-check"></i><b>3.2.1</b> The Data Generating Process (DGP)</a></li>
<li class="chapter" data-level="3.2.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-procedures"><i class="fa fa-check"></i><b>3.2.2</b> Estimation procedures</a></li>
<li class="chapter" data-level="3.2.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>3.2.3</b> Repetition</a></li>
<li class="chapter" data-level="3.2.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>3.2.4</b> Performance summaries</a></li>
<li class="chapter" data-level="3.2.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#why-the-tidy-approach"><i class="fa fa-check"></i><b>3.2.5</b> Why the tidy approach?</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multiple-scenarios"><i class="fa fa-check"></i><b>3.3</b> Multiple Scenarios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="case_ANOVA.html"><a href="case_ANOVA.html"><i class="fa fa-check"></i><b>4</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>4.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="case_ANOVA.html"><a href="case_ANOVA.html#coding-remark"><i class="fa fa-check"></i><b>4.1.1</b> Coding remark</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-estimation-procedures"><i class="fa fa-check"></i><b>4.2</b> The estimation procedures</a></li>
<li class="chapter" data-level="4.3" data-path="case_ANOVA.html"><a href="case_ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>4.3</b> Running the simulation</a></li>
<li class="chapter" data-level="4.4" data-path="case_ANOVA.html"><a href="case_ANOVA.html#analyzing-the-simulation"><i class="fa fa-check"></i><b>4.4</b> Analyzing the Simulation</a></li>
<li class="chapter" data-level="4.5" data-path="case_ANOVA.html"><a href="case_ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap_DGP.html"><a href="chap_DGP.html"><i class="fa fa-check"></i><b>5</b> Data-Generating Processes (DGPs)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chap_DGP.html"><a href="chap_DGP.html#a-statistical-model-is-a-recipe-for-data-generation"><i class="fa fa-check"></i><b>5.1</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="5.2" data-path="chap_DGP.html"><a href="chap_DGP.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>5.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="5.3" data-path="chap_DGP.html"><a href="chap_DGP.html#case_cluster"><i class="fa fa-check"></i><b>5.3</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="chap_DGP.html"><a href="chap_DGP.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>5.3.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="5.3.2" data-path="chap_DGP.html"><a href="chap_DGP.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>5.3.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="5.3.3" data-path="chap_DGP.html"><a href="chap_DGP.html#converting-our-model-to-code"><i class="fa fa-check"></i><b>5.3.3</b> Converting our model to code</a></li>
<li class="chapter" data-level="5.3.4" data-path="chap_DGP.html"><a href="chap_DGP.html#standardization-in-a-data-generating-process"><i class="fa fa-check"></i><b>5.3.4</b> Standardization in a data generating process</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="chap_DGP.html"><a href="chap_DGP.html#exercises"><i class="fa fa-check"></i><b>5.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="chap_DGP.html"><a href="chap_DGP.html#ex_dgp"><i class="fa fa-check"></i><b>5.4.1</b> The Shifted-and-scaled t distribution</a></li>
<li class="chapter" data-level="5.4.2" data-path="chap_DGP.html"><a href="chap_DGP.html#the-cluster-rct-dgp"><i class="fa fa-check"></i><b>5.4.2</b> The Cluster RCT DGP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html"><i class="fa fa-check"></i><b>6</b> Estimation procedures</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#checking-the-estimation-function"><i class="fa fa-check"></i><b>6.1</b> Checking the estimation function</a></li>
<li class="chapter" data-level="6.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#checking-via-simulation"><i class="fa fa-check"></i><b>6.2</b> Checking via simulation</a></li>
<li class="chapter" data-level="6.3" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#including-multiple-estimation-procedures"><i class="fa fa-check"></i><b>6.3</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="6.4" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#exercises-1"><i class="fa fa-check"></i><b>6.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#more-welch-and-adding-the-bff-test"><i class="fa fa-check"></i><b>6.4.1</b> More Welch and adding the BFF test</a></li>
<li class="chapter" data-level="6.4.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#more-estimators-for-the-crt"><i class="fa fa-check"></i><b>6.4.2</b> More estimators for the CRT</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html"><i class="fa fa-check"></i><b>7</b> Running the simulation</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html#example-on-our-cluster-rct"><i class="fa fa-check"></i><b>7.0.1</b> Example on our Cluster RCT</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>8</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="8.1" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-vs.-estimation"><i class="fa fa-check"></i><b>8.1</b> Inference vs. Estimation</a></li>
<li class="chapter" data-level="8.2" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-estimators"><i class="fa fa-check"></i><b>8.2</b> Comparing estimators</a></li>
<li class="chapter" data-level="8.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>8.3</b> Assessing a point estimator</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#example-on-our-cluster-rct-1"><i class="fa fa-check"></i><b>8.3.1</b> Example on our Cluster RCT</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>8.4</b> Assessing a standard error estimator</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimate-se-directly"><i class="fa fa-check"></i><b>8.4.1</b> Why not assess the estimate SE directly?</a></li>
<li class="chapter" data-level="8.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>8.4.2</b> Assessing SEs for our Cluster RCT simulation</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure"><i class="fa fa-check"></i><b>8.5</b> Assessing an inferential procedure</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>8.5.1</b> Validity</a></li>
<li class="chapter" data-level="8.5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>8.5.2</b> Power</a></li>
<li class="chapter" data-level="8.5.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>8.5.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="8.5.4" data-path="performance-criteria.html"><a href="performance-criteria.html#our-cluster-rct-simulation"><i class="fa fa-check"></i><b>8.5.4</b> Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>8.6</b> Assessing confidence intervals</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#clusters-with-confidence"><i class="fa fa-check"></i><b>8.6.1</b> Clusters with Confidence</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="performance-criteria.html"><a href="performance-criteria.html#further-measures-of-performance"><i class="fa fa-check"></i><b>8.7</b> Further measures of performance</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec_relative_performance"><i class="fa fa-check"></i><b>8.7.1</b> Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="8.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>8.7.2</b> Robust measures of performance</a></li>
<li class="chapter" data-level="8.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>8.7.3</b> Summary of peformance measures</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-mcse"><i class="fa fa-check"></i><b>8.8</b> Uncertainty in performance estimates (the MCSE)</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-variance-estimators"><i class="fa fa-check"></i><b>8.8.1</b> MCSE for variance estimators</a></li>
<li class="chapter" data-level="8.8.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.8.2</b> Calculating MCSEs with the simhelpers package</a></li>
<li class="chapter" data-level="8.8.3" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-rct-continued-do-we-have-enough-simulation-trials"><i class="fa fa-check"></i><b>8.8.3</b> Cluster RCT, continued: Do we have enough simulation trials?</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-2"><i class="fa fa-check"></i><b>8.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>9</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="9.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>9.1</b> Background</a></li>
<li class="chapter" data-level="9.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>9.2</b> Getting started</a></li>
<li class="chapter" data-level="9.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>9.3</b> The data-generating function</a></li>
<li class="chapter" data-level="9.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>9.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercices-naive-confidence-intervals"><i class="fa fa-check"></i><b>9.4.1</b> Exercices (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>9.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>9.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>9.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="9.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>9.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="9.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>9.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-3"><i class="fa fa-check"></i><b>9.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html"><i class="fa fa-check"></i><b>10</b> Case study: Attrition in a simple randomized experiment</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#the-data-generating-process"><i class="fa fa-check"></i><b>10.1</b> The data generating process</a></li>
<li class="chapter" data-level="10.2" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#estimators"><i class="fa fa-check"></i><b>10.2</b> Estimators</a></li>
<li class="chapter" data-level="10.3" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#performance-criteria-1"><i class="fa fa-check"></i><b>10.3</b> Performance criteria</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="exp_design.html"><a href="exp_design.html"><i class="fa fa-check"></i><b>11</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exp_design.html"><a href="exp_design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="exp_design.html"><a href="exp_design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="exp_design.html"><a href="exp_design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>11.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="11.3" data-path="exp_design.html"><a href="exp_design.html#ways-of-repeating-oneself"><i class="fa fa-check"></i><b>11.3</b> Ways of repeating oneself</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="exp_design.html"><a href="exp_design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>11.3.1</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="exp_design.html"><a href="exp_design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>11.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="exp_design.html"><a href="exp_design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html"><i class="fa fa-check"></i><b>12</b> Analyzing the multifactor experiment</a>
<ul>
<li class="chapter" data-level="12.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#bundling"><i class="fa fa-check"></i><b>12.1</b> Bundling</a></li>
<li class="chapter" data-level="12.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregation"><i class="fa fa-check"></i><b>12.2</b> Aggregation</a></li>
<li class="chapter" data-level="12.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#regression-summarization"><i class="fa fa-check"></i><b>12.3</b> Regression Summarization</a></li>
<li class="chapter" data-level="12.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focus-on-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>12.4</b> Focus on subset, kick rest to supplement</a></li>
<li class="chapter" data-level="12.5" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>12.5</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="12.6" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#a-demonstration-of-visualization"><i class="fa fa-check"></i><b>12.6</b> A demonstration of visualization</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#the-initial-analysis"><i class="fa fa-check"></i><b>12.6.1</b> The initial analysis</a></li>
<li class="chapter" data-level="12.6.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focusing-on-validity"><i class="fa fa-check"></i><b>12.6.2</b> Focusing on validity</a></li>
<li class="chapter" data-level="12.6.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#looking-at-main-effects"><i class="fa fa-check"></i><b>12.6.3</b> Looking at main effects</a></li>
<li class="chapter" data-level="12.6.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#recap"><i class="fa fa-check"></i><b>12.6.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#exercises-4"><i class="fa fa-check"></i><b>12.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>13</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="13.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>13.1</b> The data generating process</a></li>
<li class="chapter" data-level="13.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>13.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="13.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>13.3</b> The simulation itself</a></li>
<li class="chapter" data-level="13.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>13.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="13.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>13.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="13.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>13.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Presentation of simulation results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>14.1</b> Tabulation</a></li>
<li class="chapter" data-level="14.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>14.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>14.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="14.2.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>14.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="14.2.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>14.2.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>14.3</b> Modeling</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sec_reproducability.html"><a href="sec_reproducability.html"><i class="fa fa-check"></i><b>15</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sec_reproducability.html"><a href="sec_reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>15.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="15.2" data-path="sec_reproducability.html"><a href="sec_reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>15.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="15.3" data-path="sec_reproducability.html"><a href="sec_reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>15.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="optimize_code.html"><a href="optimize_code.html"><i class="fa fa-check"></i><b>16</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="16.1" data-path="optimize_code.html"><a href="optimize_code.html#hand-building-functions"><i class="fa fa-check"></i><b>16.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="16.2" data-path="optimize_code.html"><a href="optimize_code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>16.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="16.3" data-path="optimize_code.html"><a href="optimize_code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>16.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>17</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="17.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>17.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#making-a-safe-function-call"><i class="fa fa-check"></i><b>17.1.1</b> Making a safe function call</a></li>
<li class="chapter" data-level="17.1.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>17.1.2</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#about_stopifnot"><i class="fa fa-check"></i><b>17.2</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="saving_files.html"><a href="saving_files.html"><i class="fa fa-check"></i><b>18</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="18.1" data-path="saving_files.html"><a href="saving_files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>18.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="18.2" data-path="saving_files.html"><a href="saving_files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>18.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="18.3" data-path="saving_files.html"><a href="saving_files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>18.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="18.4" data-path="saving_files.html"><a href="saving_files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>18.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="on_functions.html"><a href="on_functions.html"><i class="fa fa-check"></i><b>19</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="19.1" data-path="on_functions.html"><a href="on_functions.html#repeating_oneself"><i class="fa fa-check"></i><b>19.1</b> Ways of repeating yourself</a></li>
<li class="chapter" data-level="19.2" data-path="on_functions.html"><a href="on_functions.html#default_arguments"><i class="fa fa-check"></i><b>19.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="19.3" data-path="on_functions.html"><a href="on_functions.html#testing-and-debugging-code-in-your-scripts"><i class="fa fa-check"></i><b>19.3</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="19.4" data-path="on_functions.html"><a href="on_functions.html#keep-multiple-files-of-code"><i class="fa fa-check"></i><b>19.4</b> Keep multiple files of code</a></li>
<li class="chapter" data-level="19.5" data-path="on_functions.html"><a href="on_functions.html#the-source-command-and-keeping-things-organized"><i class="fa fa-check"></i><b>19.5</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="19.6" data-path="on_functions.html"><a href="on_functions.html#debugging-with-browser"><i class="fa fa-check"></i><b>19.6</b> Debugging with browser</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>20</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="20.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>20.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="20.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>20.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>20.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="20.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>20.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="20.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>20.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="20.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>20.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="20.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>20.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="20.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>20.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>21</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="21.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>21.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="21.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-2"><i class="fa fa-check"></i><b>21.2</b> The data generating process</a></li>
<li class="chapter" data-level="21.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-2"><i class="fa fa-check"></i><b>21.3</b> Running the simulation</a></li>
<li class="chapter" data-level="21.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>21.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>21.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="21.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>21.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="21.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>21.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="21.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>21.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html"><i class="fa fa-check"></i><b>22</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="22.1" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>22.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="22.2" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>22.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="22.3" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>22.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="22.4" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>22.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>23</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="23.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-extensive-multi-factor-simulations"><i class="fa fa-check"></i><b>23.1</b> Use extensive multi-factor simulations</a></li>
<li class="chapter" data-level="23.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#beat-them-at-their-own-game"><i class="fa fa-check"></i><b>23.2</b> Beat them at their own game</a></li>
<li class="chapter" data-level="23.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrated-simulations"><i class="fa fa-check"></i><b>23.3</b> Calibrated simulations</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="24.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>24.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>25</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chap_DGP" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Data-Generating Processes (DGPs)<a href="chap_DGP.html#chap_DGP" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The data generating process (DGP) is the recipe we use to create fake data that we then analyze.
Often we express our DGP as a specific model, with parameters that we can set to generate data.
The advantage of this is, generally, when we generate from a specified model we know the “right answer,” and can thus compare our estimates to this right answer in order to assess whether our estimation procedures worked.</p>
<p>The easiest way to describe a DGP is usually via a mathematical model, which is fundamentally a sequence of equations and random variables that define a series of steps.
Describing DGPs in this way is especially important for more complex DGPs, such as those for hierarchical data.
These models will often be a series of chained linear equations that use a set of parameters that we set out.
Once we have them, we can convert these equations to code by simply following these laid out steps.</p>
<p>In this chapter we will walk through this process using a running example of clustered data.
In particular, we are going to focus on generating two-level data of students nested in schools.
A good starting point for building a DGP is to first write down a sketch of what the eventual data might look like.
In our case, for example, we might have:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="chap_DGP.html#cb1-1" tabindex="-1"></a><span class="co"># a tiny dataset of 2 schools and 7 students</span></span>
<span id="cb1-2"><a href="chap_DGP.html#cb1-2" tabindex="-1"></a>sim_dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">school =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb1-3"><a href="chap_DGP.html#cb1-3" tabindex="-1"></a>                   <span class="at">student =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb1-4"><a href="chap_DGP.html#cb1-4" tabindex="-1"></a>                   <span class="at">X =</span> <span class="fu">rnorm</span>( <span class="dv">7</span> ),</span>
<span id="cb1-5"><a href="chap_DGP.html#cb1-5" tabindex="-1"></a>                   <span class="at">Y =</span> <span class="fu">rnorm</span>( <span class="dv">7</span> ) <span class="sc">+</span> X )</span>
<span id="cb1-6"><a href="chap_DGP.html#cb1-6" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>( sim_dat, <span class="at">digits=</span><span class="dv">1</span> )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">schoolID</th>
<th align="right">studentID</th>
<th align="right">X</th>
<th align="center">FRL</th>
<th align="right">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.7</td>
<td align="center">yes</td>
<td align="right">3.6</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1.1</td>
<td align="center">no</td>
<td align="right">1.6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.0</td>
<td align="center">yes</td>
<td align="right">-1.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">etc</td>
<td align="right">etc</td>
<td align="center">etc</td>
<td align="right">etc</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">-0.3</td>
<td align="center">yes</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="center">no</td>
<td align="right">1.5</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">-0.7</td>
<td align="center">yes</td>
<td align="right">-1.2</td>
</tr>
<tr class="even">
<td align="right">etc</td>
<td align="right">etc</td>
<td align="right">etc</td>
<td align="center">etc</td>
<td align="right">etc</td>
</tr>
</tbody>
</table>
<p>There are several ingredients of a full mathematical model that we could use to generate data.</p>
<p><em>COVARIATES and STRUCTURAL COVARIATES</em>
Covariates are the things that we are usually given when analyzing real data.
This is a broad definition, including things beside baseline information:</p>
<ul>
<li>Conventional: student demographics, school-level characteristics, treatment assignment</li>
<li>Structural: number of observations in each school, proportion treated in each school</li>
</ul>
<p>In the real world, we do not tend to think of structural covariates as covariates per se, they are more just consequences of the data.
We rarely model them, but instead condition on them, in a statistical analysis.
In a simulation, however, we will have to decide how they come to be.</p>
<p><em>MODEL</em>
This is the parametric relationship between everything, such as a specification of how the outcomes are linked to the covariates.
This includes specification of the randomness (the distribution of the residuals, etc.).
The model will usually contain equations that one might see in an analysis of data that looks like what we are trying to generate.</p>
<p>We will also have some extra parts of the model, that define how to generate the structural covariates.
For example, we might specify that site sizes are uniform between a specified minimum and maximum size, or that some covariate <span class="math inline">\(X\)</span> is normally distributed.</p>
<p><em>DESIGN PARAMETERS</em>
These are, e.g., the number of sites and the range of allowed site sizes.
These will control how we generate the structural covariates.</p>
<p><em>PARAMETERS</em>
These are the specifics: for a given model, parameters describe how strong a relationship there is between covariate and outcome, variance of the residuals, and so forth.
We usually estimate these <em>from</em> data.
Critically, if we know them, we can <em>generate new data</em>.</p>
<p>For example, for the Welch data earlier we have, for observation <span class="math inline">\(i\)</span> in group <span class="math inline">\(g\)</span>, a mathematical representation of our data of:</p>
<p><span class="math display">\[ X_{ig} = \mu_g + \epsilon_{ig} \mbox{ with } \epsilon_{ig} \sim N( 0, \sigma^2_g ) \]</span></p>
<p>These math equations would also come along with specified parameter values (the <span class="math inline">\(\mu_g\)</span>, the <span class="math inline">\(\sigma^2_g\)</span>), and the design parameter of the sample sizes.</p>
<div id="a-statistical-model-is-a-recipe-for-data-generation" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> A statistical model is a recipe for data generation<a href="chap_DGP.html#a-statistical-model-is-a-recipe-for-data-generation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The next step is to translate our mathematical model to code.
In the real world:</p>
<ul>
<li>We obtain data, we pick a model, we estimate parameters</li>
<li>The data comes with covariates and outcomes</li>
<li>It also comes with sample size, sizes of the clusters, etc.</li>
</ul>
<p>In the simulation world, by comparison:</p>
<ul>
<li>We pick a model, we decide how much data, we generate covariates, we pick the parameters, and then we generate outcomes</li>
<li>We need to decide how many clusters, how big the clusters are, etc.</li>
<li>We have to specify how the covariates are made. This last piece is very different from real-world analysis.</li>
</ul>
<p>In terms of code, a function that implements a data-generating model should have the following form:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="chap_DGP.html#cb2-1" tabindex="-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb2-2"><a href="chap_DGP.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="chap_DGP.html#cb2-3" tabindex="-1"></a>  <span class="co"># generate pseudo-random numbers and use those to</span></span>
<span id="cb2-4"><a href="chap_DGP.html#cb2-4" tabindex="-1"></a>  <span class="co"># make some data</span></span>
<span id="cb2-5"><a href="chap_DGP.html#cb2-5" tabindex="-1"></a>  </span>
<span id="cb2-6"><a href="chap_DGP.html#cb2-6" tabindex="-1"></a>  <span class="fu">return</span>(sim_data)</span>
<span id="cb2-7"><a href="chap_DGP.html#cb2-7" tabindex="-1"></a>}</span></code></pre></div>
<p>The function takes a set of parameter values as input, simulates random numbers and does calculations, and produces as output a set of simulated data.
Again, there will in general be multiple parameters, and these will include not only the model parameters (e.g. the coefficients of a regression), but also sample sizes and other study design parameters.
The output will typically be a dataframe, mimicking what data one would see in the “real world,” possibly augmented by some other latent values that we can use later on to assess whether the estimation procedures we are checking are close to the truth.</p>
<p>For example, from our Welch case study, we have the following method that generates grouped data with a single outcome.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chap_DGP.html#cb3-1" tabindex="-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma_sq, sample_size) {</span>
<span id="cb3-2"><a href="chap_DGP.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="chap_DGP.html#cb3-3" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">sum</span>(sample_size) </span>
<span id="cb3-4"><a href="chap_DGP.html#cb3-4" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">length</span>(sample_size) </span>
<span id="cb3-5"><a href="chap_DGP.html#cb3-5" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="chap_DGP.html#cb3-6" tabindex="-1"></a>  group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>g, <span class="at">times =</span> sample_size) </span>
<span id="cb3-7"><a href="chap_DGP.html#cb3-7" tabindex="-1"></a>  mu_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu, <span class="at">times =</span> sample_size)</span>
<span id="cb3-8"><a href="chap_DGP.html#cb3-8" tabindex="-1"></a>  sigma_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">sqrt</span>(sigma_sq), <span class="at">times =</span> sample_size) </span>
<span id="cb3-9"><a href="chap_DGP.html#cb3-9" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="chap_DGP.html#cb3-10" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> mu_long, <span class="at">sd =</span> sigma_long)</span>
<span id="cb3-11"><a href="chap_DGP.html#cb3-11" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">group =</span> group, <span class="at">x =</span> x)</span>
<span id="cb3-12"><a href="chap_DGP.html#cb3-12" tabindex="-1"></a>    </span>
<span id="cb3-13"><a href="chap_DGP.html#cb3-13" tabindex="-1"></a>  <span class="fu">return</span>(sim_data)</span>
<span id="cb3-14"><a href="chap_DGP.html#cb3-14" tabindex="-1"></a>}</span></code></pre></div>
<p>Our function takes parameters as we normally thing of them (<code>mu</code>, <code>sigma_sq</code>), and other values that we might not think of as parameters per-se (<code>sample_size</code>).
When simulating data, we have to specify quantities that we, when analyzing data, often have to take for granted.</p>
<p>We our method as so:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chap_DGP.html#cb4-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb4-2"><a href="chap_DGP.html#cb4-2" tabindex="-1"></a>sigma_sq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb4-3"><a href="chap_DGP.html#cb4-3" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb4-4"><a href="chap_DGP.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="chap_DGP.html#cb4-5" tabindex="-1"></a>sim_dat <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">mu =</span> mu, </span>
<span id="cb4-6"><a href="chap_DGP.html#cb4-6" tabindex="-1"></a>                         <span class="at">sigma_sq =</span> sigma_sq, </span>
<span id="cb4-7"><a href="chap_DGP.html#cb4-7" tabindex="-1"></a>                         <span class="at">sample_size =</span> sample_size)</span>
<span id="cb4-8"><a href="chap_DGP.html#cb4-8" tabindex="-1"></a>sim_dat</span></code></pre></div>
<pre><code>## # A tibble: 15 × 2
##    group       x
##    &lt;int&gt;   &lt;dbl&gt;
##  1     1  0.0763
##  2     1 -1.86  
##  3     1 -0.626 
##  4     2  2.52  
##  5     2  1.81  
##  6     2  1.42  
##  7     2  1.56  
##  8     2  2.49  
##  9     2  3.27  
## 10     3  3.26  
## 11     3  3.09  
## 12     4  7.37  
## 13     4  5.50  
## 14     4  6.22  
## 15     4  5.74</code></pre>
</div>
<div id="checking-the-data-generating-function" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Checking the data-generating function<a href="chap_DGP.html#checking-the-data-generating-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An important part of programing in R—particularly writing functions—is finding ways to test and check the correctness of your code. Thus, after writing a data-generating function, we need to consider how to test whether the output it produces is correct. How best to do this will depend on the data-generating model being implemented.</p>
<p>For the heteroskedastic ANOVA problem, one basic thing we could do is check that the simulated data from each group follows a normal distribution. By generating very large samples from each group, we can effectively check characteristics of the population distribution.
In the following code, we simulate very large samples from each of the four groups, and check that the means and variances agree with the input parameters:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chap_DGP.html#cb6-1" tabindex="-1"></a>check_data <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">mu =</span> mu, <span class="at">sigma_sq =</span> sigma_sq,</span>
<span id="cb6-2"><a href="chap_DGP.html#cb6-2" tabindex="-1"></a>                            <span class="at">sample_size =</span> <span class="fu">rep</span>(<span class="dv">10000</span>, <span class="dv">4</span>))</span>
<span id="cb6-3"><a href="chap_DGP.html#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="chap_DGP.html#cb6-4" tabindex="-1"></a>chk <span class="ot">&lt;-</span> check_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( group ) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="chap_DGP.html#cb6-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>( <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb6-6"><a href="chap_DGP.html#cb6-6" tabindex="-1"></a>             <span class="at">mean =</span> <span class="fu">mean</span>( x ),</span>
<span id="cb6-7"><a href="chap_DGP.html#cb6-7" tabindex="-1"></a>             <span class="at">var =</span> <span class="fu">var</span>( x ) ) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="chap_DGP.html#cb6-8" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mu =</span> mu,</span>
<span id="cb6-9"><a href="chap_DGP.html#cb6-9" tabindex="-1"></a>          <span class="at">sigma2 =</span> sigma_sq ) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="chap_DGP.html#cb6-10" tabindex="-1"></a>  <span class="fu">relocate</span>( group, n, mean, mu, var, sigma2 )</span>
<span id="cb6-11"><a href="chap_DGP.html#cb6-11" tabindex="-1"></a>chk</span></code></pre></div>
<pre><code>## # A tibble: 4 × 6
##   group     n  mean    mu   var sigma2
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     1 10000 0.994     1  3.02      3
## 2     2 10000 1.99      2  2.03      2
## 3     3 10000 5.03      5  5.07      5
## 4     4 10000 6.00      6  1.00      1</code></pre>
<p>We are recovering our parameters.</p>
<p>We can also make some diagnostic plots to assess whether we have normal data (using QQ plots, where we expect a straight line if the data are normal):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chap_DGP.html#cb8-1" tabindex="-1"></a><span class="fu">ggplot</span>( check_data, <span class="fu">aes</span>( <span class="at">sample=</span>x ) ) <span class="sc">+</span></span>
<span id="cb8-2"><a href="chap_DGP.html#cb8-2" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> group ) <span class="sc">+</span></span>
<span id="cb8-3"><a href="chap_DGP.html#cb8-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-7-1.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="case_cluster" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Example: Simulating clustered data<a href="chap_DGP.html#case_cluster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generating data with complex structure can be intimidating, but if you set out a recipe for how the data is generated it is often not to bad to build that recipe up with code.
We will illustrate how to tackle this kind of data with a case study of best practices for analyzing data from a cluster-randomized RCT of students nested in schools.</p>
<p>A lot of the current literature on multisite trials (where, for example, students are randomized to treatment or control within each of a series of sites) has explored how variation in the size of impacts across sites can cause bad things can happen.
In this case study we extend this work to ask what impact treatment variation has for cluster randomized trials.</p>
<p>To set the stage, we identify three different ways one might analyze data from a cluster randomized trial:</p>
<ul>
<li>Multilevel modeling (MLM): Fit a multilevel model to account for dependencies within cluster.</li>
<li>Linear regression (LR): Fit a linear model and use cluster robust standard errors.</li>
<li>Aggregation (Agg): Calculate average outcomes for each cluster and fit a linear model with heteroskedastic robust SEs</li>
</ul>
<p>We might then ask, are any of these strategies biased? When and how much?
Are any of these strategies more precise (have smaller SEs)?
Are the standard errors for these different strategies valid?
We might think aggregation should be worse since we are losing information, right?
If so, how much is lost?</p>
<p>To make this investigation a bit more rich, we are also going to ask a final question that will influence our data generating process.
We want to investigate what happens when the impact of a site depends on the site size.
This is a common question that has gained some attention in the education world, where we might reasonably think sites of different sizes may respond to treatment differently.
In particular, we want to know if a relationship between site size and site impact would bias any of our three methods.</p>
<div id="a-design-decision-what-do-we-want-to-manipulate" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> A design decision: What do we want to manipulate?<a href="chap_DGP.html#a-design-decision-what-do-we-want-to-manipulate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a lot of ways we might generate data.
To figure out what kinds of controls we have on that process, we need to think about the goals of the simulation.</p>
<p>In our case, for example, we might think:</p>
<ol style="list-style-type: decimal">
<li>We figure if all the sites are the same size, we are probably safe. But if sites vary, then we could have issues with our estimators.</li>
<li>Also, if site size varies, but has nothing to do with impact, then we are probably good, at least for bias, but if it is associated with impact then how we average our sites is going to matter.</li>
</ol>
<p>Usually, when running a simulation, it is good practice to keep the simple option along with the complex one.
We want to both check that something does not matter as well as verify that it does.</p>
<p>Given this, we land on the following points:</p>
<ul>
<li>We need to consider both all-same-size sites and variable size sites.</li>
<li>Our DGP should have some impact variation across sites.</li>
<li>We should be able to connect impact variation to site size to explore a more malicious context.</li>
</ul>
<p>Overall, our final data should be a collection of clusters with different sizes and different baseline mean outcomes.
Some of the clusters will be treated, and some not.
We can imagine our final data being individual students, with each student having a cluster id, a treatment assignment (shared for all in the cluster) and an outcome.</p>
</div>
<div id="a-model-for-a-cluster-rct" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> A model for a cluster RCT<a href="chap_DGP.html#a-model-for-a-cluster-rct" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is usually easiest to start a recipe for data generating by writing down the mathematical model.
Write down something, and then specify any parts that you are using, in an interative process.
For our model, we start with a model for the outcome as a function of any covariates desired.</p>
<p>A covariate in a linear model creates a relationship between that covariate and the outcome.
In looking at our goals, this tells us we want to have treatment assignment as a covariate so we can have a treatment impact.
To keep things simple, we plan for a common treatment impact within cluster: if we treat a cluster, everyone in the cluster is raised by some specified amount.</p>
<p>We also want the size of impact to possibly vary by site size.
This suggests we also want a treatment by site size interaction term.
Instead of just using the site size, however, we are going to standardize our site sizes so they are more interpretable.
This makes it so if we double the sizes of all the sites, it does not change our size covariate: we want the size covariate to be relative size, not absolute.
To do this, we create a covariate which is the percent of the average site size that a site is:
<span class="math display">\[ S_j = \frac{n_j - \bar{n}}{ \bar{n} } \]</span></p>
<p>Using this coveriate, we then specify our multilevel model to describe our data:
<span class="math display">\[
\begin{aligned}
Y_{ij} &amp;= \beta_{0j} + \epsilon_{ij} \\
\epsilon_{ij} &amp;\sim N( 0, \sigma^2_\epsilon ) \\
\beta_{0j} &amp;= \gamma_{0} + \gamma_{1} Z_j + \gamma_2 Z_j S_j + u_j \\
u_j &amp;\sim N( 0, \sigma^2_u )
\end{aligned}
\]</span>
Our parameters are the mean outcome of control unit (<span class="math inline">\(\gamma_0\)</span>), the treatment impact (<span class="math inline">\(\gamma_1\)</span>), the amount of cross site variation (<span class="math inline">\(\sigma^2_u\)</span>), and residual variation (<span class="math inline">\(\sigma^2_\epsilon\)</span>).
Our <span class="math inline">\(\gamma_2\)</span> is our site-size by treatment interaction term: bigger sites will (assuming <span class="math inline">\(\gamma_2\)</span> is positive) have larger treatment impacts.</p>
<p>If you prefer the reduced form, it would be:</p>
<p><span class="math display">\[ Y_{ij} = \gamma_{0} + \gamma_{1} Z_j + \gamma_2 Z_j S_j  + u_j + \epsilon_{ij}  \]</span>
We might also include a main effect for <span class="math inline">\(S_j\)</span>.
A main effect would make larger sites systematically different than smaller sites at baseline, rather than having it only be part of our treatment variation term.
For simplicity we drop it here.</p>
<p>So far we have a mathematical model analagous to what we would write if we were <em>analyzing</em> the data.
To <em>generate</em> data, we also need several other quantities specified.
First, we need to know the number of clusters (<span class="math inline">\(J\)</span>) and the sizes of the clusters (<span class="math inline">\(n_j\)</span>, for <span class="math inline">\(j = 1, \ldots, J\)</span>).
We have to provide a recipe for generating these sizes. We might try</p>
<p><span class="math display">\[ n_j \sim unif( (1-\alpha)\bar{n}, (1+\alpha)\bar{n} ) = \bar{n} + \bar{n}\alpha \cdot unif(-1, 1) ,\]</span>
with a fixed <span class="math inline">\(\alpha\)</span> to control the amount of variation in cluster size.
If <span class="math inline">\(\bar{n} = 100\)</span> and <span class="math inline">\(\alpha = 0.25\)</span> then we would, for example, have sites ranging from 75 to 125 in size.
This specification is nice in that we can determine two parametes, <span class="math inline">\(\bar{n}\)</span> and <span class="math inline">\(\alpha\)</span>, to get our site sizes, and both parameters are easy to comprehend: average site size and amount of site size variation.</p>
<p>Given how we are generating site size, look again at our treatment impact heterogeneity term:</p>
<p><span class="math display">\[ \gamma_2 Z_j S_j = \gamma_2 Z_j \left(\frac{n_j - \bar{n}}{\bar{n}}\right) = \gamma_2 Z_j \alpha U_j, \]</span>
where <span class="math inline">\(U_j\)</span> is the <span class="math inline">\(U_j \sim unif(-1,1)\)</span> uniform variable used to generate <span class="math inline">\(n_j\)</span>.
Due to our standardizing by average site size, we make our covariate not change in terms of its importance as a function of site size, but rather as a function of site variation <span class="math inline">\(\alpha\)</span>.
In particular, <span class="math inline">\(\frac{n_j - \bar{n}}{\bar{n}}\)</span> will range from <span class="math inline">\(-\alpha\)</span> to <span class="math inline">\(\alpha\)</span>, regardless of average site size.
Carefully setting up a DGP so the “knobs” we use are standardized like this can make interpreting the simulation results much easier.
Consider if we did not divide by <span class="math inline">\(\bar{n}\)</span>: then larger sites would also have more severe heterogeniety in treatment impact; this could make interpreting the results very confusing.</p>
<p>We next need to define how we generate our treatment indicator, <span class="math inline">\(Z_j\)</span>.
We might specify some proportion <span class="math inline">\(p\)</span> assigned to treatment, and set <span class="math inline">\(Z_j = 1\)</span> or <span class="math inline">\(Z_j = 0\)</span> using a simple random sampling approach on our <span class="math inline">\(J\)</span> units.
We will see code for this below.</p>
</div>
<div id="converting-our-model-to-code" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Converting our model to code<a href="chap_DGP.html#converting-our-model-to-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For multilevel data generation, we follow our model, and go by layers.
First, we generate the sites:</p>
<ul>
<li>Generate site-level covariates</li>
<li>Generate sample size within each site</li>
<li>Generate site level random effects</li>
</ul>
<p>Then we generate the students inside the sites:</p>
<ul>
<li>Generate student covariates</li>
<li>Generate student residuals</li>
<li>Add everything up to generate student outcomes</li>
</ul>
<p>The mathematical model gives us exactly the details we need to execute on these steps.
In particular, we can translate the math directly to R code, and then finally put it all in a function.</p>
<p>We start by specifying a function with all the parameters we might want to pass it, including defaults for each (see @(#default_arguments) for more on function defaults):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chap_DGP.html#cb9-1" tabindex="-1"></a>gen_dat_model <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">n_bar =</span> <span class="dv">10</span>,</span>
<span id="cb9-2"><a href="chap_DGP.html#cb9-2" tabindex="-1"></a>                           <span class="at">J =</span> <span class="dv">30</span>,</span>
<span id="cb9-3"><a href="chap_DGP.html#cb9-3" tabindex="-1"></a>                           <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-4"><a href="chap_DGP.html#cb9-4" tabindex="-1"></a>                           <span class="at">gamma_0 =</span> <span class="dv">0</span>, <span class="at">gamma_1 =</span> <span class="dv">0</span>, <span class="at">gamma_2 =</span> <span class="dv">0</span>,</span>
<span id="cb9-5"><a href="chap_DGP.html#cb9-5" tabindex="-1"></a>                           <span class="at">sigma2_u =</span> <span class="dv">0</span>, <span class="at">sigma2_e =</span> <span class="dv">1</span>,</span>
<span id="cb9-6"><a href="chap_DGP.html#cb9-6" tabindex="-1"></a>                           <span class="at">alpha =</span> <span class="dv">0</span> ) {</span>
<span id="cb9-7"><a href="chap_DGP.html#cb9-7" tabindex="-1"></a>  <span class="co"># Code (see below) goes here.</span></span>
<span id="cb9-8"><a href="chap_DGP.html#cb9-8" tabindex="-1"></a>}</span></code></pre></div>
<p>Note our parameters are a mix of <em>model parameters</em> (gamma_0, gamma_1, sigma2_e, etc., representing coefficients in regressions, variance terms, etc.) and <em>design parameters</em> (n_bar, J, p) that directly inform data generation.
We set default arguments (e.g., gamma_0=0) so we can ignore aspects of your DGP that we don’t care about later on.</p>
<p>Inside the model, we will have a block of code to generate the sites, and then another to generate the students.</p>
<p><em>Make the sites.</em>
We make the sites first:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chap_DGP.html#cb10-1" tabindex="-1"></a>  <span class="co"># generate site sizes </span></span>
<span id="cb10-2"><a href="chap_DGP.html#cb10-2" tabindex="-1"></a>  n_min <span class="ot">=</span> <span class="fu">round</span>( n_bar <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) )</span>
<span id="cb10-3"><a href="chap_DGP.html#cb10-3" tabindex="-1"></a>  n_max <span class="ot">=</span> <span class="fu">round</span>( n_bar <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> alpha) )</span>
<span id="cb10-4"><a href="chap_DGP.html#cb10-4" tabindex="-1"></a>  nj <span class="ot">&lt;-</span> <span class="fu">sample</span>( n_min<span class="sc">:</span>n_max, J, <span class="at">replace=</span><span class="cn">TRUE</span> )</span>
<span id="cb10-5"><a href="chap_DGP.html#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="chap_DGP.html#cb10-6" tabindex="-1"></a>  <span class="co"># Generate average control outcome and average ATE for all sites</span></span>
<span id="cb10-7"><a href="chap_DGP.html#cb10-7" tabindex="-1"></a>  <span class="co"># (The random effects)</span></span>
<span id="cb10-8"><a href="chap_DGP.html#cb10-8" tabindex="-1"></a>  u0j <span class="ot">=</span> <span class="fu">rnorm</span>( J, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>( sigma2_u ) )</span>
<span id="cb10-9"><a href="chap_DGP.html#cb10-9" tabindex="-1"></a>  </span>
<span id="cb10-10"><a href="chap_DGP.html#cb10-10" tabindex="-1"></a>  <span class="co"># randomize units within each site (proportion p to treatment)</span></span>
<span id="cb10-11"><a href="chap_DGP.html#cb10-11" tabindex="-1"></a>  Zj <span class="ot">=</span> <span class="fu">ifelse</span>( <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span>J ) <span class="sc">&lt;=</span> J <span class="sc">*</span> p, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb10-12"><a href="chap_DGP.html#cb10-12" tabindex="-1"></a>  </span>
<span id="cb10-13"><a href="chap_DGP.html#cb10-13" tabindex="-1"></a>  <span class="co"># Calculate site intercept for each site</span></span>
<span id="cb10-14"><a href="chap_DGP.html#cb10-14" tabindex="-1"></a>  beta_0j <span class="ot">=</span> gamma_0 <span class="sc">+</span> gamma_1 <span class="sc">*</span> Zj <span class="sc">+</span> gamma_2 <span class="sc">*</span> Zj <span class="sc">*</span> (nj<span class="sc">-</span>n_bar)<span class="sc">/</span>n_bar <span class="sc">+</span> u0j</span></code></pre></div>
<p>Note the line with <code>sample(1:J) &lt;= J*p</code>; this is a simple trick to generate a treatment and control 0/1 indicator.</p>
<p>There is also a serious error in the above code (serious in that the code will run and look fine in many cases, but not always do what we want); we leave it as an exercise (see below) to find and fix it.</p>
<p><em>Make the individuals.</em>
We use the site characteristics to then generate the individuals.
A key piece here is the <code>rep()</code> function that takes a list and repeats each element of the list a specified number of times.
Another key</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chap_DGP.html#cb11-1" tabindex="-1"></a>  <span class="co"># Make individual site membership</span></span>
<span id="cb11-2"><a href="chap_DGP.html#cb11-2" tabindex="-1"></a>  sid <span class="ot">=</span> <span class="fu">as.factor</span>( <span class="fu">rep</span>( <span class="dv">1</span><span class="sc">:</span>J, nj ) )</span>
<span id="cb11-3"><a href="chap_DGP.html#cb11-3" tabindex="-1"></a>  dd <span class="ot">=</span> <span class="fu">data.frame</span>( <span class="at">sid =</span> sid )</span>
<span id="cb11-4"><a href="chap_DGP.html#cb11-4" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="chap_DGP.html#cb11-5" tabindex="-1"></a>  <span class="co"># Make individual level tx variables</span></span>
<span id="cb11-6"><a href="chap_DGP.html#cb11-6" tabindex="-1"></a>  dd<span class="sc">$</span>Z <span class="ot">=</span> Zj[ dd<span class="sc">$</span>sid ]</span>
<span id="cb11-7"><a href="chap_DGP.html#cb11-7" tabindex="-1"></a>  </span>
<span id="cb11-8"><a href="chap_DGP.html#cb11-8" tabindex="-1"></a>  <span class="co"># Generate the residuals </span></span>
<span id="cb11-9"><a href="chap_DGP.html#cb11-9" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">sum</span>( nj )</span>
<span id="cb11-10"><a href="chap_DGP.html#cb11-10" tabindex="-1"></a>  e <span class="ot">=</span> <span class="fu">rnorm</span>( N, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>( sigma2_e ) )</span>
<span id="cb11-11"><a href="chap_DGP.html#cb11-11" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="chap_DGP.html#cb11-12" tabindex="-1"></a>  <span class="co"># Bundle and send out</span></span>
<span id="cb11-13"><a href="chap_DGP.html#cb11-13" tabindex="-1"></a>  dd <span class="ot">&lt;-</span> <span class="fu">mutate</span>( dd, </span>
<span id="cb11-14"><a href="chap_DGP.html#cb11-14" tabindex="-1"></a>                <span class="at">sid=</span><span class="fu">as.factor</span>(sid),</span>
<span id="cb11-15"><a href="chap_DGP.html#cb11-15" tabindex="-1"></a>                <span class="at">Yobs =</span> beta_0j[sid] <span class="sc">+</span> e, </span>
<span id="cb11-16"><a href="chap_DGP.html#cb11-16" tabindex="-1"></a>                <span class="at">Z =</span> Zj[ sid ] )</span></code></pre></div>
<p>The <code>rep</code> command repeats each number (<span class="math inline">\(1, 2, /ldots,J\)</span>), the corresponding number of times as listed in <code>nj</code>.</p>
<p>We put the above code in our function skeleton.
When we call our function we get:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chap_DGP.html#cb12-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">gen_dat_model</span>( <span class="at">n=</span><span class="dv">5</span>, <span class="at">J=</span><span class="dv">3</span>, <span class="at">p=</span><span class="fl">0.5</span>, </span>
<span id="cb12-2"><a href="chap_DGP.html#cb12-2" tabindex="-1"></a>                        <span class="at">gamma_0=</span><span class="dv">0</span>, <span class="at">gamma_1=</span><span class="fl">0.2</span>, <span class="at">gamma_2=</span><span class="fl">0.2</span>,</span>
<span id="cb12-3"><a href="chap_DGP.html#cb12-3" tabindex="-1"></a>                        <span class="at">sigma2_u =</span> <span class="fl">0.4</span>, <span class="at">sigma2_e =</span> <span class="dv">1</span>,</span>
<span id="cb12-4"><a href="chap_DGP.html#cb12-4" tabindex="-1"></a>                      <span class="at">alpha =</span> <span class="fl">0.5</span> )</span>
<span id="cb12-5"><a href="chap_DGP.html#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="chap_DGP.html#cb12-6" tabindex="-1"></a>dat</span></code></pre></div>
<pre><code>##    sid Z       Yobs
## 1    1 0  1.0262993
## 2    1 0  0.6505481
## 3    2 1  0.6286035
## 4    2 1  0.3033584
## 5    2 1 -1.1567349
## 6    2 1  0.3637420
## 7    3 0  0.1580630
## 8    3 0  0.6278734
## 9    3 0 -0.2211480
## 10   3 0 -1.1402858
## 11   3 0  0.8879957</code></pre>
<p>Our data generation code is complete.
The next step is to test the code, making sure it is doing what we think it is (see exercises).</p>
</div>
<div id="standardization-in-a-data-generating-process" class="section level3 hasAnchor" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Standardization in a data generating process<a href="chap_DGP.html#standardization-in-a-data-generating-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given our model, we can generate data by specifying our parameters and variables of <span class="math inline">\(\gamma_{0}, \gamma_{1}, \gamma_{2}, \sigma^2_\epsilon, \sigma^2_u, \bar{n}, \alpha, J, p\)</span>.</p>
<p>Now, as discussed above, we want to manipulate within vs. between variation. If we just add more between variation (increase <span class="math inline">\(\sigma^2_u\)</span>), our overall variation of <span class="math inline">\(Y\)</span> will increase.
This will make it hard to think about, e.g., power, since we have confounded within vs. between variation with overall variation (which is itself bad for power).
It also impacts interpretation of coefficients. A treatment effect of 0.2 on our outcome scale is “smaller” if there is more overall variation.</p>
<p>To handle this we first (1) Standardize our data and then (2) reparameterize, so we have human-selected parameters that we can interpret that we then <em>translate</em> to our list of data generation parameters.
This allows us to, for exmaple, operate in standard quantities such as effect size units.
It also allows us ot index our DGP with more interpretable parameters such as the Intra-Class Correlation (ICC).</p>
<p>Our model is
<span class="math display">\[ Y_{ij} = \gamma_{0} + \gamma_{1} Z_j + \gamma_2 Z_j \left(\frac{n_j - \bar{n}}{\bar{n}} \right)  + u_j + \epsilon_{ij}  \]</span></p>
<p>The variance of our control-side outcomes is
<span class="math display">\[
\begin{aligned}
var( Y_{ij}(0) ) &amp;= var( \beta_{0j} + \epsilon_{ij} ) \\
&amp;= var( \gamma_{0} + \gamma_{1} Z_j + \gamma_{2}Z_j \tilde{n}_j + u_j + \epsilon_{ij} ) \\
&amp;= \sigma^2_u + \sigma^2_\epsilon
\end{aligned}
\]</span>
The effect size of an impact is defined as the impact over the control-side standard deviation.
(Sometimes people use the pooled standard deviation, but this is usually a bad choice if one suspects treatment variation. More treatment variation should not reduce the effect size for the same absolute average impact.)</p>
<p><span class="math display">\[ ES = \frac{\gamma_1}{SD( Y | Z_j = 0 )} = \frac{\gamma_1}{\sqrt{ \sigma^2_u + \sigma^2_\epsilon } } \]</span></p>
<p>The way we think about how “big” <span class="math inline">\(\gamma_1\)</span> is depends on how much site variation and residual variation there is.
But it is also easier to detect effects when the residual variation is small.
Effect sizes “standardize out” these sorts of tensions. We can use that.</p>
<p>In particular, we will use the Intraclass Correlation Coeffiicent (ICC), defined as
<span class="math display">\[ ICC = \frac{ \sigma^2_u }{ \sigma^2_\epsilon + \sigma^2_u } . \]</span>
The ICC is a measure of within vs. between variation.</p>
<p>What we then do is first standardized our data, meaning we ensure the control side variance equals 1.
Using the above, this means <span class="math inline">\(\sigma^2_u + \sigma^2_\epsilon = 1\)</span>.
It also gives us <span class="math inline">\(ICC = \sigma^2_u\)</span>, and <span class="math inline">\(\sigma^2_\epsilon = 1 - ICC\)</span>.</p>
<p>Our two model parameters are now tied together by our single ICC tuning parameter.
The core idea is we can now manipulate the aspects of the DGP we want while holding other aspects of the DGP constant.
Given our standardized scale, we have dropped a parameter from our set we might want to vary, and ensured varying the other parameter (now the ICC) is varying only one aspect of the DGP, not both.
Before, increasing <span class="math inline">\(\sigma^2_u\)</span> had two consequences: total variation and relative amount of variation at the school level.
Manipulating ICC only does the latter.</p>
<p>We would call <code>gen_dat_model</code> from our usual simulation driver as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chap_DGP.html#cb14-1" tabindex="-1"></a>run_CRT_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(reps, </span>
<span id="cb14-2"><a href="chap_DGP.html#cb14-2" tabindex="-1"></a>                        <span class="at">n_bar =</span> <span class="dv">10</span>, <span class="at">J =</span> <span class="dv">30</span>, <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-3"><a href="chap_DGP.html#cb14-3" tabindex="-1"></a>                        <span class="at">ATE =</span> <span class="dv">0</span>, <span class="at">ICC =</span> <span class="fl">0.4</span>,</span>
<span id="cb14-4"><a href="chap_DGP.html#cb14-4" tabindex="-1"></a>                        <span class="at">size_coef =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">0</span> ) {</span>
<span id="cb14-5"><a href="chap_DGP.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="chap_DGP.html#cb14-6" tabindex="-1"></a>  <span class="fu">stopifnot</span>( ICC <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> ICC <span class="sc">&lt;</span> <span class="dv">1</span> )</span>
<span id="cb14-7"><a href="chap_DGP.html#cb14-7" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="chap_DGP.html#cb14-8" tabindex="-1"></a>  <span class="fu">scat</span>( <span class="st">&quot;Running n=%d, J=%d, ICC=%.2f, ATE=%.2f (%d replicates)</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb14-9"><a href="chap_DGP.html#cb14-9" tabindex="-1"></a>        n_bar, J, ICC, ATE, reps)</span>
<span id="cb14-10"><a href="chap_DGP.html#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="chap_DGP.html#cb14-11" tabindex="-1"></a>  res <span class="ot">&lt;-</span> </span>
<span id="cb14-12"><a href="chap_DGP.html#cb14-12" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">rerun</span>( reps, {</span>
<span id="cb14-13"><a href="chap_DGP.html#cb14-13" tabindex="-1"></a>      dat <span class="ot">&lt;-</span> <span class="fu">gen_dat_model</span>( <span class="at">n_bar =</span> n_bar, <span class="at">J =</span> J, <span class="at">p =</span> p,</span>
<span id="cb14-14"><a href="chap_DGP.html#cb14-14" tabindex="-1"></a>                            <span class="at">gamma_0 =</span> <span class="dv">0</span>, <span class="at">gamma_1 =</span> ATE, <span class="at">gamma_2 =</span> size_coef,</span>
<span id="cb14-15"><a href="chap_DGP.html#cb14-15" tabindex="-1"></a>                            <span class="at">sigma2_u =</span> ICC, <span class="at">sigma2_e =</span> <span class="dv">1</span> <span class="sc">-</span> ICC,</span>
<span id="cb14-16"><a href="chap_DGP.html#cb14-16" tabindex="-1"></a>                            <span class="at">alpha =</span> alpha )</span>
<span id="cb14-17"><a href="chap_DGP.html#cb14-17" tabindex="-1"></a>      <span class="fu">analyze_data</span>(dat)</span>
<span id="cb14-18"><a href="chap_DGP.html#cb14-18" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb14-19"><a href="chap_DGP.html#cb14-19" tabindex="-1"></a>    <span class="fu">bind_rows</span>( <span class="at">.id=</span><span class="st">&quot;runID&quot;</span> )</span>
<span id="cb14-20"><a href="chap_DGP.html#cb14-20" tabindex="-1"></a>}</span></code></pre></div>
<p>Note the <code>stopifnot</code>: it is wise to ensure our parameter transforms are all reasonable, so we don’t get unexplained errors or strange results.</p>
<p>We are transforming our ICC parameter into specific other parameters that are used in our actual model to maintain our effect size interpretation of our simulation.
We haven’t even modified <code>gen_dat_model</code> method: we are just specifying the constellation of parameters as a function of the parameters we want to directly control in the simulation.</p>
</div>
</div>
<div id="exercises" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Exercises<a href="chap_DGP.html#exercises" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ex_dgp" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> The Shifted-and-scaled t distribution<a href="chap_DGP.html#ex_dgp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The shifted-and-scaled <span class="math inline">\(t\)</span>-distribution has parameters <span class="math inline">\(\mu\)</span> (mean), <span class="math inline">\(\sigma\)</span> (scale), and <span class="math inline">\(\nu\)</span> (degrees of freedom).
If <span class="math inline">\(T\)</span> follows a student’s <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(\nu\)</span> degrees of freedom, then <span class="math inline">\(S = \mu + \sigma T\)</span> follows a shifted-and-scaled <span class="math inline">\(t\)</span>-distribution.</p>
<p>The following function will generate random draws from this distribution (the scaling of <span class="math inline">\((\nu-2)/\nu\)</span> is to account for a non-scaled <span class="math inline">\(t\)</span>-distribution having a variance of <span class="math inline">\(\nu/(\nu-2)\)</span>).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chap_DGP.html#cb15-1" tabindex="-1"></a>r_tss <span class="ot">&lt;-</span> <span class="cf">function</span>(n, mean, sd, df) {</span>
<span id="cb15-2"><a href="chap_DGP.html#cb15-2" tabindex="-1"></a>  mean <span class="sc">+</span> sd <span class="sc">*</span> <span class="fu">sqrt</span>( (df<span class="dv">-2</span>)<span class="sc">/</span>df ) <span class="sc">*</span> <span class="fu">rt</span>(<span class="at">n =</span> n, <span class="at">df =</span> df)</span>
<span id="cb15-3"><a href="chap_DGP.html#cb15-3" tabindex="-1"></a>}</span>
<span id="cb15-4"><a href="chap_DGP.html#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="chap_DGP.html#cb15-5" tabindex="-1"></a><span class="fu">r_tss</span>(<span class="at">n =</span> <span class="dv">8</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">2</span>, <span class="at">df =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 3.524201 3.719571 2.999194 4.872720 1.615886 2.980145 3.766098 4.143210</code></pre>
<ol style="list-style-type: decimal">
<li><p>Modify the above <code>simulate_data</code> function to generate data from shifted-and-scaled <span class="math inline">\(t\)</span>-distributions rather than from normal distributions. Include the degrees of freedom as an input argument.
Simulate a dataset with low degrees of freedom and plot it to see if you see a few outliers.</p></li>
<li><p>Now generate more data and calculate the standard deviations to see if they are correctly calibrated (generate a big dataset to ensure you get a reliable standard deviation estimate).</p></li>
<li><p>Once you are satisfied you have a correct DGP function, re-run the Type-I error rate calculations from the prior exercises <a href="case_ANOVA.html#exAnovaExercises">link</a> on page <span class="citation">(<a href="#ref-exAnovaExercises"><strong>exAnovaExercises?</strong></a>)</span> using a <span class="math inline">\(t\)</span>-distribution with 5 degrees of freedom.
Do the results change substantially?</p></li>
</ol>
</div>
<div id="the-cluster-rct-dgp" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> The Cluster RCT DGP<a href="chap_DGP.html#the-cluster-rct-dgp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol start="4" style="list-style-type: decimal">
<li><p>What is the variance of the outcomes generated by our model if there is no treatment effect? (Try simulating data to check!) What other quick checks can you make on your DGP to make sure it is working?</p></li>
<li><p>In gen_dat_model we have the following line of code to generate the number of individuals per site.</p></li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chap_DGP.html#cb17-1" tabindex="-1"></a>nj <span class="ot">&lt;-</span> <span class="fu">sample</span>( n_min<span class="sc">:</span>n_max, J, </span>
<span id="cb17-2"><a href="chap_DGP.html#cb17-2" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<p>This code has an error. Generate a variety of datasets where you vary <code>n_min</code>, <code>n_max</code> and <code>J</code> to discover the error. Then repair the code.
Checking your data generating process across a range of scenarios is extremely important.</p>
<ol start="6" style="list-style-type: decimal">
<li>Extend the data generating process to include an individual level covariate <span class="math inline">\(X\)</span> that is predictive of outcome. In particular, you will want to adjust your level one equation to</li>
</ol>
<p><span class="math display">\[ Y_{ij} = \beta_{0j} + \beta_{1} X_{ij} + \epsilon_{ij} . \]</span>
Keep the same <span class="math inline">\(\beta_1\)</span> for all sites.
You will have to specify how to generate your <span class="math inline">\(X_{ij}\)</span>.
For starters, just generate it as a standard normal, and don’t worry about having the mean of <span class="math inline">\(X_{ij}\)</span> vary by sites unless you are excited to try to get that to work.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case_ANOVA.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimation-procedures-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/020-data-generating-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
