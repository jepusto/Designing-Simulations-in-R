<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Case study: The Power and Validity of Neyman’s ATE Estimate | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Case study: The Power and Validity of Neyman’s ATE Estimate | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Case study: The Power and Validity of Neyman’s ATE Estimate | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="James E. Pustejovsky and Luke W. Miratrix" />


<meta name="date" content="2022-05-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="parallel-processing.html"/>
<link rel="next" href="design-analysis-and-presentation-of-simulation-results.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-r-and-rstudio"><i class="fa fa-check"></i><b>1.3</b> Why R and RStudio?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#some-preliminaries"><i class="fa fa-check"></i><b>1.4</b> Some preliminaries</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>1.4.1</b> Functions</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#a-dangerous-function"><i class="fa fa-check"></i><b>1.4.2</b> A dangerous function</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction.html"><a href="introduction.html#function-skeletons"><i class="fa fa-check"></i><b>1.4.3</b> Function skeletons</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction.html"><a href="introduction.html#pipe-dreams"><i class="fa fa-check"></i><b>1.4.4</b> <code>%&gt;%</code> (Pipe) dreams</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html"><i class="fa fa-check"></i><b>2</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulation-for-a-single-scenario"><i class="fa fa-check"></i><b>2.1</b> Simulation for a single scenario</a></li>
<li class="chapter" data-level="2.2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>2.2</b> Simulating across different scenarios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>3</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>3.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-simulations"><i class="fa fa-check"></i><b>3.2</b> Tidy simulations</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-model"><i class="fa fa-check"></i><b>3.2.1</b> Data-generating model</a></li>
<li class="chapter" data-level="3.2.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-methods"><i class="fa fa-check"></i><b>3.2.2</b> Estimation methods</a></li>
<li class="chapter" data-level="3.2.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>3.2.3</b> Repetition</a></li>
<li class="chapter" data-level="3.2.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>3.2.4</b> Performance summaries</a></li>
<li class="chapter" data-level="3.2.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#results"><i class="fa fa-check"></i><b>3.2.5</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multiple-scenarios"><i class="fa fa-check"></i><b>3.3</b> Multiple Scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#keeping-the-pieces-organized"><i class="fa fa-check"></i><b>3.4</b> Keeping the pieces organized</a></li>
<li class="chapter" data-level="3.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#further-readings-resources"><i class="fa fa-check"></i><b>3.5</b> Further readings &amp; resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="case_ANOVA.html"><a href="case_ANOVA.html"><i class="fa fa-check"></i><b>4</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>4.1</b> The data-generating model</a></li>
<li class="chapter" data-level="4.2" data-path="case_ANOVA.html"><a href="case_ANOVA.html#the-estimation-procedures"><i class="fa fa-check"></i><b>4.2</b> The estimation procedures</a></li>
<li class="chapter" data-level="4.3" data-path="case_ANOVA.html"><a href="case_ANOVA.html#replication"><i class="fa fa-check"></i><b>4.3</b> Replication</a></li>
<li class="chapter" data-level="4.4" data-path="case_ANOVA.html"><a href="case_ANOVA.html#calculating-rejection-rates"><i class="fa fa-check"></i><b>4.4</b> Calculating rejection rates</a></li>
<li class="chapter" data-level="4.5" data-path="case_ANOVA.html"><a href="case_ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-generating-models.html"><a href="data-generating-models.html"><i class="fa fa-check"></i><b>5</b> Data-generating models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-generating-models.html"><a href="data-generating-models.html#computational-efficiency-versus-simplicity"><i class="fa fa-check"></i><b>5.1</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="5.2" data-path="data-generating-models.html"><a href="data-generating-models.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>5.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="5.3" data-path="data-generating-models.html"><a href="data-generating-models.html#exercises"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-generating-models.html"><a href="data-generating-models.html#shifted-and-scaled-t-distribution"><i class="fa fa-check"></i><b>5.3.1</b> Shifted-and-scaled t distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="estimation-procedures.html"><a href="estimation-procedures.html"><i class="fa fa-check"></i><b>6</b> Estimation procedures</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estimation-procedures.html"><a href="estimation-procedures.html#further-notes-on-computational-efficiency"><i class="fa fa-check"></i><b>6.1</b> Further notes on computational efficiency</a></li>
<li class="chapter" data-level="6.2" data-path="estimation-procedures.html"><a href="estimation-procedures.html#checking-the-estimation-function"><i class="fa fa-check"></i><b>6.2</b> Checking the estimation function</a></li>
<li class="chapter" data-level="6.3" data-path="estimation-procedures.html"><a href="estimation-procedures.html#exercises-1"><i class="fa fa-check"></i><b>6.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="estimation-procedures.html"><a href="estimation-procedures.html#adding-the-bff-test"><i class="fa fa-check"></i><b>6.3.1</b> Adding the BFF* test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>7</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-vs.-estimation"><i class="fa fa-check"></i><b>7.1</b> Inference vs. Estimation</a></li>
<li class="chapter" data-level="7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#evaluation-of-estimation-methods"><i class="fa fa-check"></i><b>7.2</b> Evaluation of Estimation Methods</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-actual-properties"><i class="fa fa-check"></i><b>7.2.1</b> Assessing actual properties</a></li>
<li class="chapter" data-level="7.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-estimated-properties"><i class="fa fa-check"></i><b>7.2.2</b> Assessing estimated properties</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>7.3</b> Assessing a point estimator</a></li>
<li class="chapter" data-level="7.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>7.4</b> Assessing a standard error estimator</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-widehatse-directly"><i class="fa fa-check"></i><b>7.4.1</b> Why not assess <span class="math inline">\(widehat{SE}\)</span> directly?</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-hypothesis-testing-procedure"><i class="fa fa-check"></i><b>7.5</b> Assessing a hypothesis testing procedure</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>7.5.1</b> Validity</a></li>
<li class="chapter" data-level="7.5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>7.5.2</b> Power</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>7.6</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="7.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-our-performance-estimates-the-mcse"><i class="fa fa-check"></i><b>7.7</b> Uncertainty in our performance estimates (the MCSE)</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-variance-estimators"><i class="fa fa-check"></i><b>7.7.1</b> MCSE for variance estimators</a></li>
<li class="chapter" data-level="7.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#the-simhelpers-package-and-mcses"><i class="fa fa-check"></i><b>7.7.2</b> The simhelpers package and MCSEs</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="performance-criteria.html"><a href="performance-criteria.html#absolute-vs.-relative-performance-measures"><i class="fa fa-check"></i><b>7.8</b> Absolute vs. relative performance measures</a></li>
<li class="chapter" data-level="7.9" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-simulating-cronbachs-alpha"><i class="fa fa-check"></i><b>7.9</b> Exercises: Simulating Cronbach’s alpha</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#the-data-generating-function"><i class="fa fa-check"></i><b>7.9.1</b> The data-generating function</a></li>
<li class="chapter" data-level="7.9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#the-estimation-function"><i class="fa fa-check"></i><b>7.9.2</b> The estimation function</a></li>
<li class="chapter" data-level="7.9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#replicates"><i class="fa fa-check"></i><b>7.9.3</b> Replicates</a></li>
<li class="chapter" data-level="7.9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#estimator-performance"><i class="fa fa-check"></i><b>7.9.4</b> Estimator performance</a></li>
<li class="chapter" data-level="7.9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-interval-coverage"><i class="fa fa-check"></i><b>7.9.5</b> Confidence interval coverage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>8</b> Case study: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#data-generating-model-1"><i class="fa fa-check"></i><b>8.1</b> Data-generating model</a></li>
<li class="chapter" data-level="8.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimation-procedures-1"><i class="fa fa-check"></i><b>8.2</b> Estimation procedures</a></li>
<li class="chapter" data-level="8.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#performance-calculations"><i class="fa fa-check"></i><b>8.3</b> Performance calculations</a></li>
<li class="chapter" data-level="8.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#simulation-driver"><i class="fa fa-check"></i><b>8.4</b> Simulation driver</a></li>
<li class="chapter" data-level="8.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#running-the-simulation"><i class="fa fa-check"></i><b>8.5</b> Running the simulation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html"><i class="fa fa-check"></i><b>9</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>9.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="9.2" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>9.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="9.3" data-path="ensuring-reproducibility.html"><a href="ensuring-reproducibility.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>9.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>10</b> More on functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10.1</b> Default arguments for functions</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="case_cluster.html"><a href="case_cluster.html"><i class="fa fa-check"></i><b>11</b> Case study: A simulation with clustered data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="case_cluster.html"><a href="case_cluster.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>11.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="11.2" data-path="case_cluster.html"><a href="case_cluster.html#a-mathematical-model-for-cluster-randomized-data"><i class="fa fa-check"></i><b>11.2</b> A mathematical model for cluster-randomized data</a></li>
<li class="chapter" data-level="11.3" data-path="case_cluster.html"><a href="case_cluster.html#multilevel-data-generation-is-a-recipe-using-a-statistical-model"><i class="fa fa-check"></i><b>11.3</b> Multilevel data generation is a recipe using a statistical model</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="case_cluster.html"><a href="case_cluster.html#generating-the-multisite-data"><i class="fa fa-check"></i><b>11.3.1</b> Generating the multisite data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="case_cluster.html"><a href="case_cluster.html#analyzing-our-data"><i class="fa fa-check"></i><b>11.4</b> Analyzing our data</a></li>
<li class="chapter" data-level="11.5" data-path="case_cluster.html"><a href="case_cluster.html#the-simulation"><i class="fa fa-check"></i><b>11.5</b> The simulation</a></li>
<li class="chapter" data-level="11.6" data-path="case_cluster.html"><a href="case_cluster.html#analysis-of-our-single-scenario"><i class="fa fa-check"></i><b>11.6</b> Analysis of our single scenario</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="case_cluster.html"><a href="case_cluster.html#are-the-estimators-biased"><i class="fa fa-check"></i><b>11.6.1</b> Are the estimators biased?</a></li>
<li class="chapter" data-level="11.6.2" data-path="case_cluster.html"><a href="case_cluster.html#which-method-has-the-smallest-standard-error"><i class="fa fa-check"></i><b>11.6.2</b> Which method has the smallest standard error?</a></li>
<li class="chapter" data-level="11.6.3" data-path="case_cluster.html"><a href="case_cluster.html#which-method-has-the-smallest-root-mean-squared-error"><i class="fa fa-check"></i><b>11.6.3</b> Which method has the smallest Root Mean Squared Error?</a></li>
<li class="chapter" data-level="11.6.4" data-path="case_cluster.html"><a href="case_cluster.html#do-the-methods-have-correctly-estimated-standard-errors"><i class="fa fa-check"></i><b>11.6.4</b> Do the methods have correctly estimated standard errors?</a></li>
<li class="chapter" data-level="11.6.5" data-path="case_cluster.html"><a href="case_cluster.html#did-we-have-enough-simulation-trials"><i class="fa fa-check"></i><b>11.6.5</b> Did we have enough simulation trials?</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="case_cluster.html"><a href="case_cluster.html#extending-to-a-multifactor-simulation"><i class="fa fa-check"></i><b>11.7</b> Extending to a multifactor simulation</a></li>
<li class="chapter" data-level="11.8" data-path="case_cluster.html"><a href="case_cluster.html#standardization-in-a-data-generating-process"><i class="fa fa-check"></i><b>11.8</b> Standardization in a data generating process</a></li>
<li class="chapter" data-level="11.9" data-path="case_cluster.html"><a href="case_cluster.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.9</b> Making analyze_data() quiet</a></li>
<li class="chapter" data-level="11.10" data-path="case_cluster.html"><a href="case_cluster.html#where-to-compute-performance-measures-inside-vs.-outside"><i class="fa fa-check"></i><b>11.10</b> Where to compute performance measures: inside vs. outside?</a></li>
<li class="chapter" data-level="11.11" data-path="case_cluster.html"><a href="case_cluster.html#run-the-simulation"><i class="fa fa-check"></i><b>11.11</b> Run the simulation</a></li>
<li class="chapter" data-level="11.12" data-path="case_cluster.html"><a href="case_cluster.html#analyzing-our-results"><i class="fa fa-check"></i><b>11.12</b> Analyzing our results</a>
<ul>
<li class="chapter" data-level="11.12.1" data-path="case_cluster.html"><a href="case_cluster.html#checking-on-convergence-issues"><i class="fa fa-check"></i><b>11.12.1</b> Checking on convergence issues</a></li>
<li class="chapter" data-level="11.12.2" data-path="case_cluster.html"><a href="case_cluster.html#calculating-standard-metrics"><i class="fa fa-check"></i><b>11.12.2</b> Calculating standard metrics</a></li>
<li class="chapter" data-level="11.12.3" data-path="case_cluster.html"><a href="case_cluster.html#bias-analysis"><i class="fa fa-check"></i><b>11.12.3</b> Bias analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.13" data-path="case_cluster.html"><a href="case_cluster.html#exercises-2"><i class="fa fa-check"></i><b>11.13</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>12</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="12.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>12.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings"><i class="fa fa-check"></i><b>12.1.1</b> What to do with warnings</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#saving-files-and-results"><i class="fa fa-check"></i><b>12.2</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>12.2.1</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="12.2.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#dynamically-making-directories"><i class="fa fa-check"></i><b>12.2.2</b> Dynamically making directories</a></li>
<li class="chapter" data-level="12.2.3" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>12.2.3</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="exp_design.html"><a href="exp_design.html"><i class="fa fa-check"></i><b>13</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="13.1" data-path="exp_design.html"><a href="exp_design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>13.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="13.2" data-path="exp_design.html"><a href="exp_design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>13.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="13.3" data-path="exp_design.html"><a href="exp_design.html#keeping-things-organized-and-the-source-command"><i class="fa fa-check"></i><b>13.3</b> Keeping things organized and the source command</a></li>
<li class="chapter" data-level="13.4" data-path="exp_design.html"><a href="exp_design.html#analyzing-results-from-a-multifactor-experiment"><i class="fa fa-check"></i><b>13.4</b> Analyzing results from a multifactor experiment</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="exp_design.html"><a href="exp_design.html#bundling"><i class="fa fa-check"></i><b>13.4.1</b> Bundling</a></li>
<li class="chapter" data-level="13.4.2" data-path="exp_design.html"><a href="exp_design.html#aggregation"><i class="fa fa-check"></i><b>13.4.2</b> Aggregation</a></li>
<li class="chapter" data-level="13.4.3" data-path="exp_design.html"><a href="exp_design.html#regression-summarization"><i class="fa fa-check"></i><b>13.4.3</b> Regression Summarization</a></li>
<li class="chapter" data-level="13.4.4" data-path="exp_design.html"><a href="exp_design.html#focus-on-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>13.4.4</b> Focus on subset, kick rest to supplement</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: A simulation to compare different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-data-generating-process"><i class="fa fa-check"></i><b>14.1</b> The data generating process</a></li>
<li class="chapter" data-level="14.2" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>14.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="14.3" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>14.3</b> The simulation itself</a></li>
<li class="chapter" data-level="14.4" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>14.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="14.5" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>14.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="14.6" data-path="case-study-a-simulation-to-compare-different-estimators.html"><a href="case-study-a-simulation-to-compare-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>14.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>15</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="15.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>15.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="15.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>15.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>15.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="15.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>15.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="15.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>15.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="15.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>15.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="15.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>15.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="15.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>15.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><i class="fa fa-check"></i><b>16</b> Case study: The Power and Validity of Neyman’s ATE Estimate</a>
<ul>
<li class="chapter" data-level="16.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-1-write-a-function-for-a-specific-simulation-given-specific-parameters."><i class="fa fa-check"></i><b>16.1</b> Step 1: Write a function for a specific simulation given specific parameters.</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#running-our-single-trial-more-than-once"><i class="fa fa-check"></i><b>16.1.1</b> Running our single trial more than once</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-2-make-a-dataframe-of-all-experimental-combinations-desired"><i class="fa fa-check"></i><b>16.2</b> Step 2: Make a dataframe of all experimental combinations desired</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-3-explore-results"><i class="fa fa-check"></i><b>16.3</b> Step 3: Explore results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#visualizing-experimental-results"><i class="fa fa-check"></i><b>16.3.1</b> Visualizing experimental results</a></li>
<li class="chapter" data-level="16.3.2" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#looking-at-main-effects"><i class="fa fa-check"></i><b>16.3.2</b> Looking at main effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#addendum-saving-more-details"><i class="fa fa-check"></i><b>16.4</b> Addendum: Saving more details</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="case-study-the-power-and-validity-of-neymans-ate-estimate.html"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#getting-results-ready-for-analysis"><i class="fa fa-check"></i><b>16.4.1</b> Getting results ready for analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>17</b> Design, analysis, and presentation of simulation results</a>
<ul>
<li class="chapter" data-level="17.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#designing-the-simulation-experiment"><i class="fa fa-check"></i><b>17.1</b> Designing the simulation experiment</a></li>
<li class="chapter" data-level="17.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#choosing-parameter-levels"><i class="fa fa-check"></i><b>17.2</b> Choosing parameter levels</a></li>
<li class="chapter" data-level="17.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation"><i class="fa fa-check"></i><b>17.3</b> Presentation</a></li>
<li class="chapter" data-level="17.4" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>17.4</b> Tabulation</a></li>
<li class="chapter" data-level="17.5" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>17.5</b> Visualization</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>17.5.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="17.5.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>17.5.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="17.5.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>17.5.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>17.6</b> Modeling</a></li>
<li class="chapter" data-level="17.7" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation-1"><i class="fa fa-check"></i><b>17.7</b> Presentation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html"><i class="fa fa-check"></i><b>18</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="18.1" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>18.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="18.2" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>18.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="18.3" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>18.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="18.4" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>18.4</b> Nested finite simulation procedure</a></li>
<li class="chapter" data-level="18.5" data-path="simulation-under-the-potential-outcomes-framework.html"><a href="simulation-under-the-potential-outcomes-framework.html#calibrated-simulations-and-the-potential-outcomes-framework"><i class="fa fa-check"></i><b>18.5</b> Calibrated simulations and the potential outcomes framework</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>19</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="19.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-extensive-multi-factor-simulations"><i class="fa fa-check"></i><b>19.1</b> Use extensive multi-factor simulations</a></li>
<li class="chapter" data-level="19.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#beat-them-at-their-own-game"><i class="fa fa-check"></i><b>19.2</b> Beat them at their own game</a></li>
<li class="chapter" data-level="19.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrated-simulations"><i class="fa fa-check"></i><b>19.3</b> Calibrated simulations</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>20</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="20.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>20.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-study-the-power-and-validity-of-neymans-ate-estimate" class="section level1 hasAnchor" number="16">
<h1><span class="header-section-number">Chapter 16</span> Case study: The Power and Validity of Neyman’s ATE Estimate<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#case-study-the-power-and-validity-of-neymans-ate-estimate" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The way to build a simulation experiment is to first write code to run a
specific simulation for a specific scenario. Once that is working, we will
re-use the code to systematically explore a variety of scenarios so we can
see how things change as scenario changes. Next I would build up this system.</p>
<p>For our running example we are going to look at a randomized experiment. We
will assume the treatment and control groups are normally distributed with
two different means. We will generate a random data set, estimate the
treatment effect by taking the difference in means and calculating the
associated standard error, and generating a <span class="math inline">\(p\)</span>-value using the normal
approximation. (As we will see, this is not a good idea for small sample
size since we should be using a <span class="math inline">\(t\)</span>-test style approach.)</p>
<div id="step-1-write-a-function-for-a-specific-simulation-given-specific-parameters." class="section level2 hasAnchor" number="16.1">
<h2><span class="header-section-number">16.1</span> Step 1: Write a function for a specific simulation given specific parameters.<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-1-write-a-function-for-a-specific-simulation-given-specific-parameters." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our function will generate two groups of the given sizes, one treatment and
one control, and then calculate the difference in means. It will then test
this difference using the normal approximation.</p>
<p>The function also calculates and returns the effect size as the treatment
effect divided by the control standard deviation (useful for understanding
power, shown later on).</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-1" aria-hidden="true" tabindex="-1"></a>run.one <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sd, tau, <span class="at">mu =</span> <span class="dv">5</span> ) {</span>
<span id="cb376-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  Y0 <span class="ot">=</span> mu <span class="sc">+</span> <span class="fu">rnorm</span>( nC, <span class="at">sd=</span>sd )</span>
<span id="cb376-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-3" aria-hidden="true" tabindex="-1"></a>  Y1 <span class="ot">=</span> mu <span class="sc">+</span> tau <span class="sc">+</span> <span class="fu">rnorm</span>( nT, <span class="at">sd=</span>sd )</span>
<span id="cb376-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-5" aria-hidden="true" tabindex="-1"></a>  tau.hat <span class="ot">=</span> <span class="fu">mean</span>( Y1 ) <span class="sc">-</span> <span class="fu">mean</span>( Y0 )</span>
<span id="cb376-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-6" aria-hidden="true" tabindex="-1"></a>  SE.hat <span class="ot">=</span> <span class="fu">sqrt</span>( <span class="fu">var</span>( Y0 ) <span class="sc">/</span> ( nC ) <span class="sc">+</span> <span class="fu">var</span>( Y1 ) <span class="sc">/</span> ( nT ) )</span>
<span id="cb376-7"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-8"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-8" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> tau.hat <span class="sc">/</span> SE.hat</span>
<span id="cb376-9"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-9" aria-hidden="true" tabindex="-1"></a>  pv <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>( <span class="fu">abs</span>( z ) ))</span>
<span id="cb376-10"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-11"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>( <span class="at">tau.hat =</span> tau.hat, <span class="at">ES =</span> tau <span class="sc">/</span> sd, <span class="at">SE.hat =</span> SE.hat, <span class="at">z=</span>z, <span class="at">p.value=</span>pv )</span>
<span id="cb376-12"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb376-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>A single run will generate a data set, analyze it, and give us back a variety
of results as a one-row dataframe. It will turn out that having results in a
dataframe makes using the tidyverse easier.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run.one</span>( <span class="at">nT=</span><span class="dv">5</span>, <span class="at">nC=</span><span class="dv">10</span>, <span class="at">sd=</span><span class="dv">1</span>, <span class="at">tau=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##     tau.hat  ES    SE.hat        z   p.value
## 1 0.0540692 0.5 0.5395857 0.100205 0.9201816</code></pre>
<div id="running-our-single-trial-more-than-once" class="section level3 hasAnchor" number="16.1.1">
<h3><span class="header-section-number">16.1.1</span> Running our single trial more than once<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#running-our-single-trial-more-than-once" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We <code>replicate()</code> and then stack everything to get all our results.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb379-1" aria-hidden="true" tabindex="-1"></a>eres <span class="ot">&lt;-</span> <span class="fu">replicate</span>( <span class="dv">500</span>, <span class="fu">run.one</span>( <span class="at">nC=</span><span class="dv">10</span>, <span class="at">nT=</span><span class="dv">10</span>, <span class="at">sd=</span><span class="dv">1</span>, <span class="at">tau=</span><span class="fl">0.5</span> ), <span class="at">simplify =</span> <span class="cn">FALSE</span> )</span>
<span id="cb379-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb379-2" aria-hidden="true" tabindex="-1"></a>eres <span class="ot">=</span> <span class="fu">bind_rows</span>( eres )</span></code></pre></div>
<p>Now we see why the dataframe return value of <code>run.one</code> is useful: we can then
stack all of our simulation runs to get our final set of results.
Each row is a simulation run:
head( eres )</p>
<p>We then summarize our results with the <code>dplyr</code> <code>summarise</code> function. Our
summarization calculates the average treatment effect estimate <code>E.tau.hat</code>,
the average Standard Error estimate <code>E.SE.hat</code>, the average Effect Size <code>ES</code>,
and the power <code>power</code> (defined as the percent of time we reject at
alpha=0.05, i.e., the percent of times our <span class="math inline">\(p\)</span>-value was less than our 0.05
threshold):</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb380-1" aria-hidden="true" tabindex="-1"></a>eres <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">E.tau.hat =</span> <span class="fu">mean</span>( tau.hat ),</span>
<span id="cb380-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb380-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">E.SE.hat =</span> <span class="fu">mean</span>( SE.hat ),</span>
<span id="cb380-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb380-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ES =</span> <span class="fu">mean</span>( ES ),</span>
<span id="cb380-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb380-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">power =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) )</span></code></pre></div>
<pre><code>##   E.tau.hat  E.SE.hat  ES power
## 1 0.5308502 0.4343176 0.5 0.242</code></pre>
<p>We bundle the above into a function that runs our single trial multiple times and
summarizes the results:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-1" aria-hidden="true" tabindex="-1"></a>run.experiment <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sd, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">R =</span> <span class="dv">500</span> ) {</span>
<span id="cb382-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-3" aria-hidden="true" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">replicate</span>( R, <span class="fu">run.one</span>( nC, nT, sd, tau, mu ), <span class="at">simplify=</span><span class="cn">FALSE</span> )</span>
<span id="cb382-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-4" aria-hidden="true" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">bind_rows</span>( eres )</span>
<span id="cb382-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-5" aria-hidden="true" tabindex="-1"></a>  eres <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">E.tau.hat =</span> <span class="fu">mean</span>( tau.hat ),</span>
<span id="cb382-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">E.SE.hat =</span> <span class="fu">mean</span>( SE.hat ),</span>
<span id="cb382-7"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ES =</span> <span class="fu">mean</span>( ES ),</span>
<span id="cb382-8"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">power =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb382-9"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sd=</span>sd, <span class="at">tau=</span>tau, <span class="at">mu=</span>mu, <span class="at">R=</span>R )</span>
<span id="cb382-10"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb382-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Our function also adds in the details of the simulation (the parameters we passed
to the <code>run.one()</code> call). This is an easy way to keep track of things.</p>
<p>Test our function to see what we get:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run.experiment</span>( <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##   E.tau.hat  E.SE.hat  ES power nC nT sd tau mu   R
## 1 0.5032869 0.6139875 0.5 0.208 10  3  1 0.5  5 500</code></pre>
<p>Key point: We also want a dataframe back from <code>run.experiment()</code>, because,
after calling <code>run.experiment()</code> many times, we are going to stack the
results up to make one long dataframe of results. Happily the <code>dplyr</code>
package gives us dataframes so this is not a problem here.</p>
</div>
</div>
<div id="step-2-make-a-dataframe-of-all-experimental-combinations-desired" class="section level2 hasAnchor" number="16.2">
<h2><span class="header-section-number">16.2</span> Step 2: Make a dataframe of all experimental combinations desired<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-2-make-a-dataframe-of-all-experimental-combinations-desired" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use the above to run a <em>multi-factor simulation experiment</em>. We are
going to vary four factors: control group size, treatment group size,
standard deviation of the units, and the treatment effect.</p>
<p>We first set up the levels we want to have for each of our factors
(these are our <em>simulation parameters</em>).</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb385-1" aria-hidden="true" tabindex="-1"></a>nC <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb385-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb385-2" aria-hidden="true" tabindex="-1"></a>nT <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">500</span> )</span>
<span id="cb385-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb385-3" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> )</span>
<span id="cb385-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb385-4" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span> )</span></code></pre></div>
<p>We then, using <code>expand_grid()</code> generate a dataframe of all
combinations of our factors.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb386-1" aria-hidden="true" tabindex="-1"></a>experiments <span class="ot">=</span> <span class="fu">expand_grid</span>( <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sd=</span>sds, <span class="at">tau=</span>tau )</span>
<span id="cb386-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb386-2" aria-hidden="true" tabindex="-1"></a>experiments</span></code></pre></div>
<pre><code>## # A tibble: 216 × 4
##       nC    nT    sd   tau
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     2     2     1   0  
##  2     2     2     1   0.5
##  3     2     2     1   1  
##  4     2     2     2   0  
##  5     2     2     2   0.5
##  6     2     2     2   1  
##  7     2     4     1   0  
##  8     2     4     1   0.5
##  9     2     4     1   1  
## 10     2     4     2   0  
## # … with 206 more rows</code></pre>
<p>See what we get? One row will correspond to a single experimental run. Note
how the parameters we would pass to <code>run.experiment()</code> correspond to the
columns of our dataset.</p>
<p>Also, is easy to end up running a lot of experiments! In this case we have
216!</p>
<p>We next run an experiment for each row of our dataframe of experiment factor
combinations using the <code>pmap_df()</code> function which will, for each row in our
dataframe, call <code>run.experiment()</code>, passing one parameter taken from each
column of our dataframe.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb388-1" aria-hidden="true" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span> <span class="fu">pmap_df</span>( run.experiment, <span class="at">R=</span><span class="dv">500</span> )</span></code></pre></div>
<p>The <code>R=500</code> after <code>run.experiment</code> passes the <em>same</em> parameter of <span class="math inline">\(R=500\)</span> to each
run (we run the same number of trials for each experiment).</p>
<p>Here is a peek at our results:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( exp.res )</span></code></pre></div>
<pre><code>##    E.tau.hat  E.SE.hat   ES power nC nT sd tau mu   R
## 1 0.01311053 0.8724541 0.00 0.196  2  2  1 0.0  5 500
## 2 0.53992204 0.8640737 0.50 0.228  2  2  1 0.5  5 500
## 3 0.98325407 0.8929156 1.00 0.340  2  2  1 1.0  5 500
## 4 0.01209447 1.7077286 0.00 0.170  2  2  2 0.0  5 500
## 5 0.39500948 1.8184304 0.25 0.176  2  2  2 0.5  5 500
## 6 1.05321453 1.8179832 0.50 0.230  2  2  2 1.0  5 500</code></pre>
<p>At this point you should save your simulation results to a file. This is
especially true if the simulation happens to be quite time-intensive to run.
Usually a csv file is sufficient.</p>
<p>We save using the tidyverse writing command; see “R for Data Science”
textbook, 11.5.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb391-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>( exp.res, <span class="st">&quot;results/simulation_results.csv&quot;</span> )</span></code></pre></div>
</div>
<div id="step-3-explore-results" class="section level2 hasAnchor" number="16.3">
<h2><span class="header-section-number">16.3</span> Step 3: Explore results<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#step-3-explore-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once your simulation is run, you want to evaluate the results. One would
often put this code into a seperate ‘.R’ file that loads this saved file to
start. This allows for easily changing how one analyzes an experiment
without re-running the entire thing.</p>
<div id="visualizing-experimental-results" class="section level3 hasAnchor" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Visualizing experimental results<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#visualizing-experimental-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Plotting is always a good way to vizualize simulation results. Here we make
our tau and ES into factors, so <code>ggplot</code> behaves, and then plot all our
experiments as two rows based on one factor (<code>sd</code>) with the columns being
another (<code>nT</code>). (This style of plotting a bunch of small plots is called
“many multiples” and is beloved by Tufte.) Within each plot we have the
x-axis for one factor (<code>nC</code>) and multiple lines for the final factor (<code>tau</code>).
The <span class="math inline">\(y\)</span>-axis is our outcome of interest, power. We add a 0.05 line to show
when we are rejecting at rates above our nominal <span class="math inline">\(\alpha\)</span>. This plot shows
the relationship of 5 variables.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb392-1" aria-hidden="true" tabindex="-1"></a>exp.res <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="st">&quot;results/simulation_results.csv&quot;</span> )</span></code></pre></div>
<pre><code>## Rows: 216 Columns: 10
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (10): E.tau.hat, E.SE.hat, ES, power, nC, nT, sd, tau, mu, R
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-1" aria-hidden="true" tabindex="-1"></a>exp.res <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">tau =</span> <span class="fu">as.factor</span>( tau ),</span>
<span id="cb394-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ES =</span> <span class="fu">as.factor</span>( ES ) )</span>
<span id="cb394-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb394-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( sd <span class="sc">~</span> nT, <span class="at">labeller=</span>label_both ) <span class="sc">+</span></span>
<span id="cb394-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb394-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb394-7"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb394-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-198-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p><strong>Note:</strong> We are seeing elevated rejection rates under the null for small and even
moderate sample size!</p>
<p>We can zoom in on specific simulations run, to get some more detail
such as estimated power under the null for larger groups. Here we check
and we are seeing rejection rates of around 0.05, which is what we want.
filter( exp.res, tau==0, nT &gt;= 50, nC &gt;= 50 )</p>
<p>We can get fancy and look at rejection rate (power under <code>tau = 0</code>) as a
function of both nC and nT using an interaction-style plot:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb395-1" aria-hidden="true" tabindex="-1"></a>exp.res.rej <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">filter</span>( tau <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb395-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( nC, nT ) <span class="sc">%&gt;%</span></span>
<span id="cb395-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ) )</span>
<span id="cb395-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb395-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb395-5" aria-hidden="true" tabindex="-1"></a>exp.res.rej <span class="ot">=</span> <span class="fu">mutate</span>( exp.res.rej, <span class="at">power =</span> <span class="fu">round</span>( power <span class="sc">*</span> <span class="dv">100</span> ) )</span></code></pre></div>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.rej, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>nT, <span class="at">col=</span><span class="fu">as.factor</span>(nT) ) ) <span class="sc">+</span></span>
<span id="cb396-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> nT ) <span class="sc">+</span></span>
<span id="cb396-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb396-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">5</span> ) <span class="sc">+</span></span>
<span id="cb396-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">limits =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="dv">30</span> ) ) <span class="sc">+</span></span>
<span id="cb396-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( exp.res.rej<span class="sc">$</span>nC ) ) <span class="sc">+</span></span>
<span id="cb396-7"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb396-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;# C&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Power&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;# T&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotResults-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note: This plot is somewhat imperfect. Increasing the number of simulation
runs per trial could help smooth out the trends. That being said, we see that
small tx or co groups are both bad here.</p>
</div>
<div id="looking-at-main-effects" class="section level3 hasAnchor" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Looking at main effects<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#looking-at-main-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can ignore a factor and just look at another. This is looking at the
<strong>main effect</strong> or <strong>marginal effect</strong> of the factor.</p>
<p>The easy way to do this is to let <code>ggplot</code> smooth our individual points on a
plot. Be sure to also plot the individual points to see variation, however.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb397-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( sd <span class="sc">~</span> ., <span class="at">labeller=</span>label_both ) <span class="sc">+</span></span>
<span id="cb397-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.02</span>, <span class="at">height=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb397-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb397-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb397-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb397-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotPool-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note how we see our individual runs that we marginalize over.</p>
<p>To look at our main effects we can also summarize our results, averaging our
experimental runs across other factor levels. For example, in the code below
we average over the different treatment group sizes and standard deviations,
and plot the marginalized results.</p>
<p>To marginalize, we group by the things we want to keep. <code>summarise()</code> then
averages over the things we want to get rid of.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb398-1" aria-hidden="true" tabindex="-1"></a>exp.res.sum <span class="ot">=</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( nC, tau ) <span class="sc">%&gt;%</span></span>
<span id="cb398-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb398-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">power =</span> <span class="fu">mean</span>( power ) )</span>
<span id="cb398-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb398-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( exp.res.sum )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   nC [2]
##      nC tau   power
##   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
## 1     2 0     0.211
## 2     2 0.5   0.243
## 3     2 1     0.348
## 4     4 0     0.116
## 5     4 0.5   0.174
## 6     4 1     0.306</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( exp.res.sum, <span class="fu">aes</span>( <span class="at">x=</span>nC, <span class="at">y=</span>power, <span class="at">group=</span>tau, <span class="at">col=</span>tau ) ) <span class="sc">+</span></span>
<span id="cb400-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb400-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb400-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb400-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks=</span>nC) <span class="sc">+</span></span>
<span id="cb400-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb400-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotCollapse-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We can try to get clever and look at other aspects of our experimental runs.
The above suggests that the smaller of the two groups is dictating things
going awry, in terms of elevated rejection rates under the null. We can also
look at things in terms of some other more easily interpretable parameter
(here we switch to effect size instead of raw treatment effect).</p>
<p>Given this, we might decide to look at total sample size or the smaller of
the two groups sample size and make plots that way (we are also subsetting to
just the <code>sd=1</code> cases as there is nothing really different about the two
options; we probably should average across but this could reduce clarity of
the presentation of results):</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb401-1" aria-hidden="true" tabindex="-1"></a>exp.res <span class="ot">&lt;-</span> exp.res <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">n =</span> nC <span class="sc">+</span> nT,</span>
<span id="cb401-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb401-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n.min =</span> <span class="fu">pmin</span>( nC, nT ) )</span></code></pre></div>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">filter</span>( exp.res, sd<span class="sc">==</span><span class="dv">1</span> ), <span class="fu">aes</span>( <span class="at">x=</span>n, <span class="at">y=</span>power, <span class="at">group=</span>ES, <span class="at">col=</span>ES ) ) <span class="sc">+</span></span>
<span id="cb402-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb402-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb402-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb402-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb402-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb402-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb402-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb402-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotA-1.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">filter</span>( exp.res, sd<span class="sc">==</span><span class="dv">1</span> ), <span class="fu">aes</span>( <span class="at">x=</span>n.min, <span class="at">y=</span>power, <span class="at">group=</span>ES, <span class="at">col=</span>ES ) ) <span class="sc">+</span></span>
<span id="cb403-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">width=</span><span class="fl">0.05</span>, <span class="at">height=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb403-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">span =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb403-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb403-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb403-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/plotB-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Note the few observations out in the high <code>n.min</code> region for the second
plot—this plot is a bit strange in that the different levels along the
x-axis are assymetric with respect to each other. It is not balanced.</p>
</div>
</div>
<div id="addendum-saving-more-details" class="section level2 hasAnchor" number="16.4">
<h2><span class="header-section-number">16.4</span> Addendum: Saving more details<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#addendum-saving-more-details" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our <code>exp.res</code> dataframe from above has all our simulations, one simulation per row, with
our measured outcomes. This is ideally all we need to analyze.</p>
<p>That being said, sometimes we might want to use a lot of disk space and keep
much more. In particular, each row of <code>exp.res</code> corresponds to the summary
of a whole collection of individual runs. We might instead store all of
these runs.</p>
<p>To do this we just take the summarizing step out of our <code>run.experiment()</code></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-1" aria-hidden="true" tabindex="-1"></a>run.experiment.raw <span class="ot">=</span> <span class="cf">function</span>( nC, nT, sd, tau, <span class="at">mu =</span> <span class="dv">5</span>, <span class="at">R =</span> <span class="dv">500</span> ) {</span>
<span id="cb404-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-2" aria-hidden="true" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">replicate</span>( R, <span class="fu">run.one</span>( nC, nT, sd, tau, mu ), <span class="at">simplify =</span> <span class="cn">FALSE</span> )</span>
<span id="cb404-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-3" aria-hidden="true" tabindex="-1"></a>  eres <span class="ot">=</span> <span class="fu">bind_rows</span>( eres )</span>
<span id="cb404-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-4" aria-hidden="true" tabindex="-1"></a>  eres <span class="ot">&lt;-</span> <span class="fu">mutate</span>( eres, <span class="at">nC=</span>nC, <span class="at">nT=</span>nT, <span class="at">sd=</span>sd, <span class="at">tau=</span>tau, <span class="at">mu=</span>mu, <span class="at">R=</span>R )</span>
<span id="cb404-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-5" aria-hidden="true" tabindex="-1"></a>  eres</span>
<span id="cb404-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb404-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Each call to <code>run.experiment.raw()</code> gives one row per run. We replicate our
simulation parameters for each row.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run.experiment.raw</span>( <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="at">R=</span><span class="dv">4</span> )</span></code></pre></div>
<pre><code>##     tau.hat  ES    SE.hat         z     p.value nC nT sd tau mu R
## 1 0.6135525 0.5 0.8888169 0.6903025 0.490003969 10  3  1 0.5  5 4
## 2 0.2597831 0.5 0.5401115 0.4809804 0.630530436 10  3  1 0.5  5 4
## 3 0.4963473 0.5 0.5679538 0.8739219 0.382160761 10  3  1 0.5  5 4
## 4 1.3488370 0.5 0.4478926 3.0115187 0.002599444 10  3  1 0.5  5 4</code></pre>
<p>The advantage of this is we can then generate new outcome measures, as they
occur to us, later on. The disadvantage is this result file will be <span class="math inline">\(R\)</span>
times as many rows as the older file, which can get quite, quite large.</p>
<p>But disk space is cheap! Here we run the same experiment with our more
complete storage. Note how the <code>pmap_df</code> stacks the
multiple rows from each run, giving us everything nicely bundled up:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb407-1" aria-hidden="true" tabindex="-1"></a>exp.res.full <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span> <span class="fu">pmap_df</span>( run.experiment.raw, <span class="at">R=</span><span class="dv">500</span> )</span>
<span id="cb407-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( exp.res.full )</span></code></pre></div>
<pre><code>##       tau.hat ES    SE.hat           z     p.value nC nT sd tau mu   R
## 1  0.05413216  0 1.2243659  0.04421240 0.964735098  2  2  1   0  5 500
## 2 -0.98301948  0 0.3004194 -3.27215676 0.001067304  2  2  1   0  5 500
## 3 -0.35344487  0 0.9861798 -0.35839802 0.720045476  2  2  1   0  5 500
## 4  0.34626891  0 1.3413763  0.25814450 0.796295390  2  2  1   0  5 500
## 5 -0.02718350  0 0.9248855 -0.02939121 0.976552583  2  2  1   0  5 500
## 6  1.36147713  0 0.8812838  1.54487938 0.122375441  2  2  1   0  5 500</code></pre>
<p>We end up with a lot more rows:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>( exp.res.full )</span></code></pre></div>
<pre><code>## [1] 108000</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>( exp.res )</span></code></pre></div>
<pre><code>## [1] 216</code></pre>
<p>We next save our results:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>( exp.res.full, <span class="st">&quot;results/simulation_results_full.csv&quot;</span> )</span></code></pre></div>
<p>Compare the file sizes: one is several k, the other is around 12 megabytes.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.size</span>(<span class="st">&quot;results/simulation_results.csv&quot;</span>) <span class="sc">/</span> <span class="dv">1024</span></span></code></pre></div>
<pre><code>## [1] 13.47266</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.size</span>(<span class="st">&quot;results/simulation_results_full.csv&quot;</span>) <span class="sc">/</span> <span class="dv">1024</span></span></code></pre></div>
<pre><code>## [1] 10156.77</code></pre>
<div id="getting-results-ready-for-analysis" class="section level3 hasAnchor" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> Getting results ready for analysis<a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#getting-results-ready-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we generated raw results then we need to collapse them by experimental run
before analyzing our results so we can explore the trends across the
experiments. We do this by borrowing the summarise code from inside
<code>run.experiment()</code>:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-1" aria-hidden="true" tabindex="-1"></a>exp.res.sum <span class="ot">&lt;-</span> exp.res.full <span class="sc">%&gt;%</span></span>
<span id="cb418-2"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( nC, nT, sd, tau, mu ) <span class="sc">%&gt;%</span></span>
<span id="cb418-3"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">R =</span> <span class="fu">n</span>(),</span>
<span id="cb418-4"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">E.tau.hat =</span> <span class="fu">mean</span>( tau.hat ),</span>
<span id="cb418-5"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">SE =</span> <span class="fu">sd</span>( tau.hat ),</span>
<span id="cb418-6"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">E.SE.hat =</span> <span class="fu">mean</span>( SE.hat ),</span>
<span id="cb418-7"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ES =</span> <span class="fu">mean</span>( ES ),</span>
<span id="cb418-8"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb418-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">power =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) )</span></code></pre></div>
<p>Note how I added an extra estimation of the true <span class="math inline">\(SE\)</span>, just because I could!
This is an easier fix, sometimes, than running all the simulations again
after changing the <code>run.experiment()</code> method.</p>
<p>The results of summarizing during the simulation vs. after as we just did
leads to the same place, however, although the order of rows in our final
dataset are different (and we have a tibble instead of a data.frame, a
consequence of using the <code>tidyverse</code>, but this is not something to worry
about):</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( exp.res.sum )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
## # Groups:   nC, nT, sd, tau [6]
##      nC    nT    sd   tau    mu     R E.tau.hat    SE E.SE.hat    ES power
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     2     1   0       5   500   -0.0137 0.925    0.902  0    0.152
## 2     2     2     1   0.5     5   500    0.550  1.00     0.881  0.5  0.208
## 3     2     2     1   1       5   500    0.982  0.996    0.879  1    0.318
## 4     2     2     2   0       5   500    0.0901 2.05     1.69   0    0.214
## 5     2     2     2   0.5     5   500    0.507  1.97     1.77   0.25 0.21 
## 6     2     2     2   1       5   500    1.10   1.88     1.80   0.5  0.206</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>( exp.res.sum )</span></code></pre></div>
<pre><code>## [1] 216</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="case-study-the-power-and-validity-of-neymans-ate-estimate.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>( exp.res )</span></code></pre></div>
<pre><code>## [1] 216</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="parallel-processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="design-analysis-and-presentation-of-simulation-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/065-Simulation-for-power-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
