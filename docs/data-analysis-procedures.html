<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Data analysis procedures | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Data analysis procedures | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Data analysis procedures | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-06-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-generating-processes.html"/>
<link rel="next" href="running-the-simulation-process.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#standardization-in-the-dgp"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.7</b> More to explore</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.8.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.8.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.8.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.8.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.8.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.8.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.8.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.8.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.8.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.8.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.8.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.8.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.8.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.8.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.8.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.8.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.8.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.8.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.8.10</b> Cluster-randomized trial with baseline predictors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-estimation-procedures"><i class="fa fa-check"></i><b>7.3</b> Validating Estimation Procedures</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#different-kinds-of-performance"><i class="fa fa-check"></i><b>9.1</b> Different kinds of performance</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.2</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.2.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.2.2</b> Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.3.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.4</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.5</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.5.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.6</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.6.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.6.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.6.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-monte-carlo-standard-error"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercises (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-7"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="11" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>11</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>11.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="11.3" data-path="exp-design.html"><a href="exp-design.html#when-to-aggregate-results-across-multiple-simulations"><i class="fa fa-check"></i><b>11.3</b> When to aggregate results across multiple simulations</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>11.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="11.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>11.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="11.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>11.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>11.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html"><i class="fa fa-check"></i><b>12</b> Analyzing the multifactor experiment</a>
<ul>
<li class="chapter" data-level="12.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#ways-of-analyzing-simulation-results"><i class="fa fa-check"></i><b>12.1</b> Ways of analyzing simulation results</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#plot-everything-with-many-small-multiples"><i class="fa fa-check"></i><b>12.1.1</b> Plot everything with many small multiples</a></li>
<li class="chapter" data-level="12.1.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#bundling"><i class="fa fa-check"></i><b>12.1.2</b> Bundling</a></li>
<li class="chapter" data-level="12.1.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregation"><i class="fa fa-check"></i><b>12.1.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.1.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#regression-summarization"><i class="fa fa-check"></i><b>12.1.4</b> Regression Summarization</a></li>
<li class="chapter" data-level="12.1.5" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focus-on-a-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>12.1.5</b> Focus on a subset, kick rest to supplement</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>12.2</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="12.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#case-study-power-for-a-randomized-trial"><i class="fa fa-check"></i><b>12.3</b> Case study: power for a randomized trial</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#the-initial-analysis"><i class="fa fa-check"></i><b>12.3.1</b> The initial analysis</a></li>
<li class="chapter" data-level="12.3.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focusing-on-validity"><i class="fa fa-check"></i><b>12.3.2</b> Focusing on validity</a></li>
<li class="chapter" data-level="12.3.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregate-to-look-at-main-effects"><i class="fa fa-check"></i><b>12.3.3</b> Aggregate to look at main effects</a></li>
<li class="chapter" data-level="12.3.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#recap"><i class="fa fa-check"></i><b>12.3.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#exercises-8"><i class="fa fa-check"></i><b>12.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>13</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="13.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process"><i class="fa fa-check"></i><b>13.1</b> The data generating process</a></li>
<li class="chapter" data-level="13.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>13.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="13.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>13.3</b> The simulation itself</a></li>
<li class="chapter" data-level="13.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>13.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="13.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>13.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="13.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>13.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Presentation of simulation results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>14.1</b> Tabulation</a></li>
<li class="chapter" data-level="14.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>14.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>14.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="14.2.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>14.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="14.2.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>14.2.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>14.3</b> Modeling</a></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="15" data-path="sec-reproducability.html"><a href="sec-reproducability.html"><i class="fa fa-check"></i><b>15</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sec-reproducability.html"><a href="sec-reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>15.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="15.2" data-path="sec-reproducability.html"><a href="sec-reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>15.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="15.3" data-path="sec-reproducability.html"><a href="sec-reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>15.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>16</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="16.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>16.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="16.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>16.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="16.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>16.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>17</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="17.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>17.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#making-a-safe-function-call"><i class="fa fa-check"></i><b>17.1.1</b> Making a safe function call</a></li>
<li class="chapter" data-level="17.1.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>17.1.2</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#about-stopifnot"><i class="fa fa-check"></i><b>17.2</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>18</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="18.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>18.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="18.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>18.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="18.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>18.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="18.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>18.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>19</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>19.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="19.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>19.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>19.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="19.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>19.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="19.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>19.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="19.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>19.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="19.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>19.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="19.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>19.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>20</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="20.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>20.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>20.1.1</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="20.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>20.1.2</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="20.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>20.1.3</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="20.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>20.1.4</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="20.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>20.1.5</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="21" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>21</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="21.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>21.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="21.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>21.2</b> The data generating process</a></li>
<li class="chapter" data-level="21.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-1"><i class="fa fa-check"></i><b>21.3</b> Running the simulation</a></li>
<li class="chapter" data-level="21.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>21.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>21.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="21.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>21.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="21.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>21.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="21.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>21.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>22</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="22.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>22.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="22.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>22.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="22.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>22.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="22.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>22.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>23</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="23.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>23.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#testing-and-debugging-code-in-your-scripts"><i class="fa fa-check"></i><b>A.3</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-source-command-and-keeping-things-organized"><i class="fa fa-check"></i><b>A.4</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="A.5" data-path="coding-tidbits.html"><a href="coding-tidbits.html#debugging-with-browser"><i class="fa fa-check"></i><b>A.5</b> Debugging with browser</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-analysis-procedures" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Data analysis procedures<a href="data-analysis-procedures.html#data-analysis-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The overall aims of many simulation studies have to do with understand how a particular data-analysis procedure works or comparing the performance of multiple, competing procedures.
Thus, the data-analysis procedure or procedures are the central object of study.
Depending on the research question, the data-analysis procedure might be very simple—as simple as just computing a sample correlation–or it might involve a combination of several components.
For example, the procedure might entail first computing a diagnostic test for heteroskedasticity and then, depending on the outcome of the test, applying either a conventional formula or a heteroskedasticity-robust formula for standard errors.
As another example, a data-analysis procedure might involve using multiple imputation for missingness on key variables, then fitting a statistical model, and then generating predicted values based on the model.
Also depending on the research question, we might need to create <em>several</em> functions that implement different estimation procedures to be compared.</p>
<p>In this chapter, we demonstrate how to implement data-analysis procedures in the form of R functions, so that their performance can be evaluated by repeatedly applying them to artificial data.
We start by discussing the high-level design of estimation functions and examining some simple but illustrative examples.
We then discuss approaches for writing simulations that involve multiple estimation procedure.
Next, we describe strategies for validating estimation functions.
Finally, we examine methods for handling common computational problems with estimation procedures, such as non-convergence of maximum likelihood estimators.</p>
<div id="estimation-functions" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Writing estimation functions<a href="data-analysis-procedures.html#estimation-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the abstract, a function that implements an estimation procedure should have the following form:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-analysis-procedures.html#cb1-1" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb1-2"><a href="data-analysis-procedures.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="data-analysis-procedures.html#cb1-3" tabindex="-1"></a>  <span class="co"># calculations/model-fitting/estimation procedures</span></span>
<span id="cb1-4"><a href="data-analysis-procedures.html#cb1-4" tabindex="-1"></a>  </span>
<span id="cb1-5"><a href="data-analysis-procedures.html#cb1-5" tabindex="-1"></a>  <span class="fu">return</span>(estimates)</span>
<span id="cb1-6"><a href="data-analysis-procedures.html#cb1-6" tabindex="-1"></a>}</span></code></pre></div>
<p>The function takes a dataset as input, fits a model or otherwise calculates an estimate, possibly with associated standard errors and so forth, and returns these quantities as output.
The estimates could be point-estimates of parameters, standard errors, confidence intervals, p-values, predictions, or other quantities.
The calculations in the body of the function should be set up to use datasets that have the same structure (i.e., same dimensions, same variable names) as the output of our function for generating simulated data.
However, in principle, we should also be able to run the estimation function on real data as well.</p>
<p>In Chapter <a href="case-ANOVA.html#case-ANOVA">5</a> we wrote a function called <code>ANOVA_Welch_F()</code> for computing <span class="math inline">\(p\)</span>-values from two different procedures for testing equality of means in a heteroskedastic ANOVA:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-analysis-procedures.html#cb2-1" tabindex="-1"></a>ANOVA_Welch_F <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb2-2"><a href="data-analysis-procedures.html#cb2-2" tabindex="-1"></a>  anova_F <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(x <span class="sc">~</span> group, <span class="at">data =</span> data, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="data-analysis-procedures.html#cb2-3" tabindex="-1"></a>  Welch_F <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(x <span class="sc">~</span> group, <span class="at">data =</span> data, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-4"><a href="data-analysis-procedures.html#cb2-4" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="data-analysis-procedures.html#cb2-5" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-6"><a href="data-analysis-procedures.html#cb2-6" tabindex="-1"></a>    <span class="at">ANOVA =</span> anova_F<span class="sc">$</span>p.value,</span>
<span id="cb2-7"><a href="data-analysis-procedures.html#cb2-7" tabindex="-1"></a>    <span class="at">Welch =</span> Welch_F<span class="sc">$</span>p.value</span>
<span id="cb2-8"><a href="data-analysis-procedures.html#cb2-8" tabindex="-1"></a>  )</span>
<span id="cb2-9"><a href="data-analysis-procedures.html#cb2-9" tabindex="-1"></a>  </span>
<span id="cb2-10"><a href="data-analysis-procedures.html#cb2-10" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb2-11"><a href="data-analysis-procedures.html#cb2-11" tabindex="-1"></a>}</span></code></pre></div>
<p>Apply this function to a simulated dataset returns two p-values, one for the usual ANOVA <span class="math inline">\(F\)</span> test (which assumes homoskedasticity) and one for Welch’s heteroskedastic <span class="math inline">\(F\)</span> test:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-analysis-procedures.html#cb3-1" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">generate_ANOVA_data</span>(</span>
<span id="cb3-2"><a href="data-analysis-procedures.html#cb3-2" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>), </span>
<span id="cb3-3"><a href="data-analysis-procedures.html#cb3-3" tabindex="-1"></a>  <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb3-4"><a href="data-analysis-procedures.html#cb3-4" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb3-5"><a href="data-analysis-procedures.html#cb3-5" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="data-analysis-procedures.html#cb3-6" tabindex="-1"></a><span class="fu">ANOVA_Welch_F</span>(sim_data)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##      ANOVA  Welch
##      &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.000153 0.0131</code></pre>
<p>Our <code>ANOVA_Welch_F()</code> function is designed to work with the output of <code>generate_ANOVA_data()</code> in that it assumes that the grouping variable is called <code>group</code> and the outcome is called <code>x</code>.
Relying on this assumption would be a poor choice if we were designing a function as part of an R package or for general-purpose use.
However, because the primary use of the function is for simulation, it is reasonable to assume that the input data will always have appropriate variable names.</p>
<p>In Chapter <a href="data-generating-processes.html#data-generating-processes">6</a>, we looked at a data-generating function for a bivariate Poisson distribution, an example of a non-normal bivariate distribution.
We might use such a distribution to understand the behavior of Pearson’s sample correlation coefficient and its normalizing transformation, known as Fisher’s <span class="math inline">\(z\)</span>-transformation, which is equivalent to the hyperbolic arc-tangent function (<code>atanh()</code> in R).
When variables follow a bivariate normal distribution, Fisher’s <span class="math inline">\(z\)</span>-transformed correlation is very close to normally distributed and its standard error is simply <span class="math inline">\(1 / \sqrt{N - 3}\)</span>, and thus independent of the correlation.
This makes <span class="math inline">\(z\)</span>-transformation very useful for computing confidence intervals, which can then be back-transformed to the Pearson-<span class="math inline">\(r\)</span> scale.</p>
<p>In this problem, a simple estimation function would take a dataset with two variables as input and computes the sample correlation and its <span class="math inline">\(z\)</span>-transformation, compute confidence intervals for <span class="math inline">\(z\)</span>, and then back-transform the confidence interval end-points:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-analysis-procedures.html#cb5-1" tabindex="-1"></a>r_and_z <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb5-2"><a href="data-analysis-procedures.html#cb5-2" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="data-analysis-procedures.html#cb5-3" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">cor</span>(data<span class="sc">$</span>C1, data<span class="sc">$</span>C2)</span>
<span id="cb5-4"><a href="data-analysis-procedures.html#cb5-4" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">atanh</span>(r)</span>
<span id="cb5-5"><a href="data-analysis-procedures.html#cb5-5" tabindex="-1"></a>  se_z <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="dv">3</span>)</span>
<span id="cb5-6"><a href="data-analysis-procedures.html#cb5-6" tabindex="-1"></a>  ci_z <span class="ot">&lt;-</span> z <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> se_z</span>
<span id="cb5-7"><a href="data-analysis-procedures.html#cb5-7" tabindex="-1"></a>  ci_r <span class="ot">&lt;-</span> <span class="fu">tanh</span>(ci_z)</span>
<span id="cb5-8"><a href="data-analysis-procedures.html#cb5-8" tabindex="-1"></a>  </span>
<span id="cb5-9"><a href="data-analysis-procedures.html#cb5-9" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">r =</span> r, <span class="at">z =</span> z, <span class="at">CI_lo =</span> ci_r[<span class="dv">1</span>], <span class="at">CI_hi =</span> ci_r[<span class="dv">2</span>] )</span>
<span id="cb5-10"><a href="data-analysis-procedures.html#cb5-10" tabindex="-1"></a>}</span></code></pre></div>
<p>We can generate a small dataset using the <code>r_bivariate_Poisson()</code> function developed in the last chapter, then apply our estimation function to the result:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-analysis-procedures.html#cb6-1" tabindex="-1"></a>Pois_dat <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>(<span class="dv">40</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">mu1 =</span> <span class="dv">4</span>, <span class="at">mu2 =</span> <span class="dv">4</span>)</span>
<span id="cb6-2"><a href="data-analysis-procedures.html#cb6-2" tabindex="-1"></a><span class="fu">r_and_z</span>(Pois_dat)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##       r     z CI_lo CI_hi
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.532 0.593 0.264 0.723</code></pre>
<p>Although it is a bit cumbersome to do so, we could apply the estimation function to a real dataset by renaming variables as needed.
Here is an example, which calculates the correlation between ratings of judicial integrity and familiarity with the law from the <code>USJudgeRatings</code> dataset (which is included in base R):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-analysis-procedures.html#cb8-1" tabindex="-1"></a><span class="fu">data</span>(USJudgeRatings)</span>
<span id="cb8-2"><a href="data-analysis-procedures.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="data-analysis-procedures.html#cb8-3" tabindex="-1"></a>USJudgeRatings <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="data-analysis-procedures.html#cb8-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">C1 =</span> INTG, <span class="at">C2 =</span> FAMI) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="data-analysis-procedures.html#cb8-5" tabindex="-1"></a>  <span class="fu">r_and_z</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##       r     z CI_lo CI_hi
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0.869  1.33 0.769 0.927</code></pre>
<p>The resulting <code>r</code> is the same as what we get by computing the correlation directly from the original dataset:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-analysis-procedures.html#cb10-1" tabindex="-1"></a><span class="fu">cor.test</span>(<span class="sc">~</span> INTG <span class="sc">+</span> FAMI, <span class="at">data =</span> USJudgeRatings)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  INTG and FAMI
## t = 11.238, df = 41, p-value = 4.283e-14
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7692563 0.9272343
## sample estimates:
##      cor 
## 0.868858</code></pre>
<p>It is a good practice to test out a newly-developed estimation function on real data as a check that it is working as intended.
This type of test ensures that the estimation function is not using information outside of the dataset—not cheating, for example, by using known parameter values to construct an estimate—and so would be feasible to apply in real data analysis contexts.</p>
<!-- JEP: It feels like we should have an example that demonstrates a multi-step procedure here. What could that be? -->
</div>
<div id="multiple-estimation-procedures" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Including Multiple estimation procedures<a href="data-analysis-procedures.html#multiple-estimation-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many simulations involve head-to-head comparisons between more than one data-analysis procedure.
As a design principle, we generally recommend writing different functions for each estimation method one is planning on evaluating.
Doing so makes it easier to add in additional methods as desired or to focus on just a subset of methods.
Writing separate function also leads to a code base that is flexible and useful for other purposes (such as analyzing real data).
Finally, repeating one of our primary mantras, separating functions makes debugging easier because it lets you focus attention on one thing at a time, without worrying about how errors in one area might propagate to others.</p>
<p>To see how this works in practice, we will return to the case study from Section <a href="data-generating-processes.html#case-cluster">6.6</a>, in which we developed a data-generating function for simulating a cluster-randomized trial with student-level outcomes but school-level treatment assignment.
Our data-generating process allowed for varying school sizes and heterogeneous treatment effects, which might be correlated with school size.
Several different procedures could be used to estimate an overall average effect from such a clustered experiment, including:</p>
<ul>
<li>Estimating a multi-level regression model (also known as a hierarchical linear model),</li>
<li>Estimating an ordinary least squares (OLS) regression model and applying cluster-robust standard errors, or</li>
<li>Averaging the outcomes by school, then estimating a linear regression model on the mean outcomes.</li>
</ul>
<p>All three of these methods are are widely used and have some theoretical guarantees supporting their use.
Education researchers tend to be more comfortable using multi-level regression models, whereas economists tend to use OLS with clustered standard errors.
<!-- JEP: Do we want to add any citations for further reading about these strategies? Any further comments about these methods? --></p>
<p>Let’s develop estimation functions for each of these procedures. For now we won’t worry about incorporating the school size covariate, and will focus only on getting a point estimate, standard error, and <span class="math inline">\(p\)</span>-value for the average treatment effect.</p>
<p>For the multi-level modeling strategy, there are several different existing packages that we could use.
We will implement an estimator using the popular <code>lme4</code> package, along with the <code>lmerTest</code> function for computing a <span class="math inline">\(p\)</span>-value for the average effect.
Here is a basic implementation:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-analysis-procedures.html#cb12-1" tabindex="-1"></a>analysis_MLM <span class="ot">&lt;-</span> <span class="cf">function</span>( dat ) {</span>
<span id="cb12-2"><a href="data-analysis-procedures.html#cb12-2" tabindex="-1"></a>  </span>
<span id="cb12-3"><a href="data-analysis-procedures.html#cb12-3" tabindex="-1"></a>  M1 <span class="ot">&lt;-</span> lme4<span class="sc">::</span><span class="fu">lmer</span>( Yobs <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> sid), <span class="at">data =</span> dat )</span>
<span id="cb12-4"><a href="data-analysis-procedures.html#cb12-4" tabindex="-1"></a>  M1_test <span class="ot">&lt;-</span> lmerTest<span class="sc">::</span><span class="fu">as_lmerModLmerTest</span>(M1)</span>
<span id="cb12-5"><a href="data-analysis-procedures.html#cb12-5" tabindex="-1"></a>  M1_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(M1_test)<span class="sc">$</span>coefficients</span>
<span id="cb12-6"><a href="data-analysis-procedures.html#cb12-6" tabindex="-1"></a>  </span>
<span id="cb12-7"><a href="data-analysis-procedures.html#cb12-7" tabindex="-1"></a>  <span class="fu">tibble</span>( </span>
<span id="cb12-8"><a href="data-analysis-procedures.html#cb12-8" tabindex="-1"></a>    <span class="at">ATE_hat =</span> M1_summary[<span class="st">&quot;Z&quot;</span>,<span class="st">&quot;Estimate&quot;</span>], </span>
<span id="cb12-9"><a href="data-analysis-procedures.html#cb12-9" tabindex="-1"></a>    <span class="at">SE_hat =</span> M1_summary[<span class="st">&quot;Z&quot;</span>,<span class="st">&quot;Std. Error&quot;</span>], </span>
<span id="cb12-10"><a href="data-analysis-procedures.html#cb12-10" tabindex="-1"></a>    <span class="at">p_value =</span> M1_summary[<span class="st">&quot;Z&quot;</span>, <span class="st">&quot;Pr(&gt;|t|)&quot;</span>] </span>
<span id="cb12-11"><a href="data-analysis-procedures.html#cb12-11" tabindex="-1"></a>  )</span>
<span id="cb12-12"><a href="data-analysis-procedures.html#cb12-12" tabindex="-1"></a>}</span></code></pre></div>
<p>The function fits a multi-level model with a treatment indicator as a fixed predictor and with random slopes for each school.
To get a p-value for the treatment coefficient, we have to convert the model into an <code>lmerModLmerTest</code> object and then pass it through <code>summary()</code>.
The function outputs only the statistics we are interested in: a point estimate for the treatment effect along with a standard error and p-value.</p>
<p>Our function makes use of the <code>lme4</code> and <code>lmerTest</code> packages.
Rather than assuming that these packages will be loaded, we call relevant functions using the package name as a prefix, as in <code>lme4::lmer()</code>.
This way, we can run the function without having to remember to load the packages in the global environment.
We find that this approach is also preferable to loading packages inside the function itself (e.g., with <code>require(lme4)</code>) so that calling the function does not change which packages are available in the global environment.</p>
<p>Here is a function implementing OLS regression with cluster-robust standard errors:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-analysis-procedures.html#cb13-1" tabindex="-1"></a>analysis_OLS <span class="ot">&lt;-</span> <span class="cf">function</span>( dat, <span class="at">se_type =</span> <span class="st">&quot;CR2&quot;</span> ) {</span>
<span id="cb13-2"><a href="data-analysis-procedures.html#cb13-2" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="data-analysis-procedures.html#cb13-3" tabindex="-1"></a>  M2 <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>( Yobs <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z, <span class="at">data =</span> dat, <span class="at">clusters =</span> sid,  <span class="at">se_type =</span> se_type)</span>
<span id="cb13-4"><a href="data-analysis-procedures.html#cb13-4" tabindex="-1"></a>  </span>
<span id="cb13-5"><a href="data-analysis-procedures.html#cb13-5" tabindex="-1"></a>  <span class="fu">tibble</span>( </span>
<span id="cb13-6"><a href="data-analysis-procedures.html#cb13-6" tabindex="-1"></a>    <span class="at">ATE_hat =</span> M2<span class="sc">$</span>coefficients[[<span class="st">&quot;Z&quot;</span>]], </span>
<span id="cb13-7"><a href="data-analysis-procedures.html#cb13-7" tabindex="-1"></a>    <span class="at">SE_hat =</span> M2<span class="sc">$</span>std.error[[<span class="st">&quot;Z&quot;</span>]], </span>
<span id="cb13-8"><a href="data-analysis-procedures.html#cb13-8" tabindex="-1"></a>    <span class="at">p_value =</span> M2<span class="sc">$</span>p.value[[<span class="st">&quot;Z&quot;</span>]] </span>
<span id="cb13-9"><a href="data-analysis-procedures.html#cb13-9" tabindex="-1"></a>  )</span>
<span id="cb13-10"><a href="data-analysis-procedures.html#cb13-10" tabindex="-1"></a>}</span></code></pre></div>
<p>To get cluster-robust standard errors, we use the <code>lm_robust()</code> function from the <code>estimatr()</code> package, again calling only the relevant function using the package prefix rather than loading the whole package.
A novel aspect of this estimation function is that it includes an additional intput argument, <code>se_type</code>, which allows us to control the type of standard error calculated by <code>lm_robust()</code>.
Adding this option would let us use the same function to compute (and compare) different types of clustered standard errors for the average treatment effect estimate.
We set a default option of <code>"CR2"</code>, just like the default of <code>lm_robust()</code>.</p>
<p>Finally, here is a function implementing the aggregate-then-analyze approach:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-analysis-procedures.html#cb14-1" tabindex="-1"></a>analysis_agg <span class="ot">&lt;-</span> <span class="cf">function</span>( dat, <span class="at">se_type =</span> <span class="st">&quot;HC2&quot;</span> ) {</span>
<span id="cb14-2"><a href="data-analysis-procedures.html#cb14-2" tabindex="-1"></a>  </span>
<span id="cb14-3"><a href="data-analysis-procedures.html#cb14-3" tabindex="-1"></a>  datagg <span class="ot">&lt;-</span> </span>
<span id="cb14-4"><a href="data-analysis-procedures.html#cb14-4" tabindex="-1"></a>    dat <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="data-analysis-procedures.html#cb14-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>( </span>
<span id="cb14-6"><a href="data-analysis-procedures.html#cb14-6" tabindex="-1"></a>      <span class="at">Ybar =</span> <span class="fu">mean</span>( Yobs ),</span>
<span id="cb14-7"><a href="data-analysis-procedures.html#cb14-7" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb14-8"><a href="data-analysis-procedures.html#cb14-8" tabindex="-1"></a>      <span class="at">.by =</span> <span class="fu">c</span>(sid, Z)</span>
<span id="cb14-9"><a href="data-analysis-procedures.html#cb14-9" tabindex="-1"></a>    )</span>
<span id="cb14-10"><a href="data-analysis-procedures.html#cb14-10" tabindex="-1"></a>  </span>
<span id="cb14-11"><a href="data-analysis-procedures.html#cb14-11" tabindex="-1"></a>  <span class="fu">stopifnot</span>( <span class="fu">nrow</span>( datagg ) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>sid) ) )</span>
<span id="cb14-12"><a href="data-analysis-procedures.html#cb14-12" tabindex="-1"></a>  </span>
<span id="cb14-13"><a href="data-analysis-procedures.html#cb14-13" tabindex="-1"></a>  M3 <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>( Ybar <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z, <span class="at">data =</span> datagg, <span class="at">se_type =</span> se_type )</span>
<span id="cb14-14"><a href="data-analysis-procedures.html#cb14-14" tabindex="-1"></a>  </span>
<span id="cb14-15"><a href="data-analysis-procedures.html#cb14-15" tabindex="-1"></a>  <span class="fu">tibble</span>( </span>
<span id="cb14-16"><a href="data-analysis-procedures.html#cb14-16" tabindex="-1"></a>    <span class="at">ATE_hat =</span> M3<span class="sc">$</span>coefficients[[<span class="st">&quot;Z&quot;</span>]], </span>
<span id="cb14-17"><a href="data-analysis-procedures.html#cb14-17" tabindex="-1"></a>    <span class="at">SE_hat =</span> M3<span class="sc">$</span>std.error[[<span class="st">&quot;Z&quot;</span>]], </span>
<span id="cb14-18"><a href="data-analysis-procedures.html#cb14-18" tabindex="-1"></a>    <span class="at">p_value =</span> M3<span class="sc">$</span>p.value[[<span class="st">&quot;Z&quot;</span>]] </span>
<span id="cb14-19"><a href="data-analysis-procedures.html#cb14-19" tabindex="-1"></a>  )</span>
<span id="cb14-20"><a href="data-analysis-procedures.html#cb14-20" tabindex="-1"></a>}</span></code></pre></div>
<p>Note the <code>stopifnot</code> command: putting <em>assert statements</em> in your code like this is a good way to guarantee you are not introducing weird and hard-to-track errors in your code.
For example, R likes to recycle vectors to make them the right length; if you gave it a wrong length in error, this can be a brutal error to discover.
The <code>stopifnot</code> statements halt your code as soon as something goes wrong, rather than letting that initial wrongness flow on to further work, showing up in odd results that you don’t understand later on.
See Section <a href="error-trapping-and-other-headaches.html#about-stopifnot">17.2</a> for more.
<!-- JEP: Is there any reason that the `stopifnot()` test would ever fail? I'm struggling to see the utility of this particular test. --></p>
<p>All of our functions produce output in the same format:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-analysis-procedures.html#cb15-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">gen_cluster_RCT</span>( </span>
<span id="cb15-2"><a href="data-analysis-procedures.html#cb15-2" tabindex="-1"></a>  <span class="at">J=</span><span class="dv">16</span>, <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">p =</span> <span class="fl">0.5</span>, </span>
<span id="cb15-3"><a href="data-analysis-procedures.html#cb15-3" tabindex="-1"></a>  <span class="at">gamma_0 =</span> <span class="dv">0</span>, <span class="at">gamma_1 =</span> <span class="fl">0.2</span>, <span class="at">gamma_2 =</span> <span class="fl">0.2</span>,</span>
<span id="cb15-4"><a href="data-analysis-procedures.html#cb15-4" tabindex="-1"></a>  <span class="at">sigma2_u =</span> <span class="fl">0.4</span>, <span class="at">sigma2_e =</span> <span class="fl">0.6</span></span>
<span id="cb15-5"><a href="data-analysis-procedures.html#cb15-5" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="data-analysis-procedures.html#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="data-analysis-procedures.html#cb15-7" tabindex="-1"></a><span class="fu">analysis_MLM</span>( dat )</span></code></pre></div>
<pre><code>## Warning in check_dep_version(): ABI version mismatch: 
## lme4 was built with Matrix ABI version 2
## Current Matrix ABI version is 1
## Please re-install lme4 from source or restore original &#39;Matrix&#39; package</code></pre>
<pre><code>## # A tibble: 1 × 3
##   ATE_hat SE_hat p_value
##     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1  -0.382  0.361   0.307</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-analysis-procedures.html#cb18-1" tabindex="-1"></a><span class="fu">analysis_OLS</span>( dat )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   ATE_hat SE_hat p_value
##     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1  -0.509  0.500   0.333</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-analysis-procedures.html#cb20-1" tabindex="-1"></a><span class="fu">analysis_agg</span>( dat )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   ATE_hat SE_hat p_value
##     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1  -0.369  0.359   0.322</code></pre>
<p>Ensuring that the output of all the functions is structured in the same way will make it easy to keep the results organized once we start running multiple iterations of the simulation.
We will see the benefits in action in the next chapter.</p>
</div>
<div id="validating-estimation-procedures" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Validating Estimation Procedures<a href="data-analysis-procedures.html#validating-estimation-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Just as with data-generating functions, it is critical to verify the accuracy of the estimation functions.
If an estimation function involves a known procedure that has been implemented in R or one of its contributed packages, then a straightforward verification is to compare your implementation to another existing implementation.
For estimation functions that involve multi-step procedures or novel methods, then other approaches to verification will be needed.</p>
<div id="checking-against-existing-implementations" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Checking against existing implementations<a href="data-analysis-procedures.html#checking-against-existing-implementations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For our Welch test, we can check the output of <code>ANOVA_Welch_F()</code> against the built-in <code>oneway.test</code> function. Let’s do that with a fresh set of data:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-analysis-procedures.html#cb22-1" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">generate_ANOVA_data</span>(</span>
<span id="cb22-2"><a href="data-analysis-procedures.html#cb22-2" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>), </span>
<span id="cb22-3"><a href="data-analysis-procedures.html#cb22-3" tabindex="-1"></a>  <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb22-4"><a href="data-analysis-procedures.html#cb22-4" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb22-5"><a href="data-analysis-procedures.html#cb22-5" tabindex="-1"></a>)</span>
<span id="cb22-6"><a href="data-analysis-procedures.html#cb22-6" tabindex="-1"></a></span>
<span id="cb22-7"><a href="data-analysis-procedures.html#cb22-7" tabindex="-1"></a>aov_results <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(x <span class="sc">~</span> <span class="fu">factor</span>(group), <span class="at">data =</span> sim_data, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-8"><a href="data-analysis-procedures.html#cb22-8" tabindex="-1"></a>aov_results</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means (not assuming equal variances)
## 
## data:  x and factor(group)
## F = 14.664, num df = 3.0000, denom df = 3.8761, p-value = 0.01382</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-analysis-procedures.html#cb24-1" tabindex="-1"></a>Welch_results <span class="ot">&lt;-</span> <span class="fu">ANOVA_Welch_F</span>(sim_data)</span>
<span id="cb24-2"><a href="data-analysis-procedures.html#cb24-2" tabindex="-1"></a><span class="fu">all.equal</span>(aov_results<span class="sc">$</span>p.value, Welch_results<span class="sc">$</span>Welch)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We use <code>all.equal()</code> because it will check equality up to a tolerance in R, which can avoid some weird floating point errors due to rounding.</p>
<p>For the bivariate correlation example, we can check the output of <code>r_and_z()</code> against R’s built-in <code>cor.test()</code> function, as we have already demonstrated in Section <a href="data-analysis-procedures.html#estimation-functions">7.1</a>.
Such a test is even more useful here because <code>r_and_z()</code> involves our own implementation of the confidence interval calculations, rather than relying on R’s built-in functions as we did with <code>ANOVA_Welch_F()</code>.</p>
</div>
<div id="checking-novel-procedures" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Checking novel procedures<a href="data-analysis-procedures.html#checking-novel-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulations are usually an integral part of projects to develop novel statistical methods, but if an estimation procedure truly is new, how do you check that your code is correct?
Effective methods for doing so will vary from problem to problem, but an over-arching strategy is to use theoretical results about the performance of an estimator to check that an estimator works as expected.
For instance, we might work out the algebraic properties of an estimator for a special case and then check that the results of the estimation function agree with our algebra.
In many problems, we might be able to find theoretical properties of an estimator when applied to a very large sample of data and when the model is correctly specified.</p>
<p>such as its behavior in very large samples or under correct model specification.</p>
<p>An estimation function implements a truly novel procedure.
Well, one obvious answer is simulation!</p>
<p>In principle, for large samples and data generated under the assumptions required by your new procedure, you should have a fairly good sense that your estimation procedures should work.
It is often the case that as you design your simulation, and then start analyzing the results, you will find your estimators are really not working as planned.</p>
<p>Such surprises will usually be due to (at least) three factors: you did not implement your method correctly, your method is not yet a good idea in the first place, or you do not yet understand something important about how your method works.
When faced with poor performance you thus will debug your code, revise your method, and do some serious thinking.
Ideally this will eventually lead you to a deeper understanding of a method that is a better idea in general, and correctly implemented in all likelihood.</p>
<p>For example, in one research project Luke and other co-authors were working on a way to improve Instrumental Variable (IV) estimation using post-stratification.
The idea is to group units based on a covariate that predicts compliance status, and then estimate within each group; hopefully this would improve overall estimation.</p>
<p>In the first simulation, the estimates were full of NAs and odd results because we failed to properly account for what happens when the number of compliers was estimated to be zero.
That was table stakes: after repairing that, we still found odd behavior and serious and unexpected bias, which turned out to be due to failing to implement the averaging of the groups step correctly.
We fixed the estimator again and re-ran, and found that even when we had a variable that was almost perfectly predictive of compliance, gains were still surprisingly minimal.
Eventually we understood that the groups with very few compliers were actually so unstable that they ruined the overall estimate.
These results inspired us to introduce other estimators that dropped or down-weighted such strata, which gave our paper a deeper purpose and contribution.</p>
<p>Simulation is an iterative process.
It is to help you, the researcher, learn about your estimators so you can find a way forward with your work.
What you learn then feeds back to the prior research, and you have a cycle that you eventually step off of, if you want to finish your paper.
But do not expect it to be a single, well-defined, trajectory.</p>
</div>
</div>
<div id="handling-errors-warnings-and-other-hiccups" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Handling errors, warnings, and other hiccups<a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="exercises-4" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Exercises<a href="data-analysis-procedures.html#exercises-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="BFFs-forever" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> More Heteroskedastic ANOVA<a href="data-analysis-procedures.html#BFFs-forever" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the classic simulation by Brown and Forsythe (1974), they not only looked at the performance of the homoskedastic ANOVA-F test and Welch’s heteroskedastic-F test, they also proposed their own new hypothesis testing procedure.</p>
<ol style="list-style-type: decimal">
<li><p>Write a function that implements the Brown-Forsythe F* test (the BFF* test!) as described on p. 130 of Brown and Forsythe (1974), using the following code skeleton:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-analysis-procedures.html#cb26-1" tabindex="-1"></a>BF_F <span class="ot">&lt;-</span> <span class="cf">function</span>( data ) {</span>
<span id="cb26-2"><a href="data-analysis-procedures.html#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="data-analysis-procedures.html#cb26-3" tabindex="-1"></a>  <span class="co"># fill in the guts here</span></span>
<span id="cb26-4"><a href="data-analysis-procedures.html#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="data-analysis-procedures.html#cb26-5" tabindex="-1"></a>  <span class="fu">return</span>(pval)</span>
<span id="cb26-6"><a href="data-analysis-procedures.html#cb26-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Run the following code to check that your function produces a result:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-analysis-procedures.html#cb27-1" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">generate_ANOVA_data</span>(</span>
<span id="cb27-2"><a href="data-analysis-procedures.html#cb27-2" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>), </span>
<span id="cb27-3"><a href="data-analysis-procedures.html#cb27-3" tabindex="-1"></a>  <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb27-4"><a href="data-analysis-procedures.html#cb27-4" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb27-5"><a href="data-analysis-procedures.html#cb27-5" tabindex="-1"></a>)</span>
<span id="cb27-6"><a href="data-analysis-procedures.html#cb27-6" tabindex="-1"></a><span class="fu">BF_F</span>( sim_data )</span></code></pre></div></li>
<li><p>Try calling your <code>BF_F</code> function on a variety of datasets of different sizes and shapes, to make sure it works. What kinds of datasets should you test out?</p></li>
<li><p>Add the BFF* test into the output of <code>Welch_ANOVA_F()</code> by calling your <code>BF_F()</code> function inside the body of <code>Welch_ANOVA_F()</code>.</p></li>
<li><p>The <a href="https://cran.r-project.org/package=onewaytests"><code>onewaytests</code> package</a> implements a variety of different hypothesis testing procedures for one-way ANOVA. Validate your <code>Welch_ANOVA_F()</code> function by comparing the results to the output of the relevant functions from <code>onewaytests</code>.</p></li>
</ol>
</div>
<div id="contingent-testing" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Contingent testing<a href="data-analysis-procedures.html#contingent-testing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the one-way ANOVA problem, one approach that an analyst might think to take is to conduct a preliminary significance test for heterogeneity of variances (such as Levene’s test or Bartlett’s test), and then report the <span class="math inline">\(p\)</span>-value from the homoskedastic ANOVA F test if variance heterogeneity is not detected but the <span class="math inline">\(p\)</span>-value from the BFF* test if variance heteogeneity is detected.
Modify the <code>Welch_ANOVA_F()</code> function to return the <span class="math inline">\(p\)</span>-value from this contingent BFF* test in addition to the <span class="math inline">\(p\)</span>-values from the (non-contingent) ANOVA-F, Welch, and BFF* tests.
Include an input option that allows the user to control the <span class="math inline">\(\alpha\)</span> level of the preliminary test for heterogeneity of variances, as in the following skeleton.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-analysis-procedures.html#cb28-1" tabindex="-1"></a>Welch_ANOVA_F <span class="ot">&lt;-</span> <span class="cf">function</span>( data , <span class="at">pre_alpha =</span> .<span class="dv">05</span>) {</span>
<span id="cb28-2"><a href="data-analysis-procedures.html#cb28-2" tabindex="-1"></a>  <span class="co"># preliminary test for variance heterogeneity</span></span>
<span id="cb28-3"><a href="data-analysis-procedures.html#cb28-3" tabindex="-1"></a>  <span class="co"># compute non-contingent F tests for group differences</span></span>
<span id="cb28-4"><a href="data-analysis-procedures.html#cb28-4" tabindex="-1"></a>  <span class="co"># compute contingent test</span></span>
<span id="cb28-5"><a href="data-analysis-procedures.html#cb28-5" tabindex="-1"></a>  <span class="co"># compile results</span></span>
<span id="cb28-6"><a href="data-analysis-procedures.html#cb28-6" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb28-7"><a href="data-analysis-procedures.html#cb28-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="cross-check-CRT-estimators" class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Check the cluster-RCT functions<a href="data-analysis-procedures.html#cross-check-CRT-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Section <a href="data-analysis-procedures.html#multiple-estimation-procedures">7.2</a> presented functions implementing several different strategies for estimating an average treatment effect from a cluster-randomized trial.
Write some code to validate these functions by comparing their output to the results of other tools for doing the same calculation.
Use one or more datasets simulated with <code>gen_cluster_RCT()</code>.
For each of these tests, you will need to figure out the appropriate syntax by reading the package documentation.</p>
<ol style="list-style-type: decimal">
<li><p>For <code>analysis_MLM()</code>, check the output by fitting the same model using <code>lme()</code> from the <code>nlme()</code> package or <code>glmmTMB()</code> from the package of the same name.</p></li>
<li><p>For <code>analysis_OLS()</code>, check the output by fitting the linear model using the base R function <code>lm()</code>, then computing standard errors using <code>vcovCL()</code> from the <code>sandwich</code> package. Also compare the output to the results of feeding the fitted model through <code>coef_test()</code> from the <code>clubSandwich</code> package.</p></li>
<li><p>For <code>analysis_agg()</code>, check the output by aggregating the data to the school-level, fitting the linear model using <code>lm()</code>, and computing standard errors using <code>vcovHC()</code> from the <code>sandwich</code> package.</p></li>
</ol>
</div>
<div id="CRT-ANCOVA-estimators" class="section level3 hasAnchor" number="7.5.4">
<h3><span class="header-section-number">7.5.4</span> Extending the cluster-RCT functions<a href="data-analysis-procedures.html#CRT-ANCOVA-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise <a href="data-generating-processes.html#cluster-RCT-baseline">6.8.10</a> from Chapter <a href="data-generating-processes.html#data-generating-processes">6</a> asked you to extend the data-generating function for the cluster-randomized trial to include generating a student-level covariate, <span class="math inline">\(X\)</span>, that is predictive of the outcome.
Use your modified function to generate a dataset.</p>
<ol style="list-style-type: decimal">
<li><p>Modify the estimation functions from Section <a href="data-analysis-procedures.html#multiple-estimation-procedures">7.2</a> to use models that include the covariate as a predictor.</p></li>
<li><p>Further extend the functions to include an input argument for the set of predictors to be included in the model, as in the following skeleton for the multi-level model estimator:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-analysis-procedures.html#cb29-1" tabindex="-1"></a>analysis_MLM <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">predictors =</span> <span class="st">&quot;Z&quot;</span>) {</span>
<span id="cb29-2"><a href="data-analysis-procedures.html#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="data-analysis-procedures.html#cb29-3" tabindex="-1"></a>}</span>
<span id="cb29-4"><a href="data-analysis-procedures.html#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="data-analysis-procedures.html#cb29-5" tabindex="-1"></a><span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb29-6"><a href="data-analysis-procedures.html#cb29-6" tabindex="-1"></a><span class="fu">analysis_MLM</span>( dat, <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">&quot;Z&quot;</span>,<span class="st">&quot;X&quot;</span>))</span>
<span id="cb29-7"><a href="data-analysis-procedures.html#cb29-7" tabindex="-1"></a><span class="fu">analysis_MLM</span>( dat, <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">&quot;Z&quot;</span>,<span class="st">&quot;X&quot;</span>, <span class="st">&quot;X:Z&quot;</span>))</span></code></pre></div>
<p>Hint: Check out the <code>reformulate()</code> function, which makes it easy to build formulas for different sets of predictors.</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-generating-processes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="running-the-simulation-process.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/030-Estimation-procedures.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
