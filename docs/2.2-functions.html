<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="2.2 Functions | Designing Monte Carlo Simulations in R" />
<meta property="og:type" content="book" />

<meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
<meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />

<meta name="date" content="2025-06-19" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies">

<title>2.2 Functions | Designing Monte Carlo Simulations in R</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if bootstrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#welcome" id="toc-welcome">Welcome</a>
<ul>
<li><a href="license.html#license" id="toc-license">License</a></li>
<li><a href="about-the-authors.html#about-the-authors" id="toc-about-the-authors">About the authors</a></li>
<li><a href="acknowledgements.html#acknowledgements" id="toc-acknowledgements">Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="has-sub"><a href="1-introduction.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li class="has-sub"><a href="1.1-some-of-simulations-many-uses.html#some-of-simulations-many-uses" id="toc-some-of-simulations-many-uses"><span class="toc-section-number">1.1</span> Some of simulation’s many uses</a>
<ul>
<li><a href="1.1-some-of-simulations-many-uses.html#comparing-statistical-approaches" id="toc-comparing-statistical-approaches"><span class="toc-section-number">1.1.1</span> Comparing statistical approaches</a></li>
<li><a href="1.1-some-of-simulations-many-uses.html#assessing-performance-of-complex-pipelines" id="toc-assessing-performance-of-complex-pipelines"><span class="toc-section-number">1.1.2</span> Assessing performance of complex pipelines</a></li>
<li><a href="1.1-some-of-simulations-many-uses.html#assessing-performance-under-misspecification" id="toc-assessing-performance-under-misspecification"><span class="toc-section-number">1.1.3</span> Assessing performance under misspecification</a></li>
<li><a href="1.1-some-of-simulations-many-uses.html#assessing-the-finite-sample-performance-of-a-statistical-approach" id="toc-assessing-the-finite-sample-performance-of-a-statistical-approach"><span class="toc-section-number">1.1.4</span> Assessing the finite-sample performance of a statistical approach</a></li>
<li><a href="1.1-some-of-simulations-many-uses.html#conducting-power-analyses" id="toc-conducting-power-analyses"><span class="toc-section-number">1.1.5</span> Conducting Power Analyses</a></li>
<li><a href="1.1-some-of-simulations-many-uses.html#simulating-processess" id="toc-simulating-processess"><span class="toc-section-number">1.1.6</span> Simulating processess</a></li>
</ul></li>
<li><a href="1.2-the-perils-of-simulation-as-evidence.html#the-perils-of-simulation-as-evidence" id="toc-the-perils-of-simulation-as-evidence"><span class="toc-section-number">1.2</span> The perils of simulation as evidence</a></li>
<li><a href="1.3-simulating-to-learn.html#simulating-to-learn" id="toc-simulating-to-learn"><span class="toc-section-number">1.3</span> Simulating to learn</a></li>
<li><a href="1.4-why-r.html#why-r" id="toc-why-r"><span class="toc-section-number">1.4</span> Why R?</a></li>
<li><a href="1.5-organization-of-the-text.html#organization-of-the-text" id="toc-organization-of-the-text"><span class="toc-section-number">1.5</span> Organization of the text</a></li>
</ul></li>
<li class="has-sub"><a href="2-programming-preliminaries.html#programming-preliminaries" id="toc-programming-preliminaries"><span class="toc-section-number">2</span> Programming Preliminaries</a>
<ul>
<li><a href="2.1-welcome-to-the-tidyverse.html#welcome-to-the-tidyverse" id="toc-welcome-to-the-tidyverse"><span class="toc-section-number">2.1</span> Welcome to the tidyverse</a></li>
<li class="has-sub"><a href="2.2-functions.html#functions" id="toc-functions"><span class="toc-section-number">2.2</span> Functions</a>
<ul>
<li><a href="2.2-functions.html#rolling-your-own" id="toc-rolling-your-own"><span class="toc-section-number">2.2.1</span> Rolling your own</a></li>
<li><a href="2.2-functions.html#a-dangerous-function" id="toc-a-dangerous-function"><span class="toc-section-number">2.2.2</span> A dangerous function</a></li>
<li><a href="2.2-functions.html#using-named-arguments" id="toc-using-named-arguments"><span class="toc-section-number">2.2.3</span> Using Named Arguments</a></li>
<li><a href="2.2-functions.html#argument-defaults" id="toc-argument-defaults"><span class="toc-section-number">2.2.4</span> Argument Defaults</a></li>
<li><a href="2.2-functions.html#function-skeletons" id="toc-function-skeletons"><span class="toc-section-number">2.2.5</span> Function skeletons</a></li>
</ul></li>
<li><a href="2.3-pipe-dreams.html#pipe-dreams" id="toc-pipe-dreams"><span class="toc-section-number">2.3</span> <code>\&gt;</code> (Pipe) dreams</a></li>
<li><a href="2.4-recipes-versus-patterns.html#recipes-versus-patterns" id="toc-recipes-versus-patterns"><span class="toc-section-number">2.4</span> Recipes versus Patterns</a></li>
<li><a href="2.5-exercises.html#exercises" id="toc-exercises"><span class="toc-section-number">2.5</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="3-t-test-simulation.html#t-test-simulation" id="toc-t-test-simulation"><span class="toc-section-number">3</span> An initial simulation</a>
<ul>
<li><a href="3.1-simulating-a-single-scenario.html#simulating-a-single-scenario" id="toc-simulating-a-single-scenario"><span class="toc-section-number">3.1</span> Simulating a single scenario</a></li>
<li><a href="3.2-a-non-normal-population-distribution.html#a-non-normal-population-distribution" id="toc-a-non-normal-population-distribution"><span class="toc-section-number">3.2</span> A non-normal population distribution</a></li>
<li><a href="3.3-simulating-across-different-scenarios.html#simulating-across-different-scenarios" id="toc-simulating-across-different-scenarios"><span class="toc-section-number">3.3</span> Simulating across different scenarios</a></li>
<li><a href="3.4-extending-the-simulation-design.html#extending-the-simulation-design" id="toc-extending-the-simulation-design"><span class="toc-section-number">3.4</span> Extending the simulation design</a></li>
<li><a href="3.5-exercises-1.html#exercises-1" id="toc-exercises-1"><span class="toc-section-number">3.5</span> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="has-sub"><a href="4-simulation-structure.html#simulation-structure" id="toc-simulation-structure"><span class="toc-section-number">4</span> Structure of a simulation study</a>
<ul>
<li><a href="4.1-general-structure-of-a-simulation.html#general-structure-of-a-simulation" id="toc-general-structure-of-a-simulation"><span class="toc-section-number">4.1</span> General structure of a simulation</a></li>
<li><a href="4.2-tidy-modular-simulations.html#tidy-modular-simulations" id="toc-tidy-modular-simulations"><span class="toc-section-number">4.2</span> Tidy, modular simulations</a></li>
<li class="has-sub"><a href="4.3-skeleton-of-a-simulation-study.html#skeleton-of-a-simulation-study" id="toc-skeleton-of-a-simulation-study"><span class="toc-section-number">4.3</span> Skeleton of a simulation study</a>
<ul>
<li><a href="4.3-skeleton-of-a-simulation-study.html#data-generating-process" id="toc-data-generating-process"><span class="toc-section-number">4.3.1</span> Data-Generating Process</a></li>
<li><a href="4.3-skeleton-of-a-simulation-study.html#data-analysis-procedure" id="toc-data-analysis-procedure"><span class="toc-section-number">4.3.2</span> Data Analysis Procedure</a></li>
<li><a href="4.3-skeleton-of-a-simulation-study.html#repetition" id="toc-repetition"><span class="toc-section-number">4.3.3</span> Repetition</a></li>
<li><a href="4.3-skeleton-of-a-simulation-study.html#performance-summaries" id="toc-performance-summaries"><span class="toc-section-number">4.3.4</span> Performance summaries</a></li>
<li><a href="4.3-skeleton-of-a-simulation-study.html#multifactor-simulations" id="toc-multifactor-simulations"><span class="toc-section-number">4.3.5</span> Multifactor simulations</a></li>
</ul></li>
<li><a href="4.4-exercises-2.html#exercises-2" id="toc-exercises-2"><span class="toc-section-number">4.4</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="5-case-ANOVA.html#case-ANOVA" id="toc-case-ANOVA"><span class="toc-section-number">5</span> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="has-sub"><a href="5.1-case-anova-DGP.html#case-anova-DGP" id="toc-case-anova-DGP"><span class="toc-section-number">5.1</span> The data-generating model</a>
<ul>
<li><a href="5.1-case-anova-DGP.html#now-make-a-function" id="toc-now-make-a-function"><span class="toc-section-number">5.1.1</span> Now make a function</a></li>
<li><a href="5.1-case-anova-DGP.html#cautious-coding" id="toc-cautious-coding"><span class="toc-section-number">5.1.2</span> Cautious coding</a></li>
</ul></li>
<li><a href="5.2-the-hypothesis-testing-procedures.html#the-hypothesis-testing-procedures" id="toc-the-hypothesis-testing-procedures"><span class="toc-section-number">5.2</span> The hypothesis testing procedures</a></li>
<li><a href="5.3-running-the-simulation.html#running-the-simulation" id="toc-running-the-simulation"><span class="toc-section-number">5.3</span> Running the simulation</a></li>
<li><a href="5.4-summarizing-test-performance.html#summarizing-test-performance" id="toc-summarizing-test-performance"><span class="toc-section-number">5.4</span> Summarizing test performance</a></li>
<li><a href="5.5-exAnovaExercises.html#exAnovaExercises" id="toc-exAnovaExercises"><span class="toc-section-number">5.5</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="6-data-generating-processes.html#data-generating-processes" id="toc-data-generating-processes"><span class="toc-section-number">6</span> Data-generating processes</a>
<ul>
<li class="has-sub"><a href="6.1-DGP-examples.html#DGP-examples" id="toc-DGP-examples"><span class="toc-section-number">6.1</span> Examples</a>
<ul>
<li><a href="6.1-DGP-examples.html#ANOVA-example" id="toc-ANOVA-example"><span class="toc-section-number">6.1.1</span> Example 1: One-way analysis of variance</a></li>
<li><a href="6.1-DGP-examples.html#BVPois-example" id="toc-BVPois-example"><span class="toc-section-number">6.1.2</span> Example 2: Bivariate Poisson model</a></li>
<li><a href="6.1-DGP-examples.html#CRT-example" id="toc-CRT-example"><span class="toc-section-number">6.1.3</span> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li><a href="6.2-components-of-a-dgp.html#components-of-a-dgp" id="toc-components-of-a-dgp"><span class="toc-section-number">6.2</span> Components of a DGP</a></li>
<li><a href="6.3-DGP-functions.html#DGP-functions" id="toc-DGP-functions"><span class="toc-section-number">6.3</span> A statistical model is a recipe for data generation</a></li>
<li><a href="6.4-DGP-plotting.html#DGP-plotting" id="toc-DGP-plotting"><span class="toc-section-number">6.4</span> Plot the artificial data</a></li>
<li><a href="6.5-check-the-data-generating-function.html#check-the-data-generating-function" id="toc-check-the-data-generating-function"><span class="toc-section-number">6.5</span> Check the data-generating function</a></li>
<li class="has-sub"><a href="6.6-case-cluster.html#case-cluster" id="toc-case-cluster"><span class="toc-section-number">6.6</span> Example: Simulating clustered data</a>
<ul>
<li><a href="6.6-case-cluster.html#a-design-decision-what-do-we-want-to-manipulate" id="toc-a-design-decision-what-do-we-want-to-manipulate"><span class="toc-section-number">6.6.1</span> A design decision: What do we want to manipulate?</a></li>
<li><a href="6.6-case-cluster.html#a-model-for-a-cluster-rct" id="toc-a-model-for-a-cluster-rct"><span class="toc-section-number">6.6.2</span> A model for a cluster RCT</a></li>
<li><a href="6.6-case-cluster.html#from-equations-to-code" id="toc-from-equations-to-code"><span class="toc-section-number">6.6.3</span> From equations to code</a></li>
<li><a href="6.6-case-cluster.html#standardization-in-the-dgp" id="toc-standardization-in-the-dgp"><span class="toc-section-number">6.6.4</span> Standardization in the DGP</a></li>
</ul></li>
<li><a href="6.7-three-parameter-IRT.html#three-parameter-IRT" id="toc-three-parameter-IRT"><span class="toc-section-number">6.7</span> Sometimes a DGP is all you need</a></li>
<li><a href="6.8-more-to-explore.html#more-to-explore" id="toc-more-to-explore"><span class="toc-section-number">6.8</span> More to explore</a></li>
<li class="has-sub"><a href="6.9-exercises-3.html#exercises-3" id="toc-exercises-3"><span class="toc-section-number">6.9</span> Exercises</a>
<ul>
<li><a href="6.9-exercises-3.html#Welch-t-dgp" id="toc-Welch-t-dgp"><span class="toc-section-number">6.9.1</span> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li><a href="6.9-exercises-3.html#plot-the-bivariate-poisson" id="toc-plot-the-bivariate-poisson"><span class="toc-section-number">6.9.2</span> Plot the bivariate Poisson</a></li>
<li><a href="6.9-exercises-3.html#BVP-check" id="toc-BVP-check"><span class="toc-section-number">6.9.3</span> Check the bivariate Poisson function</a></li>
<li><a href="6.9-exercises-3.html#BVP-error" id="toc-BVP-error"><span class="toc-section-number">6.9.4</span> Add error-catching to the bivariate Poisson function</a></li>
<li><a href="6.9-exercises-3.html#BVNB1" id="toc-BVNB1"><span class="toc-section-number">6.9.5</span> A bivariate negative binomial distribution</a></li>
<li><a href="6.9-exercises-3.html#BVNB2" id="toc-BVNB2"><span class="toc-section-number">6.9.6</span> Another bivariate negative binomial distribution</a></li>
<li><a href="6.9-exercises-3.html#cluster-RCT-plot" id="toc-cluster-RCT-plot"><span class="toc-section-number">6.9.7</span> Plot the data from a cluster-randomized trial</a></li>
<li><a href="6.9-exercises-3.html#cluster-RCT-checks" id="toc-cluster-RCT-checks"><span class="toc-section-number">6.9.8</span> Checking the Cluster RCT DGP</a></li>
<li><a href="6.9-exercises-3.html#cluster-RCT-heterogeneity" id="toc-cluster-RCT-heterogeneity"><span class="toc-section-number">6.9.9</span> More school-level variation</a></li>
<li><a href="6.9-exercises-3.html#cluster-RCT-baseline" id="toc-cluster-RCT-baseline"><span class="toc-section-number">6.9.10</span> Cluster-randomized trial with baseline predictors</a></li>
<li><a href="6.9-exercises-3.html#IRT-DGP-parameters" id="toc-IRT-DGP-parameters"><span class="toc-section-number">6.9.11</span> 3-parameter IRT datasets</a></li>
<li><a href="6.9-exercises-3.html#IRT-DGP-checking" id="toc-IRT-DGP-checking"><span class="toc-section-number">6.9.12</span> Check the 3-parameter IRT DGP</a></li>
<li><a href="6.9-exercises-3.html#IRT-DGP-breaking" id="toc-IRT-DGP-breaking"><span class="toc-section-number">6.9.13</span> Explore the 3-parameter IRT model</a></li>
<li><a href="6.9-exercises-3.html#meta-regression-DGP" id="toc-meta-regression-DGP"><span class="toc-section-number">6.9.14</span> Random effects meta-regression</a></li>
<li><a href="6.9-exercises-3.html#Vevea-Hedges-DGP" id="toc-Vevea-Hedges-DGP"><span class="toc-section-number">6.9.15</span> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="7-data-analysis-procedures.html#data-analysis-procedures" id="toc-data-analysis-procedures"><span class="toc-section-number">7</span> Data analysis procedures</a>
<ul>
<li><a href="7.1-estimation-functions.html#estimation-functions" id="toc-estimation-functions"><span class="toc-section-number">7.1</span> Writing estimation functions</a></li>
<li><a href="7.2-multiple-estimation-procedures.html#multiple-estimation-procedures" id="toc-multiple-estimation-procedures"><span class="toc-section-number">7.2</span> Including Multiple Data Analysis Procedures</a></li>
<li class="has-sub"><a href="7.3-validating-an-estimation-function.html#validating-an-estimation-function" id="toc-validating-an-estimation-function"><span class="toc-section-number">7.3</span> Validating an Estimation Function</a>
<ul>
<li><a href="7.3-validating-an-estimation-function.html#checking-against-existing-implementations" id="toc-checking-against-existing-implementations"><span class="toc-section-number">7.3.1</span> Checking against existing implementations</a></li>
<li><a href="7.3-validating-an-estimation-function.html#checking-novel-procedures" id="toc-checking-novel-procedures"><span class="toc-section-number">7.3.2</span> Checking novel procedures</a></li>
<li><a href="7.3-validating-an-estimation-function.html#checking-with-simulations" id="toc-checking-with-simulations"><span class="toc-section-number">7.3.3</span> Checking with simulations</a></li>
</ul></li>
<li class="has-sub"><a href="7.4-handling-errors-warnings-and-other-hiccups.html#handling-errors-warnings-and-other-hiccups" id="toc-handling-errors-warnings-and-other-hiccups"><span class="toc-section-number">7.4</span> Handling errors, warnings, and other hiccups</a>
<ul>
<li><a href="7.4-handling-errors-warnings-and-other-hiccups.html#capturing-errors-and-warnings" id="toc-capturing-errors-and-warnings"><span class="toc-section-number">7.4.1</span> Capturing errors and warnings</a></li>
<li><a href="7.4-handling-errors-warnings-and-other-hiccups.html#adapting-for-errors" id="toc-adapting-for-errors"><span class="toc-section-number">7.4.2</span> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="has-sub"><a href="7.5-exercises-4.html#exercises-4" id="toc-exercises-4"><span class="toc-section-number">7.5</span> Exercises</a>
<ul>
<li><a href="7.5-exercises-4.html#BFFs-forever" id="toc-BFFs-forever"><span class="toc-section-number">7.5.1</span> More Heteroskedastic ANOVA</a></li>
<li><a href="7.5-exercises-4.html#contingent-testing" id="toc-contingent-testing"><span class="toc-section-number">7.5.2</span> Contingent testing</a></li>
<li><a href="7.5-exercises-4.html#cross-check-CRT-estimators" id="toc-cross-check-CRT-estimators"><span class="toc-section-number">7.5.3</span> Check the cluster-RCT functions</a></li>
<li><a href="7.5-exercises-4.html#CRT-ANCOVA-estimators" id="toc-CRT-ANCOVA-estimators"><span class="toc-section-number">7.5.4</span> Extending the cluster-RCT functions</a></li>
<li><a href="7.5-exercises-4.html#contingent-estimator-processing" id="toc-contingent-estimator-processing"><span class="toc-section-number">7.5.5</span> Contingent estimator processing</a></li>
<li><a href="7.5-exercises-4.html#IRT-3PL-estimation" id="toc-IRT-3PL-estimation"><span class="toc-section-number">7.5.6</span> Estimating 3-parameter item response theory models</a></li>
<li><a href="7.5-exercises-4.html#Vevea-Hedges-estimation" id="toc-Vevea-Hedges-estimation"><span class="toc-section-number">7.5.7</span> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="8-running-the-simulation-process.html#running-the-simulation-process" id="toc-running-the-simulation-process"><span class="toc-section-number">8</span> Running the Simulation Process</a>
<ul>
<li><a href="8.1-writing-simulations-quick-with-the-simhelpers-package.html#writing-simulations-quick-with-the-simhelpers-package" id="toc-writing-simulations-quick-with-the-simhelpers-package"><span class="toc-section-number">8.1</span> Writing simulations quick with the simhelpers package</a></li>
<li><a href="8.2-adding-checks-and-balances.html#adding-checks-and-balances" id="toc-adding-checks-and-balances"><span class="toc-section-number">8.2</span> Adding Checks and Balances</a></li>
<li><a href="8.3-exercises-5.html#exercises-5" id="toc-exercises-5"><span class="toc-section-number">8.3</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="9-performance-criteria.html#performance-criteria" id="toc-performance-criteria"><span class="toc-section-number">9</span> Performance criteria</a>
<ul>
<li><a href="9.1-different-kinds-of-performance.html#different-kinds-of-performance" id="toc-different-kinds-of-performance"><span class="toc-section-number">9.1</span> Different kinds of performance</a></li>
<li class="has-sub"><a href="9.2-assessing-a-point-estimator.html#assessing-a-point-estimator" id="toc-assessing-a-point-estimator"><span class="toc-section-number">9.2</span> Assessing a Point Estimator</a>
<ul>
<li><a href="9.2-assessing-a-point-estimator.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures" id="toc-comparing-the-performances-of-the-cluster-rct-estimation-procedures"><span class="toc-section-number">9.2.1</span> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li><a href="9.2-assessing-a-point-estimator.html#estimands-not-represented-by-a-parameter" id="toc-estimands-not-represented-by-a-parameter"><span class="toc-section-number">9.2.2</span> Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="has-sub"><a href="9.3-assessing-a-standard-error-estimator.html#assessing-a-standard-error-estimator" id="toc-assessing-a-standard-error-estimator"><span class="toc-section-number">9.3</span> Assessing a Standard Error Estimator</a>
<ul>
<li><a href="9.3-assessing-a-standard-error-estimator.html#why-not-assess-the-estimated-se-directly" id="toc-why-not-assess-the-estimated-se-directly"><span class="toc-section-number">9.3.1</span> Why Not Assess the Estimated SE directly?</a></li>
<li><a href="9.3-assessing-a-standard-error-estimator.html#assessing-ses-for-our-cluster-rct-simulation" id="toc-assessing-ses-for-our-cluster-rct-simulation"><span class="toc-section-number">9.3.2</span> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="has-sub"><a href="9.4-assessing-an-inferential-procedure-hypothesis-testing.html#assessing-an-inferential-procedure-hypothesis-testing" id="toc-assessing-an-inferential-procedure-hypothesis-testing"><span class="toc-section-number">9.4</span> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li><a href="9.4-assessing-an-inferential-procedure-hypothesis-testing.html#validity" id="toc-validity"><span class="toc-section-number">9.4.1</span> Validity</a></li>
<li><a href="9.4-assessing-an-inferential-procedure-hypothesis-testing.html#power" id="toc-power"><span class="toc-section-number">9.4.2</span> Power</a></li>
<li><a href="9.4-assessing-an-inferential-procedure-hypothesis-testing.html#the-rejection-rate" id="toc-the-rejection-rate"><span class="toc-section-number">9.4.3</span> The Rejection Rate</a></li>
<li><a href="9.4-assessing-an-inferential-procedure-hypothesis-testing.html#inference-in-our-cluster-rct-simulation" id="toc-inference-in-our-cluster-rct-simulation"><span class="toc-section-number">9.4.4</span> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="has-sub"><a href="9.5-assessing-confidence-intervals.html#assessing-confidence-intervals" id="toc-assessing-confidence-intervals"><span class="toc-section-number">9.5</span> Assessing Confidence Intervals</a>
<ul>
<li><a href="9.5-assessing-confidence-intervals.html#confidence-intervals-in-our-cluster-rct-example" id="toc-confidence-intervals-in-our-cluster-rct-example"><span class="toc-section-number">9.5.1</span> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="has-sub"><a href="9.6-additional-thoughts-on-measuring-performance.html#additional-thoughts-on-measuring-performance" id="toc-additional-thoughts-on-measuring-performance"><span class="toc-section-number">9.6</span> Additional Thoughts on Measuring Performance</a>
<ul>
<li><a href="9.6-additional-thoughts-on-measuring-performance.html#sec-relative-performance" id="toc-sec-relative-performance"><span class="toc-section-number">9.6.1</span> Selecting Relative vs. Absolute Criteria</a></li>
<li><a href="9.6-additional-thoughts-on-measuring-performance.html#robust-measures-of-performance" id="toc-robust-measures-of-performance"><span class="toc-section-number">9.6.2</span> Robust Measures of Performance</a></li>
<li><a href="9.6-additional-thoughts-on-measuring-performance.html#summary-of-peformance-measures" id="toc-summary-of-peformance-measures"><span class="toc-section-number">9.6.3</span> Summary of Peformance Measures</a></li>
</ul></li>
<li class="has-sub"><a href="9.7-uncertainty-in-performance-estimates-the-monte-carlo-standard-error.html#uncertainty-in-performance-estimates-the-monte-carlo-standard-error" id="toc-uncertainty-in-performance-estimates-the-monte-carlo-standard-error"><span class="toc-section-number">9.7</span> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li><a href="9.7-uncertainty-in-performance-estimates-the-monte-carlo-standard-error.html#mcse-for-relative-variance-estimators" id="toc-mcse-for-relative-variance-estimators"><span class="toc-section-number">9.7.1</span> MCSE for Relative Variance Estimators</a></li>
<li><a href="9.7-uncertainty-in-performance-estimates-the-monte-carlo-standard-error.html#calculating-mcses-with-the-simhelpers-package" id="toc-calculating-mcses-with-the-simhelpers-package"><span class="toc-section-number">9.7.2</span> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li><a href="9.7-uncertainty-in-performance-estimates-the-monte-carlo-standard-error.html#mcse-calculation-in-our-cluster-rct-example" id="toc-mcse-calculation-in-our-cluster-rct-example"><span class="toc-section-number">9.7.3</span> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li><a href="9.8-exercises-6.html#exercises-6" id="toc-exercises-6"><span class="toc-section-number">9.8</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="10-case_Cronbach.html#case_Cronbach" id="toc-case_Cronbach"><span class="toc-section-number">10</span> Project: Cronbach Alpha</a>
<ul>
<li><a href="10.1-background.html#background" id="toc-background"><span class="toc-section-number">10.1</span> Background</a></li>
<li><a href="10.2-getting-started.html#getting-started" id="toc-getting-started"><span class="toc-section-number">10.2</span> Getting started</a></li>
<li><a href="10.3-the-data-generating-function.html#the-data-generating-function" id="toc-the-data-generating-function"><span class="toc-section-number">10.3</span> The data-generating function</a></li>
<li class="has-sub"><a href="10.4-the-estimation-function.html#the-estimation-function" id="toc-the-estimation-function"><span class="toc-section-number">10.4</span> The estimation function</a>
<ul>
<li><a href="10.4-the-estimation-function.html#exercises-naive-confidence-intervals" id="toc-exercises-naive-confidence-intervals"><span class="toc-section-number">10.4.1</span> Exercises (Naive confidence intervals)</a></li>
</ul></li>
<li class="has-sub"><a href="10.5-estimator-performance.html#estimator-performance" id="toc-estimator-performance"><span class="toc-section-number">10.5</span> Estimator performance</a>
<ul>
<li><a href="10.5-estimator-performance.html#exercises-calculating-performance" id="toc-exercises-calculating-performance"><span class="toc-section-number">10.5.1</span> Exercises (Calculating Performance)</a></li>
</ul></li>
<li><a href="10.6-replication-and-the-simulation.html#replication-and-the-simulation" id="toc-replication-and-the-simulation"><span class="toc-section-number">10.6</span> Replication (and the simulation)</a></li>
<li><a href="10.7-extension-confidence-interval-coverage.html#extension-confidence-interval-coverage" id="toc-extension-confidence-interval-coverage"><span class="toc-section-number">10.7</span> Extension: Confidence interval coverage</a></li>
<li class="has-sub"><a href="10.8-a-taste-of-multiple-scenarios.html#a-taste-of-multiple-scenarios" id="toc-a-taste-of-multiple-scenarios"><span class="toc-section-number">10.8</span> A taste of multiple scenarios</a>
<ul>
<li><a href="10.8-a-taste-of-multiple-scenarios.html#exercises-7" id="toc-exercises-7"><span class="toc-section-number">10.8.1</span> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="has-sub"><a href="11-exp-design.html#exp-design" id="toc-exp-design"><span class="toc-section-number">11</span> Designing the multifactor simulation experiment</a>
<ul>
<li class="has-sub"><a href="11.1-choosing-parameter-combinations.html#choosing-parameter-combinations" id="toc-choosing-parameter-combinations"><span class="toc-section-number">11.1</span> Choosing parameter combinations</a>
<ul>
<li><a href="11.1-choosing-parameter-combinations.html#choosing-parameters-for-the-clustered-rct" id="toc-choosing-parameters-for-the-clustered-rct"><span class="toc-section-number">11.1.1</span> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li><a href="11.2-using-pmap-to-run-multifactor-simulations.html#using-pmap-to-run-multifactor-simulations" id="toc-using-pmap-to-run-multifactor-simulations"><span class="toc-section-number">11.2</span> Using pmap to run multifactor simulations</a></li>
<li class="has-sub"><a href="11.3-when-to-aggregate-results-across-multiple-simulations.html#when-to-aggregate-results-across-multiple-simulations" id="toc-when-to-aggregate-results-across-multiple-simulations"><span class="toc-section-number">11.3</span> When to aggregate results across multiple simulations</a>
<ul>
<li><a href="11.3-when-to-aggregate-results-across-multiple-simulations.html#aggregate-as-you-simulate-inside" id="toc-aggregate-as-you-simulate-inside"><span class="toc-section-number">11.3.1</span> Aggregate as you simulate (inside)</a></li>
<li><a href="11.3-when-to-aggregate-results-across-multiple-simulations.html#keep-all-simulation-runs-outside" id="toc-keep-all-simulation-runs-outside"><span class="toc-section-number">11.3.2</span> Keep all simulation runs (outside)</a></li>
<li><a href="11.3-when-to-aggregate-results-across-multiple-simulations.html#getting-raw-results-ready-for-analysis" id="toc-getting-raw-results-ready-for-analysis"><span class="toc-section-number">11.3.3</span> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="has-sub"><a href="11.4-running-the-cluster-rct-multifactor-experiment.html#running-the-cluster-rct-multifactor-experiment" id="toc-running-the-cluster-rct-multifactor-experiment"><span class="toc-section-number">11.4</span> Running the Cluster RCT multifactor experiment</a>
<ul>
<li><a href="11.4-running-the-cluster-rct-multifactor-experiment.html#making-analyze_data-quiet" id="toc-making-analyze_data-quiet"><span class="toc-section-number">11.4.1</span> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="12-analyzing-the-multifactor-experiment.html#analyzing-the-multifactor-experiment" id="toc-analyzing-the-multifactor-experiment"><span class="toc-section-number">12</span> Analyzing the multifactor experiment</a>
<ul>
<li class="has-sub"><a href="12.1-ways-of-analyzing-simulation-results.html#ways-of-analyzing-simulation-results" id="toc-ways-of-analyzing-simulation-results"><span class="toc-section-number">12.1</span> Ways of analyzing simulation results</a>
<ul>
<li><a href="12.1-ways-of-analyzing-simulation-results.html#plot-everything-with-many-small-multiples" id="toc-plot-everything-with-many-small-multiples"><span class="toc-section-number">12.1.1</span> Plot everything with many small multiples</a></li>
<li><a href="12.1-ways-of-analyzing-simulation-results.html#bundling" id="toc-bundling"><span class="toc-section-number">12.1.2</span> Bundling</a></li>
<li><a href="12.1-ways-of-analyzing-simulation-results.html#aggregation" id="toc-aggregation"><span class="toc-section-number">12.1.3</span> Aggregation</a></li>
<li><a href="12.1-ways-of-analyzing-simulation-results.html#regression-summarization" id="toc-regression-summarization"><span class="toc-section-number">12.1.4</span> Regression Summarization</a></li>
<li><a href="12.1-ways-of-analyzing-simulation-results.html#focus-on-a-subset-kick-rest-to-supplement" id="toc-focus-on-a-subset-kick-rest-to-supplement"><span class="toc-section-number">12.1.5</span> Focus on a subset, kick rest to supplement</a></li>
</ul></li>
<li><a href="12.2-analyzing-results-when-some-trials-have-failed.html#analyzing-results-when-some-trials-have-failed" id="toc-analyzing-results-when-some-trials-have-failed"><span class="toc-section-number">12.2</span> Analyzing results when some trials have failed</a></li>
<li class="has-sub"><a href="12.3-case-study-power-for-a-randomized-trial.html#case-study-power-for-a-randomized-trial" id="toc-case-study-power-for-a-randomized-trial"><span class="toc-section-number">12.3</span> Case study: power for a randomized trial</a>
<ul>
<li><a href="12.3-case-study-power-for-a-randomized-trial.html#the-initial-analysis" id="toc-the-initial-analysis"><span class="toc-section-number">12.3.1</span> The initial analysis</a></li>
<li><a href="12.3-case-study-power-for-a-randomized-trial.html#focusing-on-validity" id="toc-focusing-on-validity"><span class="toc-section-number">12.3.2</span> Focusing on validity</a></li>
<li><a href="12.3-case-study-power-for-a-randomized-trial.html#aggregate-to-look-at-main-effects" id="toc-aggregate-to-look-at-main-effects"><span class="toc-section-number">12.3.3</span> Aggregate to look at main effects</a></li>
<li><a href="12.3-case-study-power-for-a-randomized-trial.html#recap" id="toc-recap"><span class="toc-section-number">12.3.4</span> Recap</a></li>
</ul></li>
<li><a href="12.4-exercises-8.html#exercises-8" id="toc-exercises-8"><span class="toc-section-number">12.4</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="13-case-study-comparing-different-estimators.html#case-study-comparing-different-estimators" id="toc-case-study-comparing-different-estimators"><span class="toc-section-number">13</span> Case study: Comparing different estimators</a>
<ul>
<li><a href="13.1-the-data-generating-process.html#the-data-generating-process" id="toc-the-data-generating-process"><span class="toc-section-number">13.1</span> The data generating process</a></li>
<li><a href="13.2-the-data-analysis-methods.html#the-data-analysis-methods" id="toc-the-data-analysis-methods"><span class="toc-section-number">13.2</span> The data analysis methods</a></li>
<li><a href="13.3-the-simulation-itself.html#the-simulation-itself" id="toc-the-simulation-itself"><span class="toc-section-number">13.3</span> The simulation itself</a></li>
<li><a href="13.4-calculating-performance-measures-for-all-our-estimators.html#calculating-performance-measures-for-all-our-estimators" id="toc-calculating-performance-measures-for-all-our-estimators"><span class="toc-section-number">13.4</span> Calculating performance measures for all our estimators</a></li>
<li><a href="13.5-improving-the-visualization-of-the-results.html#improving-the-visualization-of-the-results" id="toc-improving-the-visualization-of-the-results"><span class="toc-section-number">13.5</span> Improving the visualization of the results</a></li>
<li><a href="13.6-extension-the-bias-variance-tradeoff.html#extension-the-bias-variance-tradeoff" id="toc-extension-the-bias-variance-tradeoff"><span class="toc-section-number">13.6</span> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="has-sub"><a href="14-presentation-of-simulation-results.html#presentation-of-simulation-results" id="toc-presentation-of-simulation-results"><span class="toc-section-number">14</span> Presentation of simulation results</a>
<ul>
<li><a href="14.1-tabulation.html#tabulation" id="toc-tabulation"><span class="toc-section-number">14.1</span> Tabulation</a></li>
<li class="has-sub"><a href="14.2-visualization.html#visualization" id="toc-visualization"><span class="toc-section-number">14.2</span> Visualization</a>
<ul>
<li><a href="14.2-visualization.html#example-1-biserial-correlation-estimation" id="toc-example-1-biserial-correlation-estimation"><span class="toc-section-number">14.2.1</span> Example 1: Biserial correlation estimation</a></li>
<li><a href="14.2-visualization.html#example-2-variance-estimation-and-meta-regression" id="toc-example-2-variance-estimation-and-meta-regression"><span class="toc-section-number">14.2.2</span> Example 2: Variance estimation and Meta-regression</a></li>
<li><a href="14.2-visualization.html#example-heat-maps-of-coverage" id="toc-example-heat-maps-of-coverage"><span class="toc-section-number">14.2.3</span> Example: Heat maps of coverage</a></li>
</ul></li>
<li><a href="14.3-modeling.html#modeling" id="toc-modeling"><span class="toc-section-number">14.3</span> Modeling</a></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="has-sub"><a href="15-sec-reproducability.html#sec-reproducability" id="toc-sec-reproducability"><span class="toc-section-number">15</span> Ensuring reproducibility</a>
<ul>
<li><a href="15.1-seeds-and-pseudo-random-number-generators.html#seeds-and-pseudo-random-number-generators" id="toc-seeds-and-pseudo-random-number-generators"><span class="toc-section-number">15.1</span> Seeds and pseudo-random number generators</a></li>
<li><a href="15.2-including-seed-in-our-simulation-driver.html#including-seed-in-our-simulation-driver" id="toc-including-seed-in-our-simulation-driver"><span class="toc-section-number">15.2</span> Including seed in our simulation driver</a></li>
<li><a href="15.3-reasons-for-setting-the-seed.html#reasons-for-setting-the-seed" id="toc-reasons-for-setting-the-seed"><span class="toc-section-number">15.3</span> Reasons for setting the seed</a></li>
</ul></li>
<li class="has-sub"><a href="16-optimize-code.html#optimize-code" id="toc-optimize-code"><span class="toc-section-number">16</span> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li><a href="16.1-hand-building-functions.html#hand-building-functions" id="toc-hand-building-functions"><span class="toc-section-number">16.1</span> Hand-building functions</a></li>
<li><a href="16.2-sec_comp_efficiency.html#sec_comp_efficiency" id="toc-sec_comp_efficiency"><span class="toc-section-number">16.2</span> Computational efficiency versus simplicity</a></li>
<li><a href="16.3-reusing-code-to-speed-up-computation.html#reusing-code-to-speed-up-computation" id="toc-reusing-code-to-speed-up-computation"><span class="toc-section-number">16.3</span> Reusing code to speed up computation</a></li>
</ul></li>
<li class="has-sub"><a href="17-error-trapping-and-other-headaches.html#error-trapping-and-other-headaches" id="toc-error-trapping-and-other-headaches"><span class="toc-section-number">17</span> Error trapping and other headaches</a>
<ul>
<li><a href="17-error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations" id="toc-what-to-do-with-warnings-in-simulations"><span class="toc-section-number">17.0.1</span> What to do with warnings in simulations</a></li>
</ul></li>
<li class="has-sub"><a href="18-saving-files.html#saving-files" id="toc-saving-files"><span class="toc-section-number">18</span> Saving files and results</a>
<ul>
<li><a href="18.1-saving-simulations-in-general.html#saving-simulations-in-general" id="toc-saving-simulations-in-general"><span class="toc-section-number">18.1</span> Saving simulations in general</a></li>
<li><a href="18.2-saving-simulations-as-you-go.html#saving-simulations-as-you-go" id="toc-saving-simulations-as-you-go"><span class="toc-section-number">18.2</span> Saving simulations as you go</a></li>
<li><a href="18.3-dynamically-making-directories.html#dynamically-making-directories" id="toc-dynamically-making-directories"><span class="toc-section-number">18.3</span> Dynamically making directories</a></li>
<li><a href="18.4-loading-and-combining-files-of-simulation-results.html#loading-and-combining-files-of-simulation-results" id="toc-loading-and-combining-files-of-simulation-results"><span class="toc-section-number">18.4</span> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="has-sub"><a href="19-parallel-processing.html#parallel-processing" id="toc-parallel-processing"><span class="toc-section-number">19</span> Parallel Processing</a>
<ul>
<li><a href="19.1-parallel-on-your-computer.html#parallel-on-your-computer" id="toc-parallel-on-your-computer"><span class="toc-section-number">19.1</span> Parallel on your computer</a></li>
<li class="has-sub"><a href="19.2-parallel-off-your-computer.html#parallel-off-your-computer" id="toc-parallel-off-your-computer"><span class="toc-section-number">19.2</span> Parallel off your computer</a>
<ul>
<li><a href="19.2-parallel-off-your-computer.html#what-is-a-command-line-interface" id="toc-what-is-a-command-line-interface"><span class="toc-section-number">19.2.1</span> What is a command-line interface?</a></li>
<li><a href="19.2-parallel-off-your-computer.html#running-a-job-on-a-cluster" id="toc-running-a-job-on-a-cluster"><span class="toc-section-number">19.2.2</span> Running a job on a cluster</a></li>
<li><a href="19.2-parallel-off-your-computer.html#checking-on-a-job" id="toc-checking-on-a-job"><span class="toc-section-number">19.2.3</span> Checking on a job</a></li>
<li><a href="19.2-parallel-off-your-computer.html#running-lots-of-jobs-on-a-cluster" id="toc-running-lots-of-jobs-on-a-cluster"><span class="toc-section-number">19.2.4</span> Running lots of jobs on a cluster</a></li>
<li><a href="19.2-parallel-off-your-computer.html#resources-for-harvards-odyssey" id="toc-resources-for-harvards-odyssey"><span class="toc-section-number">19.2.5</span> Resources for Harvard’s Odyssey</a></li>
<li><a href="19.2-parallel-off-your-computer.html#acknowledgements-1" id="toc-acknowledgements-1"><span class="toc-section-number">19.2.6</span> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="20-simulations-as-evidence.html#simulations-as-evidence" id="toc-simulations-as-evidence"><span class="toc-section-number">20</span> Simulations as evidence</a>
<ul>
<li class="has-sub"><a href="20.1-strategies-for-making-relevant-simulations.html#strategies-for-making-relevant-simulations" id="toc-strategies-for-making-relevant-simulations"><span class="toc-section-number">20.1</span> Strategies for making relevant simulations</a>
<ul>
<li><a href="20.1-strategies-for-making-relevant-simulations.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment" id="toc-make-your-simulation-general-with-an-extensive-multi-factor-experiment"><span class="toc-section-number">20.1.1</span> Make your simulation general with an extensive multi-factor experiment</a></li>
<li><a href="20.1-strategies-for-making-relevant-simulations.html#use-previously-published-simulations-to-beat-them-at-their-own-game" id="toc-use-previously-published-simulations-to-beat-them-at-their-own-game"><span class="toc-section-number">20.1.2</span> Use previously published simulations to beat them at their own game</a></li>
<li><a href="20.1-strategies-for-making-relevant-simulations.html#calibrate-simulation-factors-to-real-data" id="toc-calibrate-simulation-factors-to-real-data"><span class="toc-section-number">20.1.3</span> Calibrate simulation factors to real data</a></li>
<li><a href="20.1-strategies-for-making-relevant-simulations.html#use-real-data-to-obtain-directly" id="toc-use-real-data-to-obtain-directly"><span class="toc-section-number">20.1.4</span> Use real data to obtain directly</a></li>
<li><a href="20.1-strategies-for-making-relevant-simulations.html#fully-calibrated-simulations" id="toc-fully-calibrated-simulations"><span class="toc-section-number">20.1.5</span> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="has-sub"><a href="21-using-simulation-as-a-power-calculator.html#using-simulation-as-a-power-calculator" id="toc-using-simulation-as-a-power-calculator"><span class="toc-section-number">21</span> Using simulation as a power calculator</a>
<ul>
<li><a href="21.1-getting-design-parameters-from-pilot-data.html#getting-design-parameters-from-pilot-data" id="toc-getting-design-parameters-from-pilot-data"><span class="toc-section-number">21.1</span> Getting design parameters from pilot data</a></li>
<li><a href="21.2-the-data-generating-process-1.html#the-data-generating-process-1" id="toc-the-data-generating-process-1"><span class="toc-section-number">21.2</span> The data generating process</a></li>
<li><a href="21.3-running-the-simulation-1.html#running-the-simulation-1" id="toc-running-the-simulation-1"><span class="toc-section-number">21.3</span> Running the simulation</a></li>
<li class="has-sub"><a href="21.4-evaluating-power.html#evaluating-power" id="toc-evaluating-power"><span class="toc-section-number">21.4</span> Evaluating power</a>
<ul>
<li><a href="21.4-evaluating-power.html#checking-validity-of-our-models" id="toc-checking-validity-of-our-models"><span class="toc-section-number">21.4.1</span> Checking validity of our models</a></li>
<li><a href="21.4-evaluating-power.html#assessing-precision-se" id="toc-assessing-precision-se"><span class="toc-section-number">21.4.2</span> Assessing Precision (SE)</a></li>
<li><a href="21.4-evaluating-power.html#assessing-power" id="toc-assessing-power"><span class="toc-section-number">21.4.3</span> Assessing power</a></li>
<li><a href="21.4-evaluating-power.html#assessing-minimum-detectable-effects" id="toc-assessing-minimum-detectable-effects"><span class="toc-section-number">21.4.4</span> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="22-potential-outcomes.html#potential-outcomes" id="toc-potential-outcomes"><span class="toc-section-number">22</span> Simulation under the Potential Outcomes Framework</a>
<ul>
<li><a href="22.1-finite-vs.-superpopulation-inference.html#finite-vs.-superpopulation-inference" id="toc-finite-vs.-superpopulation-inference"><span class="toc-section-number">22.1</span> Finite vs. Superpopulation inference</a></li>
<li><a href="22.2-data-generation-processes-for-potential-outcomes.html#data-generation-processes-for-potential-outcomes" id="toc-data-generation-processes-for-potential-outcomes"><span class="toc-section-number">22.2</span> Data generation processes for potential outcomes</a></li>
<li><a href="22.3-finite-sample-performance-measures.html#finite-sample-performance-measures" id="toc-finite-sample-performance-measures"><span class="toc-section-number">22.3</span> Finite sample performance measures</a></li>
<li><a href="22.4-nested-finite-simulation-procedure.html#nested-finite-simulation-procedure" id="toc-nested-finite-simulation-procedure"><span class="toc-section-number">22.4</span> Nested finite simulation procedure</a></li>
</ul></li>
<li class="has-sub"><a href="23-the-parametric-bootstrap.html#the-parametric-bootstrap" id="toc-the-parametric-bootstrap"><span class="toc-section-number">23</span> The Parametric bootstrap</a>
<ul>
<li><a href="23.1-air-conditioners-a-stolen-case-study.html#air-conditioners-a-stolen-case-study" id="toc-air-conditioners-a-stolen-case-study"><span class="toc-section-number">23.1</span> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="has-sub"><a href="A-coding-tidbits.html#coding-tidbits" id="toc-coding-tidbits"><span class="toc-section-number">A</span> Coding tidbits</a>
<ul>
<li class="has-sub"><a href="A.1-repeating-oneself.html#repeating-oneself" id="toc-repeating-oneself"><span class="toc-section-number">A.1</span> How to repeat yourself</a>
<ul>
<li><a href="A.1-repeating-oneself.html#using-replicate" id="toc-using-replicate"><span class="toc-section-number">A.1.1</span> Using <code>replicate()</code></a></li>
<li><a href="A.1-repeating-oneself.html#using-map" id="toc-using-map"><span class="toc-section-number">A.1.2</span> Using <code>map()</code></a></li>
<li><a href="A.1-repeating-oneself.html#map-with-no-inputs" id="toc-map-with-no-inputs"><span class="toc-section-number">A.1.3</span> map with no inputs</a></li>
<li><a href="A.1-repeating-oneself.html#other-approaches-for-repetition" id="toc-other-approaches-for-repetition"><span class="toc-section-number">A.1.4</span> Other approaches for repetition</a></li>
</ul></li>
<li><a href="A.2-default-arguments.html#default-arguments" id="toc-default-arguments"><span class="toc-section-number">A.2</span> Default arguments for functions</a></li>
<li><a href="A.3-about-source-command.html#about-source-command" id="toc-about-source-command"><span class="toc-section-number">A.3</span> The source command and keeping things organized</a></li>
<li><a href="A.4-about-keeping-tests-with-FALSE.html#about-keeping-tests-with-FALSE" id="toc-about-keeping-tests-with-FALSE"><span class="toc-section-number">A.4</span> Testing and debugging code in your scripts</a></li>
<li><a href="A.5-about-browser-debugging.html#about-browser-debugging" id="toc-about-browser-debugging"><span class="toc-section-number">A.5</span> Debugging with browser</a></li>
<li><a href="A.6-about-stopifnot.html#about-stopifnot" id="toc-about-stopifnot"><span class="toc-section-number">A.6</span> Protecting your functions with “stop”</a></li>
</ul></li>
<li><a href="B-further-readings-and-resources.html#further-readings-and-resources" id="toc-further-readings-and-resources"><span class="toc-section-number">B</span> Further readings and resources</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="functions" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Functions</h2>
<p>If you are comfortable using R for data analysis tasks, you will be familiar with many of R’s functions.
R has function to do things like calculate a summary statistic from a list of numbers (e.g., <code>mean()</code>, <code>median()</code>, or <code>sd()</code>), calculate linear regression coefficient estimates from a dataset (<code>lm()</code>), or count the number of rows in a dataset (<code>nrow()</code>).
In the abstract, a function is a little machine for transforming ingredients into outputs, like a microwave (put a bag of kernels in and it will return hot, crunchy popcorn), a cheese shredder (put a block of mozzarella in and it transforms it into topping for your pizza), or a washing machine (put in dirty clothes and detergent and it will return clean but damp clothes).
A function takes in pieces of information specified by the user (the inputs), follows a set of instructions for transforming or summarizing those inputs, and then returns the result of the calculations (the outputs).</p>
<!--
![A function as a machine](image/function-machine.png){ width=50% }
LWM: Is this worth updating and including?  If included, cite in the text.
-->
<p>A function can do nearly anything as long as the calculation can be expressed in code—it can even produce output that is random.
For example, the <code>rnorm()</code> function takes as input a number <code>n</code> and returns that many random numbers, drawn from a standard normal distribution:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="2.2-functions.html#cb2-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]  0.8380932  0.4572165 -0.1489622</code></pre>
<p>Each time the function is called, it returns a different set of numbers:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="2.2-functions.html#cb4-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]  1.0951085 -1.2560144  0.4889371</code></pre>
<p>The <code>rnorm()</code> function also has further input arguments that let the user specify the mean and standard deviation of the distribution from which numbers are drawn:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="2.2-functions.html#cb6-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1]  9.221771 10.398592 10.920492</code></pre>
<p>In writing code for simulations, we will make extensive use of this particular function and other functions that produce sequences of random numbers.
We will have more to say about random number generation later.</p>
<div id="rolling-your-own" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Rolling your own</h3>
<p>In R, you can create your own function by specifying the pieces of input information, the steps to follow in transforming the inputs, and the result to return as output.
Learning to write your own functions to carry out calculations is an immensely useful skill that will greatly enhance your ability to accomplish a range of tasks.
Writing custom functions is also central to our approach to coding Monte Carlo simulations, and so we highlight some of the key considerations here.
<a href="https://r4ds.had.co.nz/functions.html">Chapter 19 of R for Data Science (1st edition)</a> provides an in-depth discussion of how to write your own functions.</p>
<p>Here is an example of a custom function called <code>one_run()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="2.2-functions.html#cb8-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( N, mn, sd ) {</span>
<span id="cb8-2"><a href="2.2-functions.html#cb8-2" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N, <span class="at">mean =</span> mn, <span class="at">sd =</span> sd )</span>
<span id="cb8-3"><a href="2.2-functions.html#cb8-3" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>( vals )</span>
<span id="cb8-4"><a href="2.2-functions.html#cb8-4" tabindex="-1"></a>  pvalue <span class="ot">&lt;-</span> tt<span class="sc">$</span>p.value</span>
<span id="cb8-5"><a href="2.2-functions.html#cb8-5" tabindex="-1"></a>  <span class="fu">return</span>(pvalue)</span>
<span id="cb8-6"><a href="2.2-functions.html#cb8-6" tabindex="-1"></a>}</span></code></pre></div>
<p>The first line specifies that we are creating a function that takes inputs <code>N</code>, <code>mn</code>, and <code>sd</code>. These are called the <em>parameters</em>, <em>inputs</em>, or <em>arguments</em> of the function. The remaining lines inside the curly brackets are called the <em>body</em> of the function. These lines specify the instructions to follow in transforming the inputs into an output:</p>
<ol style="list-style-type: decimal">
<li>Generate a random sample of <code>N</code> observations from a normal distribution with mean <code>mn</code> and store the result in <code>vals</code>.</li>
<li>Use the built-in function <code>t.test()</code> to compute a one-sample t-test for the null hypothesis that the population mean is zero, then store the result in <code>tt</code>.</li>
<li>Extract the p-value from the t-test store the result in <code>pvalue</code>.</li>
<li>Return <code>pvalue</code> as output.</li>
</ol>
<p>Having created the function, we can then use it with any inputs that we like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="2.2-functions.html#cb9-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">100</span>, <span class="dv">5</span>, <span class="dv">1</span> )</span></code></pre></div>
<pre><code>## [1] 1.3802e-75</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="2.2-functions.html#cb11-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">10</span>, <span class="fl">0.3</span>, <span class="dv">1</span> )</span></code></pre></div>
<pre><code>## [1] 0.3483371</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="2.2-functions.html#cb13-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">10</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span> )</span></code></pre></div>
<pre><code>## [1] 0.0002435631</code></pre>
<p>In each case, the output of the function is a p-value from a simulated sample of data. The function produces a different answer each time because its instructions involve generating random numbers each time it is called.
In essence, our custom function is just a short-cut for carrying out its instructions.
Writing it saves us from having to repeatedly write or copy-paste the lines of code inside its body.</p>
</div>
<div id="a-dangerous-function" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> A dangerous function</h3>
<p>Writing custom functions will prove to be crucial for effectively implementing Monte Carlo simulations.
However, designing custom functions does take practice to master.
It also requires a degree of care above and beyond what is needed just to use R’s built-in functions.</p>
<p>One of the common mistakes encountered in writing custom functions is to let the function depend on information that is not part of the input arguments.
For example, consider the following script, which includes a nonsensical custom function called <code>funky()</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="2.2-functions.html#cb15-1" tabindex="-1"></a>secret <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb15-2"><a href="2.2-functions.html#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="2.2-functions.html#cb15-3" tabindex="-1"></a>funky <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3) {</span>
<span id="cb15-4"><a href="2.2-functions.html#cb15-4" tabindex="-1"></a>  </span>
<span id="cb15-5"><a href="2.2-functions.html#cb15-5" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb15-6"><a href="2.2-functions.html#cb15-6" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb15-7"><a href="2.2-functions.html#cb15-7" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret</span>
<span id="cb15-8"><a href="2.2-functions.html#cb15-8" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="2.2-functions.html#cb15-9" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb15-10"><a href="2.2-functions.html#cb15-10" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="2.2-functions.html#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="2.2-functions.html#cb15-12" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<p><code>funky</code> takes inputs <code>input1</code>, <code>input2</code>, and <code>input3</code>, but its instructions also depend on the quantity <code>secret</code>.
What happens if we change the value of <code>secret</code>?</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="2.2-functions.html#cb17-1" tabindex="-1"></a>secret <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-2"><a href="2.2-functions.html#cb17-2" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 102.5</code></pre>
<p>Even though we give it the same arguments as previously, the output of the function is different.
This sort of behavior is confusing.
Unless the function involves generating random numbers, we would generally expect it to return the exact same output if we give it the same inputs.
Even worse, we get a rather cryptic error if the value of <code>secret</code> is not compatible with what the function expects:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="2.2-functions.html#cb19-1" tabindex="-1"></a>secret <span class="ot">&lt;-</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb19-2"><a href="2.2-functions.html#cb19-2" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Error in input3 * ratio + secret: non-numeric argument to binary operator</code></pre>
<p>If we are not careful, we will end up with very confusing code that can very easily lead to unintended results and errors.</p>
<p>To avoid this issue, it is important for functions to only use information that is explicitly provided to it through its arguments.
This is the principle of <em>isolating the inputs</em>.
If the result of a function is supposed to depend on a quantity, then we should include that quantity among the input arguments.
We can fix our example function by including <code>secret</code> as an argument:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="2.2-functions.html#cb21-1" tabindex="-1"></a>secret <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb21-2"><a href="2.2-functions.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="2.2-functions.html#cb21-3" tabindex="-1"></a>funkier <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3, secret) {</span>
<span id="cb21-4"><a href="2.2-functions.html#cb21-4" tabindex="-1"></a>  </span>
<span id="cb21-5"><a href="2.2-functions.html#cb21-5" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb21-6"><a href="2.2-functions.html#cb21-6" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb21-7"><a href="2.2-functions.html#cb21-7" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret</span>
<span id="cb21-8"><a href="2.2-functions.html#cb21-8" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="2.2-functions.html#cb21-9" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb21-10"><a href="2.2-functions.html#cb21-10" tabindex="-1"></a>}</span>
<span id="cb21-11"><a href="2.2-functions.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="2.2-functions.html#cb21-12" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<p>Now the output of the function is always the same, regardless of the value of other objects in R:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="2.2-functions.html#cb23-1" tabindex="-1"></a>secret <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb23-2"><a href="2.2-functions.html#cb23-2" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<p>The <em>input parameter</em> <code>secret</code> holds sway here, even though there is also an object with the same name.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> If we want to try 100, we have to do so <em>explicitly</em>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="2.2-functions.html#cb25-1" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 102.5</code></pre>
<p>When writing your own functions, it may not be obvious that your function depends on external quantities and does not isolate the inputs.
In our experience, one of the best ways to detect this issue is to clear the R environment and start from a fresh palette, run the code to create the function, and call the function (perhaps more than once) to ensure that it works as expected.
Here is an illustration of what happens when we follow this process with our problematic custom function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="2.2-functions.html#cb27-1" tabindex="-1"></a><span class="co"># clear environment</span></span>
<span id="cb27-2"><a href="2.2-functions.html#cb27-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb27-3"><a href="2.2-functions.html#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="2.2-functions.html#cb27-4" tabindex="-1"></a><span class="co"># create function</span></span>
<span id="cb27-5"><a href="2.2-functions.html#cb27-5" tabindex="-1"></a>funky <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3) {</span>
<span id="cb27-6"><a href="2.2-functions.html#cb27-6" tabindex="-1"></a>  </span>
<span id="cb27-7"><a href="2.2-functions.html#cb27-7" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb27-8"><a href="2.2-functions.html#cb27-8" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb27-9"><a href="2.2-functions.html#cb27-9" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret</span>
<span id="cb27-10"><a href="2.2-functions.html#cb27-10" tabindex="-1"></a>  </span>
<span id="cb27-11"><a href="2.2-functions.html#cb27-11" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb27-12"><a href="2.2-functions.html#cb27-12" tabindex="-1"></a>}</span>
<span id="cb27-13"><a href="2.2-functions.html#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="2.2-functions.html#cb27-14" tabindex="-1"></a><span class="co"># test the function</span></span>
<span id="cb27-15"><a href="2.2-functions.html#cb27-15" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Error in funky(3, 2, 5): object &#39;secret&#39; not found</code></pre>
<p>We get an error because the external quantity is not available.
Here is the same process using our corrected function:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="2.2-functions.html#cb29-1" tabindex="-1"></a><span class="co"># clear environment</span></span>
<span id="cb29-2"><a href="2.2-functions.html#cb29-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb29-3"><a href="2.2-functions.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="2.2-functions.html#cb29-4" tabindex="-1"></a><span class="co"># create function</span></span>
<span id="cb29-5"><a href="2.2-functions.html#cb29-5" tabindex="-1"></a>funkier <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3, secret) {</span>
<span id="cb29-6"><a href="2.2-functions.html#cb29-6" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="2.2-functions.html#cb29-7" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb29-8"><a href="2.2-functions.html#cb29-8" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb29-9"><a href="2.2-functions.html#cb29-9" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret</span>
<span id="cb29-10"><a href="2.2-functions.html#cb29-10" tabindex="-1"></a>  </span>
<span id="cb29-11"><a href="2.2-functions.html#cb29-11" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb29-12"><a href="2.2-functions.html#cb29-12" tabindex="-1"></a>}</span>
<span id="cb29-13"><a href="2.2-functions.html#cb29-13" tabindex="-1"></a></span>
<span id="cb29-14"><a href="2.2-functions.html#cb29-14" tabindex="-1"></a></span>
<span id="cb29-15"><a href="2.2-functions.html#cb29-15" tabindex="-1"></a><span class="co"># test the function</span></span>
<span id="cb29-16"><a href="2.2-functions.html#cb29-16" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="at">secret =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
</div>
<div id="using-named-arguments" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Using Named Arguments</h3>
<p>When calling a function (whether it is a built-in function or a custom function that you developed), you can specify which values correspond to which arguments using argument names.
Using argument names greatly enhances the readability and flexibility of function calls.
When you specify inputs by name, R matches the values to the arguments based on the names rather than the order in which they appear.
This feature is particularly useful in complex functions with many optional arguments.</p>
<p>For example, consider the function <code>one_run()</code> from <a href="2.2-functions.html#rolling-your-own">2.2.1</a>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="2.2-functions.html#cb31-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( N, mn, sd ) {</span>
<span id="cb31-2"><a href="2.2-functions.html#cb31-2" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N, <span class="at">mean =</span> mn, <span class="at">sd =</span> sd )</span>
<span id="cb31-3"><a href="2.2-functions.html#cb31-3" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>( vals )</span>
<span id="cb31-4"><a href="2.2-functions.html#cb31-4" tabindex="-1"></a>  pvalue <span class="ot">&lt;-</span> tt<span class="sc">$</span>p.value</span>
<span id="cb31-5"><a href="2.2-functions.html#cb31-5" tabindex="-1"></a>  <span class="fu">return</span>(pvalue)</span>
<span id="cb31-6"><a href="2.2-functions.html#cb31-6" tabindex="-1"></a>}</span></code></pre></div>
<p>You could call <code>one_run()</code> with <em>named</em> arguments in any order:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="2.2-functions.html#cb32-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">one_run</span>(<span class="at">sd =</span> <span class="fl">0.5</span>, <span class="at">mn =</span> <span class="dv">2</span>, <span class="at">N =</span> <span class="dv">500</span>)</span></code></pre></div>
<p>In this call, R knows which value to assign to each argument, so we could list the arguments however we like.</p>
<p>Without naming, we would have to specify the arguments in the exact order that they appear in the function definition:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="2.2-functions.html#cb33-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">one_run</span>( <span class="dv">500</span>, <span class="dv">2</span>, <span class="fl">0.5</span> )</span></code></pre></div>
<p>Without the argument names, this line of code is harder to follow—you have to know more about the design of the function to understand how it is being used in this instance.</p>
<p>Getting in the habit of using named arguments will help you avoid errors.
If you pass arguments without naming, and in the wrong order, you can end up with very strange results that are hard to diagnose.
Even if you get it right, if someone later changes the function (say by adding a new argument in the middle of the list), your code will suddenly break with no explanation.</p>
</div>
<div id="argument-defaults" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Argument Defaults</h3>
<p>Default arguments allow you to specify typical values for parameters that a user might not need to change every time they use the function.
This can make the function easier to use and less error-prone because the defaults ensure that the function behaves sensibly even when some arguments are not explicitly provided. For example, let us revise the <code>one_run()</code> function from above to use default arguments:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="2.2-functions.html#cb34-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">N =</span> <span class="dv">10</span>, <span class="at">mn =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span> ) {</span>
<span id="cb34-2"><a href="2.2-functions.html#cb34-2" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N, <span class="at">mean =</span> mn, <span class="at">sd =</span> sd )</span>
<span id="cb34-3"><a href="2.2-functions.html#cb34-3" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>( vals )</span>
<span id="cb34-4"><a href="2.2-functions.html#cb34-4" tabindex="-1"></a>  pvalue <span class="ot">&lt;-</span> tt<span class="sc">$</span>p.value</span>
<span id="cb34-5"><a href="2.2-functions.html#cb34-5" tabindex="-1"></a>  <span class="fu">return</span>(pvalue)</span>
<span id="cb34-6"><a href="2.2-functions.html#cb34-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Now our function has a default for <code>N</code> of 10, for <code>mn</code> of 0, and for <code>s</code> of 1.
This means a user can run the function simply by calling <code>one_run()</code> without any inputs. Doing so will generate a p-value from a sample of 10 observations with a mean of zero and a standard deviation of 1.</p>
<p>Once we have our function with defaults, we can call the function while specifying only the inputs that differ from the default values:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="2.2-functions.html#cb35-1" tabindex="-1"></a>bigger_sample <span class="ot">&lt;-</span> <span class="fu">one_run</span>( <span class="at">N =</span> <span class="dv">50</span> )</span></code></pre></div>
<p>The function will use its default values for <code>mn</code> and <code>s</code>.
Using defaults lets the user call the function more succinctly.</p>
<p>Later chapters will have much more to say about the process of writing custom functions, as well as many further illustrations and examples.</p>
</div>
<div id="function-skeletons" class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Function skeletons</h3>
<p>In discussing how to write functions for simulations, we will often present <em>function skeletons</em>. By a skeleton, we mean code that creates a function with a specific set of input arguments, but where the body is left partially or fully unspecified.
Here is a cursory example of a function skeleton:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="2.2-functions.html#cb36-1" tabindex="-1"></a>run_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>( N, J, mu, sigma, tau ) {</span>
<span id="cb36-2"><a href="2.2-functions.html#cb36-2" tabindex="-1"></a>  <span class="co"># simulate data</span></span>
<span id="cb36-3"><a href="2.2-functions.html#cb36-3" tabindex="-1"></a>  <span class="co"># apply estimation procedure</span></span>
<span id="cb36-4"><a href="2.2-functions.html#cb36-4" tabindex="-1"></a>  <span class="co"># repeat</span></span>
<span id="cb36-5"><a href="2.2-functions.html#cb36-5" tabindex="-1"></a>  <span class="co"># summarize results</span></span>
<span id="cb36-6"><a href="2.2-functions.html#cb36-6" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb36-7"><a href="2.2-functions.html#cb36-7" tabindex="-1"></a>}</span></code></pre></div>
<p>In subsequent chapters, we will use function skeletons to outline the organization of code for simulation studies.
The skeleton headers make clear what the inputs to the function need to be.
Sometimes, we will leave comments in the body of the skeleton to sketch out the general flow of calculations that need to happen.
Depending on the details of the simulation, the specifics of these steps might be quite different, but the general structure will often be quite consistent.
Finally, the last line of the skeleton indicates the value that should be returned as output of the function.
Thus, skeletons are kind of like <a href="https://www.madlibs.com/">Mad Libs</a>, but with R code instead of parts of speech.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>To learn more about how R determines which values to use when executing a function, see <a href="https://adv-r.hadley.nz/functions.html#lexical-scoping">Section 6.4 of Advance R</a>.<a href="2.2-functions.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="2.1-welcome-to-the-tidyverse.html"><button class="btn btn-default">Previous</button></a>
<a href="2.3-pipe-dreams.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
