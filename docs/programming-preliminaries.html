<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Programming Preliminaries | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Programming Preliminaries | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Programming Preliminaries | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2024-06-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="an-initial-simulation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulation-hacking"><i class="fa fa-check"></i><b>1.3</b> Simulation-hacking</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.4</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#why-r"><i class="fa fa-check"></i><b>2.1</b> Why R?</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.2</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.3</b> Functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.3.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.3.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.3.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.3.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.3.3</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.4</b> <code>%&gt;%</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.5</b> Recipes versus Patterns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulation-for-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulation for a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="an-initial-simulation.html"><a href="an-initial-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.2</b> Simulating across different scenarios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy simulations</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#the-data-generating-process-dgp"><i class="fa fa-check"></i><b>4.2.1</b> The Data Generating Process (DGP)</a></li>
<li class="chapter" data-level="4.2.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-procedures"><i class="fa fa-check"></i><b>4.2.2</b> Estimation procedures</a></li>
<li class="chapter" data-level="4.2.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>4.2.3</b> Repetition</a></li>
<li class="chapter" data-level="4.2.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>4.2.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.2.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#why-the-tidy-approach"><i class="fa fa-check"></i><b>4.2.5</b> Why the tidy approach?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multiple-scenarios"><i class="fa fa-check"></i><b>4.3</b> Multiple Scenarios</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#coding-remark"><i class="fa fa-check"></i><b>5.1.1</b> Coding remark</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-estimation-procedures"><i class="fa fa-check"></i><b>5.2</b> The estimation procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#analyzing-the-simulation"><i class="fa fa-check"></i><b>5.4</b> Analyzing the Simulation</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-DGP.html"><a href="chap-DGP.html"><i class="fa fa-check"></i><b>6</b> Data-Generating Processes (DGPs)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chap-DGP.html"><a href="chap-DGP.html#a-statistical-model-is-a-recipe-for-data-generation"><i class="fa fa-check"></i><b>6.1</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.2" data-path="chap-DGP.html"><a href="chap-DGP.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>6.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="6.3" data-path="chap-DGP.html"><a href="chap-DGP.html#case-cluster"><i class="fa fa-check"></i><b>6.3</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="chap-DGP.html"><a href="chap-DGP.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.3.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.3.2" data-path="chap-DGP.html"><a href="chap-DGP.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.3.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.3.3" data-path="chap-DGP.html"><a href="chap-DGP.html#converting-our-model-to-code"><i class="fa fa-check"></i><b>6.3.3</b> Converting our model to code</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="chap-DGP.html"><a href="chap-DGP.html#exercises"><i class="fa fa-check"></i><b>6.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="chap-DGP.html"><a href="chap-DGP.html#ex_dgp"><i class="fa fa-check"></i><b>6.4.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.4.2" data-path="chap-DGP.html"><a href="chap-DGP.html#checking-and-extending-the-cluster-rct-dgp"><i class="fa fa-check"></i><b>6.4.2</b> Checking and extending the Cluster RCT DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="chap-DGP.html"><a href="chap-DGP.html#extension-standardization-in-a-data-generating-process"><i class="fa fa-check"></i><b>6.5</b> Extension: Standardization in a data generating process</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html"><i class="fa fa-check"></i><b>7</b> Estimation procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#validating-estimation-procedures"><i class="fa fa-check"></i><b>7.1</b> Validating Estimation Procedures</a></li>
<li class="chapter" data-level="7.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#checking-via-simulation"><i class="fa fa-check"></i><b>7.2</b> Checking via simulation</a></li>
<li class="chapter" data-level="7.3" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#including-multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.3</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="7.4" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#exercises-1"><i class="fa fa-check"></i><b>7.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#more-welch-and-adding-the-bff-test"><i class="fa fa-check"></i><b>7.4.1</b> More Welch and adding the BFF test</a></li>
<li class="chapter" data-level="7.4.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#more-estimators-for-cluster-randomized-trials"><i class="fa fa-check"></i><b>7.4.2</b> More estimators for Cluster Randomized Trials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-1.html"><a href="running-the-simulation-1.html#exercises-2"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-vs.-estimation"><i class="fa fa-check"></i><b>9.1</b> Inference vs. Estimation</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#ways-of-assessing-and-comparing-estimation-procedures"><i class="fa fa-check"></i><b>9.2</b> Ways of Assessing and Comparing Estimation Procedures</a></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.3.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#handling-estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.3.2</b> Handling Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.4</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.4.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.5</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.5.1</b> Validity</a></li>
<li class="chapter" data-level="9.5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.5.2</b> Power</a></li>
<li class="chapter" data-level="9.5.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.5.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.5.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.5.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.6</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.6.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.7</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.7.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.7.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.7.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-mcse"><i class="fa fa-check"></i><b>9.8</b> Uncertainty in Performance Estimates (the MCSE)</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.8.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.8.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.8.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.8.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.8.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-3"><i class="fa fa-check"></i><b>9.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercices-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercices (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-4"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html"><i class="fa fa-check"></i><b>11</b> Case study: Attrition in a simple randomized experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#the-data-generating-process"><i class="fa fa-check"></i><b>11.1</b> The data generating process</a></li>
<li class="chapter" data-level="11.2" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#estimators"><i class="fa fa-check"></i><b>11.2</b> Estimators</a></li>
<li class="chapter" data-level="11.3" data-path="case-study-attrition-in-a-simple-randomized-experiment.html"><a href="case-study-attrition-in-a-simple-randomized-experiment.html#performance-criteria-1"><i class="fa fa-check"></i><b>11.3</b> Performance criteria</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>12</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="12.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>12.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>12.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>12.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="12.3" data-path="exp-design.html"><a href="exp-design.html#ways-of-repeating-oneself"><i class="fa fa-check"></i><b>12.3</b> Ways of repeating oneself</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>12.3.1</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>12.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>12.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html"><i class="fa fa-check"></i><b>13</b> Analyzing the multifactor experiment</a>
<ul>
<li class="chapter" data-level="13.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#bundling"><i class="fa fa-check"></i><b>13.1</b> Bundling</a></li>
<li class="chapter" data-level="13.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#aggregation"><i class="fa fa-check"></i><b>13.2</b> Aggregation</a></li>
<li class="chapter" data-level="13.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#regression-summarization"><i class="fa fa-check"></i><b>13.3</b> Regression Summarization</a></li>
<li class="chapter" data-level="13.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focus-on-subset-kick-rest-to-supplement"><i class="fa fa-check"></i><b>13.4</b> Focus on subset, kick rest to supplement</a></li>
<li class="chapter" data-level="13.5" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>13.5</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="13.6" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#a-demonstration-of-visualization"><i class="fa fa-check"></i><b>13.6</b> A demonstration of visualization</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#the-initial-analysis"><i class="fa fa-check"></i><b>13.6.1</b> The initial analysis</a></li>
<li class="chapter" data-level="13.6.2" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#focusing-on-validity"><i class="fa fa-check"></i><b>13.6.2</b> Focusing on validity</a></li>
<li class="chapter" data-level="13.6.3" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#looking-at-main-effects"><i class="fa fa-check"></i><b>13.6.3</b> Looking at main effects</a></li>
<li class="chapter" data-level="13.6.4" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#recap"><i class="fa fa-check"></i><b>13.6.4</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="analyzing-the-multifactor-experiment.html"><a href="analyzing-the-multifactor-experiment.html#exercises-5"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>14.1</b> The data generating process</a></li>
<li class="chapter" data-level="14.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>14.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="14.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>14.3</b> The simulation itself</a></li>
<li class="chapter" data-level="14.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>14.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="14.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>14.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="14.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#extension-the-bias-variance-tradeoff"><i class="fa fa-check"></i><b>14.6</b> Extension: The Bias-variance tradeoff</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>15</b> Presentation of simulation results</a>
<ul>
<li class="chapter" data-level="15.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>15.1</b> Tabulation</a></li>
<li class="chapter" data-level="15.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>15.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>15.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="15.2.2" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>15.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="15.2.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#example-heat-maps-of-coverage"><i class="fa fa-check"></i><b>15.2.3</b> Example: Heat maps of coverage</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="presentation-of-simulation-results.html"><a href="presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>15.3</b> Modeling</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="sec-reproducability.html"><a href="sec-reproducability.html"><i class="fa fa-check"></i><b>16</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="16.1" data-path="sec-reproducability.html"><a href="sec-reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>16.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="16.2" data-path="sec-reproducability.html"><a href="sec-reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>16.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="16.3" data-path="sec-reproducability.html"><a href="sec-reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>16.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>17</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="17.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>17.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="17.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>17.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="17.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>17.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>18</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="18.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>18.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#making-a-safe-function-call"><i class="fa fa-check"></i><b>18.1.1</b> Making a safe function call</a></li>
<li class="chapter" data-level="18.1.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>18.1.2</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#about-stopifnot"><i class="fa fa-check"></i><b>18.2</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>19</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="19.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>19.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="19.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>19.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="19.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>19.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="19.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>19.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>20</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="20.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>20.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="20.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>20.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>20.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="20.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>20.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="20.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>20.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="20.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>20.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="20.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>20.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="20.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>20.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>21</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="21.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>21.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="21.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-2"><i class="fa fa-check"></i><b>21.2</b> The data generating process</a></li>
<li class="chapter" data-level="21.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-2"><i class="fa fa-check"></i><b>21.3</b> Running the simulation</a></li>
<li class="chapter" data-level="21.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>21.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>21.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="21.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>21.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="21.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>21.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="21.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>21.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html"><i class="fa fa-check"></i><b>22</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="22.1" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>22.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="22.2" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>22.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="22.3" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>22.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="22.4" data-path="chap-potential-outcomes.html"><a href="chap-potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>22.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>23</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="23.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-extensive-multi-factor-simulations"><i class="fa fa-check"></i><b>23.1</b> Use extensive multi-factor simulations</a></li>
<li class="chapter" data-level="23.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#beat-them-at-their-own-game"><i class="fa fa-check"></i><b>23.2</b> Beat them at their own game</a></li>
<li class="chapter" data-level="23.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrated-simulations"><i class="fa fa-check"></i><b>23.3</b> Calibrated simulations</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="24.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>24.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="on_functions.html"><a href="on_functions.html"><i class="fa fa-check"></i><b>25</b> Appendix: Coding tidbits</a>
<ul>
<li class="chapter" data-level="25.1" data-path="on_functions.html"><a href="on_functions.html#repeating-oneself"><i class="fa fa-check"></i><b>25.1</b> Other ways of repeating yourself</a></li>
<li class="chapter" data-level="25.2" data-path="on_functions.html"><a href="on_functions.html#default-arguments"><i class="fa fa-check"></i><b>25.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="25.3" data-path="on_functions.html"><a href="on_functions.html#testing-and-debugging-code-in-your-scripts"><i class="fa fa-check"></i><b>25.3</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="25.4" data-path="on_functions.html"><a href="on_functions.html#keep-multiple-files-of-code"><i class="fa fa-check"></i><b>25.4</b> Keep multiple files of code</a></li>
<li class="chapter" data-level="25.5" data-path="on_functions.html"><a href="on_functions.html#the-source-command-and-keeping-things-organized"><i class="fa fa-check"></i><b>25.5</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="25.6" data-path="on_functions.html"><a href="on_functions.html#debugging-with-browser"><i class="fa fa-check"></i><b>25.6</b> Debugging with browser</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>26</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming-preliminaries" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Programming Preliminaries<a href="programming-preliminaries.html#programming-preliminaries" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Our goal in this book is not only to introduce the conceptual principles of Monte Carlo simulation, but also to provide a practical guide to actually <em>conducting</em> simulation studies (whether for personal learning purposes or for formal methodological research).
This will require writing computer code—lots of code!
The computational principles and practices that we will describe are very general, not specific to any particular programming language, but for purposes of demonstrating, presenting examples, and practicing the process of developing a simulation, it helps to be specific.
To that end, we will be using R, a popular programming language that is widely used among statisticians, quantitative methodologists, and data scientists.
Our presentation will assume that readers are comfortable with writing R scripts to carry out tasks such as cleaning variables, summarizing data, creating data-based graphics, and running regression models (or more generally, estimating statistical models).</p>
<p>In this chapter, we introduce some essential programming concepts that may be less familiar to readers, but which are central to how we approach programming simulation studies.
We also explain some of the rationale and reasoning behind how we present example code throughout the book.</p>
<div id="why-r" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Why R?<a href="programming-preliminaries.html#why-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have chosen to focus on R (rather than some other programming language) for designing and running simulations.
The main reason for this is that we are both intimately familiar with R and use it extensively in our day-to-day work.
Simply put, it’s much easier to write in your native language than in one in which you’re less fluent.
But beyond our own habits and preferences, there are several more principled reasons for using R.</p>
<p>R is free and open source software, which can be run under many different operating systems (Windows, Mac, Linux, etc.).
This is advantageous not only because of the cost, but also because it means that anyone with a computer—anywhere in the world—can access the software and could, if they wanted, re-run our code for themselves.
This makes R a good choice for practicing transparent and open science processes.</p>
<p>There is a very large, active, and diverse community of people who use, teach, and develop R.
It is used widely for applied data analysis and statistical work in such fields as education, psychology, economics, epidemiology, public health, and political science,
and widely taught in quantitative methods and applied statistics courses.
Integral to the appeal of R is that it includes tens of thousands of contributed packages, which extend the core functionality of the language in myriad ways.
New statistical techniques are often made available in R, or can be accessed through R interfaces.
Increasingly, R can also be used to interface with other languages and platforms, such as running Python code via the <a href="https://rstudio.github.io/reticulate/">reticulate</a> package, running Stan programs for Bayesian modeling via <a href="https://mc-stan.org/users/interfaces/rstan">RStan</a>, or calling the h2o machine learning library using <a href="https://cran.r-project.org/package=h2o">h2o package</a> <span class="citation">(<a href="#ref-fryda2014H2oInterfaceH2O">Fryda et al. 2014</a>)</span>.
The huge variety of statistical tools available in R makes it a fascinating place to learn and practice.</p>
<p>R does have a persistent reputation as being a challenging and difficult language to use.
This reputation might be partly attributable to its early roots, having been developed by highly technical statisticians who did not put great emphasis on accessibility, legibility of code, or ease of use.
However, as the R community has grown, the availability of introductory documentation and learning materials has improved drastically, so that it is now much easier to access pedagogical materials and find help.
R’s reputation also probably partly stems from being a decentralized, open source project with many, many contributors.
Contributed R packages vary hugely in quality and depth of development; there are some amazingly powerful tools available but also much that is half-baked, poorly executed, or flat out wrong.
Because there is no central oversight or quality control, the onus is on the user to critically evaluate the packages that they use.
For newer users especially, we recommend focusing on more established and widely used packages, seeking input and feedback from more knowledgeable users, and taking time to validate functionality against other packages or software when possible.
A final contributor to R’s intimidating reputation might be its extreme flexibility.
As both a statistical analysis package and a fully functional programming language, R can do many things that other software packages cannot, but this also means that there are often many different ways to accomplish the same task.
In light of this situation, it’s good to keep in mind that knowing a single way to do something is usually adequate—there’s no need to learn six different words for hello, when one is enough to start a conversation.</p>
<p>On balance, we think that the many strengths of R make it worthwhile to learn and continue exploring. For simulation, in particular, R’s facility to easily write functions (bundles of commands that you can easily call in different manners), to work with multiple datasets in play at the same time, and to leverage the vast array of other people’s work all make it a very attractive language.</p>
<!-- We highly recommend using RStudio, which makes using R easier.  RStudio is an Integrated Development Environment (IDE) that structures your experience, helps keep things organized, and offers multiple time-saving features to make your programming experience better. You might also consider using R Markdown. R Markdown allows for generating documents with embedded R code and R output in a clean format, which can greatly help report generation. -->
<!-- (In fact, this book is in a variant of R Markdown.) -->
<!-- JEP: Cutting the discussion of RStudio and Rmarkdown because they don't seem essential. Open to putting it back if we have more to say about them. -->
</div>
<div id="welcome-to-the-tidyverse" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Welcome to the tidyverse<a href="programming-preliminaries.html#welcome-to-the-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Layered on top of R are a collection of contributed packages that make data wrangling and management much, much easier.
This collection is called <code>tidyverse</code> and it includes popular packages such as <code>dplyr</code>, <code>tidyr</code>, and <code>ggplot2</code>.
We use methods from the “tidyverse” throughout the book because it facilitates writing clean, concise code.
In particular, we make heavy use of the <code>dplyr</code> package for group-wise data manipulation, the <code>purrr</code> package for functional programming, and the <code>ggplot2</code> package for statistical graphics.
The <a href="https://r4ds.had.co.nz/">1st edition</a> and <a href="https://r4ds.hadley.nz/">2nd edition</a>) of the free online textbook <em>R for Data Science</em> provide an excellent, thorough introduction to these packages and much more background on the tidyverse.
We will cite portions of this text throughout the book.</p>
<p>Loading the tidyverse packages is straightforward:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="programming-preliminaries.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>( tidyverse )</span>
<span id="cb1-2"><a href="programming-preliminaries.html#cb1-2" tabindex="-1"></a><span class="fu">options</span>(<span class="fu">list</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p>(The second line is to turn off some of the persistent warnings generated by the <code>dplyr</code> function <code>summarize()</code>.)
These lines of code appear in the header of nearly every script we use.</p>
</div>
<div id="functions" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Functions<a href="programming-preliminaries.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- ![A function as a machine](image/function-machine.png){ width=50% } -->
<!-- JEP: Removed because I don't have copyright to this image. -->
<p>If you are comfortable using R for data analysis tasks, you are likely familiar with many functions that do things like calculate a summary statistic from a list of numbers (e.g., <code>mean()</code>, <code>median()</code>, or <code>sd()</code>), calculate linear regression coefficient estimates from a dataset (<code>lm()</code>), or count the number of rows in a dataset (<code>nrow()</code>).
In the abstract, a function is a little machine for transforming ingredients into outputs, like a microwave (put a bag of kernels in and it will return hot, crunchy popcorn) a cheese shredder (put a block of mozzarella in and it transforms it into topping for your pizza), or a washing machine (put in dirty clothes and detergent and it will return clean but damp clothes).
A function takes in pieces of information specified by the user (the inputs), follows a set of instructions for transforming or summarizing those inputs, and then returns the result of the calculations (the outputs).
R’s built-in functions implement all sorts of calculations, ranging from simple summary calculations to complex algorithms for fitting predictive models.</p>
<p>A function can do nearly anything as long as the calculation can be expressed in code—it can even produce output that is random.
For example, the <code>rnorm()</code> function takes as input a number <code>n</code> and returns that many random numbers, drawn from a standard normal distribution:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="programming-preliminaries.html#cb2-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1.26366</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="programming-preliminaries.html#cb4-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] -0.6307414  0.3490731  0.5998948 -1.0221221</code></pre>
<p>Each time the function is called, it returns a different set of numbers:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="programming-preliminaries.html#cb6-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] -0.244806678  1.695071510 -0.185273139
## [4]  0.440547927  0.415852593  0.411859919
## [7]  0.004185522</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="programming-preliminaries.html#cb8-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1]  0.4170059 -1.6937608 -0.5558082  0.9689695
## [5]  0.6207686 -1.4514405  1.4205177</code></pre>
<p>The <code>rnorm()</code> function also has further input arguments that let the user specify the mean and standard deviation of the distribution from which numbers are drawn:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="programming-preliminaries.html#cb10-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">7</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1]  8.637472 10.447119  9.670561  9.995382
## [5] 10.331667  9.948175 10.187655</code></pre>
<div id="rolling-your-own" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Rolling your own<a href="programming-preliminaries.html#rolling-your-own" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In R, it is also possible to create your own function by specifying the pieces of input information, the steps to follow in transforming the inputs, and the result to return as output.
Learning to write your own functions to carry out calculations is an immensely useful skill, which will greatly enhance your ability to accomplish a range of tasks in R.
Writing custom functions is also central to our approach to coding Monte Carlo simulations, and so we highlight some of the key considerations here.
<a href="https://r4ds.had.co.nz/functions.html">Chapter 19 of R for Data Science (1st edition)</a> provides an in-depth discussion of how to write your own functions.</p>
<p>Here is an example of a custom function called <code>one_run()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="programming-preliminaries.html#cb12-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( N, mn ) {</span>
<span id="cb12-2"><a href="programming-preliminaries.html#cb12-2" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N, <span class="at">mean =</span> mn )</span>
<span id="cb12-3"><a href="programming-preliminaries.html#cb12-3" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>( vals )</span>
<span id="cb12-4"><a href="programming-preliminaries.html#cb12-4" tabindex="-1"></a>  pvalue <span class="ot">&lt;-</span> tt<span class="sc">$</span>p.value</span>
<span id="cb12-5"><a href="programming-preliminaries.html#cb12-5" tabindex="-1"></a>  <span class="fu">return</span>(pvalue)</span>
<span id="cb12-6"><a href="programming-preliminaries.html#cb12-6" tabindex="-1"></a>}</span></code></pre></div>
<p>The first line specifies that we are creating a function that takes inputs <code>N</code> and <code>mn</code>. These are called <em>parameters</em>, <em>inputs</em>, or <em>arguments</em> of the function. The remaining lines inside the curly brackets are called the <em>body</em> of the function. These lines specify the instructions to follow in transforming the inputs into an output:</p>
<ol style="list-style-type: decimal">
<li>Generate a random sample of <code>N</code> observations from a normal distribution with mean <code>mn</code> and store the result in <code>vals</code>.</li>
<li>Use the built-in function <code>t.test()</code> to compute a one-sample t-test for the null hypothesis that the population mean is zero, then store the result in <code>tt</code>.</li>
<li>Extract the p-value from the t-test store the result in <code>pvalue</code>.</li>
<li>Return <code>pvalue</code> as output.</li>
</ol>
<p>Having created the function, we can then use it with any inputs that we like:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="programming-preliminaries.html#cb13-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">100</span>, <span class="dv">5</span> )</span></code></pre></div>
<pre><code>## [1] 1.997604e-77</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="programming-preliminaries.html#cb15-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">10</span>, <span class="fl">0.3</span> )</span></code></pre></div>
<pre><code>## [1] 0.8812631</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="programming-preliminaries.html#cb17-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="dv">10</span>, <span class="fl">0.3</span> )</span></code></pre></div>
<pre><code>## [1] 0.1586544</code></pre>
<p>In each case, the output of the function is a p-value from a simulated sample of data. The function produces a different answer each time because its instructions involve generating random numbers each time it is called.
In essence, our custom function is just a short-cut for carrying out its instructions.
Writing it saves us from having to repeatedly write or copy-paste the lines of code inside the body.</p>
<!-- JEP: Should we cut the remainder of this subsection, since we'll be covering something very similar in the next chapter? It seems like it kind of disrupts the focus on writing custom functions.  -->
<p>R’s <code>replicate()</code> function is a handy way to repeatedly call a line of code. Its first input argument is <code>n</code>, the number of times to repeat the calculation, followed by <code>expr</code>, which is one or more lines of code to be called.
We can use <code>replicate</code> to call <code>one_run()</code> 1000 times in a row, each time generating a new sample of 100 observations from a normal distribution with mean 0.2:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="programming-preliminaries.html#cb19-1" tabindex="-1"></a>pvs <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb19-2"><a href="programming-preliminaries.html#cb19-2" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb19-3"><a href="programming-preliminaries.html#cb19-3" tabindex="-1"></a>  <span class="at">expr =</span> <span class="fu">one_run</span>( <span class="dv">100</span>, <span class="fl">0.2</span> )</span>
<span id="cb19-4"><a href="programming-preliminaries.html#cb19-4" tabindex="-1"></a>)</span>
<span id="cb19-5"><a href="programming-preliminaries.html#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="programming-preliminaries.html#cb19-6" tabindex="-1"></a><span class="co"># create a plot of simulated pvalues</span></span>
<span id="cb19-7"><a href="programming-preliminaries.html#cb19-7" tabindex="-1"></a><span class="fu">qplot</span>( pvs, <span class="at">binwidth =</span> <span class="fl">0.02</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/pvalue_plot-1.png" width="75%" style="display: block; margin: auto;" />
We see that if our sample size is 100 and the true mean is 0.2, we will often get low <span class="math inline">\(p\)</span>-values—although not always. Using this simulated distribution of p-values, we can calculate the power of the one-sample t-test as so:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="programming-preliminaries.html#cb20-1" tabindex="-1"></a><span class="fu">sum</span>( pvs <span class="sc">&lt;=</span> <span class="fl">0.05</span> ) <span class="sc">/</span> <span class="dv">1000</span></span></code></pre></div>
<pre><code>## [1] 0.537</code></pre>
<p>This code is effectively a very short simulation. Using our custom-written function, we have discovered that we have about a 54% chance of rejecting the null, if the true population mean is 0.2 and the sample size is 100.
This short example illustrates the all the main steps in a simulation study: generating a random sample of data, applying an analytic procedure, repeating many times, and summarizing the results.
In subsequent chapters, we will see this same pattern many times and will elaborate on it to execute simulations of more complex processes.</p>
</div>
<div id="a-dangerous-function" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> A dangerous function<a href="programming-preliminaries.html#a-dangerous-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Writing custom functions will prove to be crucial for effectively implementing Monte Carlo simulations.
However, designing custom functions does take practice to master.
It also requires a degree of care above and beyond what is needed just to use R’s built-in functions.</p>
<p>One of the common mistakes encountered in writing custom functions is to let the function depend on information that is not part of the input arguments.
For example, consider the following script, which includes a nonsensical custom function called <code>funky()</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="programming-preliminaries.html#cb22-1" tabindex="-1"></a>secret_ingredient <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb22-2"><a href="programming-preliminaries.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="programming-preliminaries.html#cb22-3" tabindex="-1"></a>funky <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3) {</span>
<span id="cb22-4"><a href="programming-preliminaries.html#cb22-4" tabindex="-1"></a>  </span>
<span id="cb22-5"><a href="programming-preliminaries.html#cb22-5" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb22-6"><a href="programming-preliminaries.html#cb22-6" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb22-7"><a href="programming-preliminaries.html#cb22-7" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret_ingredient</span>
<span id="cb22-8"><a href="programming-preliminaries.html#cb22-8" tabindex="-1"></a>  </span>
<span id="cb22-9"><a href="programming-preliminaries.html#cb22-9" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb22-10"><a href="programming-preliminaries.html#cb22-10" tabindex="-1"></a>}</span>
<span id="cb22-11"><a href="programming-preliminaries.html#cb22-11" tabindex="-1"></a></span>
<span id="cb22-12"><a href="programming-preliminaries.html#cb22-12" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<p><code>funky</code> takes inputs <code>input1</code>, <code>input2</code>, and <code>input3</code>, but its instructions also depend on the quantity <code>secret_ingredient</code>.
What happens if we change the value of <code>secret_ingredient</code>?</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="programming-preliminaries.html#cb24-1" tabindex="-1"></a>secret_ingredient <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb24-2"><a href="programming-preliminaries.html#cb24-2" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 102.5</code></pre>
<p>Even though we give it the same arguments as previous, the output of the function is different.
This sort of behavior is quite confusing. Unless the function involves generating random numbers, We would generally expect it to return the exact same output if we give it the same inputs.
Even worse, we get a rather cryptic error if the value of <code>secret_ingredient</code> is not compatible with what the function expects:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="programming-preliminaries.html#cb26-1" tabindex="-1"></a>secret_ingredient <span class="ot">&lt;-</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb26-2"><a href="programming-preliminaries.html#cb26-2" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Error in input3 * ratio + secret_ingredient: non-numeric argument to binary operator</code></pre>
<p>If we are not careful, we will end up with very confusing code that can produce unintended results.</p>
<p>To avoid this issue, it is important for functions to only use information that is explicitly provided to it through its arguments.
This is the principle of <em>isolating the inputs</em>.
If the result of a function is supposed to depend on a quantity, then we should include that quantity among the input arguments.
We can fix our example function by including <code>secret_ingredient</code> as an argument:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="programming-preliminaries.html#cb28-1" tabindex="-1"></a>secret_ingredient <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb28-2"><a href="programming-preliminaries.html#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="programming-preliminaries.html#cb28-3" tabindex="-1"></a>funkier <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3, secret_ingredient) {</span>
<span id="cb28-4"><a href="programming-preliminaries.html#cb28-4" tabindex="-1"></a>  </span>
<span id="cb28-5"><a href="programming-preliminaries.html#cb28-5" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb28-6"><a href="programming-preliminaries.html#cb28-6" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb28-7"><a href="programming-preliminaries.html#cb28-7" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret_ingredient</span>
<span id="cb28-8"><a href="programming-preliminaries.html#cb28-8" tabindex="-1"></a>  </span>
<span id="cb28-9"><a href="programming-preliminaries.html#cb28-9" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb28-10"><a href="programming-preliminaries.html#cb28-10" tabindex="-1"></a>}</span>
<span id="cb28-11"><a href="programming-preliminaries.html#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="programming-preliminaries.html#cb28-12" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<p>Now the output of the function is always the same, regardless of the value of other objects in R:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="programming-preliminaries.html#cb30-1" tabindex="-1"></a>secret_ingredient <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb30-2"><a href="programming-preliminaries.html#cb30-2" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="programming-preliminaries.html#cb32-1" tabindex="-1"></a><span class="fu">funkier</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 102.5</code></pre>
<p>When writing your own functions, it may not be obvious that your function depends on external quantities and does not isolate the inputs.
In our experience, one of the best ways to detect this issue is to clear the R environment and start from a fresh palette, run the code to create the function, and call the function (perhaps more than once) to ensure that it works as expected.
Here is an illustration of what happens when we follow this process with our problematic custom function:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="programming-preliminaries.html#cb34-1" tabindex="-1"></a><span class="co"># clear environment</span></span>
<span id="cb34-2"><a href="programming-preliminaries.html#cb34-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb34-3"><a href="programming-preliminaries.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="programming-preliminaries.html#cb34-4" tabindex="-1"></a><span class="co"># create function</span></span>
<span id="cb34-5"><a href="programming-preliminaries.html#cb34-5" tabindex="-1"></a>funky <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3) {</span>
<span id="cb34-6"><a href="programming-preliminaries.html#cb34-6" tabindex="-1"></a>  </span>
<span id="cb34-7"><a href="programming-preliminaries.html#cb34-7" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb34-8"><a href="programming-preliminaries.html#cb34-8" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb34-9"><a href="programming-preliminaries.html#cb34-9" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret_ingredient</span>
<span id="cb34-10"><a href="programming-preliminaries.html#cb34-10" tabindex="-1"></a>  </span>
<span id="cb34-11"><a href="programming-preliminaries.html#cb34-11" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb34-12"><a href="programming-preliminaries.html#cb34-12" tabindex="-1"></a>}</span>
<span id="cb34-13"><a href="programming-preliminaries.html#cb34-13" tabindex="-1"></a></span>
<span id="cb34-14"><a href="programming-preliminaries.html#cb34-14" tabindex="-1"></a><span class="co"># test the function</span></span>
<span id="cb34-15"><a href="programming-preliminaries.html#cb34-15" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Error in funky(3, 2, 5): object &#39;secret_ingredient&#39; not found</code></pre>
<p>We get an error because the external quantity is not available.
Here is the same process using our corrected function:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="programming-preliminaries.html#cb36-1" tabindex="-1"></a><span class="co"># clear environment</span></span>
<span id="cb36-2"><a href="programming-preliminaries.html#cb36-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span>
<span id="cb36-3"><a href="programming-preliminaries.html#cb36-3" tabindex="-1"></a></span>
<span id="cb36-4"><a href="programming-preliminaries.html#cb36-4" tabindex="-1"></a><span class="co"># create function</span></span>
<span id="cb36-5"><a href="programming-preliminaries.html#cb36-5" tabindex="-1"></a>funkier <span class="ot">&lt;-</span> <span class="cf">function</span>(input1, input2, input3, secret_ingredient) {</span>
<span id="cb36-6"><a href="programming-preliminaries.html#cb36-6" tabindex="-1"></a>  </span>
<span id="cb36-7"><a href="programming-preliminaries.html#cb36-7" tabindex="-1"></a>  <span class="co"># do funky stuff</span></span>
<span id="cb36-8"><a href="programming-preliminaries.html#cb36-8" tabindex="-1"></a>  ratio <span class="ot">&lt;-</span> input1 <span class="sc">/</span> (input2 <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb36-9"><a href="programming-preliminaries.html#cb36-9" tabindex="-1"></a>  funky_output <span class="ot">&lt;-</span> input3 <span class="sc">*</span> ratio <span class="sc">+</span> secret_ingredient</span>
<span id="cb36-10"><a href="programming-preliminaries.html#cb36-10" tabindex="-1"></a>  </span>
<span id="cb36-11"><a href="programming-preliminaries.html#cb36-11" tabindex="-1"></a>  <span class="fu">return</span>(funky_output)  </span>
<span id="cb36-12"><a href="programming-preliminaries.html#cb36-12" tabindex="-1"></a>}</span>
<span id="cb36-13"><a href="programming-preliminaries.html#cb36-13" tabindex="-1"></a></span>
<span id="cb36-14"><a href="programming-preliminaries.html#cb36-14" tabindex="-1"></a></span>
<span id="cb36-15"><a href="programming-preliminaries.html#cb36-15" tabindex="-1"></a><span class="co"># test the function</span></span>
<span id="cb36-16"><a href="programming-preliminaries.html#cb36-16" tabindex="-1"></a><span class="fu">funky</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="at">secret_ingredient =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error in funky(3, 2, 5, secret_ingredient = 3): could not find function &quot;funky&quot;</code></pre>
<p>Later chapters will have much more to say about—and many further illustrations of—the process of writing custom functions.</p>
<!-- ### Using named arguments -->
<!-- JEP: Consider adding some discussion of how R determines which input values go with which arguments.  -->
<!-- ### Argument defaults -->
<!-- JEP: Consider adding some discussion of default arguments.  -->
</div>
<div id="function-skeletons" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Function skeletons<a href="programming-preliminaries.html#function-skeletons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In discussing how to write functions for simulations, we will often present <em>function skeletons</em>. By a skeleton, we mean code that creates a function with a specific set of input arguments, but where the body is left partially or fully unspecified.
Here is a cursory example of a function skeleton:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="programming-preliminaries.html#cb38-1" tabindex="-1"></a>run_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>( N, J, mu, sigma, tau ) {</span>
<span id="cb38-2"><a href="programming-preliminaries.html#cb38-2" tabindex="-1"></a>  <span class="co"># simulate data</span></span>
<span id="cb38-3"><a href="programming-preliminaries.html#cb38-3" tabindex="-1"></a>  <span class="co"># apply estimation procedure</span></span>
<span id="cb38-4"><a href="programming-preliminaries.html#cb38-4" tabindex="-1"></a>  <span class="co"># repeat</span></span>
<span id="cb38-5"><a href="programming-preliminaries.html#cb38-5" tabindex="-1"></a>  <span class="co"># summarize results</span></span>
<span id="cb38-6"><a href="programming-preliminaries.html#cb38-6" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb38-7"><a href="programming-preliminaries.html#cb38-7" tabindex="-1"></a>}</span></code></pre></div>
<p>In subsequent chapters, we will use function skeletons to outline the organization of code for simulation studies.
The skeleton headers make clear what the inputs to the function need to be.
Sometimes, we will leave comments in the body of the skeleton to sketch out the general flow of calculations that need to happen.
Depending on the details of the simulation, the specifics of these steps might be quite different, but the general structure will often be quite consistent.
Finally, the last line of the skeleton indicates the value that should be returned as output of the function.
Thus, skeletons are kind of like <a href="https://www.madlibs.com/">Mad Libs</a>, but with R code instead of parts of speech.</p>
</div>
</div>
<div id="pipe-dreams" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> <code>%&gt;%</code> (Pipe) dreams<a href="programming-preliminaries.html#pipe-dreams" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many of the functions from <code>tidyverse</code> packages are designed to make it easy to use them in sequence via the <code>%&gt;%</code> symbol, or <em>pipe</em>, provided by the <code>magrittr</code> package.
The pipe allows us to <em>compose</em> several functions, meaning to write a chain of several functions as a sequence, where the result of each function becomes the first input to the next function.
In code written with the pipe, the order of function calls follows like a story book or cake recipe, making it easier to see what is happening at each step in the sequence.</p>
<p>Consider the hypothetical functions <code>f()</code>, <code>g()</code>, and <code>h()</code>, and suppose we want to do a calculation that involves composing all three functions.
One way to write this calculation is</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="programming-preliminaries.html#cb39-1" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">f</span>(my_data, <span class="at">a =</span> <span class="dv">4</span>)</span>
<span id="cb39-2"><a href="programming-preliminaries.html#cb39-2" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">g</span>(res1, <span class="at">b =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-3"><a href="programming-preliminaries.html#cb39-3" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">h</span>(res2, <span class="at">c =</span> <span class="st">&quot;hot sauce&quot;</span>)</span></code></pre></div>
<p>We have to store the result of each intermediate step in an object, and it takes a careful read of the code to see that we are using <code>res1</code> as input to <code>g()</code> and <code>res2</code> as input to <code>h()</code>.</p>
<p>Alternately, we could try to write all the calculations as one line:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="programming-preliminaries.html#cb40-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">h</span>( <span class="fu">g</span>( <span class="fu">f</span>( my_data, <span class="at">a =</span> <span class="dv">4</span> ), <span class="at">b =</span> <span class="cn">FALSE</span> ), <span class="at">c =</span> <span class="st">&quot;hot sauce&quot;</span> )</span></code></pre></div>
<p>This is a mess. It takes very careful parsing to see that the <code>b</code> argument is called as part of <code>g()</code> and the <code>c</code> argument is part of h()`, and the order in which the functions appear is not the same as the order in which they are calculated.</p>
<p>With the pipe we can write the same calculation as</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="programming-preliminaries.html#cb41-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a href="programming-preliminaries.html#cb41-2" tabindex="-1"></a>  my_data <span class="sc">%&gt;%</span>        <span class="co"># initial dataset</span></span>
<span id="cb41-3"><a href="programming-preliminaries.html#cb41-3" tabindex="-1"></a>  <span class="fu">f</span>(<span class="at">a =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span>       <span class="co"># do f() to it</span></span>
<span id="cb41-4"><a href="programming-preliminaries.html#cb41-4" tabindex="-1"></a>  <span class="fu">g</span>(<span class="at">b =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>   <span class="co"># then do g()</span></span>
<span id="cb41-5"><a href="programming-preliminaries.html#cb41-5" tabindex="-1"></a>  <span class="fu">h</span>(<span class="at">c =</span> <span class="st">&quot;hot sauce&quot;</span>) <span class="co"># then do h()</span></span></code></pre></div>
<p>This addresses the all the issues with our previous attempts:
the order in which the functions appear is the same as the order in which they are executed;
the additional arguments are clearly associated with the relevant functions;
and there is only a single object holding the results of the calculations.
Pipes are a very nice technique for writing clear code that is easy for others to follow.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</div>
<div id="recipes-versus-patterns" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Recipes versus Patterns<a href="programming-preliminaries.html#recipes-versus-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As we will elaborate in subsequent chapters, we follow a modular approach to writing simulations, in which each component of the simulation is represented by its own custom function or its own object in R.
This modular approach leads to code that always has the same broad structure and where the process of implementing the simulation follows a set sequence of steps.
We start by coding a data-generating process, then write one or more data-analysis methods, then determine how to evaluate the performance of the methods, and finally implement an experimental design to examine the performance of the methods across multiple scenarios.
Over the next several chapters, we will walk through this process several times.</p>
<p>Although we always follow the same broad process, the case studies that we will present are not intended as a cookbook that must be rigidly followed.
In our experience, the specific features of a data-generating model, estimator, or research question sometimes require tweaking the template or switching up how we implement some aspect of the simulation.
And sometimes, it might just be a question of style or preference.
Because of this, we have purposely constructed the examples presented throughout the book to use different variations of our central theme rather than always following the same style and structure.
We hope that presenting these variants and adaptations will both expand your sense of what is possible and also help you to recognize the core design principles—in other words, to distinguish the forest from the trees.
Of course, we would welcome and eoncourage you to take any of the code verbatim, tweak and adapt it for your own purposes, and use it however you see fit.
After all, we know that adapting a good example is usually much easier than starting from a blank screen.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fryda2014H2oInterfaceH2O" class="csl-entry">
Fryda, Tomas, Erin LeDell, Navdeep Gill, Spencer Aiello, Anqi Fu, Arno Candel, Cliff Click, et al. 2014. <span>“H2o: <span>R Interface</span> for the ’<span>H2O</span>’ <span>Scalable Machine Learning Platform</span>.”</span> Comprehensive R Archive Network. <a href="https://doi.org/10.32614/CRAN.package.h2o">https://doi.org/10.32614/CRAN.package.h2o</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><a href="https://r4ds.had.co.nz/pipes.html">Chapter 18 of R for Data Science (1st edition)</a> provides more discussion and examples of how to use <code>%&gt;%</code>.<a href="programming-preliminaries.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="an-initial-simulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/003-programming-preliminaries.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
