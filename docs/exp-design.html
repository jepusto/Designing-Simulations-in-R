<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Designing the multifactor simulation experiment | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Designing the multifactor simulation experiment | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Designing the multifactor simulation experiment | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-07-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case_Cronbach.html"/>
<link rel="next" href="presentation-of-results.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#different-kinds-of-performance"><i class="fa fa-check"></i><b>9.1</b> Different kinds of performance</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.2</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.2.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.2.2</b> Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.3.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.4</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.5</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.5.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.6</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.6.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.6.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.6.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-monte-carlo-standard-error"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercises (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-7"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="11" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>11</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.1.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="11.1.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>11.1.2</b> Redundant factor combinations</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>11.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="11.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics-when-running-multiple-simulations"><i class="fa fa-check"></i><b>11.3</b> When to calculate performance metrics when running multiple simulations</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>11.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="11.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>11.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="11.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>11.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>11.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>11.4.1</b> Calculating performance metrics</a></li>
<li class="chapter" data-level="11.4.2" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.4.2</b> Making analyze_data() quiet</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="exp-design.html"><a href="exp-design.html#exercises-8"><i class="fa fa-check"></i><b>11.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>11.5.1</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>12</b> Presenting multifactor simulation results</a>
<ul>
<li class="chapter" data-level="12.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>12.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>12.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>12.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>12.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="12.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>12.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="12.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>12.2.3</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="12.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>12.2.4</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>12.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>12.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="12.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>12.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html"><i class="fa fa-check"></i><b>13</b> Building good vizualizations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>13.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="13.2" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#bundling"><i class="fa fa-check"></i><b>13.2</b> Bundling</a></li>
<li class="chapter" data-level="13.3" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#aggregation"><i class="fa fa-check"></i><b>13.3</b> Aggregation</a></li>
<li class="chapter" data-level="13.4" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#assessing-true-ses"><i class="fa fa-check"></i><b>13.4</b> Assessing true SEs</a></li>
<li class="chapter" data-level="13.5" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>13.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="13.6" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#assessing-estimated-ses"><i class="fa fa-check"></i><b>13.6</b> Assessing estimated SEs</a></li>
<li class="chapter" data-level="13.7" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#assessing-confidence-intervals-1"><i class="fa fa-check"></i><b>13.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="13.8" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#exercises-9"><i class="fa fa-check"></i><b>13.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.8.1" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#assessing-uncertainty"><i class="fa fa-check"></i><b>13.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="13.8.2" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#assessing-power"><i class="fa fa-check"></i><b>13.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="13.8.3" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>13.8.3</b> Going deeper with coverage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>14.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>14.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="14.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>14.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>14.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="14.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>14.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>14.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>14.4</b> Analyzing results when some trials have failed</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>15</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="15.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>15.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>16</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="16.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>16.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="16.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>16.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="16.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>16.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>17</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="17.0.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>17.0.1</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>18</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="18.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>18.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="18.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>18.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="18.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>18.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="18.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>18.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>19</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>19.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="19.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>19.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>19.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="19.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>19.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="19.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>19.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="19.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>19.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="19.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>19.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="19.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>19.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>20</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="20.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>20.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>20.1.1</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="20.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>20.1.2</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="20.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>20.1.3</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="20.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>20.1.4</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="20.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>20.1.5</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="21" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>21</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="21.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>21.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="21.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>21.2</b> The data generating process</a></li>
<li class="chapter" data-level="21.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>21.3</b> Running the simulation</a></li>
<li class="chapter" data-level="21.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>21.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>21.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="21.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>21.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="21.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>21.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="21.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>21.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>22</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="22.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>22.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="22.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>22.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="22.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>22.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="22.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>22.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>23</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="23.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>23.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-source-command"><i class="fa fa-check"></i><b>A.3</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>A.4</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="A.5" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-browser-debugging"><i class="fa fa-check"></i><b>A.5</b> Debugging with browser</a></li>
<li class="chapter" data-level="A.6" data-path="coding-tidbits.html"><a href="coding-tidbits.html#about-stopifnot"><i class="fa fa-check"></i><b>A.6</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exp-design" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Designing the multifactor simulation experiment<a href="exp-design.html#exp-design" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>So far, we have created code that will run a simulation for a single combination of parameter values.
In practice, simulation studies typically examine a range of different values, including varying the levels of the true parameter values and perhaps also varying sample sizes, to explore a range of different scenarios.
We either want reassurance that our findings are general, or we want to understand what aspects of the context lead to our found results.
A single simulation gives us no hint as to either of these questions.
It is only by looking across a range of settings that we can fully understand trade-offs, general rules, and limits.
Let’s now look at the remaining piece of the simulation puzzle: the study’s experimental design.</p>
<p>Simulation studies often take the form of <strong>full factorial</strong> designed experiments. In full factorials, each factor (a particular knob a researcher might turn to change the simulation conditions) is varied across multiple levels, and the design includes <em>every</em> possible combination of the levels of every factor. One way to represent such a design is as a list of the factors and levels being explored.</p>
<p>For example, for the Cronbach alpha simulation discussed in the prior chapter, we might want to vary:</p>
<ul>
<li>the sample size, with values of 50 or 100</li>
<li>the number of items, with values of 4 or 8</li>
<li>the true value of alpha, with values ranging from 0.1 to 0.9</li>
<li>the degrees of freedom of the multivariate <span class="math inline">\(t\)</span> distribution, with values of 5, 10, 20, or 100</li>
</ul>
<p>The above parameters describe a <span class="math inline">\(2 \times 2 \times 9 \times 4\)</span> factorial design, where each element is the number of options for that factor. This is a four factor experiment, because we have four different things we are varying.</p>
<p>To implement in code, we first save the simulation parameters as a list of factors, each factor having a list of values to explore.
We then run a simulation for every possible combination of these values.
Here is code that generates all the scenarios we will run given the above design, storing these combinations in a data frame, <code>params</code>, that represents the full experimental design:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="exp-design.html#cb365-1" tabindex="-1"></a>design_factors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb365-2"><a href="exp-design.html#cb365-2" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb365-3"><a href="exp-design.html#cb365-3" tabindex="-1"></a>  <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>),</span>
<span id="cb365-4"><a href="exp-design.html#cb365-4" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>),</span>
<span id="cb365-5"><a href="exp-design.html#cb365-5" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">100</span>)</span>
<span id="cb365-6"><a href="exp-design.html#cb365-6" tabindex="-1"></a>)</span>
<span id="cb365-7"><a href="exp-design.html#cb365-7" tabindex="-1"></a></span>
<span id="cb365-8"><a href="exp-design.html#cb365-8" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">cross_df</span>(design_factors)</span>
<span id="cb365-9"><a href="exp-design.html#cb365-9" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>## # A tibble: 144 × 4
##        n     p alpha    df
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    50     4   0.1     5
##  2   100     4   0.1     5
##  3    50     8   0.1     5
##  4   100     8   0.1     5
##  5    50     4   0.2     5
##  6   100     4   0.2     5
##  7    50     8   0.2     5
##  8   100     8   0.2     5
##  9    50     4   0.3     5
## 10   100     4   0.3     5
## # ℹ 134 more rows</code></pre>
<p>See what we get?</p>
<p>Last chapter, we wrote a <code>run.experiment()</code> method to run a simulation for a given scenario.
The parameters we would pass to <code>run.experiment()</code> correspond to the columns of <code>params</code>.
We have a total of <span class="math inline">\(2 \times 2 \times 9 \times 4 = 144\)</span> rows, each row corresponding to a simulation scenario to explore.
With multifactor experiments, it is easy to end up running a lot of experiments!</p>
<div id="choosing-parameter-combinations" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Choosing parameter combinations<a href="exp-design.html#choosing-parameter-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How do we go about choosing parameter values to examine?
Choosing which parameters to use is a central part of good simulation design because the primary limitation of simulation studies is always their <em>generalizability</em>.
On the one hand, it’s difficult to extrapolate findings from a simulation study beyond the set of simulation conditions that were examined. On the other hand, it is often difficult or impossible to examine the full space of all possible parameter values, except for very simple problems.
Even in the relatively straightforward Cronbach alpha simulation, we have four factors, and the last three could, in principle, each take an infinite number of different levels.
How can we come up with a defensible set of levels to examine?</p>
<p>The choice of simulation conditions needs to be made in the context of the problem or model that you are studying, so it is a bit difficult to offer valid, decontextualized advice.
We provide a few observations all the same:</p>
<ol style="list-style-type: decimal">
<li><p>For research simulations, it often is important to be able to relate your findings to previous research. This suggests that you should select parameter levels to make this possible, such as by looking at sample sizes similar to those examined in previous studies. That said, previous simulation studies are not always perfect (actually, there are a lot of really crummy ones out there!), and so prior work should not generally be your sole guide or justification.</p></li>
<li><p>Generally, it is better to err on the side of being more comprehensive. You learn more by looking at a broader range of conditions, and you can always boil down your results to a more limited set of conditions for purposes of presentation.</p></li>
<li><p>It is also important to explore breakdown points (e.g., what sample size is too small for a method to work?) rather than focusing only on conditions where a method might be expected to work well. Pushing the boundaries and identifying conditions where estimation methods break will help you to provide better guidance for how the methods should be used in practice.</p></li>
</ol>
<p>An important point regarding (2) is that you can be more comprehensive and then have fewer replications per scenario.
For example, say you were planning on doing 1000 simulations per scenario, but then you realize there is some new factor that you do not think matters, but that you believe other researchers will worry about.
You could add in that factor, say with four levels, and then do 250 simulations per scenario.
The total work remains the same.</p>
<p>When analyzing the final simulation you would first verify you do not see trends along this new factor, and then marginalize out that factor in your summaries of results.
Marginalizing out a factor (i.e., averaging your performance metrics across the additional factor) is a powerful technique of making a claim about how your methods work <em>on average</em> across a <em>range</em> of scenarios, rather than for a specific scenario; this comes up in the next chapter on presenting results.</p>
<p>Overall, you generally want to vary parameters that you believe matter, or that you think other people will believe matter.
The first is so you can learn.
The second is to build your case.</p>
<p>Once you have identified your parameters, you then have to decide on the levels of the parameter you will include in the simulation.
There are three strategies you might take:</p>
<ol style="list-style-type: decimal">
<li>Vary a parameter over as much of its range as you can.</li>
<li>Choose parameter levels to represent a realistic practical range. These ranges would ideally be empirically justified based on systematic reviews of prior applications. They may also simply come from ones informal impressions of what is realistic in practice.</li>
<li>Choose parameters to emulate an important known application or context.</li>
</ol>
<p>Of these choices, (1) is the most general—but is also the most computationally intensive.
Option (2) focuses attention, ideally, on what is of practical relevance to a practitioner.
Option (3) is usually coupled with a subsequent applied data analysis, and in this case the simulation is often used to enrich that analysis.
In particular, if the simulation shows the methods work for data with the given form of the target application, people may be more willing to believe the application’s findings.</p>
<p>Regardless of how you select your primary parameters, you should also vary nuisance parameters (at least a little) to test the sensitivity of your results to these other aspects.
While simulations will (generally) never be fully generalizable, you can certainly make them so they avoid the obvious things a critic might identify as an easy dismissal of your findings.</p>
<p>To recap, as you think about your parameter selection, always keep the following design principles and acknowledgements:</p>
<ul>
<li>The primary limitation of simulation studies is <strong>generalizability</strong>.</li>
<li>Choose conditions that allow you to relate your findings to previous work.</li>
<li>Err towards being comprehensive. Your goal should be to build an understanding of the major moving parts, and you can always tailor your final presentation of results to give the simplified story, once you find it.</li>
<li>Explore breakdown points (e.g., what sample size is too small for applying a given method?).</li>
</ul>
<p>Finally, you should fully expect to add and subtract from your set of simulation factors as you get your initial simulation results! No one ever runs just a single simulation.</p>
<div id="choosing-parameters-for-the-clustered-rct" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Choosing parameters for the Clustered RCT<a href="exp-design.html#choosing-parameters-for-the-clustered-rct" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extending our case study presented in Section <a href="data-generating-processes.html#case-cluster">6.6</a> to a multifactor simulation, we next design our full experiment.</p>
<p>So far, we have only investigated a single scenario at a time, although our modular approach does make exploring a range of scenarios by re-calling our simulation function relatively straightforward.
But how do our findings generalize? When are the different methods differently appropriate?
To answer this, we need to extend to a multifactor simulation to <em>systematically</em> explore how our three estimators behave across a range of contexts.
We begin by identifying some research questions we might have, given our preliminary results.</p>
<p>Regarding bias, in our initial simulation, we noticed that Linear Regression is estimating a person-weighted quantity, and so would be considered biased for the cluster-average ATE.
We might next ask, how large is bias in practice, and much does bias change as we change the cluster-size by impact relationship?</p>
<p>For precision, we saw that Linear Regression has a higher standard error.
But is this a general finding? If not, are there contexts where linear regression will have a lower standard error than the others?</p>
<p>Again for precision, we originally thought that aggregation would lose information because the little clusters would have the same weight as big clusters, but be more imprecisely estimated.
Were we wrong? Or perhaps if cluster size was even more variable, aggregation might do worse and worse.</p>
<p>Finally, the estimated SEs for all three methods all appeared to be good, although they were rather variable, relative to the true SE.
We might then ask, are the standard errors always the right size, on average? Will the estimated SEs fall apart (e.g., be way too large or way too small, in general) for some contexts? If so, which ones?</p>
<p>To answer all of these questions we need to more systematically explore the space of models.
But we have a lot of knobs to turn.
In particular, with our DGP we can generate fake cluster randomized data where we vary any of the following features:</p>
<ul>
<li>How much the average impact varies across clusters, and how strongly that is connected to cluster size</li>
<li>How much the cluster intercepts vary (degree of cross cluster variation)</li>
<li>How much residual variation there is</li>
<li>What is the average cluster size and the variation in cluster sizes</li>
<li>How many clusters do we have</li>
<li>What proportion of clusters are treated</li>
</ul>
<p>We cannot easily vary all of these factors without having too many simulations to easily peform.
We instead reflect on our research questions, speculate as to what is likely to matter, and then consider varying the following:</p>
<ul>
<li>Average cluster size: Does the number of students/cluster matter?</li>
<li>Number of clusters: Do cluster-robust SEs work with fewer clusters?</li>
<li>Variation in cluster size: Do varying cluster sizes cause bias or break things?</li>
<li>Correlation of cluster size and cluster impact: Will correlation cause bias?</li>
<li>Cross cluster variation: Does the amount of cluster variation matter?</li>
</ul>
<p>When designing the final factors, it is important to ensure each factor is isolated, in that changing one of them should not change a host of other things that might impact performance.
For example, in our case, if we simply added more cross cluster variation by directly increasing the random effects for the clusters, our total variation will also increase.
If we then see that a method deteriorates as variation increases, we then have a confound: is it the cross cluster variation is causing the problem, or is it the total variation?
We therefore want to vary cluster variation while controlling total variation; this is why we use the ICC knob discussed in Section <a href="data-generating-processes.html#case-cluster">6.6</a>.the section on the data generation process.</p>
<p>Given our research interests and the way we parameterize our DGP, we end up with the following:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="exp-design.html#cb367-1" tabindex="-1"></a>crt_design_factors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb367-2"><a href="exp-design.html#cb367-2" tabindex="-1"></a>  <span class="at">n_bar =</span> <span class="fu">c</span>( <span class="dv">20</span>, <span class="dv">80</span>, <span class="dv">320</span> ),</span>
<span id="cb367-3"><a href="exp-design.html#cb367-3" tabindex="-1"></a>  <span class="at">J =</span> <span class="fu">c</span>( <span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">80</span> ),</span>
<span id="cb367-4"><a href="exp-design.html#cb367-4" tabindex="-1"></a>  <span class="at">ATE =</span> <span class="fu">c</span>( <span class="fl">0.2</span> ),</span>
<span id="cb367-5"><a href="exp-design.html#cb367-5" tabindex="-1"></a>  <span class="at">size_coef =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb367-6"><a href="exp-design.html#cb367-6" tabindex="-1"></a>  <span class="at">ICC =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span> ),</span>
<span id="cb367-7"><a href="exp-design.html#cb367-7" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">c</span>( <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span> )</span>
<span id="cb367-8"><a href="exp-design.html#cb367-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Note our ATE factor only has one level: we could later expand this if we wanted to, but based on theoretical concerns we are fairly confident the ATE will not impact our research questions, so we leave it as it is, picked to capture what is a plausible “realistic” ATE.</p>
</div>
<div id="redundant-factor-combinations" class="section level3 hasAnchor" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Redundant factor combinations<a href="exp-design.html#redundant-factor-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Also note that we have some redundancy.
In particular, if <code>size_coef</code> is nonzero, but <code>alpha</code> is 0, then the cluster size will not impact the cluster average ATE as there is no variation in cluster size.
We could drop those factors, which would make our simulation no longer fully crossed.
This would save us simulation runs—in essence we are running the same simulation for <code>alpha=0</code> two times, once for each <code>size_coef</code> value, for each level of <code>ICC</code>, <code>n_bar</code> and <code>J</code>.
We will leave this in as a sanity check to our results, however: we know we should get the same results and if we do not, then we either have uncontrolled uncertainty in our simulation or an error in our coding.</p>
<p>Also, if computation is cheap, then keeping the multifactor structure will make analysis later on much easier.
Otherwise our experiment is not balanced, and so when we average performance across some factors to see the effect of others, we can end up with surprising and misleading results.</p>
</div>
</div>
<div id="using-pmap-to-run-multifactor-simulations" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Using pmap to run multifactor simulations<a href="exp-design.html#using-pmap-to-run-multifactor-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To run simulations across all of our factor combinations, we are going to use a very useful method in the <code>purrr</code> package called <code>pmap()</code>.
<code>pmap()</code> marches down a set of lists, running a function on each <span class="math inline">\(p\)</span>-tuple of elements, taking the <span class="math inline">\(i^{th}\)</span> element from each list for iteration <span class="math inline">\(i\)</span>, and passing them as parameters to the specified function.
<code>pmap()</code> then returns the results of this sequence of function calls as a list of results.</p>
<p>Here is a small illustration of <code>pmap()</code> in action:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="exp-design.html#cb368-1" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>( a, b, theta, scale ) {</span>
<span id="cb368-2"><a href="exp-design.html#cb368-2" tabindex="-1"></a>    scale <span class="sc">*</span> (a <span class="sc">+</span> theta<span class="sc">*</span>(b<span class="sc">-</span>a))</span>
<span id="cb368-3"><a href="exp-design.html#cb368-3" tabindex="-1"></a>}</span>
<span id="cb368-4"><a href="exp-design.html#cb368-4" tabindex="-1"></a></span>
<span id="cb368-5"><a href="exp-design.html#cb368-5" tabindex="-1"></a>args <span class="ot">=</span> <span class="fu">list</span>( <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb368-6"><a href="exp-design.html#cb368-6" tabindex="-1"></a>             <span class="at">b =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>, </span>
<span id="cb368-7"><a href="exp-design.html#cb368-7" tabindex="-1"></a>             <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>) )</span>
<span id="cb368-8"><a href="exp-design.html#cb368-8" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">pmap_dbl</span>(  args, my_function, <span class="at">scale =</span> <span class="dv">10</span> )</span></code></pre></div>
<pre><code>## [1] 18 32 58</code></pre>
<p>One important note is the variable names for the lists being iterated over must correspond exactly to function arguments of the called function.
Extra parameters can be passed after the function name; these will also be passed to each function call, but will be the same for all calls.
See how <code>scale</code> is the same for all calls in the above example.</p>
<p>Just like <code>map()</code> or <code>map2()</code>, <code>pmap()</code> has variants such as <code>_dbl</code> or <code>_df</code>.
These variants automatically stack or convert the list of things returned into a tidier collection (for <code>_dbl</code> it will convert to a vector of numbers, for <code>_df</code> it will stack the results to make a large dataframe, assuming each thing returned is a little dataframe).</p>
<p>So far, this is great, but it does not quite look like what we want: our factors are stored as a dataframe, not three lists.
This is where R gets interesting: in R, the columns of a dataframe are actually stored as a list of vectors or lists (with each of the vectors or lists having the exact same length).
This works beautifully with <code>pmap()</code>.
Witness:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="exp-design.html#cb370-1" tabindex="-1"></a>args[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 5 6 7</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="exp-design.html#cb372-1" tabindex="-1"></a>a_df <span class="ot">=</span> <span class="fu">as_tibble</span>(args)</span>
<span id="cb372-2"><a href="exp-design.html#cb372-2" tabindex="-1"></a>a_df</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##       a     b theta
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1     5   0.2
## 2     2     6   0.3
## 3     3     7   0.7</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="exp-design.html#cb374-1" tabindex="-1"></a>a_df[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 5 6 7</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="exp-design.html#cb376-1" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">pmap_dbl</span>( a_df, my_function, <span class="at">scale =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 18 32 58</code></pre>
<p>When we pass our data frame <code>a_df</code> to <code>pmap()</code>, <code>pmap()</code> takes it as a list of lists, and therefore does exactly what it did before.</p>
<p>All of this means <code>pmap()</code> can run a specified function on each row of a dataset.
Continuing the Cronbach Alpha simulation from above, we would have the following:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="exp-design.html#cb378-1" tabindex="-1"></a>params<span class="sc">$</span>iterations <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb378-2"><a href="exp-design.html#cb378-2" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span>  params <span class="sc">%&gt;%</span></span>
<span id="cb378-3"><a href="exp-design.html#cb378-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> <span class="fu">pmap</span>(., run_alpha_sim ) )</span></code></pre></div>
<p>The above code calls our <code>run_alpha_sim()</code> method for each row of our list of scenarios we want to explore.
Even better, we are storing the results <strong>as a new variable in the same dataset</strong>.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="exp-design.html#cb379-1" tabindex="-1"></a>sim_results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 6
##        n     p alpha    df iterations res  
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;
##  1    50     4   0.1     5        500 NA   
##  2   100     4   0.1     5        500 NA   
##  3    50     8   0.1     5        500 NA   
##  4   100     8   0.1     5        500 NA   
##  5    50     4   0.2     5        500 NA   
##  6   100     4   0.2     5        500 NA   
##  7    50     8   0.2     5        500 NA   
##  8   100     8   0.2     5        500 NA   
##  9    50     4   0.3     5        500 NA   
## 10   100     4   0.3     5        500 NA   
## # ℹ 134 more rows</code></pre>
<p>The above code may look a bit peculiar: we are storing a set of dataframes (our result) in our original dataframe.
This is actually ok in R: our results will be in what is called a <strong>list-column</strong>, where each element in our list column is the little summary of our simulation results for that scenario.
Here is the third scenario, for example:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="exp-design.html#cb381-1" tabindex="-1"></a>sim_results<span class="sc">$</span>res[[<span class="dv">3</span>]]</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>List columns are neat, but hard to work with.
To turn into normal data we can use <code>unnest()</code> to expand the <code>res</code> variable, replicating the values of the main variables once for each row in the nested dataset:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="exp-design.html#cb383-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb383-2"><a href="exp-design.html#cb383-2" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">unnest</span>(sim_results, <span class="at">cols =</span> res) <span class="sc">%&gt;%</span></span>
<span id="cb383-3"><a href="exp-design.html#cb383-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>iterations )</span>
<span id="cb383-4"><a href="exp-design.html#cb383-4" tabindex="-1"></a>sim_results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 5
##        n     p alpha    df res  
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;
##  1    50     4   0.1     5 NA   
##  2   100     4   0.1     5 NA   
##  3    50     8   0.1     5 NA   
##  4   100     8   0.1     5 NA   
##  5    50     4   0.2     5 NA   
##  6   100     4   0.2     5 NA   
##  7    50     8   0.2     5 NA   
##  8   100     8   0.2     5 NA   
##  9    50     4   0.3     5 NA   
## 10   100     4   0.3     5 NA   
## # ℹ 134 more rows</code></pre>
<p>We can put all of this together in a a tidy workflow as follows:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="exp-design.html#cb385-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> </span>
<span id="cb385-2"><a href="exp-design.html#cb385-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb385-3"><a href="exp-design.html#cb385-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> <span class="fu">pmap</span>(., <span class="at">.f =</span> run_alpha_sim)) <span class="sc">%&gt;%</span></span>
<span id="cb385-4"><a href="exp-design.html#cb385-4" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> res)</span></code></pre></div>
<p>If you like, you can simply use the <code>simhelpers</code> package:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="exp-design.html#cb386-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">evaluate_by_row</span>(params, run_alpha_sim)</span></code></pre></div>
<p>The above code is auto-generated by the <code>create_skeleton()</code> method as well.
One advantage of <code>simhelpers</code> is it is easy to then do the above in parallel; see Section <a href="parallel-processing.html#parallel-processing">19</a>.</p>
<p>We finally save our results using tidyverse’s <code>write_csv()</code>; see “R for Data Science” textbook, 11.5.
We first ensure we have a directory by making one via <code>dir.create()</code> (see Section <a href="saving-files.html#saving-files">18</a> for more on files):</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="exp-design.html#cb387-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb387-2"><a href="exp-design.html#cb387-2" tabindex="-1"></a><span class="fu">write_csv</span>( sim_results, <span class="at">file =</span> <span class="st">&quot;results/cronbach_results.csv&quot;</span> )</span></code></pre></div>
<p>Our simulation results for all our scenarios are now saved!</p>
</div>
<div id="when-to-calculate-performance-metrics-when-running-multiple-simulations" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> When to calculate performance metrics when running multiple simulations<a href="exp-design.html#when-to-calculate-performance-metrics-when-running-multiple-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For a single scenario simulation, we repeatedly generate and analyze data, and then assess the performance across the repetitions.
When we extend to multifactor simulations, we have a choice: do we compute performance measures for each simulation scenario as we go (inside) or do we compute all of them after we get all of our individual results (outside)?
We discuss the pros and cons of each approach next.</p>
<div id="aggregate-as-you-simulate-inside" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Aggregate as you simulate (inside)<a href="exp-design.html#aggregate-as-you-simulate-inside" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <em>inside</em> approach runs a stand-alone simulation for each scenario of interest. For each combination of factors, we simulate data, assess performance, and return a summary table. We then stack these tables to get the final results.</p>
<p>This approach, which is what we illustrated above, is straightforward: we already have a method to run simulations for a single scenario, and we just repeat it across multiple scenarios and combine the outputs.
After the <code>pmap()</code> call and the stacking of results, we end up with a dataframe with all our simulations represented, one simulation context per row (or maybe we have bundles of rows for each simulation context, with one row for each method), with the columns being our factors and measured performance outcomes.
This table of performance is ideally all we need to write up our results.</p>
<p>With “inside,” we do not have much data to store, and it is easier to modularize the simulation code.
On the cons side, we have no ability to add new performance measures on the fly or look at the individual estimates.
For example, say we wanted to see if the distribution of estimates in a scenario across iterations was right skewed, because we were worried the estimator sometimes broken down and have extreme answers?
We might want to make a histogram of the point estimates, or calculate the skew of the estimates as a performance measure.
As the individual estimates are lost, we would have no way of doing this without rerunning the entire simulation.</p>
</div>
<div id="keep-all-simulation-runs-outside" class="section level3 hasAnchor" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Keep all simulation runs (outside)<a href="exp-design.html#keep-all-simulation-runs-outside" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the <em>outside</em> approach, when we finish each single scenario we do not calculate the performance, but instead return the entire set of individual estimates as a dataframe, with each row being a method’s estimate for a given dataset.
The benefit of the outside approach is, given these raw estimates, we can dynamically add or change how we calculate performance measures without re-running the entire simulation.
This is especially important if the simulation is time intensive (e.g., if the estimators being evaluated are computationally expensive).
With the outside approach, however, we end up with massive amounts of data to store and manipulate.</p>
<p>For our Cronbach simulation, to move from inside to outside, we just take the summarizing step out of <code>run_alpha_sim()</code>.
E.g.,:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="exp-design.html#cb388-1" tabindex="-1"></a>run_alpha_sim_raw <span class="ot">&lt;-</span> <span class="cf">function</span>(iterations, n, p, alpha, df, <span class="at">coverage =</span> <span class="fl">0.95</span> ) {</span>
<span id="cb388-2"><a href="exp-design.html#cb388-2" tabindex="-1"></a>  </span>
<span id="cb388-3"><a href="exp-design.html#cb388-3" tabindex="-1"></a>  results <span class="ot">&lt;-</span> </span>
<span id="cb388-4"><a href="exp-design.html#cb388-4" tabindex="-1"></a>    <span class="fu">replicate</span>(<span class="at">n =</span> iterations, {</span>
<span id="cb388-5"><a href="exp-design.html#cb388-5" tabindex="-1"></a>      dat <span class="ot">&lt;-</span> <span class="fu">r_mvt_items</span>(<span class="at">n =</span> n, <span class="at">p =</span> p, <span class="at">alpha =</span> alpha, <span class="at">df =</span> df)</span>
<span id="cb388-6"><a href="exp-design.html#cb388-6" tabindex="-1"></a>      <span class="fu">estimate_alpha</span>(dat, <span class="at">coverage =</span> coverage)</span>
<span id="cb388-7"><a href="exp-design.html#cb388-7" tabindex="-1"></a>    }, <span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb388-8"><a href="exp-design.html#cb388-8" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb388-9"><a href="exp-design.html#cb388-9" tabindex="-1"></a>  </span>
<span id="cb388-10"><a href="exp-design.html#cb388-10" tabindex="-1"></a>  results</span>
<span id="cb388-11"><a href="exp-design.html#cb388-11" tabindex="-1"></a>}</span></code></pre></div>
<p>Each call to <code>run_alpha_sim_raw()</code> now gives one row per simulation trial:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="exp-design.html#cb389-1" tabindex="-1"></a><span class="fu">run_alpha_sim_raw</span>( <span class="at">iterations =</span> <span class="dv">4</span>, </span>
<span id="cb389-2"><a href="exp-design.html#cb389-2" tabindex="-1"></a>                   <span class="dv">50</span>, <span class="dv">6</span>, <span class="fl">0.5</span>, <span class="dv">3</span> )</span></code></pre></div>
<pre><code>##           A      Var_A       CI_L      CI_U
## 1 0.5402995 0.01014358 0.29374115 0.7007831
## 2 0.3867717 0.01805035 0.05786946 0.6008526
## 3 0.4617342 0.01390704 0.17303773 0.6496454
## 4 0.4810237 0.01292815 0.20267301 0.6622008</code></pre>
<p>We then save the entire set of estimates, rather than the performance.
The primary advantage of the outside approach is we can then generate new performance measures, as they
occur to us, later on.
The disadvantage is this result file will be <span class="math inline">\(R\)</span> times as many rows as the older file, which can get quite, quite large.</p>
<p>But disk space is cheap!
Here we run the same experiment with our more complete storage.
Note how the <code>pmap_df</code> stacks the multiple rows from each run, giving us everything nicely bundled up:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="exp-design.html#cb391-1" tabindex="-1"></a>params<span class="sc">$</span>res <span class="ot">&lt;-</span> params <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="exp-design.html#cb391-2" tabindex="-1"></a>    <span class="fu">pmap</span>( run_alpha_sim_raw, <span class="at">iterations =</span> <span class="dv">500</span> )</span>
<span id="cb391-3"><a href="exp-design.html#cb391-3" tabindex="-1"></a>sim_results_full <span class="ot">&lt;-</span> <span class="fu">unnest</span>( params,</span>
<span id="cb391-4"><a href="exp-design.html#cb391-4" tabindex="-1"></a>                            <span class="at">cols =</span> res ) </span>
<span id="cb391-5"><a href="exp-design.html#cb391-5" tabindex="-1"></a><span class="fu">write_csv</span>( sim_results_full, <span class="st">&quot;results/cronbach_results_full.csv&quot;</span> )</span></code></pre></div>
<p>We end up with a lot more rows.
Here is the number of rows for the outside vs inside approach:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="exp-design.html#cb392-1" tabindex="-1"></a><span class="fu">nrow</span>( sim_results_full )</span></code></pre></div>
<pre><code>## [1] 72000</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="exp-design.html#cb394-1" tabindex="-1"></a><span class="fu">nrow</span>( sim_results )</span></code></pre></div>
<pre><code>## [1] 144</code></pre>
<p>Comparing the file sizes on the disk, one is several k, the other is several megabytes:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="exp-design.html#cb396-1" tabindex="-1"></a><span class="fu">file.size</span>(<span class="st">&quot;results/cronbach_results.csv&quot;</span>) <span class="sc">/</span> <span class="dv">1024</span></span></code></pre></div>
<pre><code>## [1] 3.961914</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="exp-design.html#cb398-1" tabindex="-1"></a><span class="fu">file.size</span>(<span class="st">&quot;results/cronbach_results_full.csv&quot;</span>) <span class="sc">/</span> <span class="dv">1024</span></span></code></pre></div>
<pre><code>## [1] 7445.908</code></pre>
</div>
<div id="getting-raw-results-ready-for-analysis" class="section level3 hasAnchor" number="11.3.3">
<h3><span class="header-section-number">11.3.3</span> Getting raw results ready for analysis<a href="exp-design.html#getting-raw-results-ready-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we generated raw results then we need to collapse them by experimental run
before calculating performance measures so we can explore the trends across the
experiments.</p>
<p>One way to do this is to use <code>group_by()</code> and <code>summarize()</code> to summrize our raw results.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="exp-design.html#cb400-1" tabindex="-1"></a>sim_results_full <span class="sc">%&gt;%</span></span>
<span id="cb400-2"><a href="exp-design.html#cb400-2" tabindex="-1"></a>    <span class="fu">group_by</span>( n, p, alpha, df ) <span class="sc">%&gt;%</span></span>
<span id="cb400-3"><a href="exp-design.html#cb400-3" tabindex="-1"></a>  <span class="fu">summarise</span>( </span>
<span id="cb400-4"><a href="exp-design.html#cb400-4" tabindex="-1"></a>    <span class="at">bias =</span> <span class="fu">mean</span>(A <span class="sc">-</span> alpha),</span>
<span id="cb400-5"><a href="exp-design.html#cb400-5" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((A <span class="sc">-</span> alpha)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb400-6"><a href="exp-design.html#cb400-6" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 144 × 6
## # Groups:   n, p, alpha [36]
##        n     p alpha    df    bias  RMSE
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1    50     4   0.1     5 -0.103  0.388
##  2    50     4   0.1    10 -0.0527 0.263
##  3    50     4   0.1    20 -0.0190 0.221
##  4    50     4   0.1   100 -0.0313 0.219
##  5    50     4   0.2     5 -0.0966 0.399
##  6    50     4   0.2    10 -0.0406 0.225
##  7    50     4   0.2    20 -0.0301 0.223
##  8    50     4   0.2   100 -0.0348 0.206
##  9    50     4   0.3     5 -0.0683 0.281
## 10    50     4   0.3    10 -0.0331 0.199
## # ℹ 134 more rows</code></pre>
<p>If we want to use our full performance measure function <code>alpha_performance()</code> to get additional metrics such as MCSEs, we would <em>nest</em> our data into a series of mini-datasets (one for each simulation), and then process each element.
As we saw above, nesting collapses a larger dataframe into a dataframe of dataframes:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="exp-design.html#cb402-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> sim_results_full <span class="sc">|&gt;</span></span>
<span id="cb402-2"><a href="exp-design.html#cb402-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>iterations, <span class="sc">-</span>seed ) <span class="sc">|&gt;</span></span>
<span id="cb402-3"><a href="exp-design.html#cb402-3" tabindex="-1"></a>  <span class="fu">group_by</span>( n, p, alpha, df ) <span class="sc">|&gt;</span></span>
<span id="cb402-4"><a href="exp-design.html#cb402-4" tabindex="-1"></a>  <span class="fu">nest</span>( <span class="at">.key =</span> <span class="st">&quot;alpha_sims&quot;</span> )</span>
<span id="cb402-5"><a href="exp-design.html#cb402-5" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 5
## # Groups:   n, p, alpha, df [144]
##        n     p alpha    df alpha_sims        
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;            
##  1    50     4   0.1     5 &lt;tibble [500 × 4]&gt;
##  2   100     4   0.1     5 &lt;tibble [500 × 4]&gt;
##  3    50     8   0.1     5 &lt;tibble [500 × 4]&gt;
##  4   100     8   0.1     5 &lt;tibble [500 × 4]&gt;
##  5    50     4   0.2     5 &lt;tibble [500 × 4]&gt;
##  6   100     4   0.2     5 &lt;tibble [500 × 4]&gt;
##  7    50     8   0.2     5 &lt;tibble [500 × 4]&gt;
##  8   100     8   0.2     5 &lt;tibble [500 × 4]&gt;
##  9    50     4   0.3     5 &lt;tibble [500 × 4]&gt;
## 10   100     4   0.3     5 &lt;tibble [500 × 4]&gt;
## # ℹ 134 more rows</code></pre>
<p>Note how each row of our nested data has a little dataframe of the individual simulation results, with 500 rows each.
Once nested, we can then use <code>map()</code> to apply a function to each element of the nested dataframe.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="exp-design.html#cb404-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb404-2"><a href="exp-design.html#cb404-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">performance =</span> <span class="fu">map2</span>( alpha_sims, alpha, </span>
<span id="cb404-3"><a href="exp-design.html#cb404-3" tabindex="-1"></a>                              alpha_performance ) )</span>
<span id="cb404-4"><a href="exp-design.html#cb404-4" tabindex="-1"></a>results <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb404-5"><a href="exp-design.html#cb404-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>alpha_sims ) <span class="sc">%&gt;%</span></span>
<span id="cb404-6"><a href="exp-design.html#cb404-6" tabindex="-1"></a>  <span class="fu">unnest</span>( <span class="at">cols=</span><span class="st">&quot;performance&quot;</span> ) </span>
<span id="cb404-7"><a href="exp-design.html#cb404-7" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 576 × 7
## # Groups:   n, p, alpha, df [144]
##        n     p alpha    df criterion           est
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
##  1    50     4   0.1     5 alpha bias      -0.103 
##  2    50     4   0.1     5 alpha RMSE       0.388 
##  3    50     4   0.1     5 V relative bias  0.436 
##  4    50     4   0.1     5 coverage         0.826 
##  5   100     4   0.1     5 alpha bias      -0.0347
##  6   100     4   0.1     5 alpha RMSE       0.224 
##  7   100     4   0.1     5 V relative bias  0.500 
##  8   100     4   0.1     5 coverage         0.85  
##  9    50     8   0.1     5 alpha bias      -0.0728
## 10    50     8   0.1     5 alpha RMSE       0.333 
## # ℹ 566 more rows
## # ℹ 1 more variable: MCSE &lt;dbl&gt;</code></pre>
<p>We have built our final performance table <em>after</em> running the entire simulation, rather than running it on each simulation scenario in turn.</p>
<p>Now, if we want to add a performance metric, we can simply change <code>alpha_performance</code> and recalculate, without running the time-intensive simulations.
Being able to re-analyze your results is generally a far easier fix than running all the simulations again.
Summarizing during the simulation vs. after, as we just did, leads to the same set of results.
In fact, if we use the same seed, we would <em>exactly</em> the same results.
The inside vs. outside choice is one of using disk space in exchange for later flexibility.</p>
</div>
</div>
<div id="running-the-cluster-rct-multifactor-experiment" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Running the Cluster RCT multifactor experiment<a href="exp-design.html#running-the-cluster-rct-multifactor-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We run our cluster RCT simulation using the same code pattern as we used with Cronbach alpha.
Because we are not exactly sure what performance metrics we want, we will save our individual results, and then calculate performance metrics on the full data.
I.e., we are using the outside approach, not inside.</p>
<p>We first make our table of scenarios:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="exp-design.html#cb406-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> </span>
<span id="cb406-2"><a href="exp-design.html#cb406-2" tabindex="-1"></a>  <span class="fu">cross_df</span>(crt_design_factors) <span class="sc">%&gt;%</span></span>
<span id="cb406-3"><a href="exp-design.html#cb406-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb406-4"><a href="exp-design.html#cb406-4" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">20200320</span> <span class="sc">+</span> <span class="dv">17</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb406-5"><a href="exp-design.html#cb406-5" tabindex="-1"></a>  )</span></code></pre></div>
<p>To allow reproducibility, we give a different seed for each scenario just to avoid anything confusing about shared randomness across scenarios.
<!--For more on is for reproducibility; we discuss this more in Section \@ref(sec-reproducability).-->
<!-- LWM: Need to reference new location of reprod.  Does this section exist anymore? -->
We then run the simulation 1000 times each for all our scenarios, and unnest to get our final data:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="exp-design.html#cb407-1" tabindex="-1"></a>params<span class="sc">$</span>res <span class="ot">=</span> <span class="fu">pmap</span>(params, <span class="at">.f =</span> run_CRT_sim, <span class="at">reps =</span> <span class="dv">1000</span> )</span>
<span id="cb407-2"><a href="exp-design.html#cb407-2" tabindex="-1"></a>res <span class="ot">=</span> params <span class="sc">%&gt;%</span> </span>
<span id="cb407-3"><a href="exp-design.html#cb407-3" tabindex="-1"></a>  <span class="fu">unnest</span>( <span class="at">cols=</span><span class="fu">c</span>(data) )</span>
<span id="cb407-4"><a href="exp-design.html#cb407-4" tabindex="-1"></a><span class="fu">saveRDS</span>( res, <span class="at">file =</span> <span class="st">&quot;results/simulation_CRT.rds&quot;</span> )</span></code></pre></div>
<p>Normally we would do this in parallel for speed; we discuss how to do that in Section <a href="parallel-processing.html#parallel-processing">19</a>.
Even under parallel processing, this simulation took overnight to run.
Our final results look like this:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="exp-design.html#cb408-1" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## # A tibble: 810,000 × 13
##    n_bar     J   ATE size_coef   ICC alpha  reps
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    20     5   0.2         0     0     0  1000
##  2    20     5   0.2         0     0     0  1000
##  3    20     5   0.2         0     0     0  1000
##  4    20     5   0.2         0     0     0  1000
##  5    20     5   0.2         0     0     0  1000
##  6    20     5   0.2         0     0     0  1000
##  7    20     5   0.2         0     0     0  1000
##  8    20     5   0.2         0     0     0  1000
##  9    20     5   0.2         0     0     0  1000
## 10    20     5   0.2         0     0     0  1000
## # ℹ 809,990 more rows
## # ℹ 6 more variables: seed &lt;dbl&gt;, runID &lt;chr&gt;,
## #   method &lt;chr&gt;, ATE_hat &lt;dbl&gt;, SE_hat &lt;dbl&gt;,
## #   p_value &lt;dbl&gt;</code></pre>
<p>We have a lot of rows of data!</p>
<div id="calculating-performance-metrics" class="section level3 hasAnchor" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Calculating performance metrics<a href="exp-design.html#calculating-performance-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our next step is to group our results by our simulation factors and calculate all our performance metrics at once.
For example, here we calculate our main performance measures by hand:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="exp-design.html#cb410-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="at">file =</span> <span class="st">&quot;results/simulation_CRT.rds&quot;</span> )</span>
<span id="cb410-2"><a href="exp-design.html#cb410-2" tabindex="-1"></a></span>
<span id="cb410-3"><a href="exp-design.html#cb410-3" tabindex="-1"></a>sres <span class="ot">&lt;-</span> </span>
<span id="cb410-4"><a href="exp-design.html#cb410-4" tabindex="-1"></a>  res <span class="sc">%&gt;%</span> </span>
<span id="cb410-5"><a href="exp-design.html#cb410-5" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ATE, size_coef, ICC, alpha, method ) <span class="sc">%&gt;%</span></span>
<span id="cb410-6"><a href="exp-design.html#cb410-6" tabindex="-1"></a>  <span class="fu">summarise</span>( </span>
<span id="cb410-7"><a href="exp-design.html#cb410-7" tabindex="-1"></a>    <span class="at">bias =</span> <span class="fu">mean</span>(ATE_hat <span class="sc">-</span> ATE),</span>
<span id="cb410-8"><a href="exp-design.html#cb410-8" tabindex="-1"></a>    <span class="at">SE =</span> <span class="fu">sd</span>( ATE_hat ),</span>
<span id="cb410-9"><a href="exp-design.html#cb410-9" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( (ATE_hat <span class="sc">-</span> ATE )<span class="sc">^</span><span class="dv">2</span> ) ),</span>
<span id="cb410-10"><a href="exp-design.html#cb410-10" tabindex="-1"></a>    <span class="at">ESE_hat =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( SE_hat<span class="sc">^</span><span class="dv">2</span> ) ),</span>
<span id="cb410-11"><a href="exp-design.html#cb410-11" tabindex="-1"></a>    <span class="at">SD_SE_hat =</span> <span class="fu">sqrt</span>( <span class="fu">sd</span>( SE_hat<span class="sc">^</span><span class="dv">2</span> ) ),</span>
<span id="cb410-12"><a href="exp-design.html#cb410-12" tabindex="-1"></a>    <span class="at">power =</span> <span class="fu">mean</span>( p_value <span class="sc">&lt;=</span> <span class="fl">0.05</span> ),</span>
<span id="cb410-13"><a href="exp-design.html#cb410-13" tabindex="-1"></a>    <span class="at">R =</span> <span class="fu">n</span>(),</span>
<span id="cb410-14"><a href="exp-design.html#cb410-14" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb410-15"><a href="exp-design.html#cb410-15" tabindex="-1"></a>  )</span></code></pre></div>
<p>If we want MCSEs (we do), then we can do that by hand as well, or use the <code>simhelpers</code> package as so:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="exp-design.html#cb411-1" tabindex="-1"></a><span class="fu">library</span>( simhelpers )</span>
<span id="cb411-2"><a href="exp-design.html#cb411-2" tabindex="-1"></a>sres <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb411-3"><a href="exp-design.html#cb411-3" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ATE, size_coef, ICC, alpha, method ) <span class="sc">%&gt;%</span></span>
<span id="cb411-4"><a href="exp-design.html#cb411-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="fu">calc_absolute</span>( <span class="at">estimates =</span> ATE_hat,</span>
<span id="cb411-5"><a href="exp-design.html#cb411-5" tabindex="-1"></a>                            <span class="at">true_param =</span> ATE,</span>
<span id="cb411-6"><a href="exp-design.html#cb411-6" tabindex="-1"></a>                            <span class="at">criteria =</span> <span class="fu">c</span>(<span class="st">&quot;bias&quot;</span>,<span class="st">&quot;stddev&quot;</span>,</span>
<span id="cb411-7"><a href="exp-design.html#cb411-7" tabindex="-1"></a>                                         <span class="st">&quot;rmse&quot;</span>)),</span>
<span id="cb411-8"><a href="exp-design.html#cb411-8" tabindex="-1"></a>             <span class="fu">calc_relative_var</span>( <span class="at">estimates =</span> ATE_hat,</span>
<span id="cb411-9"><a href="exp-design.html#cb411-9" tabindex="-1"></a>                                <span class="at">var_estimates =</span> SE_hat<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb411-10"><a href="exp-design.html#cb411-10" tabindex="-1"></a>                                <span class="at">criteria =</span> <span class="st">&quot;relative bias&quot;</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb411-11"><a href="exp-design.html#cb411-11" tabindex="-1"></a>  <span class="fu">rename</span>( <span class="at">SE =</span> stddev,</span>
<span id="cb411-12"><a href="exp-design.html#cb411-12" tabindex="-1"></a>          <span class="at">SE_mcse =</span> stddev_mcse ) <span class="sc">%&gt;%</span></span>
<span id="cb411-13"><a href="exp-design.html#cb411-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>K_absolute, <span class="sc">-</span>K_relvar ) <span class="sc">%&gt;%</span></span>
<span id="cb411-14"><a href="exp-design.html#cb411-14" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb411-15"><a href="exp-design.html#cb411-15" tabindex="-1"></a><span class="fu">colnames</span>( sres )</span></code></pre></div>
<pre><code>##  [1] &quot;n_bar&quot;             &quot;J&quot;                
##  [3] &quot;ATE&quot;               &quot;size_coef&quot;        
##  [5] &quot;ICC&quot;               &quot;alpha&quot;            
##  [7] &quot;method&quot;            &quot;bias&quot;             
##  [9] &quot;bias_mcse&quot;         &quot;SE&quot;               
## [11] &quot;SE_mcse&quot;           &quot;rmse&quot;             
## [13] &quot;rmse_mcse&quot;         &quot;rel_bias_var&quot;     
## [15] &quot;rel_bias_var_mcse&quot;</code></pre>
<!-- LWM: James, is the above best practice for using simhelpers? -->
</div>
<div id="making-analyze_data-quiet" class="section level3 hasAnchor" number="11.4.2">
<h3><span class="header-section-number">11.4.2</span> Making analyze_data() quiet<a href="exp-design.html#making-analyze_data-quiet" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- LWM: Does this section need to be reworked in light of revision of chapter 8 (I think 8?) on making things quiet and trapping errors? -->
<p>If we run our Cluster RCT simulation when there is little cluster variation, we will get a lot of messages and warnings from our MLM estimator.
For example, from a single call we get:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="exp-design.html#cb413-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">analyze_data</span>(dat)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<p>When we scale up to our full simulations, these messages and warnings can become a nuisance.
<!--Furthermore, on our machine, the `lmer()` command can sometimes just fail (we believe there is some bug in the optimizer that fails if things are just perfectly wrong).
If our code failed on simulation run 944 out of 1000, we would lose everything!-->
To keep track of these issues, we trap messages and warnings using the <code>quietly()</code> method of the <code>purrr</code> package as so (see Chapter @(#safe_code) for more on capturing warnings and trapping errors):</p>
<pre><code>quiet_lmer = quietly( lmer )

quiet_analyze_data &lt;- function( dat ) {
    
    # MLM
    M1 &lt;- quiet_lmer( Yobs ~ 1 + Z + (1|sid), data=dat )
    M = M1$result
    message1 = ifelse( length( M1$message ) &gt; 0, 1, 0 )
    warning1 = ifelse( length( M1$warning ) &gt; 0, 1, 0 )

   ...

    # Compile our results
    tibble( 
      method = c( &quot;MLM&quot;, &quot;LR&quot;, &quot;Agg&quot; ),
      ATE_hat = c( est1, est2, est3 ),
      SE_hat = c( se1, se2, se3 ),
      p_value = c( pv1, pv2, pv3 ),
      message = c( message1, 0, 0 ),
      warning = c( warning1, 0, 0 )
    )
}</code></pre>
<p>We now get a note about the message regarding convergence saved in our results:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="exp-design.html#cb416-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">quiet_analyze_data</span>(dat)</span>
<span id="cb416-2"><a href="exp-design.html#cb416-2" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   method ATE_hat SE_hat    df p_value message
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 MLM      0.235 0.440   20.0   0.599       1
## 2 LR       0.235 0.0467   1     0.125       0
## 3 Agg      0.232 0.0468   1     0.127       0
## # ℹ 1 more variable: warning &lt;dbl&gt;</code></pre>
<p>See? No more warnings are printed to the console, but we do see the message as a variable in our results.</p>
</div>
</div>
<div id="exercises-8" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Exercises<a href="exp-design.html#exercises-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="exercise:trimmed-mean" class="section level3 hasAnchor" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Comparing the trimmed mean, median and mean<a href="exp-design.html#exercise:trimmed-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this exercise, you will write a simulation to compare different forms of an
estimator for estimating the same thing.
In particular, you will compare estimation of the
center of a symmetric distribution via mean, trimmed mean, and median (so the
mean and median are the same). These are the three estimation strategies
that we might be comparing in a paper (pretend you “invented” the trimmed
mean and want to demonstrate its utility).</p>
<p>To do this, you should break building this simulation evaluation down into lots of
functions to show the general framework. This framework can readily be
extended to more complicated simulation studies.
This extended exercise illustrates how methodologists might compare different strategies for estimation, and is what we might see in the “simulation” section of a stats paper.</p>
<p>For our data-generation function use the scaled <span class="math inline">\(t\)</span>-distribution so the standard deviation will always be 1 but we will have different fatness of tails (high chance of outliers):</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="exp-design.html#cb418-1" tabindex="-1"></a>gen.data <span class="ot">=</span> <span class="cf">function</span>( n, mu, df0 ) {</span>
<span id="cb418-2"><a href="exp-design.html#cb418-2" tabindex="-1"></a>    mu <span class="sc">+</span> <span class="fu">rt</span>( n, <span class="at">df=</span>df0 ) <span class="sc">/</span> <span class="fu">sqrt</span>( df0 <span class="sc">/</span> (df0<span class="dv">-2</span>) )</span>
<span id="cb418-3"><a href="exp-design.html#cb418-3" tabindex="-1"></a>}</span></code></pre></div>
<p>The variance of a <span class="math inline">\(t\)</span> distribution is <span class="math inline">\(df/(df-2)\)</span>, so when we divide our observations by the
square root of this, we standardize them so they have unit variance.</p>
<ol style="list-style-type: decimal">
<li><p>Verify this generates data with mean <code>mu</code> and standard deviation 1 for various <code>df0</code> values.</p></li>
<li><p>Write a method to calculate the mean, trimmed mean, and median of a vector of data.
The trimmed mean should trim 10% of the data from each end.
The method should return a data frame with the three estimates, with each row being one of our estimators.</p></li>
<li><p>Verify your method works by analyzing a dataset generated with <code>gen.data()</code>.
For example, you can generate a dataset of size 100 with <code>gen.data(100, 0, 3)</code> and then analyze it.</p></li>
<li><p>Use <code>bundle_sim()</code> to create a simulation function that generates data and then analyzes it.
The function should take <code>n</code> and <code>df0</code> as arguments, and return the estimates from your analysis method.
Use <code>id</code> to give each simulation run an ID.</p></li>
<li><p>Run your simulation function for 1000 datasets of size 10, with <code>mu=0</code> and <code>df0=5</code>.
Store the results in a variable called <code>raw.exps</code>.</p></li>
<li><p>Write a function to calculate the RMSE, bias, and standard error for your three estimators, given the results.</p></li>
<li><p>Make a single function that takes <span class="math inline">\(df0\)</span> and <span class="math inline">\(n\)</span>, and runs a simulation and returns the performances of your three methods.</p></li>
<li><p>Now make a grid of <span class="math inline">\(n =10, 50, 250, 1250\)</span> and <span class="math inline">\(df_0 =  3, 5, 15, 30\)</span>, and generate results for your multifactor simulation.</p></li>
<li><p>Make a plot showing how SE changes as a function of sample size for each estimator. Are they different?</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case_Cronbach.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="presentation-of-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/070-experimental-design.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
