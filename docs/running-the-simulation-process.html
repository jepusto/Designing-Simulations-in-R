<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-analysis-procedures.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#standardization-in-the-dgp"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.11</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.12</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-estimation-procedures"><i class="fa fa-check"></i><b>7.3</b> Validating Estimation Procedures</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="running-the-simulation-process" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Running the Simulation Process<a href="running-the-simulation-process.html#running-the-simulation-process" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the prior two chapters we saw how to write functions that generate data according to a specified model (and parameters) and functions that implement estimation procedures on simulated data.
We next put those two together and repeat a bunch of times to obtain a lot of results such as point estimates, estimated standard errors and/or confidence intervals.</p>
<p>We use two primary ways of doing this in this textbook.
The first is to write a function that does a single step of a simulation, and then use the <code>map()</code> function to run that single step multiple times.</p>
<p>For our Cluster RCT case study, for example, we would write the following that takes our simulation parameters and runs a single trial of our simulation:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="running-the-simulation-process.html#cb261-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J=</span><span class="dv">20</span>, </span>
<span id="cb261-2"><a href="running-the-simulation-process.html#cb261-2" tabindex="-1"></a>                     <span class="at">gamma_1 =</span> <span class="fl">0.3</span>, <span class="at">gamma_2 =</span> <span class="fl">0.5</span>,</span>
<span id="cb261-3"><a href="running-the-simulation-process.html#cb261-3" tabindex="-1"></a>                     <span class="at">sigma2_u =</span> <span class="fl">0.20</span>, <span class="at">sigma2_e =</span> <span class="fl">0.80</span>,</span>
<span id="cb261-4"><a href="running-the-simulation-process.html#cb261-4" tabindex="-1"></a>                     <span class="at">alpha =</span> <span class="fl">0.75</span> ) {</span>
<span id="cb261-5"><a href="running-the-simulation-process.html#cb261-5" tabindex="-1"></a>  </span>
<span id="cb261-6"><a href="running-the-simulation-process.html#cb261-6" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">gen_cluster_RCT</span>( <span class="at">n_bar =</span> n_bar, <span class="at">J=</span>J, </span>
<span id="cb261-7"><a href="running-the-simulation-process.html#cb261-7" tabindex="-1"></a>                        <span class="at">gamma_1 =</span> gamma_1, <span class="at">gamma_2 =</span> gamma_2,</span>
<span id="cb261-8"><a href="running-the-simulation-process.html#cb261-8" tabindex="-1"></a>                        <span class="at">sigma2_u =</span> sigma2_u, <span class="at">sigma2_e =</span> sigma2_e,</span>
<span id="cb261-9"><a href="running-the-simulation-process.html#cb261-9" tabindex="-1"></a>                        <span class="at">alpha =</span> alpha )</span>
<span id="cb261-10"><a href="running-the-simulation-process.html#cb261-10" tabindex="-1"></a>  MLM <span class="ot">=</span> <span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb261-11"><a href="running-the-simulation-process.html#cb261-11" tabindex="-1"></a>  LR <span class="ot">=</span> <span class="fu">analysis_OLS</span>( dat )</span>
<span id="cb261-12"><a href="running-the-simulation-process.html#cb261-12" tabindex="-1"></a>  Agg <span class="ot">=</span> <span class="fu">analysis_agg</span>( dat )</span>
<span id="cb261-13"><a href="running-the-simulation-process.html#cb261-13" tabindex="-1"></a>  </span>
<span id="cb261-14"><a href="running-the-simulation-process.html#cb261-14" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">MLM =</span> MLM, <span class="at">LR =</span> LR, <span class="at">Agg =</span> Agg,</span>
<span id="cb261-15"><a href="running-the-simulation-process.html#cb261-15" tabindex="-1"></a>             <span class="at">.id =</span> <span class="st">&quot;method&quot;</span> )</span>
<span id="cb261-16"><a href="running-the-simulation-process.html#cb261-16" tabindex="-1"></a>}</span></code></pre></div>
<p>We have added a bunch of defaults to our function, so we can easily run it without remembering all the things we can change.</p>
<p>When we call it, we get a nice table of results that we can evaluate:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="running-the-simulation-process.html#cb262-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">alpha=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   method ATE_hat SE_hat p_value
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 MLM      0.334  0.206   0.123
## 2 LR       0.382  0.230   0.116
## 3 Agg      0.329  0.203   0.122</code></pre>
<p>The results for each method is a single line.
We record estimated impact, estimated standard error, and a nominal <span class="math inline">\(p\)</span>-value.
Note how the <code>bind_rows()</code> method can take naming on the fly, and give us a column of <code>method</code>, which will be very useful for keeping track of what estimated what.
We intentionally wrap up our results with a data frame to make later processing of data with the tidyverse package much easier.</p>
<p>We then use the <code>map()</code> function to run this function multiple times:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="running-the-simulation-process.html#cb264-1" tabindex="-1"></a><span class="fu">set.seed</span>( <span class="dv">40404</span> )</span>
<span id="cb264-2"><a href="running-the-simulation-process.html#cb264-2" tabindex="-1"></a>R <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb264-3"><a href="running-the-simulation-process.html#cb264-3" tabindex="-1"></a>ATE <span class="ot">=</span> <span class="fl">0.30</span></span>
<span id="cb264-4"><a href="running-the-simulation-process.html#cb264-4" tabindex="-1"></a>runs <span class="ot">&lt;-</span> </span>
<span id="cb264-5"><a href="running-the-simulation-process.html#cb264-5" tabindex="-1"></a>  <span class="fu">map_df</span>( <span class="dv">1</span><span class="sc">:</span>R, <span class="sc">~</span><span class="fu">one_run</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J=</span><span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE ),</span>
<span id="cb264-6"><a href="running-the-simulation-process.html#cb264-6" tabindex="-1"></a>          <span class="at">.id=</span><span class="st">&quot;runID&quot;</span> ) </span>
<span id="cb264-7"><a href="running-the-simulation-process.html#cb264-7" tabindex="-1"></a></span>
<span id="cb264-8"><a href="running-the-simulation-process.html#cb264-8" tabindex="-1"></a><span class="fu">saveRDS</span>( runs, <span class="at">file =</span> <span class="st">&quot;results/cluster_RCT_simulation.rds&quot;</span> )</span></code></pre></div>
<p>What the <code>map()</code> function is doing is first making a list from 1 to R, and then for each element in that list, it is calling <code>one_run()</code> with the parameters <code>n_bar = 30, J=20</code>.
The <code>~</code> is a shorthand way of writing a function that takes one argument, and then calls <code>one_run()</code> with that argument; the argument is the iteration number (1, 2, 3, …, R), but we are ignoring it. The <code>.id = "runID"</code> argument is a way of keeping track of which iteration number produced which result.
The <code>_df</code> at the end of <code>map_df()</code> is a way of telling <code>map()</code> to take the results of each iteration and bind them together into a single data frame.</p>
<p>Once our simulation is complete, we save our results to a file for future use; this speeds up our lives since we will not have to constantly re-run our simulation each time we want to explore the results.</p>
<p>We have arrived! We now have the individual results of all our methods applied to each of 1000 generated datasets.
The next step is to evaluate how well the estimators did.
Regarding our point estimate, for example, we have these primary questions:</p>
<ul>
<li>Is it biased? (bias)</li>
<li>Is it precise? (standard error)</li>
<li>Does it predict well? (RMSE)</li>
</ul>
<p>In the next chapter, we systematically go through answering these questions for our initial scenario.</p>
<div id="writing-simulations-quick-with-the-simhelpers-package" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Writing simulations quick with the simhelpers package<a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>map</code> approach is a bit strange, with building a secret function on the fly with <code>~</code>, and also having the copy over all the parameters we pass from <code>one_run()</code> to <code>gen_cluster_RCT()</code>.
The <code>simhelpers</code> package provides a shortcut that makes this step easier.</p>
<p>To do it, we first need to write a single estimation procedure function that puts all of our estimators together:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="running-the-simulation-process.html#cb265-1" tabindex="-1"></a>analyze_data <span class="ot">=</span> <span class="cf">function</span>( dat ) {</span>
<span id="cb265-2"><a href="running-the-simulation-process.html#cb265-2" tabindex="-1"></a>  MLM <span class="ot">=</span> <span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb265-3"><a href="running-the-simulation-process.html#cb265-3" tabindex="-1"></a>  LR <span class="ot">=</span> <span class="fu">analysis_OLS</span>( dat )</span>
<span id="cb265-4"><a href="running-the-simulation-process.html#cb265-4" tabindex="-1"></a>  Agg <span class="ot">=</span> <span class="fu">analysis_agg</span>( dat )</span>
<span id="cb265-5"><a href="running-the-simulation-process.html#cb265-5" tabindex="-1"></a>  </span>
<span id="cb265-6"><a href="running-the-simulation-process.html#cb265-6" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">MLM =</span> MLM, <span class="at">LR =</span> LR, <span class="at">Agg =</span> Agg,</span>
<span id="cb265-7"><a href="running-the-simulation-process.html#cb265-7" tabindex="-1"></a>             <span class="at">.id =</span> <span class="st">&quot;method&quot;</span> )</span>
<span id="cb265-8"><a href="running-the-simulation-process.html#cb265-8" tabindex="-1"></a>}</span></code></pre></div>
<p>This is simply the <code>one_run()</code> method from above, but without the data generating part.
When we pass a dataset to it, we get a nice table of results that we can evaluate, as we did before.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="running-the-simulation-process.html#cb266-1" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">gen_cluster_RCT</span>( <span class="at">n=</span><span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> <span class="fl">0.30</span> )</span>
<span id="cb266-2"><a href="running-the-simulation-process.html#cb266-2" tabindex="-1"></a><span class="fu">analyze_data</span>( dat )</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<pre><code>## # A tibble: 3 × 4
##   method ATE_hat SE_hat    p_value
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 MLM      0.382 0.0813 0.00000325
## 2 LR       0.382 0.0672 0.0000213 
## 3 Agg      0.382 0.0672 0.0000213</code></pre>
<p>We can now use <code>simhelpers</code> to write us a new function for the entire simulation:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="running-the-simulation-process.html#cb269-1" tabindex="-1"></a><span class="fu">library</span>(simhelpers)</span>
<span id="cb269-2"><a href="running-the-simulation-process.html#cb269-2" tabindex="-1"></a>sim_function <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>( gen_cluster_RCT, analyze_data )</span></code></pre></div>
<p>We can then use it as so:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="running-the-simulation-process.html#cb270-1" tabindex="-1"></a><span class="fu">sim_function</span>( <span class="dv">2</span>, <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE )</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<pre><code>## # A tibble: 6 × 4
##   method ATE_hat SE_hat    p_value
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 MLM      0.294 0.0854 0.00291   
## 2 LR       0.294 0.0854 0.00291   
## 3 Agg      0.294 0.0854 0.00291   
## 4 MLM      0.375 0.0781 0.00000202
## 5 LR       0.375 0.0666 0.0000244 
## 6 Agg      0.375 0.0666 0.0000244</code></pre>
<p>The <code>bundle_sim()</code> command takes our DGP function and our estimation procedures function and gives us back a function, which we have called <code>sim_function</code>, that will run a simulation using whatever parameters we give it.
The <code>bundle_sim()</code> command examines <code>gen_cluster_RCT</code> function, figures out what parameters it needs, and makes sure that the newly created function is able to take those parameters from the user.</p>
<p>To use it for our simulation, we would then write</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="running-the-simulation-process.html#cb273-1" tabindex="-1"></a>rns <span class="ot">&lt;-</span> <span class="fu">sim_function</span>( R, <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE )</span>
<span id="cb273-2"><a href="running-the-simulation-process.html#cb273-2" tabindex="-1"></a><span class="fu">saveRDS</span>( runs, <span class="at">file =</span> <span class="st">&quot;results/cluster_RCT_simulation.rds&quot;</span> )</span></code></pre></div>
<p>This is a bit more elegant than the <code>map()</code> approach, and is especially useful when we have a lot of parameters to pass around.</p>
</div>
<div id="adding-checks-and-balances" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Adding Checks and Balances<a href="running-the-simulation-process.html#adding-checks-and-balances" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the extensions of the prior DGP chapter, we discussed indexing our DGP by the ICC instead of the two variance components.
We can do this, and also translate some of the more obscure model parameters to easier to interpret parameters from within our simulation driver as follows:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="running-the-simulation-process.html#cb274-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J=</span><span class="dv">20</span>, </span>
<span id="cb274-2"><a href="running-the-simulation-process.html#cb274-2" tabindex="-1"></a>                     <span class="at">ATE =</span> <span class="fl">0.3</span>, <span class="at">size_coef =</span> <span class="fl">0.5</span>,</span>
<span id="cb274-3"><a href="running-the-simulation-process.html#cb274-3" tabindex="-1"></a>                     <span class="at">ICC =</span> <span class="fl">0.4</span>,</span>
<span id="cb274-4"><a href="running-the-simulation-process.html#cb274-4" tabindex="-1"></a>                     <span class="at">alpha =</span> <span class="fl">0.75</span> ) {</span>
<span id="cb274-5"><a href="running-the-simulation-process.html#cb274-5" tabindex="-1"></a>    <span class="fu">stopifnot</span>( ICC <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> ICC <span class="sc">&lt;</span> <span class="dv">1</span> )</span>
<span id="cb274-6"><a href="running-the-simulation-process.html#cb274-6" tabindex="-1"></a></span>
<span id="cb274-7"><a href="running-the-simulation-process.html#cb274-7" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">gen_cluster_RCT</span>( <span class="at">n_bar =</span> n_bar, <span class="at">J=</span>J, </span>
<span id="cb274-8"><a href="running-the-simulation-process.html#cb274-8" tabindex="-1"></a>                        <span class="at">gamma_1 =</span> ATE, <span class="at">gamma_2 =</span> size_coef,</span>
<span id="cb274-9"><a href="running-the-simulation-process.html#cb274-9" tabindex="-1"></a>                        <span class="at">sigma2_u =</span> ICC, <span class="at">sigma2_e =</span> <span class="dv">1</span><span class="sc">-</span>ICC,</span>
<span id="cb274-10"><a href="running-the-simulation-process.html#cb274-10" tabindex="-1"></a>                        <span class="at">alpha =</span> alpha )</span>
<span id="cb274-11"><a href="running-the-simulation-process.html#cb274-11" tabindex="-1"></a>  </span>
<span id="cb274-12"><a href="running-the-simulation-process.html#cb274-12" tabindex="-1"></a>  MLM <span class="ot">=</span> <span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb274-13"><a href="running-the-simulation-process.html#cb274-13" tabindex="-1"></a>  LR <span class="ot">=</span> <span class="fu">analysis_OLS</span>( dat )</span>
<span id="cb274-14"><a href="running-the-simulation-process.html#cb274-14" tabindex="-1"></a>  Agg <span class="ot">=</span> <span class="fu">analysis_agg</span>( dat )</span>
<span id="cb274-15"><a href="running-the-simulation-process.html#cb274-15" tabindex="-1"></a>  </span>
<span id="cb274-16"><a href="running-the-simulation-process.html#cb274-16" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">MLM =</span> MLM, <span class="at">LR =</span> LR, <span class="at">Agg =</span> Agg,</span>
<span id="cb274-17"><a href="running-the-simulation-process.html#cb274-17" tabindex="-1"></a>             <span class="at">.id =</span> <span class="st">&quot;method&quot;</span> )</span>
<span id="cb274-18"><a href="running-the-simulation-process.html#cb274-18" tabindex="-1"></a>}</span></code></pre></div>
<p>Note the <code>stopifnot</code>: it is wise to ensure our parameter transforms are all reasonable, so we do not get unexplained errors or strange results later on.
It is best if your code fails as soon as possible! Otherwise debugging can be quite hard.</p>
<p>In our modified <code>one_run()</code> we are transforming our ICC parameter into specific other parameters that are used in our actual model to maintain our effect size interpretation of our simulation.
We have not even modified our <code>gen_cluster_RCT()</code> DGP method: we are just specifying the constellation of parameters as a function of the parameters we want to directly control in the simulation.</p>
<p>Controlling how we use the foundational elements such as our data generating code is a key tool for making the higher level simulations sensible and more easily interpretable.
Here we have put our entire simulation into effect size units, and are now providing “knobs” to the simulation that are directly interpretable.</p>
</div>
<div id="exercises-5" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Exercises<a href="running-the-simulation-process.html#exercises-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>In the prior chapter’s exercises, you made a new <code>BF_F</code> function for the Welch simulation. Now incorporate the <code>BF_F</code> function into the <code>one_run()</code> function, and use your revised function to generate simulation results for this additional estimator.</li>
</ol>

<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div class="csl-entry">
Abdulkadiroğlu, Atila, Joshua D Angrist, Yusuke Narita, and Parag A Pathak. 2017. <span>“Research Design Meets Market Design: Using Centralized Assignment for Impact Evaluation.”</span> <em>Econometrica</em> 85 (5): 1373–1432.
</div>
<div class="csl-entry">
Bloom, Howard S., Stephen W. Raudenbush, Michael J. Weiss, and Kristin Porter. 2016. <span>“<span class="nocase">Using Multisite Experiments to Study Cross-Site Variation in Treatment Effects: A Hybrid Approach With Fixed Intercepts and a Random Treatment Coefficient</span>.”</span> <em>Journal of Research on Educational Effectiveness</em> 10 (4): 0–0. <a href="https://doi.org/10.1080/19345747.2016.1264518">https://doi.org/10.1080/19345747.2016.1264518</a>.
</div>
<div class="csl-entry">
Boulesteix, Anne-Laure, Sabine Hoffmann, Alethea Charlton, and Heidi Seibold. 2020. <span>“A Replication Crisis in Methodological Research?”</span> <em>Significance</em> 17 (5): 18–21. <a href="https://doi.org/10.1111/1740-9713.01444">https://doi.org/10.1111/1740-9713.01444</a>.
</div>
<div class="csl-entry">
Boulesteix, Anne-Laure, Sabine Lauer, and Manuel J. A. Eugster. 2013. <span>“A Plea for Neutral Comparison Studies in Computational Sciences.”</span> <em>PLOS ONE</em> 8 (4): e61562. <a href="https://doi.org/10.1371/journal.pone.0061562">https://doi.org/10.1371/journal.pone.0061562</a>.
</div>
<div class="csl-entry">
Boulesteix, Anne-Laure, Rory Wilson, and Alexander Hapfelmeier. 2017. <span>“Towards Evidence-Based Computational Statistics: Lessons from Clinical Research on the Role and Design of Real-Data Benchmark Studies.”</span> <em>BMC Medical Research Methodology</em> 17 (1, 1): 1–12. <a href="https://doi.org/10.1186/s12874-017-0417-2">https://doi.org/10.1186/s12874-017-0417-2</a>.
</div>
<div class="csl-entry">
Brown, Morton B., and Alan B. Forsythe. 1974. <span>“The <span>Small Sample Behavior</span> of <span>Some Statistics Which Test</span> the <span>Equality</span> of <span>Several Means</span>.”</span> <em>Technometrics</em> 16 (1): 129–32. <a href="https://doi.org/10.1080/00401706.1974.10489158">https://doi.org/10.1080/00401706.1974.10489158</a>.
</div>
<div class="csl-entry">
Cho, Hunyong, Chuwen Liu, John S Preisser, and Di Wu. 2023. <span>“A Bivariate Zero-Inflated Negative Binomial Model and Its Applications to Biomedical Settings.”</span> <em>Statistical Methods in Medical Research</em> 32 (7): 1300–1317. <a href="https://doi.org/10.1177/09622802231172028">https://doi.org/10.1177/09622802231172028</a>.
</div>
<div class="csl-entry">
Davison, A. C., and D. V. Hinkley. 1997. <em>Bootstrap Methods and Their Applications</em>. Cambridge: Cambridge University Press.
</div>
<div class="csl-entry">
Dong, Nianbo, and Rebecca Maynard. 2013. <span>“<span><em>PowerUp</em></span><span><em>!</em></span> : <span>A Tool</span> for <span>Calculating Minimum Detectable Effect Sizes</span> and <span>Minimum Required Sample Sizes</span> for <span>Experimental</span> and <span>Quasi-Experimental Design Studies</span>.”</span> <em>Journal of Research on Educational Effectiveness</em> 6 (1): 24–67. <a href="https://doi.org/10.1080/19345747.2012.673143">https://doi.org/10.1080/19345747.2012.673143</a>.
</div>
<div class="csl-entry">
Efron, Bradley. 2000. <span>“The Bootstrap and Modern Statistics.”</span> <em>Journal of the American Statistical Association</em> 95 (452): 1293–96. <a href="https://doi.org/10.2307/2669773">https://doi.org/10.2307/2669773</a>.
</div>
<div class="csl-entry">
Faul, Franz, Edgar Erdfelder, Axel Buchner, and Albert-Georg Lang. 2009. <span>“Statistical Power Analyses Using <span>G</span>*<span>Power</span> 3.1: <span>Tests</span> for Correlation and Regression Analyses.”</span> <em>Behavior Research Methods</em> 41 (4): 1149–60. <a href="https://doi.org/10.3758/BRM.41.4.1149">https://doi.org/10.3758/BRM.41.4.1149</a>.
</div>
<div class="csl-entry">
Fryda, Tomas, Erin LeDell, Navdeep Gill, Spencer Aiello, Anqi Fu, Arno Candel, Cliff Click, et al. 2014. <span>“H2o: <span>R Interface</span> for the ’<span>H2O</span>’ <span>Scalable Machine Learning Platform</span>.”</span> Comprehensive R Archive Network. <a href="https://doi.org/10.32614/CRAN.package.h2o">https://doi.org/10.32614/CRAN.package.h2o</a>.
</div>
<div class="csl-entry">
Gelman, Andrew, John B. Carlin, Hal S. Stern, David B. Dunson, Aki Vehtari, and Donald B. Rubin. 2013. <em>Bayesian <span>Data Analysis</span></em>. 0th ed. <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/b16018">https://doi.org/10.1201/b16018</a>.
</div>
<div class="csl-entry">
Good, Phillip. 2013. <em>Permutation Tests: A Practical Guide to Resampling Methods for Testing Hypotheses</em>. Springer Science &amp; Business Media.
</div>
<div class="csl-entry">
Hunter, Kristen B., Luke Miratrix, and Kristin Porter. 2024. <span>“PUMP: Estimating Power, Minimum Detectable Effect Size, and Sample Size When Adjusting for Multiple Outcomes in Multi-Level Experiments.”</span> <em>Journal of Statistical Software</em> 108 (6): 1–43. <a href="https://doi.org/10.18637/jss.v108.i06">https://doi.org/10.18637/jss.v108.i06</a>.
</div>
<div class="csl-entry">
James, G. S. 1951. <span>“The Comparison of Several Groups of Observations When the Ratios of the Population Variances Are Unknown.”</span> <em>Biometrika</em> 38 (3/4): 324. <a href="https://doi.org/10.2307/2332578">https://doi.org/10.2307/2332578</a>.
</div>
<div class="csl-entry">
Jones, Owen, Robert Maillardet, and Andrew Robinson. 2012. <em>Introduction to <span>Scientific Programming</span> and <span>Simulation Using R</span></em>. New York: <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9781420068740">https://doi.org/10.1201/9781420068740</a>.
</div>
<div class="csl-entry">
Lehmann, Erich Leo et al. 1975. <span>“Statistical Methods Based on Ranks.”</span> <em>Nonparametrics. San Francisco, CA, Holden-Day</em> 2.
</div>
<div class="csl-entry">
Long, J. Scott, and Laurie H. Ervin. 2000. <span>“Using Heteroscedasticity Consistent Standard Errors in the Linear Regression Model.”</span> <em>The American Statistician</em> 54 (3): 217–24. <a href="https://doi.org/10.1080/00031305.2000.10474549">https://doi.org/10.1080/00031305.2000.10474549</a>.
</div>
<div class="csl-entry">
Mehrotra, Devan V. 1997. <span>“Improving the Brown-Forsythe Solution to the Generalized Behrens-Fisher Problem.”</span> <em>Communications in Statistics - Simulation and Computation</em> 26 (3): 1139–45. <a href="https://doi.org/10.1080/03610919708813431">https://doi.org/10.1080/03610919708813431</a>.
</div>
<div class="csl-entry">
Miratrix, Luke W., Michael J. Weiss, and Brit Henderson. 2021. <span>“An <span>Applied Researcher</span>’s <span>Guide</span> to <span>Estimating Effects</span> from <span>Multisite Individually Randomized Trials</span>: <span>Estimands</span>, <span>Estimators</span>, and <span>Estimates</span>.”</span> <em>Journal of Research on Educational Effectiveness</em> 14 (1): 270–308. <a href="https://doi.org/10.1080/19345747.2020.1831115">https://doi.org/10.1080/19345747.2020.1831115</a>.
</div>
<div class="csl-entry">
Morris, Tim P., Ian R. White, and Michael J. Crowther. 2019. <span>“Using Simulation Studies to Evaluate Statistical Methods.”</span> <em>Statistics in Medicine</em>, January. <a href="https://doi.org/10.1002/sim.8086">https://doi.org/10.1002/sim.8086</a>.
</div>
<div class="csl-entry">
Robert, Christian, and George Casella. 2010. <em>Introducing <span>Monte Carlo Methods</span> with <span>R</span></em>. New York, NY: Springer. <a href="https://doi.org/10.1007/978-1-4419-1576-4">https://doi.org/10.1007/978-1-4419-1576-4</a>.
</div>
<div class="csl-entry">
Siepe, Björn S., František Bartoš, Tim Morris, Anne-Laure Boulesteix, Daniel W. Heck, and Samuel Pawel. 2024. <span>“Simulation Studies for Methodological Research in Psychology: A Standardized Template for Planning, Preregistration, and Reporting,”</span> January. <a href="https://doi.org/10.31234/osf.io/ufgy6">https://doi.org/10.31234/osf.io/ufgy6</a>.
</div>
<div class="csl-entry">
Staiger, Douglas O, and Jonah E Rockoff. 2010. <span>“Searching for Effective Teachers with Imperfect Information.”</span> <em>Journal of Economic Perspectives</em> 24 (3): 97–118.
</div>
<div class="csl-entry">
Tipton, Elizabeth. 2013. <span>“Stratified Sampling Using Cluster Analysis: A Sample Selection Strategy for Improved Generalizations from Experiments.”</span> <em>Evaluation Review</em> 37 (2): 109–39. <a href="https://doi.org/10.1177/0193841X13516324">https://doi.org/10.1177/0193841X13516324</a>.
</div>
<div class="csl-entry">
Vevea, Jack L, and Larry V Hedges. 1995. <span>“A General Linear Model for Estimating Effect Size in the Presence of Publication Bias.”</span> <em>Psychometrika</em> 60 (3): 419–35. <a href="https://doi.org/10.1007/BF02294384">https://doi.org/10.1007/BF02294384</a>.
</div>
<div class="csl-entry">
Welch, B. L. 1951. <span>“On the Comparison of Several Mean Values: <span>An</span> Alternative Approach.”</span> <em>Biometrika</em> 38 (3/4): 330. <a href="https://doi.org/10.2307/2332579">https://doi.org/10.2307/2332579</a>.
</div>
<div class="csl-entry">
White, Halbert. 1980. <span>“A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity.”</span> <em>Econometrica</em> 48 (4): 817–38.
</div>
<div class="csl-entry">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</div>
</div>



























            </section>

          </div>
        </div>
      </div>
<a href="data-analysis-procedures.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/035-running-simulation.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
