<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Building good vizualizations | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Building good vizualizations | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Building good vizualizations | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-06-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="presenting-multifactor-simulation-results.html"/>
<link rel="next" href="special-topics-on-reporting-simulation-results.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-data-generating-model"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-Generating Processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-statistical-model-is-a-recipe-for-data-generation"><i class="fa fa-check"></i><b>6.1</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>6.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.3</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.3.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.3.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.3.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#converting-our-model-to-code"><i class="fa fa-check"></i><b>6.3.3</b> Converting our model to code</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster-stand"><i class="fa fa-check"></i><b>6.4</b> Extension: Standardization in a data generating process</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ex_dgp"><i class="fa fa-check"></i><b>6.5.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.5.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#checking-and-extending-the-cluster-rct-dgp"><i class="fa fa-check"></i><b>6.5.2</b> Checking and extending the Cluster RCT DGP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-estimation-procedures"><i class="fa fa-check"></i><b>7.1</b> Validating Estimation Procedures</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-via-simulation"><i class="fa fa-check"></i><b>7.2</b> Checking via simulation</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#including-multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.3</b> Including Multiple estimation procedures</a></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#more-welch-and-adding-the-bff-test"><i class="fa fa-check"></i><b>7.4.1</b> More Welch and adding the BFF test</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#more-estimators-for-cluster-randomized-trials"><i class="fa fa-check"></i><b>7.4.2</b> More estimators for Cluster Randomized Trials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#writing-simulations-quick-with-the-simhelpers-package"><i class="fa fa-check"></i><b>8.1</b> Writing simulations quick with the simhelpers package</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#adding-checks-and-balances"><i class="fa fa-check"></i><b>8.2</b> Adding Checks and Balances</a></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance criteria</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#different-kinds-of-performance"><i class="fa fa-check"></i><b>9.1</b> Different kinds of performance</a></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-point-estimator"><i class="fa fa-check"></i><b>9.2</b> Assessing a Point Estimator</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#comparing-the-performances-of-the-cluster-rct-estimation-procedures"><i class="fa fa-check"></i><b>9.2.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#estimands-not-represented-by-a-parameter"><i class="fa fa-check"></i><b>9.2.2</b> Estimands Not Represented By a Parameter</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-a-standard-error-estimator"><i class="fa fa-check"></i><b>9.3</b> Assessing a Standard Error Estimator</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#why-not-assess-the-estimated-se-directly"><i class="fa fa-check"></i><b>9.3.1</b> Why Not Assess the Estimated SE directly?</a></li>
<li class="chapter" data-level="9.3.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.2</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-an-inferential-procedure-hypothesis-testing"><i class="fa fa-check"></i><b>9.4</b> Assessing an Inferential Procedure (Hypothesis Testing)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>9.5</b> Assessing Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.5.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#additional-thoughts-on-measuring-performance"><i class="fa fa-check"></i><b>9.6</b> Additional Thoughts on Measuring Performance</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.6.1</b> Selecting Relative vs. Absolute Criteria</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#robust-measures-of-performance"><i class="fa fa-check"></i><b>9.6.2</b> Robust Measures of Performance</a></li>
<li class="chapter" data-level="9.6.3" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6.3</b> Summary of Peformance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#uncertainty-in-performance-estimates-the-monte-carlo-standard-error"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="case_Cronbach.html"><a href="case_Cronbach.html"><i class="fa fa-check"></i><b>10</b> Project: Cronbach Alpha</a>
<ul>
<li class="chapter" data-level="10.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#background"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="case_Cronbach.html"><a href="case_Cronbach.html#getting-started"><i class="fa fa-check"></i><b>10.2</b> Getting started</a></li>
<li class="chapter" data-level="10.3" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-data-generating-function"><i class="fa fa-check"></i><b>10.3</b> The data-generating function</a></li>
<li class="chapter" data-level="10.4" data-path="case_Cronbach.html"><a href="case_Cronbach.html#the-estimation-function"><i class="fa fa-check"></i><b>10.4</b> The estimation function</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-naive-confidence-intervals"><i class="fa fa-check"></i><b>10.4.1</b> Exercises (Naive confidence intervals)</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="case_Cronbach.html"><a href="case_Cronbach.html#estimator-performance"><i class="fa fa-check"></i><b>10.5</b> Estimator performance</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-calculating-performance"><i class="fa fa-check"></i><b>10.5.1</b> Exercises (Calculating Performance)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="case_Cronbach.html"><a href="case_Cronbach.html#replication-and-the-simulation"><i class="fa fa-check"></i><b>10.6</b> Replication (and the simulation)</a></li>
<li class="chapter" data-level="10.7" data-path="case_Cronbach.html"><a href="case_Cronbach.html#extension-confidence-interval-coverage"><i class="fa fa-check"></i><b>10.7</b> Extension: Confidence interval coverage</a></li>
<li class="chapter" data-level="10.8" data-path="case_Cronbach.html"><a href="case_Cronbach.html#a-taste-of-multiple-scenarios"><i class="fa fa-check"></i><b>10.8</b> A taste of multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="case_Cronbach.html"><a href="case_Cronbach.html#exercises-7"><i class="fa fa-check"></i><b>10.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="11" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>11</b> Designing the multifactor simulation experiment</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.1.1</b> Choosing parameters for the Clustered RCT</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>11.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="11.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics-when-running-multiple-simulations"><i class="fa fa-check"></i><b>11.3</b> When to calculate performance metrics when running multiple simulations</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>11.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="11.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>11.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="11.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>11.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="exp-design.html"><a href="exp-design.html#running-the-cluster-rct-multifactor-experiment"><i class="fa fa-check"></i><b>11.4</b> Running the Cluster RCT multifactor experiment</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="exp-design.html"><a href="exp-design.html#making-analyze_data-quiet"><i class="fa fa-check"></i><b>11.4.1</b> Making analyze_data() quiet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html"><i class="fa fa-check"></i><b>12</b> Presenting multifactor simulation results</a>
<ul>
<li class="chapter" data-level="12.1" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>12.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>12.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#visualization"><i class="fa fa-check"></i><b>12.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>12.2.1</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="12.2.2" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>12.2.2</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="12.2.3" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>12.2.3</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="12.2.4" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>12.2.4</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#modeling"><i class="fa fa-check"></i><b>12.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>12.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="12.3.2" data-path="presenting-multifactor-simulation-results.html"><a href="presenting-multifactor-simulation-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>12.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html"><i class="fa fa-check"></i><b>13</b> Building good vizualizations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>13.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="13.2" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#bundling"><i class="fa fa-check"></i><b>13.2</b> Bundling</a></li>
<li class="chapter" data-level="13.3" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#aggregation"><i class="fa fa-check"></i><b>13.3</b> Aggregation</a></li>
<li class="chapter" data-level="13.4" data-path="building-good-vizualizations.html"><a href="building-good-vizualizations.html#exercises-8"><i class="fa fa-check"></i><b>13.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>14.1</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>14.1.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-when-some-trials-have-failed"><i class="fa fa-check"></i><b>14.2</b> Analyzing results when some trials have failed</a></li>
<li class="chapter" data-level="14.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#more-on-modeling"><i class="fa fa-check"></i><b>14.3</b> More on modeling</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>14.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="14.3.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-estimators-of-treatment-variation-revisited"><i class="fa fa-check"></i><b>14.3.2</b> Example 2: Estimators of treatment variation, revisited</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>15</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="15.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-generating-process"><i class="fa fa-check"></i><b>15.1</b> The data generating process</a></li>
<li class="chapter" data-level="15.2" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-data-analysis-methods"><i class="fa fa-check"></i><b>15.2</b> The data analysis methods</a></li>
<li class="chapter" data-level="15.3" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#the-simulation-itself"><i class="fa fa-check"></i><b>15.3</b> The simulation itself</a></li>
<li class="chapter" data-level="15.4" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#calculating-performance-measures-for-all-our-estimators"><i class="fa fa-check"></i><b>15.4</b> Calculating performance measures for all our estimators</a></li>
<li class="chapter" data-level="15.5" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#improving-the-visualization-of-the-results"><i class="fa fa-check"></i><b>15.5</b> Improving the visualization of the results</a></li>
<li class="chapter" data-level="15.6" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>15.6</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="part"><span><b>IV Common Challenges with Large-Scale Simulations</b></span></li>
<li class="chapter" data-level="16" data-path="sec-reproducability.html"><a href="sec-reproducability.html"><i class="fa fa-check"></i><b>16</b> Ensuring reproducibility</a>
<ul>
<li class="chapter" data-level="16.1" data-path="sec-reproducability.html"><a href="sec-reproducability.html#seeds-and-pseudo-random-number-generators"><i class="fa fa-check"></i><b>16.1</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="16.2" data-path="sec-reproducability.html"><a href="sec-reproducability.html#including-seed-in-our-simulation-driver"><i class="fa fa-check"></i><b>16.2</b> Including seed in our simulation driver</a></li>
<li class="chapter" data-level="16.3" data-path="sec-reproducability.html"><a href="sec-reproducability.html#reasons-for-setting-the-seed"><i class="fa fa-check"></i><b>16.3</b> Reasons for setting the seed</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="optimize-code.html"><a href="optimize-code.html"><i class="fa fa-check"></i><b>17</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="17.1" data-path="optimize-code.html"><a href="optimize-code.html#hand-building-functions"><i class="fa fa-check"></i><b>17.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="17.2" data-path="optimize-code.html"><a href="optimize-code.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>17.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="17.3" data-path="optimize-code.html"><a href="optimize-code.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>17.3</b> Reusing code to speed up computation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html"><i class="fa fa-check"></i><b>18</b> Error trapping and other headaches</a>
<ul>
<li class="chapter" data-level="18.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#safe_code"><i class="fa fa-check"></i><b>18.1</b> Safe code</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#making-a-safe-function-call"><i class="fa fa-check"></i><b>18.1.1</b> Making a safe function call</a></li>
<li class="chapter" data-level="18.1.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>18.1.2</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="error-trapping-and-other-headaches.html"><a href="error-trapping-and-other-headaches.html#about-stopifnot"><i class="fa fa-check"></i><b>18.2</b> Protecting your functions with “stop”</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="saving-files.html"><a href="saving-files.html"><i class="fa fa-check"></i><b>19</b> Saving files and results</a>
<ul>
<li class="chapter" data-level="19.1" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>19.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="19.2" data-path="saving-files.html"><a href="saving-files.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>19.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="19.3" data-path="saving-files.html"><a href="saving-files.html#dynamically-making-directories"><i class="fa fa-check"></i><b>19.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="19.4" data-path="saving-files.html"><a href="saving-files.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>19.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>20</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="20.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>20.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="20.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-off-your-computer"><i class="fa fa-check"></i><b>20.2</b> Parallel off your computer</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>20.2.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="20.2.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>20.2.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="20.2.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>20.2.3</b> Checking on a job</a></li>
<li class="chapter" data-level="20.2.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>20.2.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="20.2.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>20.2.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="20.2.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>20.2.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>21</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="21.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>21.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>21.1.1</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="21.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>21.1.2</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="21.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>21.1.3</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="21.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>21.1.4</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="21.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>21.1.5</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Specialized Use-Cases</b></span></li>
<li class="chapter" data-level="22" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html"><i class="fa fa-check"></i><b>22</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="22.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>22.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="22.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#the-data-generating-process-1"><i class="fa fa-check"></i><b>22.2</b> The data generating process</a></li>
<li class="chapter" data-level="22.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#running-the-simulation-1"><i class="fa fa-check"></i><b>22.3</b> Running the simulation</a></li>
<li class="chapter" data-level="22.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#evaluating-power"><i class="fa fa-check"></i><b>22.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>22.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="22.4.2" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-precision-se"><i class="fa fa-check"></i><b>22.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="22.4.3" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-power"><i class="fa fa-check"></i><b>22.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="22.4.4" data-path="using-simulation-as-a-power-calculator.html"><a href="using-simulation-as-a-power-calculator.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>22.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>23</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="23.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>23.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="23.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>23.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="23.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>23.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="23.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>23.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>24</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="24.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>24.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding tidbits</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#testing-and-debugging-code-in-your-scripts"><i class="fa fa-check"></i><b>A.3</b> Testing and debugging code in your scripts</a></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-source-command-and-keeping-things-organized"><i class="fa fa-check"></i><b>A.4</b> The source command and keeping things organized</a></li>
<li class="chapter" data-level="A.5" data-path="coding-tidbits.html"><a href="coding-tidbits.html#debugging-with-browser"><i class="fa fa-check"></i><b>A.5</b> Debugging with browser</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-good-vizualizations" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> Building good vizualizations<a href="building-good-vizualizations.html#building-good-vizualizations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Visualization should nearly always be the first step in analyzing simulation results.
In the prior chapter, we saw a series of visualizations that showed overall trends across a variety of examples.
Those visualizations are not the initial ones that were created for those research projects.
In practice, making a visualization often requires creating a <em>bunch</em> of graphs to look at different aspects of the data.
From that pile of graphs, you would then refine ones that communicate the overall results most cleanly, and include those in your main write-up.
In our work, we find we often generate a series of R Markdown reports that load the simulation results and generate collections visualizations targeting our various research questions.
These initial documents are then discussed internally by the research team.</p>
<p>In this chapter we dive into how to create visualizations, and discuss a set of common tools that we use to explore our simulation results.
In particular, we focus on four essential tools:</p>
<ol style="list-style-type: decimal">
<li><strong>Subsetting</strong>: Multifactor simulations can be complex and confusing. Sometimes it is easier to first explore a subset of the simulation results, such as a single factor level.</li>
<li><strong>Many small multiples</strong>: plotting all of the results in a single plot, with facets to break up the results by simulation factors.</li>
<li><strong>Bundling</strong>: grouping the results by a primary factor of interest, and then plotting the performance measure as a boxplot so you can see how much variation there is within that factor level.</li>
<li><strong>Aggregation</strong>: averaging the performance measure across some of the simulation factors, so you can see overall trends.</li>
</ol>
<!--These tools are often used in combination.
To get a sense of an overall trend, you can aggregate across factors, averaging your performance metrics and then making line charts or scatterplots.

For all of these plots, if you have a lot of factors, you might also want to use small multiples (faceting) to break up the plots into manageable chunks.
Do this especially if entire sets of simulation results are on radically different scales of performance (e.g., you have a range of outcomes explored, each on a different scale).
You can further use color, shape, and line type to encode different factors.
-->
<p>We next walk through these techniques using our running example of comparing methods for analyzing a Cluster RCT.
We will start with an investigation of bias.</p>
<p>As a reminder, in our Cluster RCT example, we have three methods for estimating the average treatment effect: linear regression of the student-level outcome onto treatment (with cluster-robust standard errors); aggregation, where we regress the cluster-level average outcome onto treatment (with heteroskedastic robust standard errors); and multilevel modeling with random effects.
We want to know if these methods are biased for our defined estimand, which is the cluster-average effect.
We have five simulation factors: school size (<code>n_bar</code>), number of schools (<code>J</code>), the intraclass correlation (<code>ICC</code>), the degree of variation in school size (<code>alpha</code>), and the relationship between school size and treatment effect (<code>size_coef</code>).</p>
<div id="subsetting-and-many-small-multiples" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Subsetting and Many Small Multiples<a href="building-good-vizualizations.html#subsetting-and-many-small-multiples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an initial exploration, you can simply filter the simulation results to a single factor level for some nuisance parameter.
Generally, with small multiples, it is relatively straightforward to look at <em>three simulation factors</em>.
This is because, with a facet grid, you can plot five things easily: two for the facets, one for the x-axis, one for color/line type, and one for the y-axis.
We usually use two of these for method and outcome, giving three factors to explore.</p>
<p>For example, for our simulation, we might examine an ICC of 0.20 only, taking it as a “reasonable” value that, given our substance matter knowledge, we know is frequently found in empirical data.
We migth further pick <span class="math inline">\(n_bar = 80\)</span> so we do not have to worry about it too much.
This leaves three factors, allowing us to plot all of our simulation results.
We the bias as a function of <code>J</code>, with different lines for the different methods, and facets for the different levels of <code>size_coef</code> and <code>alpha</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="building-good-vizualizations.html#cb1-1" tabindex="-1"></a>sres_sub <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="building-good-vizualizations.html#cb1-2" tabindex="-1"></a>  <span class="fu">filter</span>( ICC <span class="sc">==</span> <span class="fl">0.20</span>, n_bar <span class="sc">==</span> <span class="dv">80</span> )</span>
<span id="cb1-3"><a href="building-good-vizualizations.html#cb1-3" tabindex="-1"></a><span class="fu">ggplot</span>( sres_sub, <span class="fu">aes</span>( <span class="fu">as.factor</span>(J), bias, </span>
<span id="cb1-4"><a href="building-good-vizualizations.html#cb1-4" tabindex="-1"></a>                       <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb1-5"><a href="building-good-vizualizations.html#cb1-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> alpha, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb1-6"><a href="building-good-vizualizations.html#cb1-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-7"><a href="building-good-vizualizations.html#cb1-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb1-8"><a href="building-good-vizualizations.html#cb1-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Each point is one of our methods in one of our simulation scenarios.
We are looking at the raw results.
We connect the points with lines to help us see trends within each of the small multiples.
The lines help us visually track which group of points goes with which.</p>
<p>We immediately see that when there is a lot of site variation, and it relates to outcome, linear regression is very different from the other two methods. When there is no variation, or it does not relate to impact, nothing is particularly biased.</p>
<!--Again, we are showing five variables: our facets are organized by two (alpha and the size coefficient), and within each facet we have three (J, our outcome of bias, and the methods themselves).-->
<p>Subsetting is a very useful tool, especially when the scope of the simulation feels overwhelming.
It can also be used as a quick validity check, we can subset to a known context where we know nothing exciting should be happening, and then check that indeed nothing is there.
For example, in our context we might subset to the scenarios with no variation in site size or relationship between size and outcome:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="building-good-vizualizations.html#cb2-1" tabindex="-1"></a>sres_null <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="building-good-vizualizations.html#cb2-2" tabindex="-1"></a>  <span class="fu">filter</span>( size_coef <span class="sc">==</span> <span class="dv">0</span>, alpha <span class="sc">==</span> <span class="dv">0</span> )</span></code></pre></div>
<p>So, for our null check, we have three factors and can plot the them all:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="building-good-vizualizations.html#cb3-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres_null, <span class="fu">aes</span>( ICC, bias, </span>
<span id="cb3-2"><a href="building-good-vizualizations.html#cb3-2" tabindex="-1"></a>                       <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb3-3"><a href="building-good-vizualizations.html#cb3-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>( J <span class="sc">~</span> n_bar, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb3-4"><a href="building-good-vizualizations.html#cb3-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-5"><a href="building-good-vizualizations.html#cb3-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb3-6"><a href="building-good-vizualizations.html#cb3-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>As predicted, nothing is happening.
Interestingly, we see that all methods are identical when there is no site variation, regardless of ICC, J, or <code>n_bar</code>.</p>
<p>Subsetting allows for a deep dive into a specific context.
It also can make it easier to think through what is happening in a complex context.
Sometimes we might even just report a subset in our final analysis.
In this case, we would consider the other levels as a “sensitivity” analysis vaguely alluded to in our main report and placed elsewhere, such as an online supplemental appendix.</p>
<p>It would be our job, in this case, to verify that our reported findings on the main results indeed were echoed in our other, set-aside, simulation runs.
In our case, as we see below, we will see little effect of the ICC on how one model performs relative to another; we thus might be able to safely ignore the ICC factor in our main report.</p>
<p>But if you do want to look at all your simulation results at once, you need to somehow aggregate your results to make them all fit on the plot.
We next present bundling, a way of using the core idea of small multiples for showing all of the raw results, but which does so in a semi-aggregated way.</p>
</div>
<div id="bundling" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Bundling<a href="building-good-vizualizations.html#bundling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When faced with many simulation factors, we can <em>bundle</em> bundle the simulations into groups defined by a selected primary factor of interest, and then plot each bundle with a boxplot of a selected performance criteria.
Each boxplot then shows the central measure of how well an estimator worked across those scenarios, along with a sense of how much that performance varied across those simulations.
If the boxes are narrow, then we know that the variation across simulations within the box did not impact performance much.
If the boxes are wide, then we know that the factors that vary within the box matter a lot for performance.</p>
<p>With bundling, we generally need a good number of simulation runs per scenario, so that the MCSE in the performance measures does not make our boxplots look substantially more variable (wider) than the truth.
(Consider a case where the simulations within a box all would have the same performance, but the MCSE is large; in this case we would see a wide boxplot when we should not.)</p>
<p>To illustrate, group our Cluster RCT results by method, ICC, the size coefficient (how strong the cluster size to treatment impact relationship is), and alpha (how much the cluster sizes vary).
For a specific ICC, size, and alpha, we will put the boxes for the three methods side-by-side to directly compare the methods:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="building-good-vizualizations.html#cb4-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(alpha), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb4-2"><a href="building-good-vizualizations.html#cb4-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> ICC, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb4-3"><a href="building-good-vizualizations.html#cb4-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="building-good-vizualizations.html#cb4-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb4-5"><a href="building-good-vizualizations.html#cb4-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v1-1.png" width="672" /></p>
<p>Each box is a collection of simulation trials. E.g., for <code>ICC = 0.6</code>, <code>size_coef = 0.2</code>, and <code>alpha = 0.8</code> each of the three boxes contains 9 scenarios representing the varying level 1 and level 2 sample sizes.
Here are the 9 for the Aggregation method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="building-good-vizualizations.html#cb5-1" tabindex="-1"></a><span class="fu">filter</span>( sres, </span>
<span id="cb5-2"><a href="building-good-vizualizations.html#cb5-2" tabindex="-1"></a>        ICC <span class="sc">==</span> <span class="fl">0.6</span>, </span>
<span id="cb5-3"><a href="building-good-vizualizations.html#cb5-3" tabindex="-1"></a>        size_coef <span class="sc">==</span> <span class="fl">0.2</span>,</span>
<span id="cb5-4"><a href="building-good-vizualizations.html#cb5-4" tabindex="-1"></a>        alpha <span class="sc">==</span> <span class="fl">0.8</span>, method<span class="sc">==</span><span class="st">&quot;Agg&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="building-good-vizualizations.html#cb5-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( n_bar<span class="sc">:</span>alpha, bias ) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="building-good-vizualizations.html#cb5-6" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>( <span class="at">digits =</span> <span class="dv">2</span> )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">n_bar</th>
<th align="right">J</th>
<th align="right">ATE</th>
<th align="right">size_coef</th>
<th align="right">ICC</th>
<th align="right">alpha</th>
<th align="right">bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">20</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.02</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">-0.01</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">-0.02</td>
</tr>
<tr class="odd">
<td align="right">80</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.02</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">320</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="right">320</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
<tr class="odd">
<td align="right">320</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
</tbody>
</table>
<p>Our bias boxplot makes some trends clear.
For example, we see that there is virtually no bias for any method when the size coefficient is 0 and the ICC is 0.
It is a bit more unclear, but it seems there is also virtually no bias when the size coefficient is 0 regardless of ICC, but the boxes get wider as ICC increases, making us wonder if something else is potentially going on.
When alpha is 0 and the size coefficient is 0.2, all methods have a negative bias for most scenarios considered, as all boxes and almost all of the whiskers are below the 0 line (when ICC is 0.6 or 0.8 we may have some instances of 0 or positive bias, if that is not MCSE giving long tails).</p>
<p>The apparent outliers (long tails) for some of the boxplots suggest that the other two factors (cluster size and number of clusters) do relate to the degree of bias. We could try bundling along different aspects to see if that explains these differences:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="building-good-vizualizations.html#cb6-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(n_bar), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(n_bar,method) ) ) <span class="sc">+</span></span>
<span id="cb6-2"><a href="building-good-vizualizations.html#cb6-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb6-3"><a href="building-good-vizualizations.html#cb6-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="building-good-vizualizations.html#cb6-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb6-5"><a href="building-good-vizualizations.html#cb6-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v2-1.png" width="672" /></p>
<p>No progress there; we have long tails suggesting something is allowing for large bias in some contexts.
This could be MCSE, with some of our bias estimates being large due to random chance.
Or it could be some specific combination of factors allows for large bias (e.g., perhaps small sample sizes makes our estimators more vulnerable to bias).
In an actual analysis, we would make a note to investigate these anomalies a bit further, later on.</p>
<p>In general, playing around with factors so that the boxes are generally narrow is a good idea; it means that you have found a representation of the data where the variation within your bundles is less important.
This might not always be possible, if all your factors matter; in this case the width of your boxes tells you to what extent the bundled factors matter relative to the factors explicitly present in your plot.</p>
</div>
<div id="aggregation" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Aggregation<a href="building-good-vizualizations.html#aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Boxplots can make seeing trends more difficult, as the eye is drawn to the boxes and tails, and the range of your plot axes can be large due to needing to accommodate the full tails and outliers of your results; this can compress the mean differences between groups, making them look small.
Instead of bundling, we can therefore aggregate, where we average all the scenarios within a box to get a single number of average performance.
This will show us overall trends rather than individual simulation variation.</p>
<p>When we aggregate, and average over some of the factors, we collapse our simulation results down to fewer moving parts.
Aggregation across factors is better than having not had those factors in the first place!
A performance measure averaged over a factor is a more general answer of how things work in practice than having not varied the factor at all.</p>
<p>For example, if we average across ICC and site variation, and see that our methods had different degrees of bias as a function of <span class="math inline">\(J\)</span>, we would know that the found trend is a general trend across a range of scenarios defined by different ICC and site variation levels, rather than a specific one tied to a single ICC and amount of site variation.
Our conclusions would then be more general: if we had not explored more scenarios, we would not have any sense of how general our found trend might be.</p>
<p>That said, if some of our scenarios had no bias, and some had large bias, when we aggregated we would report that there is generally a moderate amount of bias.
This would not be entirely faithful to the actual results.
If, however, the initial boxplots show ranges generally positive or generally negative, then aggregation will be more faithful to the spirit of the results.</p>
<p>Also, aggregated results can be misleading if you have scaling issues or extreme outliers.
With bias, our scale is fairly well set, so we are good.
But if we were aggregating standard errors over different sample sizes, then the larger standard errors of the smaller sample size simulations (and the greater variability in estimating those standard errors) would swamp the standard errors of the larger sample sizes.
Usually, with aggregation, we want to average over something we believe does not change massively over the marginalized-out factors.
To achieve this, we can often average over a relative measure (such as standard error divided by the standard error of some baseline method), which tend to be more invariant and comparable across scenarios.</p>
<p>A major advantage of aggregation over the bundling approach is we can have a smaller number of replications per factor combination with aggregation.
If the number of replicates within each scenario is small, then the performance measures for each scenario is estimated with a lot of error; the aggregate, by contrast, will be an average across many more replicates and thus give a good sense of <em>average</em> performance.
The averaging, in effect, gives a lot more replications per aggregated performance measure.</p>
<p>For our cluster RCT, we might aggregate our bias across our sample sizes as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="building-good-vizualizations.html#cb7-1" tabindex="-1"></a>ssres <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="building-good-vizualizations.html#cb7-2" tabindex="-1"></a>  sres <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="building-good-vizualizations.html#cb7-3" tabindex="-1"></a>  <span class="fu">group_by</span>( method, ICC, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="building-good-vizualizations.html#cb7-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">bias =</span> <span class="fu">mean</span>( bias ),</span>
<span id="cb7-5"><a href="building-good-vizualizations.html#cb7-5" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">n</span>() )</span>
<span id="cb7-6"><a href="building-good-vizualizations.html#cb7-6" tabindex="-1"></a>ssres</span></code></pre></div>
<pre><code>## # A tibble: 90 × 6
## # Groups:   method, ICC, alpha [45]
##    method   ICC alpha size_coef      bias     n
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Agg      0     0         0    0.00170      9
##  2 Agg      0     0         0.2  0.000307     9
##  3 Agg      0     0.5       0    0.000329     9
##  4 Agg      0     0.5       0.2  0.000240     9
##  5 Agg      0     0.8       0    0.000470     9
##  6 Agg      0     0.8       0.2 -0.000440     9
##  7 Agg      0.2   0         0   -0.00585      9
##  8 Agg      0.2   0         0.2 -0.00181      9
##  9 Agg      0.2   0.5       0   -0.00141      9
## 10 Agg      0.2   0.5       0.2 -0.00226      9
## # ℹ 80 more rows</code></pre>
<p>We now have a single bias estimate for each combination of ICC, alpha, and size_coef; we have collapsed 9 scenarios into one overall scenario that generalizes bias across different sizes of experiment.
We can then plot, using many small multiples:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="building-good-vizualizations.html#cb9-1" tabindex="-1"></a><span class="fu">ggplot</span>( ssres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb9-2"><a href="building-good-vizualizations.html#cb9-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span>  alpha, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb9-3"><a href="building-good-vizualizations.html#cb9-3" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="building-good-vizualizations.html#cb9-4" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span></span>
<span id="cb9-5"><a href="building-good-vizualizations.html#cb9-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb9-6"><a href="building-good-vizualizations.html#cb9-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>We see more clearly that greater variation in cluster size (alpha) leads to greater bias for the linear regression estimator, but only if the coefficient for size is nonzero (which makes sense given our theoretical understanding of the problem—if size is not related to treatment effect, it is hard to imagine how varying cluster sizes would cause much bias).
We are looking at an interaction between our simulation factors: we only see bias for linear regression when cluster size relates to impact and there is variation in cluster size.
As ICC increases, we are not seeing any major differences in the pattern of our results
We also see that all the estimators have near zero bias when there is no variation in cluster size, with the overplotted lines on the top row of the figure.</p>
<p>If you have many levels of a factor, as we do with ICC, you can let ggplot aggregate directly by taking advantage of the smoothing options:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="building-good-vizualizations.html#cb10-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb10-2"><a href="building-good-vizualizations.html#cb10-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb10-3"><a href="building-good-vizualizations.html#cb10-3" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.15</span>,</span>
<span id="cb10-4"><a href="building-good-vizualizations.html#cb10-4" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.04</span>) ) <span class="sc">+</span></span>
<span id="cb10-5"><a href="building-good-vizualizations.html#cb10-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se=</span><span class="cn">FALSE</span> ) <span class="sc">+</span> </span>
<span id="cb10-6"><a href="building-good-vizualizations.html#cb10-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb10-7"><a href="building-good-vizualizations.html#cb10-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>In the above, we let the original points show faintly as well, to give a sense of the variation across simulation trials.</p>
<div id="a-note-on-how-to-aggregate" class="section level4 hasAnchor" number="13.3.0.1">
<h4><span class="header-section-number">13.3.0.1</span> A note on how to aggregate<a href="building-good-vizualizations.html#a-note-on-how-to-aggregate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Some performance measures are biased with respect to the Monte Carlo uncertainty.
The estimated standard error, for example, is biased; the variance, by contrast, is not.
The RMSE is biased, the MSE is not.</p>
<p>When aggregating, therefore, it is often best to aggregate the unbiased performance measures, and then calculate the biased ones from those.
For example, to estimate aggregated standard error you might do the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="building-good-vizualizations.html#cb12-1" tabindex="-1"></a>agg_perf <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="building-good-vizualizations.html#cb12-2" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, method, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="building-good-vizualizations.html#cb12-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">SE =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( SE<span class="sc">^</span><span class="dv">2</span> ) ) )</span></code></pre></div>
<p>Because bias is linear, you do not need to worry about the bias of the standard error.
But if you are looking at the magnitude of bias (<span class="math inline">\(|bias|\)</span>), then you can run into issues when the biases are close to zero, if they are measured noisily.
In this case, looking at average bias, not <span class="math inline">\(|bias|\)</span>, is safer.</p>
<!--
## Regression Summarization

One can treat the simulation results as a dataset in its own right.
In this case we can regress a performance measure against the methods and various factor levels to get "main effects" of how the different levels impact performance, holding the other levels constant.
This type of regression is called a "meta regression" (@kleijnen1981regression,@friedman1988metamodel,@gilbert2024multilevel), as we are regressing on already processed results.
It also has ties to meta analysis (see, e.g., @borenstein2021introduction), where we look for trends across sets of experiments.

In a meta regression, the main effect estimated for each method will tell us if a method is, on average, higher or lower than the baseline method, averaging across all the simulation scenarios.
The main effect of the factors will tell us if that factor impacts the performance measure.

These regressions can also include interactions between method and factor, to see if some factors impact different methods differently.
They can also include interactions between factors, which allows us to explore how the impact of a factor can matter more or less, depending on other aspects of the context.

For our cluster RCT, we might have, for example:


``` r
# Make our simulation factors factors rather tha numeric values
sres_f = sres %>%
  mutate( across( c( n_bar, J, size_coef, ICC, alpha ), factor ) )

# Run the regression
M <- lm( bias ~ (n_bar + J + size_coef + ICC + alpha) * method, 
         data = sres_f )

# View the results
stargazer::stargazer(M, type = "text",
                     single.row = TRUE )
```

```
## 
## ==================================================
##                            Dependent variable:    
##                        ---------------------------
##                                   bias            
## --------------------------------------------------
## n_bar80                      -0.003 (0.002)       
## n_bar320                     -0.001 (0.002)       
## J20                          -0.002 (0.002)       
## J80                          -0.002 (0.002)       
## size_coef0.2                  0.003 (0.002)       
## ICC0.2                       -0.001 (0.003)       
## ICC0.4                        0.002 (0.003)       
## ICC0.6                        0.001 (0.003)       
## ICC0.8                       -0.0004 (0.003)      
## alpha0.5                     -0.002 (0.002)       
## alpha0.8                      0.001 (0.002)       
## methodLR                    -0.011*** (0.004)     
## methodMLM                     0.003 (0.004)       
## n_bar80:methodLR             0.0001 (0.003)       
## n_bar320:methodLR           -0.00001 (0.003)      
## n_bar80:methodMLM            -0.0005 (0.003)      
## n_bar320:methodMLM           -0.001 (0.003)       
## J20:methodLR                 0.005* (0.003)       
## J80:methodLR                 0.006* (0.003)       
## J20:methodMLM                 0.001 (0.003)       
## J80:methodMLM                 0.001 (0.003)       
## size_coef0.2:methodLR       0.016*** (0.002)      
## size_coef0.2:methodMLM        0.003 (0.002)       
## ICC0.2:methodLR              -0.0003 (0.004)      
## ICC0.4:methodLR              -0.0001 (0.004)      
## ICC0.6:methodLR              0.0005 (0.004)       
## ICC0.8:methodLR              -0.001 (0.004)       
## ICC0.2:methodMLM             -0.005 (0.004)       
## ICC0.4:methodMLM             -0.006 (0.004)       
## ICC0.6:methodMLM             -0.006 (0.004)       
## ICC0.8:methodMLM             -0.006 (0.004)       
## alpha0.5:methodLR            0.006** (0.003)      
## alpha0.8:methodLR           0.017*** (0.003)      
## alpha0.5:methodMLM            0.001 (0.003)       
## alpha0.8:methodMLM            0.003 (0.003)       
## Constant                      0.002 (0.003)       
## --------------------------------------------------
## Observations                       810            
## R2                                0.280           
## Adjusted R2                       0.248           
## Residual Std. Error         0.014 (df = 774)      
## F Statistic              8.616*** (df = 35; 774)  
## ==================================================
## Note:                  *p<0.1; **p<0.05; ***p<0.01
```

We can quickly get a lot of features, making a meta-regression somewhat hard to interpret.
This one does not even have interactions of the simulation factors--which, given the found interactions from our plots, is a major concern!
That said, picking out the significant coefficients is a quick way to obtain a lot of clues as to what is driving performance.
E.g., some features interact with the LR method for bias.
The other two methods seem less impacted.
-->
</div>
</div>
<div id="exercises-8" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Exercises<a href="building-good-vizualizations.html#exercises-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>For our cluster RCT, use the simulation results to assess how much better (or worse) the different methods are to each other in terms of confidence interval coverage. What scenarios tend to result in the worst coverage?</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="presenting-multifactor-simulation-results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="special-topics-on-reporting-simulation-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/074-building-good-vizualizations.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
