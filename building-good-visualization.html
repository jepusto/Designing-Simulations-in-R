<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Building good visualizations | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Building good visualizations | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Building good visualizations | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-10-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="presentation-of-results.html"/>
<link rel="next" href="special-topics-on-reporting-simulation-results.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-alphas"><i class="fa fa-check"></i><b>5.5.1</b> Other <span class="math inline">\(\alpha\)</span>’s</a></li>
<li class="chapter" data-level="5.5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-compare-results"><i class="fa fa-check"></i><b>5.5.2</b> Compare results</a></li>
<li class="chapter" data-level="5.5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-power"><i class="fa fa-check"></i><b>5.5.3</b> Power</a></li>
<li class="chapter" data-level="5.5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-wide-long"><i class="fa fa-check"></i><b>5.5.4</b> Wide or long?</a></li>
<li class="chapter" data-level="5.5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-tests"><i class="fa fa-check"></i><b>5.5.5</b> Other tests</a></li>
<li class="chapter" data-level="5.5.6" data-path="case-ANOVA.html"><a href="case-ANOVA.html#methodological-extensions"><i class="fa fa-check"></i><b>5.5.6</b> Methodological extensions</a></li>
<li class="chapter" data-level="5.5.7" data-path="case-ANOVA.html"><a href="case-ANOVA.html#power-analysis"><i class="fa fa-check"></i><b>5.5.7</b> Power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance metrics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Metrics for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-criteria.html"><a href="performance-criteria.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performance of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-criteria.html"><a href="performance-criteria.html#less-conventional-performance-metrics"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-standard-error-estimators"><i class="fa fa-check"></i><b>9.2</b> Metrics for Standard Error Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#satterthwaite-degrees-of-freedom"><i class="fa fa-check"></i><b>9.2.1</b> Satterthwaite degrees of freedom</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.2</b> Assessing SEs for the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Metrics for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Metrics for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Selecting Relative vs. Absolute Metrics</a></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#implicit-estimands"><i class="fa fa-check"></i><b>9.6</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#MCSE"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.8</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.9</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.10" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="performance-criteria.html"><a href="performance-criteria.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.10.1</b> Brown and Forsythe (1974)</a></li>
<li class="chapter" data-level="9.10.2" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-t-confidence-intervals"><i class="fa fa-check"></i><b>9.10.2</b> Better confidence intervals</a></li>
<li class="chapter" data-level="9.10.3" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-rct-simulation-under-a-strong-null-hypothesis"><i class="fa fa-check"></i><b>9.10.3</b> Cluster RCT simulation under a strong null hypothesis</a></li>
<li class="chapter" data-level="9.10.4" data-path="performance-criteria.html"><a href="performance-criteria.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.10.4</b> Jackknife calculation of MCSEs</a></li>
<li class="chapter" data-level="9.10.5" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.10.5</b> Distribution theory for person-level average treatment effects</a></li>
<li class="chapter" data-level="9.10.6" data-path="performance-criteria.html"><a href="performance-criteria.html#multiple-scenario-performance"><i class="fa fa-check"></i><b>9.10.6</b> Multiple scenarios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>10</b> Designing and executing multifactor simulations</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>10.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="10.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.3</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exp-design.html"><a href="exp-design.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="exp-design.html"><a href="exp-design.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>10.5</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>10.5.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="10.5.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>10.5.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="10.5.3" data-path="exp-design.html"><a href="exp-design.html#running-the-simulations"><i class="fa fa-check"></i><b>10.5.3</b> Running the simulations</a></li>
<li class="chapter" data-level="10.5.4" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>10.5.4</b> Calculating performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="exp-design.html"><a href="exp-design.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="exp-design.html"><a href="exp-design.html#brown-and-forsythe-redux"><i class="fa fa-check"></i><b>10.6.1</b> Brown and Forsythe redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="exp-design.html"><a href="exp-design.html#meta-regression"><i class="fa fa-check"></i><b>10.6.2</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.3" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.3</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>11</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="11.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>11.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>11.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>11.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>11.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="11.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="11.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>11.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="11.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>11.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="11.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>11.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>11.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>11.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="11.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>11.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>11.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>12</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>12.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="12.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>12.2</b> Bundling</a></li>
<li class="chapter" data-level="12.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>12.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-true-ses"><i class="fa fa-check"></i><b>12.4</b> Assessing true SEs</a></li>
<li class="chapter" data-level="12.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>12.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="12.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-estimated-ses"><i class="fa fa-check"></i><b>12.6</b> Assessing estimated SEs</a></li>
<li class="chapter" data-level="12.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>12.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="12.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>12.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="12.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>12.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="12.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>12.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="12.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>12.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>13</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="13.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>13.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>13.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="13.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>13.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>13.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="13.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>13.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>13.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>13.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>14.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>15</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="15.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>15.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>15.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="15.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>15.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="15.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>15.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="15.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>15.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="15.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>15.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="15.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>15.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>16</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="16.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>16.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>16.1.1</b> The source command</a></li>
<li class="chapter" data-level="16.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>16.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="16.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>16.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>16.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="16.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>16.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>16.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="16.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>16.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="16.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>16.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="16.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>16.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>17</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="17.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>17.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="17.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>17.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="17.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>17.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>17.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="17.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>17.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="17.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>17.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="17.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>17.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="17.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>17.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="17.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>17.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>18</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>18.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="18.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>18.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="18.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>18.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="18.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>18.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>18.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="19" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>19</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>19.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="19.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>19.2</b> The data generating process</a></li>
<li class="chapter" data-level="19.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>19.3</b> Running the simulation</a></li>
<li class="chapter" data-level="19.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>19.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>19.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="19.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>19.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="19.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>19.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="19.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>19.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>19.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>20</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="20.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>20.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="20.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>20.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="20.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>20.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="20.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>20.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>21</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="21.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>21.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-good-visualization" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> Building good visualizations<a href="building-good-visualization.html#building-good-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Visualization should nearly always be the first step in analyzing simulation results.
In the prior chapter, we saw a series of visualizations that showed overall trends across a variety of examples.
Those visualizations were not the initial ones created for those research projects.
In practice, making a visualization often requires creating a <em>bunch</em> of graphs to look at different aspects of the data.
From that pile of graphs, you would then refine ones that communicate the overall results most cleanly, and include those in your main write-up.</p>
<p>In our work, we find we often generate a series of R Markdown reports with comprehensive simulation results targeting our various research questions.
These initial documents are then discussed internally by the research team.</p>
<p>In this chapter we discuss a set of common tools that we frequently use to explore our simulation results.
In particular, we focus on four essential tools:</p>
<ol style="list-style-type: decimal">
<li><strong>Subsetting</strong>: Multifactor simulations can be complex and confusing. Sometimes it is easier to first explore a subset of the simulation results, such as a single factor level.</li>
<li><strong>Many small multiples</strong>: Plot many results in a single plot, with facets to break up the results by simulation factors.</li>
<li><strong>Bundling</strong>: Group the results by a primary factor of interest, and then plotting the performance measure as a boxplot so you can see how much variation there is within that factor level.</li>
<li><strong>Aggregation</strong>: Average the performance measure across some of the simulation factors, so you can see overall trends.</li>
</ol>
<!--These tools are often used in combination.
To get a sense of an overall trend, you can aggregate across factors, averaging your performance metrics and then making line charts or scatterplots.

For all of these plots, if you have a lot of factors, you might also want to use small multiples (faceting) to break up the plots into manageable chunks.
Do this especially if entire sets of simulation results are on radically different scales of performance (e.g., you have a range of outcomes explored, each on a different scale).
You can further use color, shape, and line type to encode different factors.
-->
<p>To illustrate these tools, we walk through them using our running example of comparing methods for analyzing a Cluster RCT.
We will start with an investigation of bias.</p>
<p>As a reminder, in our Cluster RCT example, we have three methods for estimating the average treatment effect: linear regression of the student-level outcome onto treatment (with cluster-robust standard errors); aggregation, where we regress the cluster-level average outcome onto treatment (with heteroskedastic robust standard errors); and multilevel modeling with random effects.
We want to know if these methods are biased for our defined estimand, which is the cluster-average effect.
We have five simulation factors: school size (<code>n_bar</code>), number of schools (<code>J</code>), the intraclass correlation (<code>ICC</code>), the degree of variation in school size (<code>alpha</code>), and the relationship between school size and treatment effect (<code>size_coef</code>).</p>
<p>Once we go through the core tools, we continue our evaluation of our simulation to show how we can assess various performance metrics of interest (true standard error, RMSE, estimated standard errors, and coverage) using these tools.
We do not dive deeply into validity or power; see Chapter <a href="sec:power.html#sec:power">19</a> for more on these measures.</p>
<div id="subsetting-and-many-small-multiples" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Subsetting and Many Small Multiples<a href="building-good-visualization.html#subsetting-and-many-small-multiples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an initial exploration, you can simply filter the simulation results to a single factor level for some nuisance parameter.
Generally, with small multiples, it is relatively straightforward to look at <em>three simulation factors</em>.
This is because, with a facet grid, you can plot five things easily: two for the facets, one for the x-axis, one for color/line type, and one for the y-axis.
We usually use two of these for method and outcome, giving three factors to explore.</p>
<p>For example, for our simulation, we might examine an ICC of 0.20 only, taking it as a “reasonable” value that, given our substance matter knowledge, we know is frequently found in empirical data.
We might further pick <span class="math inline">\(\bar{n} = 80\)</span>, as our middle level for that factor.
This leaves three factors, allowing us to plot all of our simulation results.
We plot bias as a function of <code>J</code>, with different lines for the different methods, and facets for the different levels of <code>size_coef</code> and <code>alpha</code>.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="building-good-visualization.html#cb374-1" tabindex="-1"></a>sres_sub <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb374-2"><a href="building-good-visualization.html#cb374-2" tabindex="-1"></a>  <span class="fu">filter</span>( ICC <span class="sc">==</span> <span class="fl">0.20</span>, n_bar <span class="sc">==</span> <span class="dv">80</span> )</span>
<span id="cb374-3"><a href="building-good-visualization.html#cb374-3" tabindex="-1"></a><span class="fu">ggplot</span>( sres_sub, <span class="fu">aes</span>( <span class="fu">as.factor</span>(J), bias, </span>
<span id="cb374-4"><a href="building-good-visualization.html#cb374-4" tabindex="-1"></a>                       <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb374-5"><a href="building-good-visualization.html#cb374-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> alpha, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb374-6"><a href="building-good-visualization.html#cb374-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb374-7"><a href="building-good-visualization.html#cb374-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb374-8"><a href="building-good-visualization.html#cb374-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-214-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Each point is one of our methods in one of our simulation scenarios.
We are looking at the raw results.
We connect the points with lines to help us see trends within each of the small multiples.
The lines help us visually track which group of points goes with which.</p>
<p>We immediately see that when there is a lot of site variation, and it relates to outcome, linear regression is very different from the other two methods.
We also see that when <code>alpha</code> is 0 and <code>size_coef</code> is 0, we may also have a negative bias.
Before we get too excited about this surprising result, we calculate MCSEs to see if this is a real effect or just noise:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="building-good-visualization.html#cb375-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres_sub, <span class="fu">aes</span>( <span class="fu">as.factor</span>(J), bias, </span>
<span id="cb375-2"><a href="building-good-visualization.html#cb375-2" tabindex="-1"></a>                       <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb375-3"><a href="building-good-visualization.html#cb375-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> alpha, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb375-4"><a href="building-good-visualization.html#cb375-4" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.3</span>) ) <span class="sc">+</span></span>
<span id="cb375-5"><a href="building-good-visualization.html#cb375-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb375-6"><a href="building-good-visualization.html#cb375-6" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>( <span class="fu">aes</span>( <span class="at">ymin =</span> bias <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>bias_mcse,</span>
<span id="cb375-7"><a href="building-good-visualization.html#cb375-7" tabindex="-1"></a>                      <span class="at">ymax =</span> bias <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>bias_mcse ),</span>
<span id="cb375-8"><a href="building-good-visualization.html#cb375-8" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.3</span>),</span>
<span id="cb375-9"><a href="building-good-visualization.html#cb375-9" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb375-10"><a href="building-good-visualization.html#cb375-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb375-11"><a href="building-good-visualization.html#cb375-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-215-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Our confidence intervals exclude zero!
Our excitement mounts.
We next check all the scenarios with <code>alpha = 0</code>, and <code>size_coef = 0</code> to see if this is a real effect.
We can still plot all our data, as we only have three factors, <code>ICC</code>, <code>J_bar</code>, and <code>n_bar</code>, left to plot.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="building-good-visualization.html#cb376-1" tabindex="-1"></a>null_sub <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb376-2"><a href="building-good-visualization.html#cb376-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( alpha <span class="sc">==</span> <span class="dv">0</span>, size_coef <span class="sc">==</span> <span class="dv">0</span> )</span>
<span id="cb376-3"><a href="building-good-visualization.html#cb376-3" tabindex="-1"></a><span class="fu">ggplot</span>( null_sub, <span class="fu">aes</span>( ICC, bias, </span>
<span id="cb376-4"><a href="building-good-visualization.html#cb376-4" tabindex="-1"></a>                       <span class="at">col=</span>method, <span class="at">pch=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb376-5"><a href="building-good-visualization.html#cb376-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>( J <span class="sc">~</span> n_bar, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb376-6"><a href="building-good-visualization.html#cb376-6" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.03</span>) ) <span class="sc">+</span></span>
<span id="cb376-7"><a href="building-good-visualization.html#cb376-7" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.03</span>) ) <span class="sc">+</span></span>
<span id="cb376-8"><a href="building-good-visualization.html#cb376-8" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>( <span class="fu">aes</span>( <span class="at">ymin =</span> bias <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>bias_mcse,</span>
<span id="cb376-9"><a href="building-good-visualization.html#cb376-9" tabindex="-1"></a>                      <span class="at">ymax =</span> bias <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>bias_mcse ),</span>
<span id="cb376-10"><a href="building-good-visualization.html#cb376-10" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.03</span>),</span>
<span id="cb376-11"><a href="building-good-visualization.html#cb376-11" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb376-12"><a href="building-good-visualization.html#cb376-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb376-13"><a href="building-good-visualization.html#cb376-13" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-216-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>It appears that our <code>ICC=0.20</code> and <code>n_bar=80</code> scenario was just a fluke.
Almost everything else easily covers 0, and we are not seeing any major trends.
Overall we conclude that indeed, when there is no variation, or when the variation does not relate to impact, nothing is particularly biased.
Interestingly, we further see that all methods seem to give identical estimates when there is no site variation, regardless of ICC, J, or <code>n_bar</code> (that is the easiest explanation of all the estimated biases and associated MCSEs being identical).</p>
<!--Again, we are showing five variables: our facets are organized by two (alpha and the size coefficient), and within each facet we have three (J, our outcome of bias, and the methods themselves).-->
<p>Subsetting is a very useful tool, especially when the scope of the simulation feels overwhelming.
And as we just saw, it can also be used as a quick validity check: we can subset to a known context where we know nothing exciting should be happening, and then check that indeed nothing is there.</p>
<p>Subsetting allows for a deep dive into a specific context.
It also can make it easier to think through what is happening in a complex context.
Sometimes we might even just report a subset in our final analysis.
In this case, we would consider the other levels as a “sensitivity” analysis vaguely alluded to in our main report and placed elsewhere, such as an online supplemental appendix.</p>
<p>It would be our job, in this case, to verify that our reported findings on the main results indeed were echoed in our other, set-aside, simulation runs.
In our case, as we see below, we will see little effect of the ICC on how one model performs relative to another; we thus might be able to safely ignore the ICC factor in our main report.</p>
<p>Subsetting is useful, but if you do want to look at all your simulation results at once, you need to somehow aggregate your results to make them all fit on the plot.
We next present bundling, a way of using the core idea of small multiples for showing all of the raw results, but in a semi-aggregated way.</p>
</div>
<div id="bundling" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Bundling<a href="building-good-visualization.html#bundling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When faced with many simulation factors, we can <em>bundle</em> the simulations into groups defined by a selected primary factor of interest, and then plot each bundle with a boxplot of the distribution of a selected performance criteria.
Each boxplot shows the central measure of how well an estimator worked across a set of scenarios, along with a sense of how much that performance varied across those scenarios.
If the boxes are narrow, then we know that the variation across simulations within the box did not impact performance much.
If the boxes are wide, then we know that the factors that vary within the box matter a lot for performance.</p>
<p>With bundling, we generally need a good number of simulation runs per scenario, so that the MCSE in the performance measures does not make our boxplots look substantially more variable (wider) than the truth.
(Consider a case where all the scenarios within a box have zero bias; if MCSE were large, we would see a wide boxplot when we should not.)</p>
<p>To illustrate bundling, we group our Cluster RCT results by method, ICC, the size coefficient (how strong the cluster size to treatment impact relationship is), and alpha (how much the cluster sizes vary).
For a specific ICC, size, and alpha, we will put the boxes for the three methods side-by-side to directly compare them:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="building-good-visualization.html#cb377-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(alpha), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb377-2"><a href="building-good-visualization.html#cb377-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> ICC, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb377-3"><a href="building-good-visualization.html#cb377-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb377-4"><a href="building-good-visualization.html#cb377-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb377-5"><a href="building-good-visualization.html#cb377-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v1-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Each box is a collection of simulation trials. E.g., for <code>ICC = 0.6</code>, <code>size_coef = 0.2</code>, and <code>alpha = 0.8</code> each of the three boxes contains 9 scenarios representing the varying level 1 and level 2 sample sizes.
Here are the 9 for the Aggregation method:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="building-good-visualization.html#cb378-1" tabindex="-1"></a><span class="fu">filter</span>( sres, </span>
<span id="cb378-2"><a href="building-good-visualization.html#cb378-2" tabindex="-1"></a>        ICC <span class="sc">==</span> <span class="fl">0.6</span>, </span>
<span id="cb378-3"><a href="building-good-visualization.html#cb378-3" tabindex="-1"></a>        size_coef <span class="sc">==</span> <span class="fl">0.2</span>,</span>
<span id="cb378-4"><a href="building-good-visualization.html#cb378-4" tabindex="-1"></a>        alpha <span class="sc">==</span> <span class="fl">0.8</span>, method<span class="sc">==</span><span class="st">&quot;Agg&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb378-5"><a href="building-good-visualization.html#cb378-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( n_bar<span class="sc">:</span>alpha, bias ) <span class="sc">%&gt;%</span></span>
<span id="cb378-6"><a href="building-good-visualization.html#cb378-6" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>( <span class="at">digits =</span> <span class="dv">2</span> )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">n_bar</th>
<th align="right">J</th>
<th align="right">ATE</th>
<th align="right">size_coef</th>
<th align="right">ICC</th>
<th align="right">alpha</th>
<th align="right">bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">20</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.02</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">-0.01</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">-0.02</td>
</tr>
<tr class="odd">
<td align="right">80</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.02</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">320</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="right">320</td>
<td align="right">20</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
<tr class="odd">
<td align="right">320</td>
<td align="right">80</td>
<td align="right">0.2</td>
<td align="right">0.2</td>
<td align="right">0.6</td>
<td align="right">0.8</td>
<td align="right">0.01</td>
</tr>
</tbody>
</table>
<p>Our bias boxplot makes some trends clear.
For example, we see that there is virtually no bias for any method when the size coefficient is 0 and the ICC is 0.
It is a bit more unclear, but it seems there is also virtually no bias when the size coefficient is 0 regardless of ICC, but the boxes get wider as ICC increases, making us wonder if something else is potentially going on.
When alpha is 0 and the size coefficient is 0.2, all methods have a negative bias for most scenarios considered, as all boxes and almost all of the whiskers are below the 0 line (when ICC is 0.6 or 0.8 we may have some instances of 0 or positive bias, if that is not MCSE giving long tails).</p>
<p>The apparent outliers (long tails) for some of the boxplots suggest that the other two factors (cluster size and number of clusters) do relate to the degree of bias. We could try bundling along different aspects to see if that explains these differences:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="building-good-visualization.html#cb379-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( <span class="fu">as.factor</span>(n_bar), bias, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>(n_bar,method) ) ) <span class="sc">+</span></span>
<span id="cb379-2"><a href="building-good-visualization.html#cb379-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb379-3"><a href="building-good-visualization.html#cb379-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb379-4"><a href="building-good-visualization.html#cb379-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb379-5"><a href="building-good-visualization.html#cb379-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/clusterRCT_plot_bias_v2-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>No progress there; we have long tails suggesting something is allowing for large bias in some contexts.
This could be MCSE, with some of our bias estimates being large due to random chance.
Or it could be some specific combination of factors allows for large bias (e.g., perhaps small sample sizes makes our estimators more vulnerable to bias).
In an actual analysis, we would make a note to investigate these anomalies later on.</p>
<p>In general, playing around with factors so that the boxes are generally narrow is a good idea; it means that you have found a representation of the data where the variation within your bundles is less important.
This might not always be possible, if all your factors matter; in this case the width of your boxes tells you to what extent the bundled factors matter relative to the factors explicitly present in your plot.</p>
</div>
<div id="aggregation" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Aggregation<a href="building-good-visualization.html#aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Boxplots can make seeing trends more difficult, as the eye is drawn to the boxes and tails, and the range of your plot axes can be large due to needing to accommodate the full tails and outliers of your results; this can compress the mean differences between groups, making them look small.
Instead of bundling, we can therefore aggregate, where we average all the scenarios within a box to get a single number of average performance.
This will show us overall trends rather than individual simulation variation.</p>
<p>When we aggregate, and average over some of the factors, we collapse our simulation results down to fewer moving parts.
Aggregation across factors is better than not having varied those factors in the first place!
A performance measure averaged over a factor is a more general answer of how things work in practice than having not varied the factor at all.</p>
<p>For example, if we average across ICC and site variation, and see that our methods had different degrees of bias as a function of <span class="math inline">\(J\)</span>, we would know that the found trend is a general trend across a range of scenarios defined by different ICC and site variation levels, rather than a specific one tied to a single ICC and amount of site variation.
Our conclusions would then be more general: if we had not explored more scenarios, we would not have any sense of how general our found trend might be.</p>
<p>That said, if some of our scenarios had no bias, and some had large bias, when we aggregated we would report that there is generally a moderate amount of bias.
This would not be entirely faithful to the actual results.
If, however, the initial boxplots show results generally in one direction or another, then aggregation will be more faithful to the spirit of the results.</p>
<p>Also, aggregated results can be misleading if you have scaling issues or extreme outliers.
With bias, our scale is fairly well set, so we are good.
But if we were aggregating standard errors over different sample sizes, then the larger standard errors of the smaller sample size simulations (and the greater variability in estimating those standard errors) would swamp the standard errors of the larger sample sizes.
Usually, with aggregation, we want to average over something we believe does not change massively over the marginalized-out factors.
To achieve this, we can often average over a relative measure (such as standard error divided by the standard error of some baseline method), which tend to be more invariant and comparable across scenarios.</p>
<p>A major advantage of aggregation over the bundling approach is we can have fewer replications per scenario.
If the number of replicates within each scenario is small, then the performance measures for each scenario is estimated with a lot of error; the aggregate, by contrast, will be an average across many more replicates and thus give a good sense of <em>average</em> performance.
The averaging, in effect, gives a lot more replications per aggregated performance measure.</p>
<p>For our cluster RCT, we might aggregate our bias across our sample sizes as follows:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="building-good-visualization.html#cb380-1" tabindex="-1"></a>ssres <span class="ot">&lt;-</span> </span>
<span id="cb380-2"><a href="building-good-visualization.html#cb380-2" tabindex="-1"></a>  sres <span class="sc">%&gt;%</span> </span>
<span id="cb380-3"><a href="building-good-visualization.html#cb380-3" tabindex="-1"></a>  <span class="fu">group_by</span>( method, ICC, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb380-4"><a href="building-good-visualization.html#cb380-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">bias =</span> <span class="fu">mean</span>( bias ),</span>
<span id="cb380-5"><a href="building-good-visualization.html#cb380-5" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">n</span>() )</span></code></pre></div>
<p>We now have a single bias estimate for each combination of ICC, alpha, and size_coef; we have collapsed 9 scenarios into one overall scenario that generalizes bias across different sizes of experiment.
We can then plot, using many small multiples:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="building-good-visualization.html#cb381-1" tabindex="-1"></a><span class="fu">ggplot</span>( ssres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb381-2"><a href="building-good-visualization.html#cb381-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span>  alpha, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb381-3"><a href="building-good-visualization.html#cb381-3" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span> </span>
<span id="cb381-4"><a href="building-good-visualization.html#cb381-4" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">alpha=</span><span class="fl">0.75</span> ) <span class="sc">+</span></span>
<span id="cb381-5"><a href="building-good-visualization.html#cb381-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb381-6"><a href="building-good-visualization.html#cb381-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/agg_bias_plot_clusterRCT-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We see more clearly that greater variation in cluster size (alpha) leads to greater bias for the linear regression estimator, but only if the coefficient for size is nonzero (which makes sense given our theoretical understanding of the problem—if size is not related to treatment effect, it is hard to imagine how varying cluster sizes would cause much bias).
We are looking at an interaction between our simulation factors: we only see bias for linear regression when cluster size relates to impact and there is variation in cluster size.
As ICC increases, we are not seeing any major differences in the pattern of our results
We also see that all the estimators have near zero bias when there is no variation in cluster size, with the overplotted lines on the top row of the figure.</p>
<p>If you have many levels of a factor, as we do with ICC, you can let ggplot aggregate directly by taking advantage of the smoothing options:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="building-good-visualization.html#cb382-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, bias, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb382-2"><a href="building-good-visualization.html#cb382-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( alpha <span class="sc">~</span>  size_coef, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb382-3"><a href="building-good-visualization.html#cb382-3" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha=</span><span class="fl">0.10</span>,</span>
<span id="cb382-4"><a href="building-good-visualization.html#cb382-4" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.04</span>) ) <span class="sc">+</span></span>
<span id="cb382-5"><a href="building-good-visualization.html#cb382-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se=</span><span class="cn">FALSE</span> ) <span class="sc">+</span> </span>
<span id="cb382-6"><a href="building-good-visualization.html#cb382-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb382-7"><a href="building-good-visualization.html#cb382-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-219-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>In the above, we let the original points show faintly as well, to give a sense of the variation across simulation trials.</p>
<div id="a-note-on-how-to-aggregate" class="section level4 hasAnchor" number="12.3.0.1">
<h4><span class="header-section-number">12.3.0.1</span> A note on how to aggregate<a href="building-good-visualization.html#a-note-on-how-to-aggregate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Some performance measures are biased with respect to the Monte Carlo uncertainty.
The estimated standard error, for example, is biased; the variance, by contrast, is not.
The RMSE is biased, the MSE is not.</p>
<p>When aggregating, therefore, it is often best to aggregate the unbiased performance measures, and then calculate the biased ones from those.
For example, to estimate aggregated standard error you might do the following:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="building-good-visualization.html#cb383-1" tabindex="-1"></a>agg_perf <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span> </span>
<span id="cb383-2"><a href="building-good-visualization.html#cb383-2" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, method, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb383-3"><a href="building-good-visualization.html#cb383-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">SE =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( SE<span class="sc">^</span><span class="dv">2</span> ) ) )</span></code></pre></div>
<p>Because bias is linear, you do not need to worry about the bias of the standard error.
But if you are looking at the magnitude of bias (<span class="math inline">\(|bias|\)</span>), then you can run into issues when the biases are close to zero, if they are measured noisily.
In this case, looking at average bias, not average <span class="math inline">\(|bias|\)</span>, is safer.</p>
</div>
</div>
<div id="assessing-true-ses" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Assessing true SEs<a href="building-good-visualization.html#assessing-true-ses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We just did a deep dive into bias.<br />
Uncertainty (standard errors) is another primary performance criterion of interest.</p>
<p>As an initial exploration, we plot the standard error estimates from our Cluster RCT simulation, using smoothed lines to visualize trends. We use <code>ggplot</code>’s <code>geom_smooth</code> to aggregate over <code>size_coef</code> and <code>alpha</code>, which we leave out of the plot.
We include individual data points to visualize variation around the smoothed estimates:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="building-good-visualization.html#cb384-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, SE, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb384-2"><a href="building-good-visualization.html#cb384-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( n_bar <span class="sc">~</span>  J, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb384-3"><a href="building-good-visualization.html#cb384-3" tabindex="-1"></a>  <span class="fu">geom_jitter</span>( <span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb384-4"><a href="building-good-visualization.html#cb384-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb384-5"><a href="building-good-visualization.html#cb384-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and
## formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-221-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We observe several broad trends in the standard error behavior.
First, standard error increases with the intraclass correlation (ICC).
This is as expected: greater similarity within clusters reduces the effective sample size.
Second, standard error decreases as the number of clusters (J) increases, which reflects the benefit of having more independent units of analysis.
In contrast, increasing the cluster size (n_bar) has relatively little effect on the standard error (the rows of our facets look about the same).
Lastly, all methods show fairly similar levels of standard error overall.</p>
<p>While we can extract all of these from the figure, the figure is still not ideal for <em>comparing</em> our methods.
The dominant influence of design features like ICC and sample size obscures our ability to detect meaningful differences between methods.
In other words, even though SE changes across scenarios, it’s difficult to tell which method is actually performing better within each scenario.</p>
<p>We can also view the same information using boxplots, effectively “bundling” over the left-out dimensions.
We also put <code>n_bar</code> in our bundles because maybe it does not matter that much:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="building-good-visualization.html#cb386-1" tabindex="-1"></a><span class="fu">ggplot</span>( sres, <span class="fu">aes</span>( ICC, SE, <span class="at">col=</span>method, <span class="at">group=</span><span class="fu">paste0</span>( ICC, method ) ) ) <span class="sc">+</span></span>
<span id="cb386-2"><a href="building-good-visualization.html#cb386-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span>  J, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb386-3"><a href="building-good-visualization.html#cb386-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>( <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">coef =</span> <span class="cn">Inf</span>) <span class="sc">+</span> </span>
<span id="cb386-4"><a href="building-good-visualization.html#cb386-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( sres<span class="sc">$</span>ICC)) <span class="sc">+</span></span>
<span id="cb386-5"><a href="building-good-visualization.html#cb386-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-222-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Our plots are still dominated by the strong effects of ICC and the number of clusters (J). When performance metrics like standard error vary systematically with design features, it becomes difficult to compare methods meaningfully across scenarios.</p>
<p>To address this, we shift our focus through standardization. Instead of noting that:</p>
<blockquote>
<p>“All my SEs are getting smaller,”</p>
</blockquote>
<p>we want to conclude that:</p>
<blockquote>
<p>“Estimator 1 has systematically higher SEs than Estimator 2 across scenarios.”</p>
</blockquote>
<p>Simulation results are often driven by broad design effects, which can obscure the specific methodological questions we care about. Standardizing helps bring those comparisons to the forefront.
Let’s try that next.</p>
<div id="standardizing-to-compare-across-simulation-scenarios" class="section level4 hasAnchor" number="12.4.0.1">
<h4><span class="header-section-number">12.4.0.1</span> Standardizing to compare across simulation scenarios<a href="building-good-visualization.html#standardizing-to-compare-across-simulation-scenarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One straightforward strategy for standardization is to compare each method’s performance to a designated baseline. In this example, we use Linear Regression (LR) as our baseline.</p>
<p>We focus on the standard error (SE) of each method’s estimate, rescaling it relative to LR.
We do this by, for each simulation scenario, dividing each method’s SE by the SE of LR, to produce <code>SE.scale</code>.
This relative measure, SE.scale, allows us to examine how much better or worse each method performs in terms of precision under varying conditions.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="building-good-visualization.html#cb387-1" tabindex="-1"></a>ssres <span class="ot">&lt;-</span> </span>
<span id="cb387-2"><a href="building-good-visualization.html#cb387-2" tabindex="-1"></a>  sres <span class="sc">%&gt;%</span> </span>
<span id="cb387-3"><a href="building-good-visualization.html#cb387-3" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ATE, size_coef, ICC, alpha ) <span class="sc">%&gt;%</span></span>
<span id="cb387-4"><a href="building-good-visualization.html#cb387-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">SE.scale =</span> SE <span class="sc">/</span> SE[method<span class="sc">==</span><span class="st">&quot;LR&quot;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb387-5"><a href="building-good-visualization.html#cb387-5" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>We can then treat it as a measure like any other.
Here we bundle:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="building-good-visualization.html#cb388-1" tabindex="-1"></a><span class="fu">ggplot</span>( ssres, <span class="fu">aes</span>( ICC, SE.scale, <span class="at">col=</span>method,</span>
<span id="cb388-2"><a href="building-good-visualization.html#cb388-2" tabindex="-1"></a>                    <span class="at">group =</span> <span class="fu">interaction</span>(ICC, method) ) ) <span class="sc">+</span></span>
<span id="cb388-3"><a href="building-good-visualization.html#cb388-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>( n_bar <span class="sc">~</span>  J, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb388-4"><a href="building-good-visualization.html#cb388-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>( <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">width=</span><span class="fl">0.1</span> ) <span class="sc">+</span></span>
<span id="cb388-5"><a href="building-good-visualization.html#cb388-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>() )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-224-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>The figure above shows how each method compares to LR across simulation scenarios. We see that Aggregation performs worse than LR when the Intraclass Correlation Coefficient (ICC) is zero. However, when ICC is greater than zero, Aggregation yields improved precision.
The Multilevel Model (MLM), in contrast, appears more adaptive. It captures the benefits of aggregation when ICC is high, but avoids the precision cost when ICC is zero. This adaptivity makes MLM appealing in practice when ICC is unknown or variable across contexts.</p>
<p>Although faceting by n_bar and J helps reveal potential interaction effects, it may be more effective to collapse across these variables for a cleaner summary.
We are also not seeing how site size variation is impacting these results, and we might think that matters, especially for aggregation.</p>
<p>As a warning regarding Monte Carlo uncertainty: when standardizing results, it is important to remember that uncertainty in the baseline measure (here, LR) propagates to the standardized values. This should be considered when interpreting variability in the scaled results.
Uncertaintly for relative performance is generally tricky to assess.</p>
<p>To clarify the main patterns, we average our SE.scale across simulation settings—relative performance is on the same scale, so averaging is a natural thing to do.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="building-good-visualization.html#cb389-1" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> </span>
<span id="cb389-2"><a href="building-good-visualization.html#cb389-2" tabindex="-1"></a>  ssres <span class="sc">%&gt;%</span> </span>
<span id="cb389-3"><a href="building-good-visualization.html#cb389-3" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, alpha, method ) <span class="sc">%&gt;%</span></span>
<span id="cb389-4"><a href="building-good-visualization.html#cb389-4" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">SE.scale =</span> <span class="fu">mean</span>( SE.scale ) )</span>
<span id="cb389-5"><a href="building-good-visualization.html#cb389-5" tabindex="-1"></a></span>
<span id="cb389-6"><a href="building-good-visualization.html#cb389-6" tabindex="-1"></a><span class="fu">ggplot</span>( s2, <span class="fu">aes</span>( ICC, SE.scale, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb389-7"><a href="building-good-visualization.html#cb389-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> alpha ) <span class="sc">+</span></span>
<span id="cb389-8"><a href="building-good-visualization.html#cb389-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb389-9"><a href="building-good-visualization.html#cb389-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>() ) <span class="sc">+</span></span>
<span id="cb389-10"><a href="building-good-visualization.html#cb389-10" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">&quot;Average relative SE to Linear Regression&quot;</span>,</span>
<span id="cb389-11"><a href="building-good-visualization.html#cb389-11" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Relative Standard Error&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-225-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Our aggregated plot of precision of aggregation and MLM relative to Linear Regression gives a simple story clearly told.
The performance of aggregation improves with ICC.
MLM also has benefits over LR, and does not pay much cost when ICC is low.</p>
<p>We can also visualize the variability in relative standard errors across simulation scenarios using boxplots.
This allows us to examine how consistent each method’s performance is under different ICC conditions.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="building-good-visualization.html#cb390-1" tabindex="-1"></a>ssres <span class="sc">%&gt;%</span> </span>
<span id="cb390-2"><a href="building-good-visualization.html#cb390-2" tabindex="-1"></a>  <span class="fu">filter</span>( method <span class="sc">!=</span> <span class="st">&quot;LR&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb390-3"><a href="building-good-visualization.html#cb390-3" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( ICC, SE.scale, <span class="at">col=</span>method, </span>
<span id="cb390-4"><a href="building-good-visualization.html#cb390-4" tabindex="-1"></a>               <span class="at">group =</span> <span class="fu">interaction</span>(ICC, method) ) ) <span class="sc">+</span></span>
<span id="cb390-5"><a href="building-good-visualization.html#cb390-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> alpha, <span class="at">nrow=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb390-6"><a href="building-good-visualization.html#cb390-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">1</span>  ) <span class="sc">+</span></span>
<span id="cb390-7"><a href="building-good-visualization.html#cb390-7" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>( <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">width=</span><span class="fl">0.1</span> ) <span class="sc">+</span></span>
<span id="cb390-8"><a href="building-good-visualization.html#cb390-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">90</span>, <span class="dv">125</span>, <span class="at">by=</span><span class="dv">5</span> ) ) </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-226-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>These boxplots show the full distribution of relative standard errors across all simulated scenarios, separated by ICC level. We exclude LR as it is the reference method.</p>
<p>The pattern is clear: when ICC = 0, Aggregation performs worse than LR, and MLM performs about the same. But as ICC increases, Aggregation and MLM both improve, and perform about the same to each other.
This highlights the robustness of MLM across diverse conditions.</p>
<p>We might also explore how uncertainty changes with other factors.
Here, we see whether cluster size meaningfully helps:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="building-good-visualization.html#cb391-1" tabindex="-1"></a>sres <span class="sc">%&gt;%</span></span>
<span id="cb391-2"><a href="building-good-visualization.html#cb391-2" tabindex="-1"></a>  <span class="fu">filter</span>( alpha <span class="sc">==</span> <span class="fl">0.8</span>, size_coef <span class="sc">==</span> <span class="fl">0.2</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb391-3"><a href="building-good-visualization.html#cb391-3" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">aes</span>( n_bar, SE, <span class="at">col=</span><span class="fu">factor</span>(ICC), <span class="at">group=</span>ICC ) ) <span class="sc">+</span></span>
<span id="cb391-4"><a href="building-good-visualization.html#cb391-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>( J <span class="sc">~</span> method, <span class="at">labeller =</span> label_both, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-5"><a href="building-good-visualization.html#cb391-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-227-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>If the ICC is low, cluster size matters. Otherwise, the benefits are much more slim.</p>
</div>
</div>
<div id="the-bias-se-rmse-plot" class="section level2 hasAnchor" number="12.5">
<h2><span class="header-section-number">12.5</span> The Bias-SE-RMSE plot<a href="building-good-visualization.html#the-bias-se-rmse-plot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can also visualize bias and standard error together, along with RMSE, to get a fuller picture of performance.
To illustrate, we subset to our biggest scenarios, in terms of sample size, and no ICC:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="building-good-visualization.html#cb392-1" tabindex="-1"></a>bsr <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb392-2"><a href="building-good-visualization.html#cb392-2" tabindex="-1"></a>  <span class="fu">filter</span>( n_bar <span class="sc">==</span> <span class="dv">320</span>, J<span class="sc">==</span><span class="dv">80</span>, ICC <span class="sc">==</span> <span class="dv">0</span> )</span>
<span id="cb392-3"><a href="building-good-visualization.html#cb392-3" tabindex="-1"></a></span>
<span id="cb392-4"><a href="building-good-visualization.html#cb392-4" tabindex="-1"></a>bsr <span class="ot">&lt;-</span> bsr <span class="sc">%&gt;%</span></span>
<span id="cb392-5"><a href="building-good-visualization.html#cb392-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>R, <span class="sc">-</span>power, <span class="sc">-</span>ESE_hat, <span class="sc">-</span>SD_SE_hat ) <span class="sc">%&gt;%</span></span>
<span id="cb392-6"><a href="building-good-visualization.html#cb392-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( <span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;bias&quot;</span>,<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;RMSE&quot;</span>),</span>
<span id="cb392-7"><a href="building-good-visualization.html#cb392-7" tabindex="-1"></a>                <span class="at">names_to =</span> <span class="st">&quot;measure&quot;</span>,</span>
<span id="cb392-8"><a href="building-good-visualization.html#cb392-8" tabindex="-1"></a>                <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb392-9"><a href="building-good-visualization.html#cb392-9" tabindex="-1"></a>  <span class="fu">group_by</span>( measure, size_coef, method, ICC, alpha ) <span class="sc">%&gt;%</span></span>
<span id="cb392-10"><a href="building-good-visualization.html#cb392-10" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">value =</span> <span class="fu">mean</span>( value ),</span>
<span id="cb392-11"><a href="building-good-visualization.html#cb392-11" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">n</span>() )</span>
<span id="cb392-12"><a href="building-good-visualization.html#cb392-12" tabindex="-1"></a></span>
<span id="cb392-13"><a href="building-good-visualization.html#cb392-13" tabindex="-1"></a>bsr<span class="sc">$</span>measure <span class="ot">=</span> <span class="fu">factor</span>( bsr<span class="sc">$</span>measure, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;bias&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;RMSE&quot;</span>),</span>
<span id="cb392-14"><a href="building-good-visualization.html#cb392-14" tabindex="-1"></a>                      <span class="at">labels =</span><span class="fu">c</span>(<span class="st">&quot;|bias|&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;RMSE&quot;</span> ) )</span>
<span id="cb392-15"><a href="building-good-visualization.html#cb392-15" tabindex="-1"></a></span>
<span id="cb392-16"><a href="building-good-visualization.html#cb392-16" tabindex="-1"></a><span class="fu">ggplot</span>( bsr, <span class="fu">aes</span>( alpha, value, <span class="at">col=</span>method )) <span class="sc">+</span></span>
<span id="cb392-17"><a href="building-good-visualization.html#cb392-17" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> measure ) <span class="sc">+</span></span>
<span id="cb392-18"><a href="building-good-visualization.html#cb392-18" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb392-19"><a href="building-good-visualization.html#cb392-19" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Site Variation&quot;</span> )  <span class="sc">+</span></span>
<span id="cb392-20"><a href="building-good-visualization.html#cb392-20" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb392-21"><a href="building-good-visualization.html#cb392-21" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb392-22"><a href="building-good-visualization.html#cb392-22" tabindex="-1"></a>         <span class="at">legend.direction=</span><span class="st">&quot;horizontal&quot;</span>, </span>
<span id="cb392-23"><a href="building-good-visualization.html#cb392-23" tabindex="-1"></a>         <span class="at">legend.key.width=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb392-24"><a href="building-good-visualization.html#cb392-24" tabindex="-1"></a>         <span class="at">panel.border =</span> <span class="fu">element_blank</span>() )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-228-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>The combination of bias, standard error, and RMSE provides a rich and informative view of estimator performance.</p>
<p>As an illustration, in the above plot, we focus on a specific simulation scenario with n_bar = 320, J = 80, and ICC = 0. The top row represents settings where effect size is independent of cluster size, while the bottom row reflects a correlation between size and effect.</p>
<p>These types of visualizations directly illustrates the canonical relationship:</p>
<p><span class="math display">\[ \text{RMSE}^2 = \text{Bias}^2 + \text{SE}^2 \]</span></p>
<p>In the plot we get overall performance (RMSE) clearly decomposed into into its two fundamental components: systematic error (bias) and variability (standard error).
Here we see how bias for LR, for example, is dominant when site variation is high.
The differences in SE are small and so not the main reason for differences in overall estimator performance; bias is the main driver.</p>
<p>This is the kind of diagnostic plot we often wish were included in more applied simulation studies.</p>
</div>
<div id="assessing-estimated-ses" class="section level2 hasAnchor" number="12.6">
<h2><span class="header-section-number">12.6</span> Assessing estimated SEs<a href="building-good-visualization.html#assessing-estimated-ses" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far we have examined the performance of our <em>point estimators</em>.
We next look at ways to assess our <em>estimated</em> standard errors.
A good first question is whether they are about the right size, on average, across all the scenarios.</p>
<p>Here it is very important to see if they are <em>reliably</em> the right size, so the bundling method is an especially important tool here.
We first see if the average estimated SE, relative to the true SE, is usually around 1 across all scenarios:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="building-good-visualization.html#cb393-1" tabindex="-1"></a>sres <span class="ot">&lt;-</span> sres <span class="sc">%&gt;%</span></span>
<span id="cb393-2"><a href="building-good-visualization.html#cb393-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">inflate =</span> ESE_hat <span class="sc">/</span> SE  ) </span>
<span id="cb393-3"><a href="building-good-visualization.html#cb393-3" tabindex="-1"></a></span>
<span id="cb393-4"><a href="building-good-visualization.html#cb393-4" tabindex="-1"></a><span class="fu">ggplot</span>( sres,</span>
<span id="cb393-5"><a href="building-good-visualization.html#cb393-5" tabindex="-1"></a>        <span class="fu">aes</span>( ICC, inflate, <span class="at">col=</span>method,</span>
<span id="cb393-6"><a href="building-good-visualization.html#cb393-6" tabindex="-1"></a>             <span class="at">group =</span> <span class="fu">interaction</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb393-7"><a href="building-good-visualization.html#cb393-7" tabindex="-1"></a>    <span class="fu">facet_grid</span>( . <span class="sc">~</span> J, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb393-8"><a href="building-good-visualization.html#cb393-8" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>( <span class="at">position=</span><span class="st">&quot;dodge&quot;</span> ) <span class="sc">+</span></span>
<span id="cb393-9"><a href="building-good-visualization.html#cb393-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept=</span><span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb393-10"><a href="building-good-visualization.html#cb393-10" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">&quot;n&quot;</span> ) <span class="sc">+</span></span>
<span id="cb393-11"><a href="building-good-visualization.html#cb393-11" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>() ) </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-229-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We see that our estimated SEs are about right, on average, across all scenarios.
When ICC is 0 and J is small, the MLM SEs are a bit too high.
When J is 5, the LR estimator can be a bit low under some circumstances.
We can start exploring these trends to dig into why our are wide (suggesting that other factors dictate when the SEs are biased).</p>
<p>We can look at the <span class="math inline">\(J = 80\)</span> to see what MCSEs are like.
The <code>simhelpers</code> <code>calc_relative_var()</code> method gives mcses for relative bias.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="building-good-visualization.html#cb394-1" tabindex="-1"></a>se_res <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span></span>
<span id="cb394-2"><a href="building-good-visualization.html#cb394-2" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ATE, size_coef, ICC, alpha, method ) <span class="sc">%&gt;%</span></span>
<span id="cb394-3"><a href="building-good-visualization.html#cb394-3" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="fu">calc_relative_var</span>( <span class="at">estimates =</span> ATE_hat,</span>
<span id="cb394-4"><a href="building-good-visualization.html#cb394-4" tabindex="-1"></a>                     <span class="at">var_estimates =</span> SE_hat<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb394-5"><a href="building-good-visualization.html#cb394-5" tabindex="-1"></a>                     <span class="at">criteria =</span> <span class="st">&quot;relative bias&quot;</span> ) )</span>
<span id="cb394-6"><a href="building-good-visualization.html#cb394-6" tabindex="-1"></a>se_res <span class="sc">%&gt;%</span></span>
<span id="cb394-7"><a href="building-good-visualization.html#cb394-7" tabindex="-1"></a>  <span class="fu">filter</span>( J <span class="sc">==</span> <span class="dv">80</span>, n_bar <span class="sc">==</span> <span class="dv">80</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb394-8"><a href="building-good-visualization.html#cb394-8" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( ICC, rel_bias_var, <span class="at">col=</span>method ) ) <span class="sc">+</span></span>
<span id="cb394-9"><a href="building-good-visualization.html#cb394-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>( size_coef <span class="sc">~</span> alpha  ) <span class="sc">+</span> </span>
<span id="cb394-10"><a href="building-good-visualization.html#cb394-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb394-11"><a href="building-good-visualization.html#cb394-11" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.05</span>) ) <span class="sc">+</span></span>
<span id="cb394-12"><a href="building-good-visualization.html#cb394-12" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.05</span>) ) <span class="sc">+</span></span>
<span id="cb394-13"><a href="building-good-visualization.html#cb394-13" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>( <span class="fu">aes</span>( <span class="at">ymin =</span> rel_bias_var <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>rel_bias_var_mcse,</span>
<span id="cb394-14"><a href="building-good-visualization.html#cb394-14" tabindex="-1"></a>                      <span class="at">ymax =</span> rel_bias_var <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>rel_bias_var_mcse ),</span>
<span id="cb394-15"><a href="building-good-visualization.html#cb394-15" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_dodge</span>( <span class="at">width=</span><span class="fl">0.05</span> ),</span>
<span id="cb394-16"><a href="building-good-visualization.html#cb394-16" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">0</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-230-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>In looking at this plot, we see no real evidence of miscalibration.
This makes us think the boxes in the prior plot are wide due to MCSE rather than other simulation factors driving some slight miscalibration in some scenarios when <span class="math inline">\(J\)</span> is high.
We might then assume this applies to the <span class="math inline">\(J = 20\)</span> case as well.</p>
<p>Finally, we can look at how stable the estimated SEs are, relative to the actual uncertainty.
We calculate the standard deviation of the estimated standard errors and compare that to the standard deviation of the point estimate.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="building-good-visualization.html#cb395-1" tabindex="-1"></a>sres <span class="ot">&lt;-</span> <span class="fu">mutate</span>( sres,</span>
<span id="cb395-2"><a href="building-good-visualization.html#cb395-2" tabindex="-1"></a>               <span class="at">SD_SE_hat_rat =</span> SD_SE_hat <span class="sc">/</span> SE )</span>
<span id="cb395-3"><a href="building-good-visualization.html#cb395-3" tabindex="-1"></a></span>
<span id="cb395-4"><a href="building-good-visualization.html#cb395-4" tabindex="-1"></a><span class="fu">ggplot</span>( sres,</span>
<span id="cb395-5"><a href="building-good-visualization.html#cb395-5" tabindex="-1"></a>        <span class="fu">aes</span>( ICC, SD_SE_hat_rat, <span class="at">col=</span>method,</span>
<span id="cb395-6"><a href="building-good-visualization.html#cb395-6" tabindex="-1"></a>             <span class="at">group =</span> <span class="fu">interaction</span>(ICC,method) ) ) <span class="sc">+</span></span>
<span id="cb395-7"><a href="building-good-visualization.html#cb395-7" tabindex="-1"></a>    <span class="fu">facet_grid</span>( . <span class="sc">~</span> J, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb395-8"><a href="building-good-visualization.html#cb395-8" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>( <span class="at">position=</span><span class="st">&quot;dodge&quot;</span> ) <span class="sc">+</span></span>
<span id="cb395-9"><a href="building-good-visualization.html#cb395-9" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">&quot;n&quot;</span> ) <span class="sc">+</span></span>
<span id="cb395-10"><a href="building-good-visualization.html#cb395-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>() ) </span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-231-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>It looks like MLM has more reliably estimated SEs than other methods when ICC is small.
Aggregation has more trouble estimating uncertainty when J is small.
Finally, LR’s SEs are generally more unstable, relative to its performance, when <span class="math inline">\(J\)</span> is larger.</p>
<p>Assessing the stability of standard errors is usually very in the weeds of a performance evaluation.
It is a tricky measure: if the true SE is high for a method, then the relative instability will be lower, even if the absolute instability is the same.
Thinking through what might be driving what can be difficult, and is often not central to the main purpose of an evaluation.
People often look at confidence interval coverage and confidence interval width, instead, to assess the quality of estimated SEs.</p>
</div>
<div id="assessing-confidence-intervals" class="section level2 hasAnchor" number="12.7">
<h2><span class="header-section-number">12.7</span> Assessing confidence intervals<a href="building-good-visualization.html#assessing-confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Coverage is a blend of how accurate our estimates are and how good our estimated SEs are.
To assess coverage, we first calculate confidence intervals using the estimated effect, estimated standard error, and degrees of freedom.
Once we have our calculated t-based intervals, we can average them across runs to get average width and coverage using <code>simhelpers</code>.
A good confidence interval estimator would be one which is generally relatively short while maintaining proper coverage.</p>
<p>Our calculations are as so:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="building-good-visualization.html#cb396-1" tabindex="-1"></a>res<span class="sc">$</span>df <span class="ot">=</span> res<span class="sc">$</span>J</span>
<span id="cb396-2"><a href="building-good-visualization.html#cb396-2" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">mutate</span>( res,</span>
<span id="cb396-3"><a href="building-good-visualization.html#cb396-3" tabindex="-1"></a>               <span class="at">tstar =</span> <span class="fu">qt</span>( <span class="fl">0.975</span>, <span class="at">df=</span>df ),</span>
<span id="cb396-4"><a href="building-good-visualization.html#cb396-4" tabindex="-1"></a>               <span class="at">CI_low =</span> ATE_hat <span class="sc">-</span> tstar<span class="sc">*</span>SE_hat,</span>
<span id="cb396-5"><a href="building-good-visualization.html#cb396-5" tabindex="-1"></a>               <span class="at">CI_high =</span> ATE_hat <span class="sc">+</span> tstar<span class="sc">*</span>SE_hat,</span>
<span id="cb396-6"><a href="building-good-visualization.html#cb396-6" tabindex="-1"></a>               <span class="at">width =</span> CI_high <span class="sc">-</span> CI_low )</span>
<span id="cb396-7"><a href="building-good-visualization.html#cb396-7" tabindex="-1"></a></span>
<span id="cb396-8"><a href="building-good-visualization.html#cb396-8" tabindex="-1"></a>covres <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb396-9"><a href="building-good-visualization.html#cb396-9" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ICC, alpha, size_coef, method, ATE ) <span class="sc">%&gt;%</span></span>
<span id="cb396-10"><a href="building-good-visualization.html#cb396-10" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="fu">calc_coverage</span>( <span class="at">lower_bound =</span> CI_low, </span>
<span id="cb396-11"><a href="building-good-visualization.html#cb396-11" tabindex="-1"></a>                            <span class="at">upper_bound =</span> CI_high,</span>
<span id="cb396-12"><a href="building-good-visualization.html#cb396-12" tabindex="-1"></a>                            <span class="at">true_param =</span> ATE ) ) <span class="sc">%&gt;%</span></span>
<span id="cb396-13"><a href="building-good-visualization.html#cb396-13" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>We then look at those simulations with a relationship of site size and impact.
We subset to <code>n_bar = 80</code>, <code>size_coef = 0.2</code> and <code>alpha = 0.5</code> to simplify for our initial plot:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="building-good-visualization.html#cb397-1" tabindex="-1"></a>c_sub <span class="ot">&lt;-</span> covres <span class="sc">%&gt;%</span></span>
<span id="cb397-2"><a href="building-good-visualization.html#cb397-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>( size_coef <span class="sc">!=</span> <span class="dv">0</span>, n_bar <span class="sc">==</span> <span class="dv">80</span>, alpha <span class="sc">==</span> <span class="fl">0.5</span> )</span>
<span id="cb397-3"><a href="building-good-visualization.html#cb397-3" tabindex="-1"></a></span>
<span id="cb397-4"><a href="building-good-visualization.html#cb397-4" tabindex="-1"></a><span class="fu">ggplot</span>( c_sub, <span class="fu">aes</span>( ICC, coverage, <span class="at">col=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb397-5"><a href="building-good-visualization.html#cb397-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> J, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb397-6"><a href="building-good-visualization.html#cb397-6" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb397-7"><a href="building-good-visualization.html#cb397-7" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb397-8"><a href="building-good-visualization.html#cb397-8" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>( <span class="fu">aes</span>( <span class="at">ymax =</span> coverage <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>coverage_mcse, </span>
<span id="cb397-9"><a href="building-good-visualization.html#cb397-9" tabindex="-1"></a>                      <span class="at">ymin =</span> coverage <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>coverage_mcse ), <span class="at">width=</span><span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb397-10"><a href="building-good-visualization.html#cb397-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="fl">0.95</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-233-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Generally coverage is good unless <span class="math inline">\(J\)</span> is low or ICC is 0.
Monte Carlo standard errors indicate that, in some settings, the observed coverage is reliably different from the nominal 95%, suggesting issues with estimator bias, standard error estimation, or both.
We might want to see if these results are general across other settings (see exercises).</p>
<p>For confidence interval width, we can calculate the average width relative to the width of LR across all scenarios:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="building-good-visualization.html#cb398-1" tabindex="-1"></a>covres <span class="ot">&lt;-</span> covres <span class="sc">%&gt;%</span></span>
<span id="cb398-2"><a href="building-good-visualization.html#cb398-2" tabindex="-1"></a>  <span class="fu">group_by</span>( n_bar, J, ICC, alpha, size_coef ) <span class="sc">%&gt;%</span></span>
<span id="cb398-3"><a href="building-good-visualization.html#cb398-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">width_rel =</span> width <span class="sc">/</span> width[method<span class="sc">==</span><span class="st">&quot;LR&quot;</span>] ) <span class="sc">%&gt;%</span></span>
<span id="cb398-4"><a href="building-good-visualization.html#cb398-4" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb398-5"><a href="building-good-visualization.html#cb398-5" tabindex="-1"></a></span>
<span id="cb398-6"><a href="building-good-visualization.html#cb398-6" tabindex="-1"></a>c_agg <span class="ot">&lt;-</span> covres <span class="sc">%&gt;%</span></span>
<span id="cb398-7"><a href="building-good-visualization.html#cb398-7" tabindex="-1"></a>  <span class="fu">group_by</span>( ICC, J, alpha, method ) <span class="sc">%&gt;%</span></span>
<span id="cb398-8"><a href="building-good-visualization.html#cb398-8" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">coverage =</span> <span class="fu">mean</span>( coverage ),</span>
<span id="cb398-9"><a href="building-good-visualization.html#cb398-9" tabindex="-1"></a>             <span class="at">coverage_mcse =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( coverage_mcse<span class="sc">^</span><span class="dv">2</span> ) ) <span class="sc">/</span> <span class="fu">n</span>(),</span>
<span id="cb398-10"><a href="building-good-visualization.html#cb398-10" tabindex="-1"></a>             <span class="at">width_rel =</span> <span class="fu">mean</span>( width_rel ) ) <span class="sc">%&gt;%</span></span>
<span id="cb398-11"><a href="building-good-visualization.html#cb398-11" tabindex="-1"></a>  <span class="fu">filter</span>( method <span class="sc">!=</span> <span class="st">&quot;LR&quot;</span> )</span>
<span id="cb398-12"><a href="building-good-visualization.html#cb398-12" tabindex="-1"></a>  </span>
<span id="cb398-13"><a href="building-good-visualization.html#cb398-13" tabindex="-1"></a><span class="fu">ggplot</span>( c_agg, <span class="fu">aes</span>( ICC, width_rel, <span class="at">col=</span>method, <span class="at">group=</span>method ) ) <span class="sc">+</span></span>
<span id="cb398-14"><a href="building-good-visualization.html#cb398-14" tabindex="-1"></a>  <span class="fu">facet_grid</span>( J <span class="sc">~</span> alpha ) <span class="sc">+</span></span>
<span id="cb398-15"><a href="building-good-visualization.html#cb398-15" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb398-16"><a href="building-good-visualization.html#cb398-16" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb398-17"><a href="building-good-visualization.html#cb398-17" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&quot;Relative CI Width&quot;</span>,</span>
<span id="cb398-18"><a href="building-good-visualization.html#cb398-18" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Average Relative CI Width to Linear Regression&quot;</span> ) <span class="sc">+</span></span>
<span id="cb398-19"><a href="building-good-visualization.html#cb398-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>() )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-234-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Confidence interval width serves as a proxy for precision. Narrow intervals suggest more precise estimates.
We see MLM has wider intervals, relative to LR, when ICC is low. When there is site variation, both Agg and MLM have shorter intervals.</p>
</div>
<div id="exercises-8" class="section level2 hasAnchor" number="12.8">
<h2><span class="header-section-number">12.8</span> Exercises<a href="building-good-visualization.html#exercises-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="assessing-uncertainty" class="section level3 hasAnchor" number="12.8.1">
<h3><span class="header-section-number">12.8.1</span> Assessing uncertainty<a href="building-good-visualization.html#assessing-uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Select a plot from this chapter that does not have monte carlo standard errors.
Add monte carlo standard errors to that selected plot.</p>
</div>
<div id="assessing-power" class="section level3 hasAnchor" number="12.8.2">
<h3><span class="header-section-number">12.8.2</span> Assessing power<a href="building-good-visualization.html#assessing-power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Make a plot showing how power changes as <span class="math inline">\(J\)</span> changes.
As an extra step, add MCSEs to the plot to assess whether you have a reasonable numbers of replications in the simulation.</p>
</div>
<div id="going-deeper-with-coverage" class="section level3 hasAnchor" number="12.8.3">
<h3><span class="header-section-number">12.8.3</span> Going deeper with coverage<a href="building-good-visualization.html#going-deeper-with-coverage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For our cluster RCT, we saw coverage is low in some circumstances.
Explore the full set of simulation results, possibly adding your own analyses, to ascertain why coverage is low.
Is it due to estimator bias? Unreliably estimated standard errors? Something else?
Make a final plot and draft a short write-up that captures how coverage is vulnerable for the three estimators.</p>
</div>
<div id="pearson-correlations-with-a-bivariate-poisson-distribution" class="section level3 hasAnchor" number="12.8.4">
<h3><span class="header-section-number">12.8.4</span> Pearson correlations with a bivariate Poisson distribution<a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="exp-design.html#using-pmap-to-run-multifactor-simulations">10.2</a>, we generated results for a multifactor simulation of confidence intervals for Pearson’s correlation coefficient under a bivariate Poisson data-generating process. Create a plot that depicts the coverage rate of the confidence intervals for <span class="math inline">\(\rho\)</span> across all four simulation factors.
Write a brief explanation of how the plot is laid out and explain why you chose to construct it as you did.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="presentation-of-results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="special-topics-on-reporting-simulation-results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/074-building-good-vizualizations.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
