<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Running the Simulation Process | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-09-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-analysis-procedures.html"/>
<link rel="next" href="performance-criteria.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-alphas"><i class="fa fa-check"></i><b>5.5.1</b> Other <span class="math inline">\(\alpha\)</span>’s</a></li>
<li class="chapter" data-level="5.5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-compare-results"><i class="fa fa-check"></i><b>5.5.2</b> Compare results</a></li>
<li class="chapter" data-level="5.5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-power"><i class="fa fa-check"></i><b>5.5.3</b> Power</a></li>
<li class="chapter" data-level="5.5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-wide-long"><i class="fa fa-check"></i><b>5.5.4</b> Wide or long?</a></li>
<li class="chapter" data-level="5.5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-tests"><i class="fa fa-check"></i><b>5.5.5</b> Other tests</a></li>
<li class="chapter" data-level="5.5.6" data-path="case-ANOVA.html"><a href="case-ANOVA.html#methodological-extensions"><i class="fa fa-check"></i><b>5.5.6</b> Methodological extensions</a></li>
<li class="chapter" data-level="5.5.7" data-path="case-ANOVA.html"><a href="case-ANOVA.html#power-analysis"><i class="fa fa-check"></i><b>5.5.7</b> Power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance metrics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Metrics for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-criteria.html"><a href="performance-criteria.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-criteria.html"><a href="performance-criteria.html#less-conventional-performance-metrics"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-standard-error-estimators"><i class="fa fa-check"></i><b>9.2</b> Metrics for Standard Error Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.1</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Metrics for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Metrics for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Selecting Relative vs. Absolute Metrics</a></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6</b> Summary of Peformance Measures</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#windsorization-to-control-outliers"><i class="fa fa-check"></i><b>9.6.1</b> Windsorization to control outliers</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#correlation-measures-vs-absolute-performance"><i class="fa fa-check"></i><b>9.6.2</b> Correlation measures vs absolute performance</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures-1"><i class="fa fa-check"></i><b>9.7</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#implicit-estimands"><i class="fa fa-check"></i><b>9.8</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#MCSE"><i class="fa fa-check"></i><b>9.9</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.9.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.9.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.9.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="performance-criteria.html"><a href="performance-criteria.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.10</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.11" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.11</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.11.1" data-path="performance-criteria.html"><a href="performance-criteria.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.11.1</b> Brown and Forsythe (1974)</a></li>
<li class="chapter" data-level="9.11.2" data-path="performance-criteria.html"><a href="performance-criteria.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.11.2</b> Jackknife calculation of MCSEs</a></li>
<li class="chapter" data-level="9.11.3" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.11.3</b> Distribution theory for person-level average treatment effects</a></li>
<li class="chapter" data-level="9.11.4" data-path="performance-criteria.html"><a href="performance-criteria.html#multiple-scenario-performance"><i class="fa fa-check"></i><b>9.11.4</b> Multiple scenarios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>10</b> Designing and executing multifactor simulations</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>10.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="10.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.3</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exp-design.html"><a href="exp-design.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="exp-design.html"><a href="exp-design.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>10.5</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>10.5.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="10.5.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>10.5.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="10.5.3" data-path="exp-design.html"><a href="exp-design.html#running-the-simulations"><i class="fa fa-check"></i><b>10.5.3</b> Running the simulations</a></li>
<li class="chapter" data-level="10.5.4" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>10.5.4</b> Calculating performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="exp-design.html"><a href="exp-design.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="exp-design.html"><a href="exp-design.html#brown-and-forsythe-redux"><i class="fa fa-check"></i><b>10.6.1</b> Brown and Forsythe redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="exp-design.html"><a href="exp-design.html#meta-regression"><i class="fa fa-check"></i><b>10.6.2</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.3" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.3</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>11</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="11.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>11.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>11.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>11.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>11.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="11.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="11.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>11.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="11.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>11.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="11.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>11.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>11.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>11.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="11.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>11.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>11.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>12</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>12.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="12.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>12.2</b> Bundling</a></li>
<li class="chapter" data-level="12.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>12.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-true-ses"><i class="fa fa-check"></i><b>12.4</b> Assessing true SEs</a></li>
<li class="chapter" data-level="12.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>12.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="12.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-estimated-ses"><i class="fa fa-check"></i><b>12.6</b> Assessing estimated SEs</a></li>
<li class="chapter" data-level="12.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>12.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="12.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>12.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="12.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>12.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="12.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>12.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="12.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>12.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>13</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="13.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>13.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>13.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="13.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>13.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>13.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="13.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>13.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>13.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>13.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>14.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>15</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="15.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>15.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>15.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="15.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>15.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="15.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>15.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="15.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>15.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="15.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>15.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="15.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>15.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>16</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="16.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>16.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>16.1.1</b> The source command</a></li>
<li class="chapter" data-level="16.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>16.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="16.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>16.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>16.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="16.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>16.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>16.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="16.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>16.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="16.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>16.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="16.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>16.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>17</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="17.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>17.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="17.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>17.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="17.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>17.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>17.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="17.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>17.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="17.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>17.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="17.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>17.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="17.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>17.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="17.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>17.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>18</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>18.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="18.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>18.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="18.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>18.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="18.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>18.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>18.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="19" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>19</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>19.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="19.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>19.2</b> The data generating process</a></li>
<li class="chapter" data-level="19.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>19.3</b> Running the simulation</a></li>
<li class="chapter" data-level="19.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>19.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>19.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="19.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>19.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="19.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>19.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="19.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>19.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>19.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>20</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="20.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>20.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="20.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>20.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="20.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>20.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="20.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>20.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>21</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="21.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>21.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="running-the-simulation-process" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Running the Simulation Process<a href="running-the-simulation-process.html#running-the-simulation-process" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the prior two chapters we saw how to write functions that generate data according to a particular model and functions that implement data-analysis procedures on simulated data.
The next step in a simulation involves putting these two pieces together, running the DGP function and the data-analysis function repeatedly to obtain results (in the form of point estimates, standard errors, confidence intervals, p-values, or other quantities) from many replications of the whole process.</p>
<p>As with most things R-related, there are many different techniques that can be used to repeat a set of calculations over and over.
In this chapter, we demonstrate several techniques for doing so.
We then explain how to ensure reproducibility of simulation results by setting the seed used by R’s random number generator.</p>
<div id="repeating-oneself" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Repeating oneself<a href="running-the-simulation-process.html#repeating-oneself" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose that we want to simulate Pearson’s correlation coefficient calculated based on a sample from the bivariate Poisson function.
We saw a DGP function for the bivariate Poisson in Section <a href="data-generating-processes.html#DGP-functions">6.3</a>, and an estimation function in Section <a href="data-analysis-procedures.html#estimation-functions">7.1</a>.
To produce a simulated correlation coefficient, we need to run these two functions in turn:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="running-the-simulation-process.html#cb259-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>( <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span> )</span>
<span id="cb259-2"><a href="running-the-simulation-process.html#cb259-2" tabindex="-1"></a><span class="fu">r_and_z</span>(dat)</span></code></pre></div>
<pre><code>##           r         z     CI_lo     CI_hi
## 1 0.5332607 0.5946905 0.2141294 0.7495318</code></pre>
<p>To execute a simulation with these components, we need to repeat this set of calculations over and over.
R has many different functions for doing exactly this.
As one of many alternatives, the <code>simhelpers</code> package includes a function called <code>repeat_and_stack()</code>, which can be used to evaluate an arbitrary expression many times over.
We can use it to generate five replications of our correlation coefficient:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="running-the-simulation-process.html#cb261-1" tabindex="-1"></a><span class="fu">library</span>(simhelpers)</span>
<span id="cb261-2"><a href="running-the-simulation-process.html#cb261-2" tabindex="-1"></a><span class="fu">repeat_and_stack</span>(</span>
<span id="cb261-3"><a href="running-the-simulation-process.html#cb261-3" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">5</span>, </span>
<span id="cb261-4"><a href="running-the-simulation-process.html#cb261-4" tabindex="-1"></a>  {</span>
<span id="cb261-5"><a href="running-the-simulation-process.html#cb261-5" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>( <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span> )</span>
<span id="cb261-6"><a href="running-the-simulation-process.html#cb261-6" tabindex="-1"></a>    <span class="fu">r_and_z</span>(dat)</span>
<span id="cb261-7"><a href="running-the-simulation-process.html#cb261-7" tabindex="-1"></a>  }, </span>
<span id="cb261-8"><a href="running-the-simulation-process.html#cb261-8" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;rep&quot;</span>, </span>
<span id="cb261-9"><a href="running-the-simulation-process.html#cb261-9" tabindex="-1"></a>  <span class="at">stack =</span> <span class="cn">TRUE</span></span>
<span id="cb261-10"><a href="running-the-simulation-process.html#cb261-10" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   rep         r         z      CI_lo     CI_hi
## 1   1 0.6406898 0.7593429  0.3645711 0.8132451
## 2   2 0.2165457 0.2200290 -0.1558849 0.5350714
## 3   3 0.5664693 0.6423085  0.2590719 0.7696643
## 4   4 0.4534481 0.4890323  0.1113731 0.6994524
## 5   5 0.5044732 0.5552884  0.1762338 0.7317497</code></pre>
<p>The first argument specifies the number of times to repeat the calculation.
The second argument is an R expression that will be evaluated.
The expression is wrapped in curly braces (<code>{}</code>) because it involves more than a single line of code.
Including the option <code>id = "rep"</code> returns a dataset that includes a variable called <code>rep</code> to identify each replication of the process.
Setting the option <code>stack = TRUE</code> will stack up the output of each expression into a single tibble, which will facilitate later calculations on the results.
Setting this option is not necessary because it is <code>TRUE</code> by default; setting <code>stack = FALSE</code> will return the results in a list rather than a tibble (try this for yourself to see!).</p>
<p>There are many other functions that work very much like <code>repeat_and_stack()</code>, including the base-R function <code>replicate()</code> and the now-deprecated function <code>rerun()</code> from <code>{purrr}</code>.
The functions in the <code>map()</code> family from <code>{purrr}</code> can also be used to do the same thing as <code>repeat_and_stack()</code>.
See Appendix <a href="coding-tidbits.html#more-repeating-oneself">A.1</a> for more discussion of these alternatives.</p>
</div>
<div id="one-run-at-a-time" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> One run at a time<a href="running-the-simulation-process.html#one-run-at-a-time" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A slightly different technique for running multiple replications of a process is to first write a function that executes a single run of the simulation, and then repeatedly evaluate that single function.
For instance, here is a function that stitches together the two steps in the bivariate-Poisson correlation simulation:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="running-the-simulation-process.html#cb263-1" tabindex="-1"></a>one_bivariate_Poisson_r <span class="ot">&lt;-</span> <span class="cf">function</span>(N, rho, mu1, mu2) {</span>
<span id="cb263-2"><a href="running-the-simulation-process.html#cb263-2" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>( <span class="at">N =</span> N, <span class="at">rho =</span> rho, <span class="at">mu1 =</span> mu1, <span class="at">mu2 =</span> mu2 )</span>
<span id="cb263-3"><a href="running-the-simulation-process.html#cb263-3" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">r_and_z</span>(dat)</span>
<span id="cb263-4"><a href="running-the-simulation-process.html#cb263-4" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb263-5"><a href="running-the-simulation-process.html#cb263-5" tabindex="-1"></a>}</span></code></pre></div>
<p>Calling the function produces a nicely formatted set of results:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="running-the-simulation-process.html#cb264-1" tabindex="-1"></a><span class="fu">one_bivariate_Poisson_r</span>(<span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>)</span></code></pre></div>
<pre><code>##           r         z     CI_lo     CI_hi
## 1 0.5713896 0.6495836 0.2658458 0.7726132</code></pre>
<p>We can then evaluate the function over and over using <code>repeat_and_stack()</code>:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="running-the-simulation-process.html#cb266-1" tabindex="-1"></a><span class="fu">repeat_and_stack</span>(</span>
<span id="cb266-2"><a href="running-the-simulation-process.html#cb266-2" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">5</span>, </span>
<span id="cb266-3"><a href="running-the-simulation-process.html#cb266-3" tabindex="-1"></a>  <span class="fu">one_bivariate_Poisson_r</span>( <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span> ), </span>
<span id="cb266-4"><a href="running-the-simulation-process.html#cb266-4" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;rep&quot;</span></span>
<span id="cb266-5"><a href="running-the-simulation-process.html#cb266-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   rep         r         z       CI_lo     CI_hi
## 1   1 0.6920971 0.8519697  0.44204893 0.8423369
## 2   2 0.4639223 0.5022978  0.12445393 0.7061652
## 3   3 0.5054484 0.5565974  0.17750188 0.7323572
## 4   4 0.3102351 0.3208056 -0.05632999 0.6030973
## 5   5 0.2699476 0.2768073 -0.10005206 0.5743583</code></pre>
<p>This technique of wrapping the data-generating function and estimation function inside of another function might strike you as a bit cumbersome because the wrapper is only two lines of code and writing it requires repeating many of the function argument names when calling the data-generating function (<code>N = N, rho = rho</code>, etc.).
However, the wrapper technique can be useful for more complicated simulations, such as those that involve comparison of multiple estimation methods.</p>
<p>Consider the cluster-randomized experiment case study presented in Section <a href="data-generating-processes.html#case-cluster">6.6</a> and <a href="data-analysis-procedures.html#multiple-estimation-procedures">7.2</a>.
In this simulation, we are interested in comparing the performance of three different estimation methods: a multi-level model, a linear regression with clustered standard errors, and a linear regression on the data aggregated to the school level.
A single replication of the simulation entails generating a dataset and then applying three different estimation functions to it.
Here is a function that takes our simulation parameters and runs a single trial of the full process:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="running-the-simulation-process.html#cb268-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( </span>
<span id="cb268-2"><a href="running-the-simulation-process.html#cb268-2" tabindex="-1"></a>  <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> <span class="fl">0.3</span>, <span class="at">gamma_2 =</span> <span class="fl">0.5</span>,</span>
<span id="cb268-3"><a href="running-the-simulation-process.html#cb268-3" tabindex="-1"></a>  <span class="at">sigma2_u =</span> <span class="fl">0.20</span>, <span class="at">sigma2_e =</span> <span class="fl">0.80</span>, <span class="at">alpha =</span> <span class="fl">0.75</span> </span>
<span id="cb268-4"><a href="running-the-simulation-process.html#cb268-4" tabindex="-1"></a>) {</span>
<span id="cb268-5"><a href="running-the-simulation-process.html#cb268-5" tabindex="-1"></a>  </span>
<span id="cb268-6"><a href="running-the-simulation-process.html#cb268-6" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">gen_cluster_RCT</span>(</span>
<span id="cb268-7"><a href="running-the-simulation-process.html#cb268-7" tabindex="-1"></a>    <span class="at">n_bar =</span> n_bar, <span class="at">J =</span> J, <span class="at">gamma_1 =</span> gamma_1, <span class="at">gamma_2 =</span> gamma_2,</span>
<span id="cb268-8"><a href="running-the-simulation-process.html#cb268-8" tabindex="-1"></a>    <span class="at">sigma2_u =</span> sigma2_u, <span class="at">sigma2_e =</span> sigma2_e, <span class="at">alpha =</span> alpha </span>
<span id="cb268-9"><a href="running-the-simulation-process.html#cb268-9" tabindex="-1"></a>  )</span>
<span id="cb268-10"><a href="running-the-simulation-process.html#cb268-10" tabindex="-1"></a>  MLM <span class="ot">&lt;-</span> <span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb268-11"><a href="running-the-simulation-process.html#cb268-11" tabindex="-1"></a>  LR <span class="ot">&lt;-</span> <span class="fu">analysis_OLS</span>( dat )</span>
<span id="cb268-12"><a href="running-the-simulation-process.html#cb268-12" tabindex="-1"></a>  Agg <span class="ot">&lt;-</span> <span class="fu">analysis_agg</span>( dat )</span>
<span id="cb268-13"><a href="running-the-simulation-process.html#cb268-13" tabindex="-1"></a>  </span>
<span id="cb268-14"><a href="running-the-simulation-process.html#cb268-14" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">MLM =</span> MLM, <span class="at">LR =</span> LR, <span class="at">Agg =</span> Agg, <span class="at">.id =</span> <span class="st">&quot;method&quot;</span> )</span>
<span id="cb268-15"><a href="running-the-simulation-process.html#cb268-15" tabindex="-1"></a>}</span></code></pre></div>
<p>We have added a bunch of defaults to our function, so that we can run it without having to remember all the various input parameters.
When we call the function, we get a nicely structured table of results:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="running-the-simulation-process.html#cb269-1" tabindex="-1"></a><span class="fu">one_run</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">alpha=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   method ATE_hat SE_hat p_value
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 MLM      0.506  0.255  0.0630
## 2 LR       0.474  0.261  0.0881
## 3 Agg      0.511  0.255  0.0609</code></pre>
<p>We organize the output in a tibble to make it easier to do subsequent data processing and analysis.
The results for each method are organized in separate lines.
For each method, we record the impact estimate, its estimated standard error, and a nominal <span class="math inline">\(p\)</span>-value.
Note how the <code>bind_rows()</code> method can take naming on the fly, and give us a column of <code>method</code>, which will be very useful for keeping track of which results come from which estimation.</p>
<p>Once we have a function to execute a single run, we can produce multiple results using <code>repeat_and_stack()</code>:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="running-the-simulation-process.html#cb271-1" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb271-2"><a href="running-the-simulation-process.html#cb271-2" tabindex="-1"></a>ATE <span class="ot">&lt;-</span> <span class="fl">0.30</span></span>
<span id="cb271-3"><a href="running-the-simulation-process.html#cb271-3" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">repeat_and_stack</span>(R, </span>
<span id="cb271-4"><a href="running-the-simulation-process.html#cb271-4" tabindex="-1"></a>                         <span class="fu">one_run</span>( <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J=</span><span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE ),</span>
<span id="cb271-5"><a href="running-the-simulation-process.html#cb271-5" tabindex="-1"></a>                         <span class="at">id =</span> <span class="st">&quot;runID&quot;</span>) </span>
<span id="cb271-6"><a href="running-the-simulation-process.html#cb271-6" tabindex="-1"></a><span class="fu">saveRDS</span>( runs, <span class="at">file =</span> <span class="st">&quot;results/cluster_RCT_simulation.rds&quot;</span> )</span></code></pre></div>
<p>Setting <code>id = "runID"</code> lets us keep track of which iteration number produced which result.
Once our simulation is complete, we save our results to a file so that we can avoid having to re-run the full simulation if we want to explore the results in some future work session.</p>
<p>We now have results for each of our estimation methods applied to each of 1000 generated datasets.
The next step is to evaluate how well the estimators did.
For example, we will want to examine questions about bias, precision, and accuracy of the three point estimators.
In Chapter <a href="performance-criteria.html#performance-criteria">9</a>, we will look systematically at ways to quantify the performance of estimation methods.</p>
<div id="one-run-reparameterization" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Reparameterizing<a href="running-the-simulation-process.html#one-run-reparameterization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="data-generating-processes.html#DGP-standardization">6.6.4</a>, we discussed how to index the DGP of the cluster-randomized experiment using an intra-class correlation (ICC) instead of using two separate variance components.
This type of re-parameterization can be handled as part of writing a wrapper function for executing the DGP and estimation procedures.
Here is a revised version of <code>one_run()</code>, which also renames some of the more obscure model parameters using terms that are easier to interpret:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="running-the-simulation-process.html#cb272-1" tabindex="-1"></a>one_run <span class="ot">&lt;-</span> <span class="cf">function</span>( </span>
<span id="cb272-2"><a href="running-the-simulation-process.html#cb272-2" tabindex="-1"></a>  <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">ATE =</span> <span class="fl">0.3</span>, <span class="at">size_coef =</span> <span class="fl">0.5</span>,</span>
<span id="cb272-3"><a href="running-the-simulation-process.html#cb272-3" tabindex="-1"></a>  <span class="at">ICC =</span> <span class="fl">0.4</span>, <span class="at">alpha =</span> <span class="fl">0.75</span> </span>
<span id="cb272-4"><a href="running-the-simulation-process.html#cb272-4" tabindex="-1"></a>) {</span>
<span id="cb272-5"><a href="running-the-simulation-process.html#cb272-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>( ICC <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> ICC <span class="sc">&lt;</span> <span class="dv">1</span> )</span>
<span id="cb272-6"><a href="running-the-simulation-process.html#cb272-6" tabindex="-1"></a></span>
<span id="cb272-7"><a href="running-the-simulation-process.html#cb272-7" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">gen_cluster_RCT</span>( </span>
<span id="cb272-8"><a href="running-the-simulation-process.html#cb272-8" tabindex="-1"></a>    <span class="at">n_bar =</span> n_bar, <span class="at">J=</span>J, <span class="at">gamma_1 =</span> ATE, <span class="at">gamma_2 =</span> size_coef,</span>
<span id="cb272-9"><a href="running-the-simulation-process.html#cb272-9" tabindex="-1"></a>    <span class="at">sigma2_u =</span> ICC, <span class="at">sigma2_e =</span> <span class="dv">1</span><span class="sc">-</span>ICC, <span class="at">alpha =</span> alpha </span>
<span id="cb272-10"><a href="running-the-simulation-process.html#cb272-10" tabindex="-1"></a>  )</span>
<span id="cb272-11"><a href="running-the-simulation-process.html#cb272-11" tabindex="-1"></a>  </span>
<span id="cb272-12"><a href="running-the-simulation-process.html#cb272-12" tabindex="-1"></a>  MLM <span class="ot">=</span> <span class="fu">analysis_MLM</span>( dat )</span>
<span id="cb272-13"><a href="running-the-simulation-process.html#cb272-13" tabindex="-1"></a>  LR <span class="ot">=</span> <span class="fu">analysis_OLS</span>( dat )</span>
<span id="cb272-14"><a href="running-the-simulation-process.html#cb272-14" tabindex="-1"></a>  Agg <span class="ot">=</span> <span class="fu">analysis_agg</span>( dat )</span>
<span id="cb272-15"><a href="running-the-simulation-process.html#cb272-15" tabindex="-1"></a>  </span>
<span id="cb272-16"><a href="running-the-simulation-process.html#cb272-16" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">MLM =</span> MLM, <span class="at">LR =</span> LR, <span class="at">Agg =</span> Agg, <span class="at">.id =</span> <span class="st">&quot;method&quot;</span> )</span>
<span id="cb272-17"><a href="running-the-simulation-process.html#cb272-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Note the <code>stopifnot</code>: it is wise to ensure our parameter transforms are all reasonable, so we do not get unexplained errors or strange results later on.
It is best if your code fails as soon as possible! Otherwise debugging can be quite hard.
<!-- JEP: This seems like a tangent. --></p>
<p>Controlling how we use the foundational elements such as our data generating code is a key technique for making the higher level simulations sensible and more easily interpretable.
In the revised <code>one_run()</code> function, we transform the <code>ICC</code> input parameter into the parameters used by <code>gen_cluster_RCT()</code> so as to maintain the effect size interpretation of our simulation.
We have not modified <code>gen_cluster_RCT()</code> at all: instead, we specify the parameters of the DGP function in terms of the parameters we want to directly control in the simulation.
Here we have put our entire simulation into effect size units, and are now providing “knobs” to the simulation that are directly interpretable.</p>
</div>
</div>
<div id="bundle-sim-demo" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Bundling simulations with <code>simhelpers</code><a href="running-the-simulation-process.html#bundle-sim-demo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The techniques that we have demonstrated for repeating a set of calculations each involve a very specific coding pattern, which will often have the same structure even if the details of the data-generating model or the names of the input parameters are very different from the examples we have presented.
The <code>simhelpers</code> package provides a function <code>bundle_sim()</code> that abstracts this common pattern and allows you to automatically stitch together (or “bundle”) a DGP function and an estimation function, so that they can be run once or multiple times.
Thus, <code>bundle_sim()</code> provides a convenient alternative to writing your own <code>one_run()</code> function for each simulation, thereby saving a bit of typing (and avoiding an opportunity for bugs to creep into your code).</p>
<p><code>bundle_sim()</code> takes a DGP function and an estimation function as inputs and gives us back a new function that will run a simulation using whatever parameters we give it.
Here is a basic example, which creates a function for simulating Pearson correlation coefficients with a bivariate Poisson distribution:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="running-the-simulation-process.html#cb273-1" tabindex="-1"></a>sim_r_Poisson <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>(<span class="at">f_generate =</span> r_bivariate_Poisson, </span>
<span id="cb273-2"><a href="running-the-simulation-process.html#cb273-2" tabindex="-1"></a>                            <span class="at">f_analyze =</span> r_and_z, </span>
<span id="cb273-3"><a href="running-the-simulation-process.html#cb273-3" tabindex="-1"></a>                            <span class="at">id =</span> <span class="st">&quot;rep&quot;</span>)</span></code></pre></div>
<p>If we specify the optional argument <code>id = "rep"</code>, the function will include a variable called <code>rep</code> with a unique identifier for each replication of the simulation process.
We can use the newly created function like so:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="running-the-simulation-process.html#cb274-1" tabindex="-1"></a><span class="fu">sim_r_Poisson</span>( <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>)</span></code></pre></div>
<pre><code>##   rep         r         z      CI_lo     CI_hi
## 1   1 0.4584003 0.4952841  0.1175430 0.7026316
## 2   2 0.2136916 0.2170364 -0.1588034 0.5329322
## 3   3 0.4675940 0.5069866  0.1290674 0.7085081
## 4   4 0.6562349 0.7861718  0.3876033 0.8221341</code></pre>
<p>To create this simulation function, <code>bundle_sim()</code> examined <code>r_bivariate_Poisson()</code>, figured out what its input arguments are, and made sure that the simulation function includes the same input arguments.
You can see the full set of arguments for <code>sim_r_Poisson()</code> by evaluating it with <code>args()</code>:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="running-the-simulation-process.html#cb276-1" tabindex="-1"></a><span class="fu">args</span>(sim_r_Poisson)</span></code></pre></div>
<pre><code>## function (reps, N, mu1, mu2, rho = 0, seed = NA_integer_) 
## NULL</code></pre>
<p>In addition to the expected arguments from <code>r_bivariate_Poisson()</code>, the function has some additional inputs.
Its first argument is <code>reps</code>, which controls the number of times that the simulation process will be evaluated.
Its last argument is <code>seed</code>, which we will discuss in Section <a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs">8.4</a>.</p>
<p>The <code>bundle_sim()</code> function requires specifying a DGP function and a <em>single</em> estimation function, with the data as the first argument.
For our cluster-randomized experiment example, we would then need to use our <code>estimate_Tx_Fx()</code> function that organizes all of the estimators (see Chapter <a href="data-analysis-procedures.html#multiple-estimation-procedures">7.2</a>).
We then use <code>bundle_sim()</code> to create a function for running an entire simulation:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="running-the-simulation-process.html#cb278-1" tabindex="-1"></a>sim_cluster_RCT <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>( gen_cluster_RCT, estimate_Tx_Fx, <span class="at">id =</span> <span class="st">&quot;runID&quot;</span> )</span></code></pre></div>
<p>We can call the newly created function like so:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="running-the-simulation-process.html#cb279-1" tabindex="-1"></a><span class="fu">sim_cluster_RCT</span>( <span class="dv">2</span>, </span>
<span id="cb279-2"><a href="running-the-simulation-process.html#cb279-2" tabindex="-1"></a>                 <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE, </span>
<span id="cb279-3"><a href="running-the-simulation-process.html#cb279-3" tabindex="-1"></a>                 <span class="at">sigma2_u =</span> <span class="fl">0.3</span>, <span class="at">sigma2_e =</span> <span class="fl">0.7</span> )</span></code></pre></div>
<pre><code>##   runID estimator   ATE_hat    SE_hat     p_value
## 1     1       MLM 1.0718041 0.3464600 0.009834928
## 2     1       OLS 0.8725333 0.3581403 0.041659400
## 3     1       agg 1.1574631 0.4486484 0.018880161
## 4     2       MLM 0.3975797 0.2379827 0.111564711
## 5     2       OLS 0.4656465 0.2686438 0.111156240
## 6     2       agg 0.3142312 0.2140596 0.159372293</code></pre>
<p>Again, <code>bundle_sim()</code> produces a function with input names that exactly match the inputs of the DGP function that we give it.
It is not possible to re-parameterize or change argument names, as we did with <code>one_run()</code> in Section <a href="running-the-simulation-process.html#one-run-reparameterization">8.2.1</a>.
See Exercise <a href="running-the-simulation-process.html#reparameterization-redux">8.5.3</a> for further discussion of this limitation.</p>
<p>To use the simulation function in practice, we call it by specifying the number of replications desired (which we have stored in <code>R</code>) and any relevant input parameters.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="running-the-simulation-process.html#cb281-1" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">sim_cluster_RCT</span>( R, </span>
<span id="cb281-2"><a href="running-the-simulation-process.html#cb281-2" tabindex="-1"></a>                         <span class="at">n_bar =</span> <span class="dv">30</span>, <span class="at">J =</span> <span class="dv">20</span>, <span class="at">gamma_1 =</span> ATE, </span>
<span id="cb281-3"><a href="running-the-simulation-process.html#cb281-3" tabindex="-1"></a>                         <span class="at">sigma2_u =</span> <span class="fl">0.3</span>, <span class="at">sigma2_e =</span> <span class="fl">0.7</span> )</span>
<span id="cb281-4"><a href="running-the-simulation-process.html#cb281-4" tabindex="-1"></a><span class="fu">saveRDS</span>( runs, <span class="at">file =</span> <span class="st">&quot;results/cluster_RCT_simulation.rds&quot;</span> )</span></code></pre></div>
<p>The <code>bundle_sim()</code> function is just a convenient way to create a function that pieces together the steps in the simulation process, which is especially useful when the component functions include many input parameters.
The function has several further features, which we will demonstrate in subsequent chapters.</p>
</div>
<div id="seeds-and-pseudo-RNGs" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Seeds and pseudo-random number generators<a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In prior chapters, we have used built-in functions to generate random numbers and also written our own data-generating functions that produce artificial data following a specific random process.
With either type of function, re-running it with the exact same input parameters will produce different results.
For instance, running the <code>rchisq</code> function with the same set of inputs will produce two different sequences of <span class="math inline">\(\chi^2\)</span> random variables:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="running-the-simulation-process.html#cb282-1" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb282-2"><a href="running-the-simulation-process.html#cb282-2" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb282-3"><a href="running-the-simulation-process.html#cb282-3" tabindex="-1"></a><span class="fu">rbind</span>(c1, c2)</span></code></pre></div>
<pre><code>##        [,1]     [,2]     [,3]     [,4]
## c1 2.859183 2.925194 9.362208 2.502835
## c2 3.495920 5.326844 1.008615 2.359409</code></pre>
<p>If you run the same code as above, you will get different results from these.
Likewise, running the bivariate Poisson function from Section <a href="data-generating-processes.html#DGP-functions">6.3</a> or the <code>sim_r_Poisson()</code> function from Section <a href="running-the-simulation-process.html#bundle-sim-demo">8.3</a> multiple times will produce different datasets:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="running-the-simulation-process.html#cb284-1" tabindex="-1"></a>dat_A <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>(<span class="dv">20</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">mu1 =</span> <span class="dv">4</span>, <span class="at">mu2 =</span> <span class="dv">7</span>)</span>
<span id="cb284-2"><a href="running-the-simulation-process.html#cb284-2" tabindex="-1"></a>dat_B <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>(<span class="dv">20</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">mu1 =</span> <span class="dv">4</span>, <span class="at">mu2 =</span> <span class="dv">7</span>)</span>
<span id="cb284-3"><a href="running-the-simulation-process.html#cb284-3" tabindex="-1"></a><span class="fu">identical</span>(dat_A, dat_B)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="running-the-simulation-process.html#cb286-1" tabindex="-1"></a>sim_A <span class="ot">&lt;-</span> <span class="fu">sim_r_Poisson</span>( <span class="dv">10</span>, <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>)</span>
<span id="cb286-2"><a href="running-the-simulation-process.html#cb286-2" tabindex="-1"></a>sim_B <span class="ot">&lt;-</span> <span class="fu">sim_r_Poisson</span>( <span class="dv">10</span>, <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>)</span>
<span id="cb286-3"><a href="running-the-simulation-process.html#cb286-3" tabindex="-1"></a><span class="fu">identical</span>(sim_A, sim_B)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Of course, this is the intended behavior of these functions, but it has an important consequence that needs some care and attention.
Using functions like <code>rchisq()</code>, <code>r_bivariate_Poisson()</code>, or <code>r_bivariate_Poisson()</code> in a simulation study means that the results will not be fully reproducible.</p>
<p>When using DGP functions for simulations, it is useful to be able to exactly control the process of generating random numbers.
This is much more feasible than it sounds: Monte Carlo simulations are random, at least in theory, but computers are deterministic.
When we use R to generate what we have been referring to as “random numbers,” the functions produce what are actually <em>pseudo-random</em> numbers.
Pseudo-random numbers are generated from chains of mathematical equations designed to produce sequences of numbers that appear random, but actually follow a deterministic sequence.
Each subsequent random number is a calculated by starting from the previously generated value (i.e., the current state of the random number generator), applying a complicated function, and storing the result (i.e., updating the state).
The numbers returned by the generator form a chain that, ideally, cycles through an extremely long list of values in a way that looks stochastic and unpredictable.</p>
<p>The state of the pseudo-random number generator is shared across different functions that produce pseudo-random numbers, so it does not matter if we are generating numbers with <code>rnorm()</code> or <code>rchisq()</code> or <code>r_bivariate_Poisson()</code>.
Each time we ask for a random number from the generator, its state is updated.
Functions like <code>rnorm()</code> and <code>rchisq()</code> all call the low-level generator and then transform the result to be of the correct distribution.</p>
<p>Because the generator is actually deterministic, we can control its output by specify a starting value or initial state,
In R, the state of the random number generator can be controlled by setting what its known as the seed.
The <code>set.seed()</code> function allows us to specify a seed value, so that we can exactly reproduce a calculation.
For example,</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="running-the-simulation-process.html#cb288-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb288-2"><a href="running-the-simulation-process.html#cb288-2" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb288-3"><a href="running-the-simulation-process.html#cb288-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb288-4"><a href="running-the-simulation-process.html#cb288-4" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb288-5"><a href="running-the-simulation-process.html#cb288-5" tabindex="-1"></a><span class="fu">rbind</span>(c1, c2)</span></code></pre></div>
<pre><code>##        [,1]    [,2]     [,3]     [,4]
## c1 2.575556 0.93847 8.062264 3.685932
## c2 2.575556 0.93847 8.062264 3.685932</code></pre>
<p>Similarly, we can set the seed and run a series of calculations involving multiple functions that make use of the random number generator:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="running-the-simulation-process.html#cb290-1" tabindex="-1"></a><span class="co"># First time</span></span>
<span id="cb290-2"><a href="running-the-simulation-process.html#cb290-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb290-3"><a href="running-the-simulation-process.html#cb290-3" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb290-4"><a href="running-the-simulation-process.html#cb290-4" tabindex="-1"></a>dat_A <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>(<span class="dv">20</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">mu1 =</span> <span class="dv">4</span>, <span class="at">mu2 =</span> <span class="dv">7</span>)</span>
<span id="cb290-5"><a href="running-the-simulation-process.html#cb290-5" tabindex="-1"></a></span>
<span id="cb290-6"><a href="running-the-simulation-process.html#cb290-6" tabindex="-1"></a><span class="co"># Exactly reproduce the calculations</span></span>
<span id="cb290-7"><a href="running-the-simulation-process.html#cb290-7" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb290-8"><a href="running-the-simulation-process.html#cb290-8" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">rchisq</span>(<span class="dv">4</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb290-9"><a href="running-the-simulation-process.html#cb290-9" tabindex="-1"></a>dat_B <span class="ot">&lt;-</span> <span class="fu">r_bivariate_Poisson</span>(<span class="dv">20</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">mu1 =</span> <span class="dv">4</span>, <span class="at">mu2 =</span> <span class="dv">7</span>)</span>
<span id="cb290-10"><a href="running-the-simulation-process.html#cb290-10" tabindex="-1"></a></span>
<span id="cb290-11"><a href="running-the-simulation-process.html#cb290-11" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">A =</span> <span class="fu">r_and_z</span>(dat_A), <span class="at">B =</span> <span class="fu">r_and_z</span>(dat_B), <span class="at">.id =</span> <span class="st">&quot;Rep&quot;</span>)</span></code></pre></div>
<pre><code>##   Rep         r         z      CI_lo     CI_hi
## 1   A 0.2990194 0.3084424 -0.1653856 0.6548844
## 2   B 0.2990194 0.3084424 -0.1653856 0.6548844</code></pre>
<p>The <code>bundle_sim()</code> function demonstrated in Section <a href="running-the-simulation-process.html#bundle-sim-demo">8.3</a> creates a function for repeating the process of generating and analyzing data.
By default, the function it produces includes an argument <code>seed</code>, which allows the user to set a seed value before repeatedly evaluating the DGP function and estimation function.
By default, the <code>seed</code> argument is <code>NULL</code> and so the current seed is not modified.
Specifying an integer-valued seed will make the results exactly reproducible:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="running-the-simulation-process.html#cb292-1" tabindex="-1"></a>sim_A <span class="ot">&lt;-</span> <span class="fu">sim_r_Poisson</span>( <span class="dv">10</span>, <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>,</span>
<span id="cb292-2"><a href="running-the-simulation-process.html#cb292-2" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">25</span>)</span>
<span id="cb292-3"><a href="running-the-simulation-process.html#cb292-3" tabindex="-1"></a>sim_B <span class="ot">&lt;-</span> <span class="fu">sim_r_Poisson</span>( <span class="dv">10</span>, <span class="at">N =</span> <span class="dv">30</span>, <span class="at">rho =</span> <span class="fl">0.4</span>, <span class="at">mu1 =</span> <span class="dv">8</span>, <span class="at">mu2 =</span> <span class="dv">14</span>,</span>
<span id="cb292-4"><a href="running-the-simulation-process.html#cb292-4" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">25</span>)</span>
<span id="cb292-5"><a href="running-the-simulation-process.html#cb292-5" tabindex="-1"></a><span class="fu">identical</span>(sim_A, sim_B)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>In practice, it is a good idea to always set seed values for your simulations, so that you (or someone else) can exactly reproduce the results.
Attending to reproducibility allows us to easily check if we are running the same code that generated a set of results.
For instance, try running the previous blocks of code on your machine; if you set the seed to the same value as we did, you should get identical output.</p>
<p>Setting seeds is also very helpful for debugging.
Suppose we had an error that showed up in one of a thousand replications, causing the simulation to crash sometimes.
If we set a seed and find that the code crashes, we can debug and then rerun the simulation.
If it now runs without error, we know we fixed the problem.
If we had not set the seed, we would not know if we were just getting (un)lucky, and avoiding the error by chance.</p>
<!-- JEP: Seems an odd place to end. Any short concluding thoughts about the whole chapter? -->
</div>
<div id="exercises-5" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Exercises<a href="running-the-simulation-process.html#exercises-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="Welch-simulation" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Welch simulations<a href="running-the-simulation-process.html#Welch-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the prior chapter’s exercises, you made a new <code>BF_F</code> function for the Welch simulation. Now incorporate the <code>BF_F</code> function into the <code>one_run()</code> function, and use your revised function to generate simulation results for this additional estimator.</p>
</div>
<div id="Pearson-sampling-distributions" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Compare sampling distributions of Pearson’s correlation coefficients<a href="running-the-simulation-process.html#Pearson-sampling-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>sim_r_Poisson()</code> to generate 5000 replications of the Fisher-z-transformed correlation coefficient under a bivariate Poisson distribution with <span class="math inline">\(\rho = 0.7\)</span> for a sample of <span class="math inline">\(N = 40\)</span> observations. You pick the remaining parameters.</p></li>
<li><p>Create a bundled simulation function by combining the data-generating function from Exercise <a href="data-generating-processes.html#BVNB1">6.9.5</a> or <a href="data-generating-processes.html#BVNB2">6.9.6</a> with the <code>r_and_z()</code> estimation function. Run the function to generate 5000 replications of the Fisher-z-transformed correlation coefficient under a bivariate negative binomial distribution, with the same parameter values as above.</p></li>
<li><p>Create a plot that shows both sampling distributions, making it easy to compare the distributions.</p></li>
</ol>
</div>
<div id="reparameterization-redux" class="section level3 hasAnchor" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Reparameterization, redux<a href="running-the-simulation-process.html#reparameterization-redux" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Section <a href="running-the-simulation-process.html#one-run-reparameterization">8.2.1</a>, we illustrated how the <code>one_run()</code> simulation wrapper function could be tweaked in order to reparameterize the model in terms of a single intra-class correlation rather than two variance parameters.
But what if you want to avoid having to write your own simulation wrapper and instead use <code>bundle_sim()</code>?
Revise <code>gen_cluster_RCT()</code> to accomplish the reparameterization, then bundle it with <code>analyze_data()</code>.</p>
</div>
<div id="fancy-cluster-RCT-sims" class="section level3 hasAnchor" number="8.5.4">
<h3><span class="header-section-number">8.5.4</span> Fancy clustered RCT simulations<a href="running-the-simulation-process.html#fancy-cluster-RCT-sims" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Exercise <a href="data-generating-processes.html#cluster-RCT-baseline">6.9.10</a>, your task was to write a data-generating function for a cluster-randomized trial that includes a baseline covariate.
Then in Exercise <a href="data-analysis-procedures.html#CRT-ANCOVA-estimators">7.5.4</a>, your task was to create an estimation function that could be applied to data from such a trial.</p>
<ol style="list-style-type: decimal">
<li><p>Now, using your work from these exercises, create a bundled simulation function that combines the data-generating function and the estimation function. Ensure that the estimation function returns average treatment effect estimates both with and without controlling for the baseline covariate.</p></li>
<li><p>Use the resulting function to simulate results from 1000 replications of a cluster-randomized trial, each analyzed two ways (with and without covariate adjustment).</p></li>
<li><p>Create a plot that shows the sampling distribution of each average treatment effect estimator in a way that makes it easy to compare the distributions.</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-analysis-procedures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="performance-criteria.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/035-running-simulation.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
