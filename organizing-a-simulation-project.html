<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Organizing a simulation project | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Organizing a simulation project | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Organizing a simulation project | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simulations-as-evidence.html"/>
<link rel="next" href="parallel-processing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance metrics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Metrics for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-criteria.html"><a href="performance-criteria.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performances of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-criteria.html"><a href="performance-criteria.html#less-conventional-performance-metrics"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-standard-error-estimators"><i class="fa fa-check"></i><b>9.2</b> Metrics for Standard Error Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.1</b> Assessing SEs for Our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Metrics for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Metrics for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-our-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in our Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Selecting Relative vs. Absolute Metrics</a></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.6</b> Summary of Peformance Measures</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="performance-criteria.html"><a href="performance-criteria.html#windsorization-to-control-outliers"><i class="fa fa-check"></i><b>9.6.1</b> Windsorization to control outliers</a></li>
<li class="chapter" data-level="9.6.2" data-path="performance-criteria.html"><a href="performance-criteria.html#correlation-measures-vs-absolute-performance"><i class="fa fa-check"></i><b>9.6.2</b> Correlation measures vs absolute performance</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures-1"><i class="fa fa-check"></i><b>9.7</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#implicit-estimands"><i class="fa fa-check"></i><b>9.8</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#MCSE"><i class="fa fa-check"></i><b>9.9</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.9.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.9.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.9.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="performance-criteria.html"><a href="performance-criteria.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.10</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.11" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.11</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.11.1" data-path="performance-criteria.html"><a href="performance-criteria.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.11.1</b> Brown and Forsythe (1974)</a></li>
<li class="chapter" data-level="9.11.2" data-path="performance-criteria.html"><a href="performance-criteria.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.11.2</b> Jackknife calculation of MCSEs</a></li>
<li class="chapter" data-level="9.11.3" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.11.3</b> Distribution theory for person-level average treatment effects</a></li>
<li class="chapter" data-level="9.11.4" data-path="performance-criteria.html"><a href="performance-criteria.html#multiple-scenario-performance"><i class="fa fa-check"></i><b>9.11.4</b> Multiple scenarios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>10</b> Designing and executing multifactor simulations</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>10.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="10.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.3</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exp-design.html"><a href="exp-design.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="exp-design.html"><a href="exp-design.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>10.5</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>10.5.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="10.5.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>10.5.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="10.5.3" data-path="exp-design.html"><a href="exp-design.html#running-the-simulations"><i class="fa fa-check"></i><b>10.5.3</b> Running the simulations</a></li>
<li class="chapter" data-level="10.5.4" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>10.5.4</b> Calculating performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="exp-design.html"><a href="exp-design.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="exp-design.html"><a href="exp-design.html#brown-and-forsythe-redux"><i class="fa fa-check"></i><b>10.6.1</b> Brown and Forsythe redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="exp-design.html"><a href="exp-design.html#meta-regression"><i class="fa fa-check"></i><b>10.6.2</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.3" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.3</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>11</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="11.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>11.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>11.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>11.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>11.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="11.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="11.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>11.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="11.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>11.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="11.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>11.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>11.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>11.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="11.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>11.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>11.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>12</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>12.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="12.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>12.2</b> Bundling</a></li>
<li class="chapter" data-level="12.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>12.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-true-ses"><i class="fa fa-check"></i><b>12.4</b> Assessing true SEs</a></li>
<li class="chapter" data-level="12.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>12.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="12.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-estimated-ses"><i class="fa fa-check"></i><b>12.6</b> Assessing estimated SEs</a></li>
<li class="chapter" data-level="12.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>12.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="12.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>12.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="12.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>12.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="12.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>12.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="12.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>12.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>13</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="13.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>13.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>13.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="13.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>13.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>13.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="13.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>13.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>13.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>13.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>14.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>15</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="15.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>15.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>15.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="15.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>15.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="15.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>15.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="15.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>15.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="15.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>15.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="15.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>15.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>16</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="16.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>16.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>16.1.1</b> The source command</a></li>
<li class="chapter" data-level="16.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>16.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="16.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>16.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>16.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="16.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>16.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>16.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="16.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>16.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="16.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>16.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="16.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>16.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>17</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="17.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>17.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="17.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>17.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="17.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>17.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>17.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="17.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>17.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="17.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>17.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="17.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>17.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="17.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>17.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="17.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>17.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>18</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>18.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="18.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>18.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="18.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>18.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="18.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>18.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>18.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="19" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>19</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>19.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="19.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>19.2</b> The data generating process</a></li>
<li class="chapter" data-level="19.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>19.3</b> Running the simulation</a></li>
<li class="chapter" data-level="19.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>19.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>19.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="19.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>19.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="19.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>19.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="19.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>19.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>19.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>20</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="20.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>20.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="20.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>20.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="20.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>20.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="20.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>20.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>21</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="21.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>21.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="organizing-a-simulation-project" class="section level1 hasAnchor" number="16">
<h1><span class="header-section-number">Chapter 16</span> Organizing a simulation project<a href="organizing-a-simulation-project.html#organizing-a-simulation-project" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As we saw earlier, a full multifactor simulation can generate a lot of output that can be hard to navigate.
They are complex, multifaceted projects by design.
This means that the project itself can be hard to manage.
It can be easy to become overwhelmed by a steady accumulation of scripts that generate data, analyze data, run simulations, and so on.</p>
<p>This section is designed to give you the computational skills and ideas that will make it easier to handle complex simulation projects.
We start with a discussion of file and project management, then turn to parallel processing, and finally close with some core programming habits that we have found useful for keeping on top of this type of sprawling complexity.</p>
<p>Simulations have two general phases: generate your results and analyze your results.
The ending of the first phase should be to save the generated results.
The beginning of the second phase should then be to load the results from a file and analyze them.
These phases can be in a separate ‘.R’ files.
Dividing your simulations in this way allows for easily changing how one <em>analyzes</em> an experiment without re-running the entire thing.</p>
<p>This is the simplest version of a general principle of a larger project: put code for different purposes in different files.</p>
<p>For example, at the minimum, for a complex multifactor simulation, you will likely have three general collections of code, not including the code to run the multifactor simulation itself:</p>
<ul>
<li>Code for generating data</li>
<li>Code for analyzing data</li>
<li>Code for running a single simulation scenario</li>
</ul>
<p>If each of these pieces is large and complex, you might consider putting them in three different <code>.R</code> files.
To do this, we need to talk about what kinds of R scripts exist, and also talk about how you can tell one script to load another script.</p>
<div id="well-structured-r-scripts" class="section level2 hasAnchor" number="16.1">
<h2><span class="header-section-number">16.1</span> Well structured R scripts<a href="organizing-a-simulation-project.html#well-structured-r-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In R, there are two critical file types that can hold R code: <code>.R</code> files (scripts) and <code>.Rmd</code> (or <code>.qmd</code>) markdown files.
The former just holds R code, while the latter holds a mix of R code and text.
The latter is what you would render (or knit) to make a final report–it will run the code, and mix the results in with the text to give a nicely formatted report with code, figures, tables, and other printout nicely embedded.
These are what is typically used for smaller projects—all the code and discussion of code would be in a single, convienent place.</p>
<p>For larger projects, you will be more dependant on the first type of file, the <code>.R</code> script.
Ideally, the principle of modular programming would be applied to these files.
Each <code>.R</code> file would hold a collection of code that is related to a single task.
There are two main types of of <code>.R</code> script: those that <em>just</em> have functions that can be used for other purposes (meaning that if you run them, the only thing that happens is you end up with some new functions in your current workspace), and those that are traditional scripts such that when you run them, R will do a variety of specified tasks.</p>
<div id="about-source-command" class="section level3 hasAnchor" number="16.1.1">
<h3><span class="header-section-number">16.1.1</span> The source command<a href="organizing-a-simulation-project.html#about-source-command" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inside of an R script you can “source” other <code>.R</code> files.
The <code>source()</code> command essentially “cuts and pastes” the contents of the given file into your R work session.
E.g.,</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="organizing-a-simulation-project.html#cb479-1" tabindex="-1"></a><span class="fu">source</span>( here<span class="sc">::</span><span class="fu">here</span>( <span class="st">&quot;R/data_generators.R&quot;</span> ) )</span>
<span id="cb479-2"><a href="organizing-a-simulation-project.html#cb479-2" tabindex="-1"></a><span class="fu">source</span>( here<span class="sc">::</span><span class="fu">here</span>( <span class="st">&quot;R/estimators.R&quot;</span> ) )</span>
<span id="cb479-3"><a href="organizing-a-simulation-project.html#cb479-3" tabindex="-1"></a><span class="fu">source</span>( here<span class="sc">::</span><span class="fu">here</span>( <span class="st">&quot;R/simulation_support.R&quot;</span> ) )</span></code></pre></div>
<p>If the named file has code to run, it will run it.
If the named file has a list of methods, those methods will now be available for use.
The <code>here::here()</code> command is a convenience function that allows you to specify a file path relative to your R project root directory, so you can easily find your files.</p>
<p>You can even source files inside files that are sourced.
For example, <code>simulation_support.R</code> could, inside it, source the other two files.
You would then only source the single simulation support file in your primary simulation script.</p>
<p>One reason for putting code in individual files is you can then have testing code in each of your files (in False blocks, see below), testing each of your components.
Then, when you are not focused on that component, you don’t have to look at that testing code.</p>
<p>Another good reason for this type of modular organizing is you can then allow for a whole simulation universe, writing a variety of data generators that together form a library of options.
You can then easily create different simulations that use your different pieces, in your larger project.</p>
<p>For example, in one recent simulation project on estimators for an Instrumental Variable analysis, we had several different data generators for generating different types of compliance patterns (IVs are often used to handle noncompliance in randomized experiments).
Our <code>data_generators.R</code> code file then had several methods.
When we sourced it, we end up wit the following list of methods:</p>
<pre><code>&gt; ls()
[1] &quot;describe_sim_data&quot;  &quot;make_dat&quot;           &quot;make.dat_1side&quot;     
[4] &quot;make_dat_1side_old&quot; &quot;make_dat_orig&quot;      &quot;make_dat_simple&quot;
[7] &quot;make_dat_tuned&quot;     &quot;rand_exp&quot;           &quot;summarize_sim_data&quot;</code></pre>
<p>The <code>describe()</code> and <code>summarize()</code> methods printed various statistics about a sample dataset; these are used to debug and understand how the generated data looks.
We also had a variety of different DGP methods because we had different versions that came up as we were trying to chase down errors in our estimators and understand strange behavior.</p>
<p>Putting the estimators in a different file also had a nice additional purpose: we also had an applied data example in our work, and we could simply source that single file and use those estimators on our actual data.
This ensured our simulation and applied analysis were perfectly aligned in terms of the estimators we were using.
Also, as we debugged our estimators and tweaked them, we immediately could re-run our applied analysis to update those results with minimal effort.</p>
<p>Modular programming is key.</p>
</div>
<div id="putting-headers-in-your-.r-file" class="section level3 hasAnchor" number="16.1.2">
<h3><span class="header-section-number">16.1.2</span> Putting headers in your .R file<a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you write a <code>.R</code> script, it is a good idea to put a header at the top of the file, giving a description of the file’s purpose.
Then, you can also put dividers in your file, e.g.,</p>
<pre><code>#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#
# Data generating functions ----
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#</code></pre>
<p>Note the <code>----</code> at the end of the middle line: if you add those trailing dashes, then if you click on the dropdown at the bottom of your RStudio, you will see a pop-up table of contents that allows you to quickly navigate to different parts of your source file.</p>
</div>
<div id="about-keeping-tests-with-FALSE" class="section level3 hasAnchor" number="16.1.3">
<h3><span class="header-section-number">16.1.3</span> Storing testing code in your scripts<a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you have an extended <code>.R</code> file with a list of functions, you might also want to store a lot of code that runs each function in turn, so you can easily remind yourself of what it does, or what the output looks like.
One way to keep this code around, but not have it run all the time when you run your script, is to put the code inside a “FALSE block,” that might look like so:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="organizing-a-simulation-project.html#cb482-1" tabindex="-1"></a><span class="co"># My testing code ----</span></span>
<span id="cb482-2"><a href="organizing-a-simulation-project.html#cb482-2" tabindex="-1"></a><span class="cf">if</span> ( <span class="cn">FALSE</span> ) {</span>
<span id="cb482-3"><a href="organizing-a-simulation-project.html#cb482-3" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">my_function</span>( <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span> )</span>
<span id="cb482-4"><a href="organizing-a-simulation-project.html#cb482-4" tabindex="-1"></a>  res</span>
<span id="cb482-5"><a href="organizing-a-simulation-project.html#cb482-5" tabindex="-1"></a>  <span class="co"># Some notes as to what I want to see.</span></span>
<span id="cb482-6"><a href="organizing-a-simulation-project.html#cb482-6" tabindex="-1"></a>  </span>
<span id="cb482-7"><a href="organizing-a-simulation-project.html#cb482-7" tabindex="-1"></a>  <span class="fu">sd</span>( res )</span>
<span id="cb482-8"><a href="organizing-a-simulation-project.html#cb482-8" tabindex="-1"></a>  <span class="co"># This should be around 20</span></span>
<span id="cb482-9"><a href="organizing-a-simulation-project.html#cb482-9" tabindex="-1"></a>}</span></code></pre></div>
<p>You can then, when you open and look at the script, paste the code inside the block into the console when you want to run it.
If you source the script, however, it will not run at all, and thus your code will source faster and not print out any extraneous output.
This is a good way to keep your testing code with the code it is testing.
When you want to work on just the part of the project captured by your script, you can work inside the single file very easily, ignoring the other parts of your project.</p>
<p>You can also (or instead) write testing code, which we will talk about further below.</p>
</div>
</div>
<div id="principled-directory-structures" class="section level2 hasAnchor" number="16.2">
<h2><span class="header-section-number">16.2</span> Principled directory structures<a href="organizing-a-simulation-project.html#principled-directory-structures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We <em>strongly advocate</em> keeping a well-organized directory for your simulation.
We recommend using RStudio, or a similar IDE, and having a directory structure like the following:</p>
<pre><code>my_project/
  proj.Rproj
  README.md
  R/
  data/
  results/
  scripts/
  test/</code></pre>
<p>For those who have written R pacakges, this structure will look familiar.
The <code>R/</code> directory is where you put your core R code.
We will have <code>.R</code> scripts that just hold our core methods; we can then “load” these scripts into our workspace as needed to gain access to those methods.
Saved methods might include the methods you have developed that you are planning on testing (unless they are in a separate package), and methods to generate data.
We <em>do not</em> put the scripts that run the actual simulation here. The <code>R/</code> folder is to store the building blocks of our simulation only, not the final scripts that use those blocks to run and analyze our simulations themselves.</p>
<p>The <code>data/</code> directory is where you put any data files you are using in your simulation.
The <code>results/</code> directory is where you will save any generated results of your simulation.
Sometimes it might be worth having <code>raw_results</code> and <code>results</code>, where <code>raw_results</code> are what you save as soon as you finish running the simulation, and <code>results</code> have final results where you may have merged and summarized the raw results.</p>
<p>The <code>scripts/</code> directory is where you put your scripts that run the simulation and analyze simulation results.
You will likely have one script that runs the simulation, and one or more scripts that analyze the results.</p>
<p>Finally, the <code>test/</code> directory is where you put any testing code you have written to test your methods.
You can even use the <code>testthat</code> package to write unit tests for your methods, and put those in the <code>test/</code> directory.
This structure is not required, but it is a good idea to have a well-organized project of some type.</p>
</div>
<div id="saving-files" class="section level2 hasAnchor" number="16.3">
<h2><span class="header-section-number">16.3</span> Saving simulation results<a href="organizing-a-simulation-project.html#saving-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Always save your simulation results to a file.
Simulations are painful and time consuming to run, and you will invariably want to analyze the results of them in a variety of different ways, once you have looked at your preliminary analysis.
We advocate saving your simulation as soon as it is complete.
But there are some ways to do better than that, such as saving as you go.
This can protect you if your simulation occasionally crashes, or if you want to rerun only parts of your simulation for some reason.</p>
<div id="saving-simulations-in-general" class="section level3 hasAnchor" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Saving simulations in general<a href="organizing-a-simulation-project.html#saving-simulations-in-general" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once your simulation has completed, you can save it like so:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="organizing-a-simulation-project.html#cb484-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb484-2"><a href="organizing-a-simulation-project.html#cb484-2" tabindex="-1"></a><span class="fu">write_csv</span>( res, <span class="st">&quot;results/simulation_CRT.csv&quot;</span> )</span></code></pre></div>
<p><code>write_csv()</code> is a tidyverse file-writing command; see “R for Data Science”
textbook, 11.5.</p>
<p>You can then load it, just before analysis, as so:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="organizing-a-simulation-project.html#cb485-1" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="st">&quot;results/simulation_CRT.csv&quot;</span> )</span></code></pre></div>
<p>There are two general tools for saving. The <code>read/write_csv</code> methods save your file in a way where you can open it with a spreadsheet program and look at it.
But your results should be in a vanilla, rectangular format (non-fancy data frame without list columns).</p>
<p>Alternatively, you can use the <code>saveRDS()</code> and <code>readRDS()</code> methods; these save objects to a file such that when you load them, they are as you left them.
The RDS saving keeps your R object as given.
The simpler format of a csv file means your factors, if you have them, may not preserve as factors, and so forth.</p>
</div>
<div id="saving-simulations-as-you-go" class="section level3 hasAnchor" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Saving simulations as you go<a href="organizing-a-simulation-project.html#saving-simulations-as-you-go" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are not sure you have time to run your entire simulation, or you think your computer might crash half way through, or something similar, you can save each chunk you run as you go, in its own file. You then stack those files at the end to get your final results.
With clever design, you can even then selectively delete files to rerun only parts of your larger simulation—but be sure to rerun everything from scratch before you run off and publish your results, to avoid embarrassing errors.</p>
<p>Here, for example, is a script from a research project examining how one might use post-stratification to improve the precision of an IV estimate.
This is the script that runs the simulation.
Note the sourcing of other scripts that have all the relevant functions; these are not important here.
Due to modular programming, we can see what this script does, even without those detail.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="organizing-a-simulation-project.html#cb486-1" tabindex="-1"></a><span class="fu">source</span>( <span class="st">&quot;R/simulation_functions.R&quot;</span> )</span>
<span id="cb486-2"><a href="organizing-a-simulation-project.html#cb486-2" tabindex="-1"></a></span>
<span id="cb486-3"><a href="organizing-a-simulation-project.html#cb486-3" tabindex="-1"></a><span class="cf">if</span> ( <span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;results/frags&quot;</span> ) ) {</span>
<span id="cb486-4"><a href="organizing-a-simulation-project.html#cb486-4" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="st">&quot;results/frags&quot;</span>)</span>
<span id="cb486-5"><a href="organizing-a-simulation-project.html#cb486-5" tabindex="-1"></a>}</span>
<span id="cb486-6"><a href="organizing-a-simulation-project.html#cb486-6" tabindex="-1"></a></span>
<span id="cb486-7"><a href="organizing-a-simulation-project.html#cb486-7" tabindex="-1"></a><span class="co"># Number of simulation replicates per scenario</span></span>
<span id="cb486-8"><a href="organizing-a-simulation-project.html#cb486-8" tabindex="-1"></a>R <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb486-9"><a href="organizing-a-simulation-project.html#cb486-9" tabindex="-1"></a></span>
<span id="cb486-10"><a href="organizing-a-simulation-project.html#cb486-10" tabindex="-1"></a><span class="co"># Do simulation breaking up R into this many chunks</span></span>
<span id="cb486-11"><a href="organizing-a-simulation-project.html#cb486-11" tabindex="-1"></a>M_CHUNK <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb486-12"><a href="organizing-a-simulation-project.html#cb486-12" tabindex="-1"></a></span>
<span id="cb486-13"><a href="organizing-a-simulation-project.html#cb486-13" tabindex="-1"></a><span class="do">###### Set up the multifactor simulation #######</span></span>
<span id="cb486-14"><a href="organizing-a-simulation-project.html#cb486-14" tabindex="-1"></a></span>
<span id="cb486-15"><a href="organizing-a-simulation-project.html#cb486-15" tabindex="-1"></a><span class="co"># chunkNo is a hack to make a bunch of smaller chunks for doing parallel more</span></span>
<span id="cb486-16"><a href="organizing-a-simulation-project.html#cb486-16" tabindex="-1"></a><span class="co"># efficiently.</span></span>
<span id="cb486-17"><a href="organizing-a-simulation-project.html#cb486-17" tabindex="-1"></a>factors <span class="ot">=</span> <span class="fu">expand_grid</span>( <span class="at">chunkNo =</span> <span class="dv">1</span><span class="sc">:</span>M_CHUNK,</span>
<span id="cb486-18"><a href="organizing-a-simulation-project.html#cb486-18" tabindex="-1"></a>                       <span class="at">N =</span> <span class="fu">c</span>( <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span> ),</span>
<span id="cb486-19"><a href="organizing-a-simulation-project.html#cb486-19" tabindex="-1"></a>                       <span class="at">pi_c =</span> <span class="fu">c</span>( <span class="fl">0.05</span>, <span class="fl">0.075</span>, <span class="fl">0.10</span> ),</span>
<span id="cb486-20"><a href="organizing-a-simulation-project.html#cb486-20" tabindex="-1"></a>                       <span class="at">nt_shift =</span> <span class="fu">c</span>( <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb486-21"><a href="organizing-a-simulation-project.html#cb486-21" tabindex="-1"></a>                       <span class="at">pred_comp =</span> <span class="fu">c</span>( <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span> ),</span>
<span id="cb486-22"><a href="organizing-a-simulation-project.html#cb486-22" tabindex="-1"></a>                       <span class="at">pred_Y =</span> <span class="fu">c</span>( <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span> ),</span>
<span id="cb486-23"><a href="organizing-a-simulation-project.html#cb486-23" tabindex="-1"></a>                       <span class="at">het_tx =</span> <span class="fu">c</span>( <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span> ),</span>
<span id="cb486-24"><a href="organizing-a-simulation-project.html#cb486-24" tabindex="-1"></a>                       <span class="at">sd0 =</span> <span class="dv">1</span></span>
<span id="cb486-25"><a href="organizing-a-simulation-project.html#cb486-25" tabindex="-1"></a>                       )</span>
<span id="cb486-26"><a href="organizing-a-simulation-project.html#cb486-26" tabindex="-1"></a>factors <span class="ot">&lt;-</span> factors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb486-27"><a href="organizing-a-simulation-project.html#cb486-27" tabindex="-1"></a>    <span class="at">reps =</span> R <span class="sc">/</span> M_CHUNK,</span>
<span id="cb486-28"><a href="organizing-a-simulation-project.html#cb486-28" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">16200320</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb486-29"><a href="organizing-a-simulation-project.html#cb486-29" tabindex="-1"></a>)</span></code></pre></div>
<p>This generates a data frame of all our factor combinations.
This is our list of “tasks” (each row of factors).
These tasks have repeats: the “chunks” means we do a portion of each scenario, as specified by our simulation factors, as a process.
This would allow for greater parallelization (e.g., if we had more cores), and also lets us save our work without finishing an entire scenario of, in this case, 1000 iterations.</p>
<p>To set up our simulation we make a little helper method to do one row.
With each row, once we have run it, we save it to disk.
This means if we kill our simulation half-way through, most of the work would be saved.
Our function is then going to either do the simulation (and save the result to disk immediately), or, if it can find the file with the results from a previous run, load those results from disk:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="organizing-a-simulation-project.html#cb487-1" tabindex="-1"></a>safe_run_sim <span class="ot">=</span> <span class="fu">safely</span>( run_sim )</span>
<span id="cb487-2"><a href="organizing-a-simulation-project.html#cb487-2" tabindex="-1"></a>file_saving_sim <span class="ot">=</span> <span class="cf">function</span>( chunkNo, seed, ... ) {</span>
<span id="cb487-3"><a href="organizing-a-simulation-project.html#cb487-3" tabindex="-1"></a>    fname <span class="ot">=</span> <span class="fu">paste0</span>( <span class="st">&quot;results/frags/fragment_&quot;</span>, chunkNo, <span class="st">&quot;_&quot;</span>, seed, <span class="st">&quot;.rds&quot;</span> )</span>
<span id="cb487-4"><a href="organizing-a-simulation-project.html#cb487-4" tabindex="-1"></a>    res <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb487-5"><a href="organizing-a-simulation-project.html#cb487-5" tabindex="-1"></a>    <span class="cf">if</span> ( <span class="sc">!</span><span class="fu">file.exists</span>(fname) ) {</span>
<span id="cb487-6"><a href="organizing-a-simulation-project.html#cb487-6" tabindex="-1"></a>        res <span class="ot">=</span> <span class="fu">safe_run_sim</span>( <span class="at">chunkNo=</span>chunkNo, <span class="at">seed=</span>seed, ... )</span>
<span id="cb487-7"><a href="organizing-a-simulation-project.html#cb487-7" tabindex="-1"></a>        <span class="fu">saveRDS</span>(res, <span class="at">file =</span> fname )</span>
<span id="cb487-8"><a href="organizing-a-simulation-project.html#cb487-8" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb487-9"><a href="organizing-a-simulation-project.html#cb487-9" tabindex="-1"></a>        res <span class="ot">=</span> <span class="fu">readRDS</span>( <span class="at">file=</span>fname )</span>
<span id="cb487-10"><a href="organizing-a-simulation-project.html#cb487-10" tabindex="-1"></a>    }</span>
<span id="cb487-11"><a href="organizing-a-simulation-project.html#cb487-11" tabindex="-1"></a>    <span class="fu">return</span>( res )</span>
<span id="cb487-12"><a href="organizing-a-simulation-project.html#cb487-12" tabindex="-1"></a>}</span></code></pre></div>
<p>Note how we wrap our core <code>run_sim</code> method (that takes all our simulation factors and runs a simulation for those factors) in <code>safely</code>; <code>run_sim()</code> was crashing very occasionally, and so to make the code more robust, we wrapped it so we could see any error messages.
Our method cleverly either loads a saved result, or generates it, for a given chunk.
This means from whatever is calling the function, it will look exactly the same whether it is loading a saved result or generating a new one.</p>
<p>We next run the simulation by calling <code>file_saving_sim()</code> for all of our simulation scenarios.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="organizing-a-simulation-project.html#cb488-1" tabindex="-1"></a><span class="co"># Shuffle the rows so we run in random order to load balance.</span></span>
<span id="cb488-2"><a href="organizing-a-simulation-project.html#cb488-2" tabindex="-1"></a>factors <span class="ot">=</span> <span class="fu">sample_n</span>(factors, <span class="fu">nrow</span>(factors) )</span>
<span id="cb488-3"><a href="organizing-a-simulation-project.html#cb488-3" tabindex="-1"></a></span>
<span id="cb488-4"><a href="organizing-a-simulation-project.html#cb488-4" tabindex="-1"></a><span class="cf">if</span> ( <span class="cn">TRUE</span> ) {</span>
<span id="cb488-5"><a href="organizing-a-simulation-project.html#cb488-5" tabindex="-1"></a>    <span class="co"># Run in parallel</span></span>
<span id="cb488-6"><a href="organizing-a-simulation-project.html#cb488-6" tabindex="-1"></a>    parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb488-7"><a href="organizing-a-simulation-project.html#cb488-7" tabindex="-1"></a>    </span>
<span id="cb488-8"><a href="organizing-a-simulation-project.html#cb488-8" tabindex="-1"></a>    <span class="fu">library</span>(future)</span>
<span id="cb488-9"><a href="organizing-a-simulation-project.html#cb488-9" tabindex="-1"></a>    <span class="fu">library</span>(furrr)</span>
<span id="cb488-10"><a href="organizing-a-simulation-project.html#cb488-10" tabindex="-1"></a>    </span>
<span id="cb488-11"><a href="organizing-a-simulation-project.html#cb488-11" tabindex="-1"></a>    <span class="co">#plan(multiprocess) # choose an appropriate plan from future package</span></span>
<span id="cb488-12"><a href="organizing-a-simulation-project.html#cb488-12" tabindex="-1"></a>    <span class="co">#plan(multicore)</span></span>
<span id="cb488-13"><a href="organizing-a-simulation-project.html#cb488-13" tabindex="-1"></a>    <span class="fu">plan</span>(multisession, <span class="at">workers =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">2</span> )</span>
<span id="cb488-14"><a href="organizing-a-simulation-project.html#cb488-14" tabindex="-1"></a>    </span>
<span id="cb488-15"><a href="organizing-a-simulation-project.html#cb488-15" tabindex="-1"></a>    factors<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">future_pmap</span>(factors, <span class="at">.f =</span> file_saving_sim,</span>
<span id="cb488-16"><a href="organizing-a-simulation-project.html#cb488-16" tabindex="-1"></a>                          <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">NULL</span>),</span>
<span id="cb488-17"><a href="organizing-a-simulation-project.html#cb488-17" tabindex="-1"></a>                          <span class="at">.progress =</span> <span class="cn">TRUE</span> )</span>
<span id="cb488-18"><a href="organizing-a-simulation-project.html#cb488-18" tabindex="-1"></a>    </span>
<span id="cb488-19"><a href="organizing-a-simulation-project.html#cb488-19" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb488-20"><a href="organizing-a-simulation-project.html#cb488-20" tabindex="-1"></a>  <span class="co"># Run not in parallel, used for debugging</span></span>
<span id="cb488-21"><a href="organizing-a-simulation-project.html#cb488-21" tabindex="-1"></a>  factors<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">pmap</span>(factors, <span class="at">.f =</span> file_saving_sim )</span>
<span id="cb488-22"><a href="organizing-a-simulation-project.html#cb488-22" tabindex="-1"></a>}</span>
<span id="cb488-23"><a href="organizing-a-simulation-project.html#cb488-23" tabindex="-1"></a></span>
<span id="cb488-24"><a href="organizing-a-simulation-project.html#cb488-24" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code></pre></div>
<p>Note how we shuffle the rows of our task list so that which process gets what task is randomized.
If some tasks are much longer (e.g., due to larger sample size) then this will get balanced out across our processes.
See <a href="parallel-processing.html#parallel-processing">17</a> for more on parallel processing.</p>
<p>The <code>if-then</code> structure allows us to easily switch between parallel and nonparallel code.
This makes debugging easier: when running in parallel, stuff printed to the console does not show until the simulation is over.
Plus it would be all mixed up since multiple processes are working simultaneously.</p>
<p>The above overall structure allows the researcher to delete one of the “fragment” files from the disk, run the simulation code, and have it just do one tiny piece of the simulation.
This means the researcher can insert a <code>browser()</code> command somewhere inside the code, and debug the code, in the natural context of how the simulation is being run.</p>
<p>The seed setting ensures reproducibility.
Once we are done, we need to clean up our results:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="organizing-a-simulation-project.html#cb489-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> </span>
<span id="cb489-2"><a href="organizing-a-simulation-project.html#cb489-2" tabindex="-1"></a>    factors <span class="sc">%&gt;%</span> </span>
<span id="cb489-3"><a href="organizing-a-simulation-project.html#cb489-3" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="at">cols =</span> res)</span>
<span id="cb489-4"><a href="organizing-a-simulation-project.html#cb489-4" tabindex="-1"></a></span>
<span id="cb489-5"><a href="organizing-a-simulation-project.html#cb489-5" tabindex="-1"></a><span class="co"># Cut apart the results and error messages</span></span>
<span id="cb489-6"><a href="organizing-a-simulation-project.html#cb489-6" tabindex="-1"></a>sim_results<span class="sc">$</span>sr <span class="ot">=</span> <span class="fu">rep</span>( <span class="fu">c</span>(<span class="st">&quot;res&quot;</span>,<span class="st">&quot;err&quot;</span>), <span class="fu">nrow</span>(sim_results)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb489-7"><a href="organizing-a-simulation-project.html#cb489-7" tabindex="-1"></a>sim_results <span class="ot">=</span> <span class="fu">pivot_wider</span>( sim_results, <span class="at">names_from =</span> sr, <span class="at">values_from =</span> res )</span>
<span id="cb489-8"><a href="organizing-a-simulation-project.html#cb489-8" tabindex="-1"></a></span>
<span id="cb489-9"><a href="organizing-a-simulation-project.html#cb489-9" tabindex="-1"></a><span class="fu">saveRDS</span>( sim_results, <span class="at">file=</span><span class="st">&quot;results/simulation_results.rds&quot;</span> )</span></code></pre></div>
<p>Our final <code>simulation_results.rds</code> file will have all the results from our simulation, made by stacking all of the fragments of our simulation together.</p>
</div>
<div id="dynamically-making-directories" class="section level3 hasAnchor" number="16.3.3">
<h3><span class="header-section-number">16.3.3</span> Dynamically making directories<a href="organizing-a-simulation-project.html#dynamically-making-directories" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are generating a lot of files, then you should put them somewhere.
But where?
It can be nice to dynamically generate a directory for your files on fly.
One way to do this is to write a function that will make any needed directory, if it doesn’t exist, and then put your file in that spot.
For example, you might have your own version of <code>write_csv</code> as:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="organizing-a-simulation-project.html#cb490-1" tabindex="-1"></a>my_write_csv <span class="ot">&lt;-</span> <span class="cf">function</span>( data, path, file ) {</span>
<span id="cb490-2"><a href="organizing-a-simulation-project.html#cb490-2" tabindex="-1"></a>  </span>
<span id="cb490-3"><a href="organizing-a-simulation-project.html#cb490-3" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="sc">!</span><span class="fu">dir.exists</span>( here<span class="sc">::</span><span class="fu">here</span>( path ) ) ) {</span>
<span id="cb490-4"><a href="organizing-a-simulation-project.html#cb490-4" tabindex="-1"></a>    <span class="fu">dir.create</span>( here<span class="sc">::</span><span class="fu">here</span>( path ), <span class="at">recursive=</span><span class="cn">TRUE</span> ) </span>
<span id="cb490-5"><a href="organizing-a-simulation-project.html#cb490-5" tabindex="-1"></a>  }</span>
<span id="cb490-6"><a href="organizing-a-simulation-project.html#cb490-6" tabindex="-1"></a>  <span class="fu">write_csv</span>( data, <span class="fu">paste0</span>( path, file ) )</span>
<span id="cb490-7"><a href="organizing-a-simulation-project.html#cb490-7" tabindex="-1"></a>}</span></code></pre></div>
<p>This will look for a path (starting from your R Project, by taking advantage of the <code>here</code> package), and put your data file in that spot.
If the spot doesn’t exist, it will make it for you.</p>
</div>
<div id="loading-and-combining-files-of-simulation-results" class="section level3 hasAnchor" number="16.3.4">
<h3><span class="header-section-number">16.3.4</span> Loading and combining files of simulation results<a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once your simulation files are all generated, the following code will stack them all into a giant set of results, assuming all the files are themselves data frames stored in RDS objects.
This function will try and stack all files found in a given directory; for it to work, you should ensure there are no other files stored there.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="organizing-a-simulation-project.html#cb491-1" tabindex="-1"></a>load.all.sims <span class="ot">=</span> <span class="cf">function</span>( <span class="at">filehead=</span><span class="st">&quot;raw_results/&quot;</span> ) {</span>
<span id="cb491-2"><a href="organizing-a-simulation-project.html#cb491-2" tabindex="-1"></a>  </span>
<span id="cb491-3"><a href="organizing-a-simulation-project.html#cb491-3" tabindex="-1"></a>  files <span class="ot">=</span> <span class="fu">list.files</span>( filehead, <span class="at">full.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb491-4"><a href="organizing-a-simulation-project.html#cb491-4" tabindex="-1"></a>  </span>
<span id="cb491-5"><a href="organizing-a-simulation-project.html#cb491-5" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">map_df</span>( files, <span class="cf">function</span>( fname ) {</span>
<span id="cb491-6"><a href="organizing-a-simulation-project.html#cb491-6" tabindex="-1"></a>    <span class="fu">cat</span>( <span class="st">&quot;Reading results from &quot;</span>, fname, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> )</span>
<span id="cb491-7"><a href="organizing-a-simulation-project.html#cb491-7" tabindex="-1"></a>    rs <span class="ot">=</span> <span class="fu">readRDS</span>( <span class="at">file =</span> fname )</span>
<span id="cb491-8"><a href="organizing-a-simulation-project.html#cb491-8" tabindex="-1"></a>    rs<span class="sc">$</span>filename <span class="ot">=</span> fname</span>
<span id="cb491-9"><a href="organizing-a-simulation-project.html#cb491-9" tabindex="-1"></a>    rs</span>
<span id="cb491-10"><a href="organizing-a-simulation-project.html#cb491-10" tabindex="-1"></a>  })</span>
<span id="cb491-11"><a href="organizing-a-simulation-project.html#cb491-11" tabindex="-1"></a>  res</span>
<span id="cb491-12"><a href="organizing-a-simulation-project.html#cb491-12" tabindex="-1"></a>}</span></code></pre></div>
<p>You would use as so:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="organizing-a-simulation-project.html#cb492-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">load.all.sims</span>( <span class="at">filehead=</span><span class="st">&quot;raw_results/&quot;</span> )</span>
<span id="cb492-2"><a href="organizing-a-simulation-project.html#cb492-2" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>( results )</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simulations-as-evidence.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parallel-processing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/105-file-management.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
