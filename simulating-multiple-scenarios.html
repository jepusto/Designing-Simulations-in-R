<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Simulating across multiple scenarios | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Simulating across multiple scenarios | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Simulating across multiple scenarios | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2026-01-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="performance-measures.html"/>
<link rel="next" href="designing-multifactor-simulations.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#ANOVA-hypothesis-testing-function"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-alphas"><i class="fa fa-check"></i><b>5.5.1</b> Other <span class="math inline">\(\alpha\)</span>’s</a></li>
<li class="chapter" data-level="5.5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-compare-results"><i class="fa fa-check"></i><b>5.5.2</b> Compare results</a></li>
<li class="chapter" data-level="5.5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-power"><i class="fa fa-check"></i><b>5.5.3</b> Power</a></li>
<li class="chapter" data-level="5.5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-wide-long"><i class="fa fa-check"></i><b>5.5.4</b> Wide or long?</a></li>
<li class="chapter" data-level="5.5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-tests"><i class="fa fa-check"></i><b>5.5.5</b> Other tests</a></li>
<li class="chapter" data-level="5.5.6" data-path="case-ANOVA.html"><a href="case-ANOVA.html#methodological-extensions"><i class="fa fa-check"></i><b>5.5.6</b> Methodological extensions</a></li>
<li class="chapter" data-level="5.5.7" data-path="case-ANOVA.html"><a href="case-ANOVA.html#power-analysis"><i class="fa fa-check"></i><b>5.5.7</b> Power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-measures.html"><a href="performance-measures.html"><i class="fa fa-check"></i><b>9</b> Performance Measures</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-measures.html"><a href="performance-measures.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Measures for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-measures.html"><a href="performance-measures.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performance of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-measures.html"><a href="performance-measures.html#less-conventional-measures"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-measures.html"><a href="performance-measures.html#measures-for-variance-estimators"><i class="fa fa-check"></i><b>9.2</b> Measures for Variance Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-measures.html"><a href="performance-measures.html#satterthwaite-degrees-of-freedom"><i class="fa fa-check"></i><b>9.2.1</b> Satterthwaite degrees of freedom</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-measures.html"><a href="performance-measures.html#assessing-ses-for-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.2</b> Assessing SEs for the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-measures.html"><a href="performance-measures.html#measures-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Measures for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-CI-coverage"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-measures.html"><a href="performance-measures.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Measures for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-measures.html"><a href="performance-measures.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-measures.html"><a href="performance-measures.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-measures.html"><a href="performance-measures.html#rejection-rates"><i class="fa fa-check"></i><b>9.4.3</b> Rejection Rates</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-measures.html"><a href="performance-measures.html#inference-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-measures.html"><a href="performance-measures.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Relative or Absolute Measures?</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-measures.html"><a href="performance-measures.html#performance-relative-to-a-benchmark-estimator"><i class="fa fa-check"></i><b>9.5.1</b> Performance relative to a benchmark estimator</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-measures.html"><a href="performance-measures.html#implicit-estimands"><i class="fa fa-check"></i><b>9.6</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.7" data-path="performance-measures.html"><a href="performance-measures.html#MCSE"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-measures.html"><a href="performance-measures.html#conventional-measures-for-point-estimators"><i class="fa fa-check"></i><b>9.7.1</b> Conventional measures for point estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-measures.html"><a href="performance-measures.html#less-conventional-measures-for-point-estimators"><i class="fa fa-check"></i><b>9.7.2</b> Less conventional measures for point estimators</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-measures.html"><a href="performance-measures.html#MCSE-for-relative-variance"><i class="fa fa-check"></i><b>9.7.3</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.4" data-path="performance-measures.html"><a href="performance-measures.html#mcse-for-confidence-intervals-and-hypothesis-tests"><i class="fa fa-check"></i><b>9.7.4</b> MCSE for Confidence Intervals and Hypothesis Tests</a></li>
<li class="chapter" data-level="9.7.5" data-path="performance-measures.html"><a href="performance-measures.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.5</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.6" data-path="performance-measures.html"><a href="performance-measures.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.6</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-measures.html"><a href="performance-measures.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.8</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.9" data-path="performance-measures.html"><a href="performance-measures.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.9</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.10" data-path="performance-measures.html"><a href="performance-measures.html#exercises-6"><i class="fa fa-check"></i><b>9.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="performance-measures.html"><a href="performance-measures.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.10.1</b> Brown and Forsythe (1974) results</a></li>
<li class="chapter" data-level="9.10.2" data-path="performance-measures.html"><a href="performance-measures.html#size-adjusted-power"><i class="fa fa-check"></i><b>9.10.2</b> Size-adjusted power</a></li>
<li class="chapter" data-level="9.10.3" data-path="performance-measures.html"><a href="performance-measures.html#three-correlation-estimators"><i class="fa fa-check"></i><b>9.10.3</b> Three correlation estimators</a></li>
<li class="chapter" data-level="9.10.4" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-t-confidence-intervals"><i class="fa fa-check"></i><b>9.10.4</b> Confidence interval comparison</a></li>
<li class="chapter" data-level="9.10.5" data-path="performance-measures.html"><a href="performance-measures.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.10.5</b> Jackknife calculation of MCSEs for RMSE</a></li>
<li class="chapter" data-level="9.10.6" data-path="performance-measures.html"><a href="performance-measures.html#jackknife-MCSE-ratio"><i class="fa fa-check"></i><b>9.10.6</b> Jackknife calculation of MCSEs for RMSE ratios</a></li>
<li class="chapter" data-level="9.10.7" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.10.7</b> Distribution theory for person-level average treatment effects</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Systematic Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html"><i class="fa fa-check"></i><b>10</b> Simulating across multiple scenarios</a>
<ul>
<li class="chapter" data-level="10.1" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#simulating-across-levels-of-a-single-factor"><i class="fa fa-check"></i><b>10.1</b> Simulating across levels of a single factor</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#a-performance-summary-function"><i class="fa fa-check"></i><b>10.1.1</b> A performance summary function</a></li>
<li class="chapter" data-level="10.1.2" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#adding-performance-calculations-to-the-simulation-driver"><i class="fa fa-check"></i><b>10.1.2</b> Adding performance calculations to the simulation driver</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#simulating-across-multiple-factors"><i class="fa fa-check"></i><b>10.2</b> Simulating across multiple factors</a></li>
<li class="chapter" data-level="10.3" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.3</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.4" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.4</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.4.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.4.2" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.4.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.4.3" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.4.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#summary"><i class="fa fa-check"></i><b>10.5</b> Summary</a></li>
<li class="chapter" data-level="10.6" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#extending-Brown-Forsythe-power"><i class="fa fa-check"></i><b>10.6.1</b> Extending Brown and Forsythe</a></li>
<li class="chapter" data-level="10.6.2" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.2</b> Comparing the trimmed mean, median and mean</a></li>
<li class="chapter" data-level="10.6.3" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#exercise:multifactor-latent-correlation"><i class="fa fa-check"></i><b>10.6.3</b> Estimating latent correlations</a></li>
<li class="chapter" data-level="10.6.4" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#exercise:multifactor-meta-regression"><i class="fa fa-check"></i><b>10.6.4</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.5" data-path="simulating-multiple-scenarios.html"><a href="simulating-multiple-scenarios.html#exercise:examine-a-multifactor-simulation-design"><i class="fa fa-check"></i><b>10.6.5</b> Examine a multifactor simulation design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html"><i class="fa fa-check"></i><b>11</b> Designing multifactor simulations</a>
<ul>
<li class="chapter" data-level="11.1" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>11.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="11.2" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>11.2</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>11.2.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="11.2.2" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>11.2.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="11.2.3" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#running-the-simulations"><i class="fa fa-check"></i><b>11.2.3</b> Running the simulations</a></li>
<li class="chapter" data-level="11.2.4" data-path="designing-multifactor-simulations.html"><a href="designing-multifactor-simulations.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>11.2.4</b> Calculating performance metrics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>12</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="12.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>12.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>12.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>12.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>12.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="12.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>12.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="12.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>12.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="12.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>12.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="12.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>12.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>12.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>12.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="12.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>12.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>12.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>13</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>13.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="13.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>13.2</b> Bundling</a></li>
<li class="chapter" data-level="13.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>13.3</b> Aggregation</a></li>
<li class="chapter" data-level="13.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#comparing-true-ses-with-standardization"><i class="fa fa-check"></i><b>13.4</b> Comparing true SEs with standardization</a></li>
<li class="chapter" data-level="13.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>13.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="13.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-the-quality-of-the-estimated-ses"><i class="fa fa-check"></i><b>13.6</b> Assessing the quality of the estimated SEs</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#stability-of-estimated-ses"><i class="fa fa-check"></i><b>13.6.1</b> Stability of estimated SEs</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>13.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="13.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>13.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>13.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="13.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>13.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="13.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>13.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="13.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>13.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
<li class="chapter" data-level="13.8.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#making-another-plot-for-assessing-ses"><i class="fa fa-check"></i><b>13.8.5</b> Making another plot for assessing SEs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>14</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="14.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>14.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>14.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="14.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>14.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>14.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="14.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>14.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>14.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>14.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>15</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="15.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>15.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>16</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="16.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>16.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>16.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="16.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>16.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="16.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>16.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="16.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>16.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="16.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>16.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="16.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>16.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="17" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>17</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="17.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>17.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>17.1.1</b> The source command</a></li>
<li class="chapter" data-level="17.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>17.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="17.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>17.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>17.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="17.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>17.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>17.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="17.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>17.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="17.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>17.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="17.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>17.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>18</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>18.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="18.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>18.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="18.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>18.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>18.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="18.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>18.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="18.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>18.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="18.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>18.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="18.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>18.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="18.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>18.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>19</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>19.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="19.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>19.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="19.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>19.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="19.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>19.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="19.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>19.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="20" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>20</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="20.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>20.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="20.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>20.2</b> The data generating process</a></li>
<li class="chapter" data-level="20.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>20.3</b> Running the simulation</a></li>
<li class="chapter" data-level="20.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>20.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>20.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="20.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>20.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="20.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>20.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="20.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>20.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>20.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>21</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="21.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>21.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="21.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>21.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="21.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>21.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="21.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>21.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>22</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="22.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>22.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulating-multiple-scenarios" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Simulating across multiple scenarios<a href="simulating-multiple-scenarios.html#simulating-multiple-scenarios" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In Chapter <a href="simulation-structure.html#simulation-structure">4</a>, we described the general structure of basic simulations as following four steps: generate, analyze, repeat, and summarize.
The principles of tidy simulation suggest that each of these steps should be represented by its own function or set of code.
For any particular simulation we have a data-generating function and a data-analysis function, which can be bundled together into a simulation driver that repeatedly executes the generate-and-analyze process; we also have a summarization function (or set of code) that computes performance measures across the replications of the simulation process.
In the previous section of the book, we focused on creating code that will run a simulation for a single scenario, going from a set of parameter values to a set of performance measures.</p>
<p>In practice, simulation studies often involve examining a range of different values, such as multiple levels of a focal parameter value and potentially also multiple levels for auxiliary parameters, sample size, and other design parameters.
In this chapter, we demonstrate an approach for executing simulations across multiple scenarios and organizing the results for further analysis.
Our focus here is on the programming techniques and computational structure.
In the next chapter, we discuss some of the deeper theoretical challenges of designing multifactor simulations.
Then in subsequent chapters, we examine tools for analyzing and making sense of results from more complex, multifactor simulation designs.</p>
<p>In Chapter <a href="simulation-structure.html#simulation-structure">4</a>, we described three further steps involved in systematic simulations: <em>designing</em> a set of scenarios to examine, <em>executing</em> across multiple scenarios, and <em>synthesizing</em> the performance results across scenarios.
The same principles of tidy simulation apply to these steps as well.
In this chapter, we will demonstrate how to create a dataset representing the experimental design of the simulation, how to execute a simulation driver across multiple scenarios, and how to organize results for synthesis.</p>
<div id="simulating-across-levels-of-a-single-factor" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Simulating across levels of a single factor<a href="simulating-multiple-scenarios.html#simulating-across-levels-of-a-single-factor" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Even if we are only using simulation in an ad hoc, exploratory way, we will often be interested in examining the performance of a model or estimation method in more than one scenario.
We have already seen examples of this in Chapter <a href="t-test-simulation.html#t-test-simulation">3</a>, where we looked at the coverage rate of a confidence interval for the mean of an exponential distribution.
In Section <a href="t-test-simulation.html#simulating-across-different-scenarios">3.3</a>, we applied a simulation driver function across a set of sample sizes ranging from 10 to 300, finding that the coverage rate improves towards the desired level as sample size increases.
Simple forms of systematic exploration such as this are useful in many situations.
For instance, when using Monte Carlo simulation for study planning, we might examine simulated power over a range of the target parameter to identify the smallest parameter for power is above a desired level.
If we are using simulation simply to study an unfamiliar model, we might vary a key parameter over a wide range to see how the performance of an estimator changes.
These forms of exploration can be understood as single-factor simulations.</p>
<p>To demonstrate a single-factor simulation, we revisit the case study on heteroskedastic analysis of variance, as studied by <span class="citation">@brown1974SmallSampleBehavior</span> and developed in Chapter <a href="case-ANOVA.html#case-ANOVA">5</a>.
Suppose that we want to understand how the power of Welch’s test varies as a function of the maximum distance between group means.
The data-generating function <code>generate_ANOVA_data()</code> that we developed previously was set up to take a vector of means per group, so we re-parameterize the function to define the group means based on the maximum difference (<code>max_diff</code>), under the assumption that the means are equally spaced between zero and the maximum difference.
We will also re-parameterize the function in terms of the total sample size and the fraction of observations allocated to each group.
The revised function is</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="simulating-multiple-scenarios.html#cb328-1" tabindex="-1"></a>generate_ANOVA_new <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb328-2"><a href="simulating-multiple-scenarios.html#cb328-2" tabindex="-1"></a>  G, max_diff, <span class="at">sigma_sq =</span> <span class="dv">1</span>, <span class="at">N =</span> <span class="dv">20</span>, <span class="at">allocation =</span> <span class="st">&quot;equal&quot;</span></span>
<span id="cb328-3"><a href="simulating-multiple-scenarios.html#cb328-3" tabindex="-1"></a>) {</span>
<span id="cb328-4"><a href="simulating-multiple-scenarios.html#cb328-4" tabindex="-1"></a>  </span>
<span id="cb328-5"><a href="simulating-multiple-scenarios.html#cb328-5" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_diff, <span class="at">length.out =</span> G)</span>
<span id="cb328-6"><a href="simulating-multiple-scenarios.html#cb328-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(allocation, <span class="st">&quot;equal&quot;</span>)) {</span>
<span id="cb328-7"><a href="simulating-multiple-scenarios.html#cb328-7" tabindex="-1"></a>    allocation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> G, <span class="at">times =</span> G) </span>
<span id="cb328-8"><a href="simulating-multiple-scenarios.html#cb328-8" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb328-9"><a href="simulating-multiple-scenarios.html#cb328-9" tabindex="-1"></a>    allocation <span class="ot">&lt;-</span> <span class="fu">rep</span>(allocation, <span class="at">length.out =</span> G)</span>
<span id="cb328-10"><a href="simulating-multiple-scenarios.html#cb328-10" tabindex="-1"></a>  }</span>
<span id="cb328-11"><a href="simulating-multiple-scenarios.html#cb328-11" tabindex="-1"></a>  </span>
<span id="cb328-12"><a href="simulating-multiple-scenarios.html#cb328-12" tabindex="-1"></a>  N_g <span class="ot">&lt;-</span> <span class="fu">round</span>(N <span class="sc">*</span> allocation)  </span>
<span id="cb328-13"><a href="simulating-multiple-scenarios.html#cb328-13" tabindex="-1"></a>  </span>
<span id="cb328-14"><a href="simulating-multiple-scenarios.html#cb328-14" tabindex="-1"></a>  group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>G, <span class="at">times =</span> N_g))</span>
<span id="cb328-15"><a href="simulating-multiple-scenarios.html#cb328-15" tabindex="-1"></a>  mu_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu, <span class="at">times =</span> N_g)</span>
<span id="cb328-16"><a href="simulating-multiple-scenarios.html#cb328-16" tabindex="-1"></a>  sigma_long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">sqrt</span>(sigma_sq), <span class="at">length.out =</span> G), <span class="at">times =</span> N_g)</span>
<span id="cb328-17"><a href="simulating-multiple-scenarios.html#cb328-17" tabindex="-1"></a>  </span>
<span id="cb328-18"><a href="simulating-multiple-scenarios.html#cb328-18" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> mu_long, <span class="at">sd =</span> sigma_long)</span>
<span id="cb328-19"><a href="simulating-multiple-scenarios.html#cb328-19" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">group =</span> group, <span class="at">x =</span> x)</span>
<span id="cb328-20"><a href="simulating-multiple-scenarios.html#cb328-20" tabindex="-1"></a>  </span>
<span id="cb328-21"><a href="simulating-multiple-scenarios.html#cb328-21" tabindex="-1"></a>  <span class="fu">return</span>(sim_data)</span>
<span id="cb328-22"><a href="simulating-multiple-scenarios.html#cb328-22" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can create a simulation driver by combining this new data-generating function with the data-analysis function we created in Section <a href="case-ANOVA.html#ANOVA-hypothesis-testing-function">5.2</a>:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="simulating-multiple-scenarios.html#cb329-1" tabindex="-1"></a>sim_ANOVA <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>(<span class="at">f_generate =</span> generate_ANOVA_new, <span class="at">f_analyze =</span> ANOVA_Welch_F)</span></code></pre></div>
<p>To compute power, we generate a set of simulated <span class="math inline">\(p\)</span> values and then summarize the rejection rate of the Welch test at <span class="math inline">\(\alpha\)</span> levels of .01 and .05:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="simulating-multiple-scenarios.html#cb330-1" tabindex="-1"></a><span class="fu">sim_ANOVA</span>(<span class="dv">100</span>, <span class="at">G =</span> <span class="dv">4</span>, <span class="at">max_diff =</span> <span class="fl">0.5</span>, <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">N =</span> <span class="dv">40</span>) <span class="sc">|&gt;</span></span>
<span id="cb330-2"><a href="simulating-multiple-scenarios.html#cb330-2" tabindex="-1"></a>  <span class="fu">calc_rejection</span>(<span class="at">p_values =</span> Welch, <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>))</span></code></pre></div>
<pre><code>##   K_rejection rej_rate_01 rej_rate_05
## 1         100        0.06        0.08
##   rej_rate_mcse_01 rej_rate_mcse_05
## 1       0.02374868       0.02712932</code></pre>
<p>Now we can apply this process for several different scenarios with different values of <code>mu1</code>.</p>
<p>Following the principles of tidy simulation, it is useful to represent the design of a systematic simulation as a dataset with a row for each scenario to be considered.
For a single-factor simulation, the experimental design consists of a dataset with just a single variable:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="simulating-multiple-scenarios.html#cb332-1" tabindex="-1"></a>Welch_design <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">max_diff =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>))</span>
<span id="cb332-2"><a href="simulating-multiple-scenarios.html#cb332-2" tabindex="-1"></a><span class="fu">str</span>(Welch_design)</span></code></pre></div>
<pre><code>## tibble [9 × 1] (S3: tbl_df/tbl/data.frame)
##  $ max_diff: num [1:9] 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8</code></pre>
<p>To compute simulation results for each of these scenarios, we can use the <code>map()</code> function from <code>purrr()</code>.
This function takes a list of values as the input, then calls a function on each value.
Our <code>sim_ANOVA()</code> function has several further arguments that need to be specified.
Because these will be the same for every value of <code>max_diff</code>, we can include them as additional arguments in <code>map()</code>, and they will be used every time <code>sim_ANOVA()</code> is called.
Here is one way to code this:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="simulating-multiple-scenarios.html#cb334-1" tabindex="-1"></a>Welch_results <span class="ot">&lt;-</span> </span>
<span id="cb334-2"><a href="simulating-multiple-scenarios.html#cb334-2" tabindex="-1"></a>  Welch_design <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="simulating-multiple-scenarios.html#cb334-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb334-4"><a href="simulating-multiple-scenarios.html#cb334-4" tabindex="-1"></a>    <span class="at">pvals =</span> <span class="fu">map</span>(max_diff, sim_ANOVA, <span class="at">reps =</span> <span class="dv">100</span>, <span class="at">G =</span> <span class="dv">4</span>, </span>
<span id="cb334-5"><a href="simulating-multiple-scenarios.html#cb334-5" tabindex="-1"></a>                <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">N =</span> <span class="dv">40</span>)</span>
<span id="cb334-6"><a href="simulating-multiple-scenarios.html#cb334-6" tabindex="-1"></a>  )</span></code></pre></div>
<p>Another way to accomplish the same thing is to specify an anonymous function (also called a lambda) in the <code>map()</code> call.
This syntax makes it clearer that the additional arguments are getting called in every evaluation of <code>sim_ANOVA()</code>:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="simulating-multiple-scenarios.html#cb335-1" tabindex="-1"></a>Welch_results <span class="ot">&lt;-</span> </span>
<span id="cb335-2"><a href="simulating-multiple-scenarios.html#cb335-2" tabindex="-1"></a>  Welch_design <span class="sc">%&gt;%</span></span>
<span id="cb335-3"><a href="simulating-multiple-scenarios.html#cb335-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb335-4"><a href="simulating-multiple-scenarios.html#cb335-4" tabindex="-1"></a>    <span class="at">pvals =</span> <span class="fu">map</span>(max_diff, <span class="sc">~</span> <span class="fu">sim_ANOVA</span>(<span class="dv">100</span>, <span class="at">G =</span> <span class="dv">4</span>, <span class="at">max_diff =</span> .x, </span>
<span id="cb335-5"><a href="simulating-multiple-scenarios.html#cb335-5" tabindex="-1"></a>                                      <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb335-6"><a href="simulating-multiple-scenarios.html#cb335-6" tabindex="-1"></a>                                      <span class="at">N =</span> <span class="dv">40</span>))</span>
<span id="cb335-7"><a href="simulating-multiple-scenarios.html#cb335-7" tabindex="-1"></a>  )</span></code></pre></div>
<p>In the resulting dataset, the <code>pvals</code> variable is a list, with each entry consisting of a tibble of simulated p-values.
Using the <code>unnest()</code> function simplies the structure of the results, making it easier to do performance calculations:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="simulating-multiple-scenarios.html#cb336-1" tabindex="-1"></a>Welch_results_long <span class="ot">&lt;-</span> Welch_results <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(pvals)</span></code></pre></div>
<p>The resulting dataset has 900 rows, consisting of 100 replications for each of 9 scenarios.
To compute power levels, we use <code>calc_rejection()</code> after grouping the results by scenario:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="simulating-multiple-scenarios.html#cb337-1" tabindex="-1"></a>Welch_power <span class="ot">&lt;-</span> </span>
<span id="cb337-2"><a href="simulating-multiple-scenarios.html#cb337-2" tabindex="-1"></a>  Welch_results_long <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="simulating-multiple-scenarios.html#cb337-3" tabindex="-1"></a>  <span class="fu">group_by</span>(max_diff) <span class="sc">%&gt;%</span></span>
<span id="cb337-4"><a href="simulating-multiple-scenarios.html#cb337-4" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb337-5"><a href="simulating-multiple-scenarios.html#cb337-5" tabindex="-1"></a>    <span class="fu">calc_rejection</span>(<span class="at">p_values =</span> Welch, <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>,.<span class="dv">05</span>))</span>
<span id="cb337-6"><a href="simulating-multiple-scenarios.html#cb337-6" tabindex="-1"></a>  )</span>
<span id="cb337-7"><a href="simulating-multiple-scenarios.html#cb337-7" tabindex="-1"></a></span>
<span id="cb337-8"><a href="simulating-multiple-scenarios.html#cb337-8" tabindex="-1"></a>Welch_power</span></code></pre></div>
<pre><code>## # A tibble: 9 × 6
##   max_diff K_rejection rej_rate_01 rej_rate_05
##      &lt;dbl&gt;       &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1      0           100        0.07        0.1 
## 2      0.1         100        0.03        0.06
## 3      0.2         100        0.04        0.08
## 4      0.3         100        0.03        0.11
## 5      0.4         100        0.01        0.04
## 6      0.5         100        0.02        0.11
## 7      0.6         100        0.05        0.11
## 8      0.7         100        0.03        0.11
## 9      0.8         100        0.04        0.16
## # ℹ 2 more variables: rej_rate_mcse_01 &lt;dbl&gt;,
## #   rej_rate_mcse_05 &lt;dbl&gt;</code></pre>
<p>The power levels are quite low, with the <span class="math inline">\(\alpha = .05\)</span>-level tests reaching a maximum power of 0.16 when <code>max_diff</code> is 0.8.
The lower power levels max sense here because we are looking at a scenario with a very small sample size of just 10 observations per group.</p>
<div id="a-performance-summary-function" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> A performance summary function<a href="simulating-multiple-scenarios.html#a-performance-summary-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These performance calculations focus only on the results for the Welch test, when we might be interested in comparing Welch’s test to the conventional ANOVA <span class="math inline">\(F\)</span>.
One way to carry out the performance calculations for both measures is to write a small function that encapsulates the performance calculations, then use it in place of <code>calc_rejection()</code>.
The function should take a set of simulation results as input and provide a dataset of performance measures as output.
Here is one possible implementation, which uses <code>map()</code> to apply the performance calculations to each set of simulated p-values:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="simulating-multiple-scenarios.html#cb339-1" tabindex="-1"></a>summarize_power <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>,.<span class="dv">05</span>)) {</span>
<span id="cb339-2"><a href="simulating-multiple-scenarios.html#cb339-2" tabindex="-1"></a>  ANOVA <span class="ot">&lt;-</span> <span class="fu">calc_rejection</span>(data, <span class="at">p_values =</span> ANOVA, <span class="at">alpha =</span> alpha, <span class="at">format =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb339-3"><a href="simulating-multiple-scenarios.html#cb339-3" tabindex="-1"></a>  Welch <span class="ot">&lt;-</span> <span class="fu">calc_rejection</span>(data, <span class="at">p_values =</span> Welch, <span class="at">alpha =</span> alpha, <span class="at">format =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb339-4"><a href="simulating-multiple-scenarios.html#cb339-4" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb339-5"><a href="simulating-multiple-scenarios.html#cb339-5" tabindex="-1"></a>    <span class="at">ANOVA =</span> ANOVA, </span>
<span id="cb339-6"><a href="simulating-multiple-scenarios.html#cb339-6" tabindex="-1"></a>    <span class="at">Welch =</span> Welch,</span>
<span id="cb339-7"><a href="simulating-multiple-scenarios.html#cb339-7" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">&quot;test&quot;</span></span>
<span id="cb339-8"><a href="simulating-multiple-scenarios.html#cb339-8" tabindex="-1"></a>  )</span>
<span id="cb339-9"><a href="simulating-multiple-scenarios.html#cb339-9" tabindex="-1"></a>} </span>
<span id="cb339-10"><a href="simulating-multiple-scenarios.html#cb339-10" tabindex="-1"></a></span>
<span id="cb339-11"><a href="simulating-multiple-scenarios.html#cb339-11" tabindex="-1"></a>power_levels <span class="ot">&lt;-</span> </span>
<span id="cb339-12"><a href="simulating-multiple-scenarios.html#cb339-12" tabindex="-1"></a>  Welch_results <span class="sc">%&gt;%</span></span>
<span id="cb339-13"><a href="simulating-multiple-scenarios.html#cb339-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb339-14"><a href="simulating-multiple-scenarios.html#cb339-14" tabindex="-1"></a>    <span class="at">power =</span> <span class="fu">map</span>(pvals, summarize_power, <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>))</span>
<span id="cb339-15"><a href="simulating-multiple-scenarios.html#cb339-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb339-16"><a href="simulating-multiple-scenarios.html#cb339-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pvals) <span class="sc">%&gt;%</span></span>
<span id="cb339-17"><a href="simulating-multiple-scenarios.html#cb339-17" tabindex="-1"></a>  <span class="fu">unnest</span>(power)</span>
<span id="cb339-18"><a href="simulating-multiple-scenarios.html#cb339-18" tabindex="-1"></a></span>
<span id="cb339-19"><a href="simulating-multiple-scenarios.html#cb339-19" tabindex="-1"></a>power_levels</span></code></pre></div>
<pre><code>## # A tibble: 36 × 6
##    max_diff test  K_rejection alpha rej_rate
##       &lt;dbl&gt; &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1      0   ANOVA         100  0.01     0.04
##  2      0   ANOVA         100  0.05     0.08
##  3      0   Welch         100  0.01     0.07
##  4      0   Welch         100  0.05     0.1 
##  5      0.1 ANOVA         100  0.01     0.03
##  6      0.1 ANOVA         100  0.05     0.11
##  7      0.1 Welch         100  0.01     0.03
##  8      0.1 Welch         100  0.05     0.06
##  9      0.2 ANOVA         100  0.01     0.03
## 10      0.2 ANOVA         100  0.05     0.1 
## # ℹ 26 more rows
## # ℹ 1 more variable: rej_rate_mcse &lt;dbl&gt;</code></pre>
</div>
<div id="adding-performance-calculations-to-the-simulation-driver" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Adding performance calculations to the simulation driver<a href="simulating-multiple-scenarios.html#adding-performance-calculations-to-the-simulation-driver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have a function for carrying out the performance calculations, we could consider incorporating this step into the simulation driver function.
That way, we can call the simulation driver function with a set of parameter values and it will return a table of performance summaries.
The <code>bundle_sim()</code> function from <code>simhelpers</code> will create such a function for us, by combining a performance calculation function with the data-generating and data-analysis functions:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="simulating-multiple-scenarios.html#cb341-1" tabindex="-1"></a>sim_ANOVA_full <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>(</span>
<span id="cb341-2"><a href="simulating-multiple-scenarios.html#cb341-2" tabindex="-1"></a>  <span class="at">f_generate =</span> generate_ANOVA_new, </span>
<span id="cb341-3"><a href="simulating-multiple-scenarios.html#cb341-3" tabindex="-1"></a>  <span class="at">f_analyze =</span> ANOVA_Welch_F,</span>
<span id="cb341-4"><a href="simulating-multiple-scenarios.html#cb341-4" tabindex="-1"></a>  <span class="at">f_summarize =</span> summarize_power</span>
<span id="cb341-5"><a href="simulating-multiple-scenarios.html#cb341-5" tabindex="-1"></a>)</span>
<span id="cb341-6"><a href="simulating-multiple-scenarios.html#cb341-6" tabindex="-1"></a></span>
<span id="cb341-7"><a href="simulating-multiple-scenarios.html#cb341-7" tabindex="-1"></a><span class="fu">args</span>(sim_ANOVA_full)</span></code></pre></div>
<pre><code>## function (reps, G, max_diff, sigma_sq = 1, N = 20, allocation = &quot;equal&quot;, 
##     alpha = c(0.01, 0.05), seed = NA_integer_, summarize = TRUE) 
## NULL</code></pre>
<p>The resulting function includes an input argument that controls which alpha levels to use in the rejection rate calculations.
The bundled simulation driver also includes an additional option called <code>summarize</code>, which allows the user to control whether to apply the performance calculation function to the simulation output.
The default value of <code>TRUE</code> means that calling the function will compute rejection rates:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="simulating-multiple-scenarios.html#cb343-1" tabindex="-1"></a><span class="fu">sim_ANOVA_full</span>(</span>
<span id="cb343-2"><a href="simulating-multiple-scenarios.html#cb343-2" tabindex="-1"></a>  <span class="at">reps =</span> <span class="dv">100</span>, <span class="at">G =</span> <span class="dv">4</span>, <span class="at">max_diff =</span> <span class="fl">0.5</span>, </span>
<span id="cb343-3"><a href="simulating-multiple-scenarios.html#cb343-3" tabindex="-1"></a>  <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">N =</span> <span class="dv">40</span>, </span>
<span id="cb343-4"><a href="simulating-multiple-scenarios.html#cb343-4" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>)</span>
<span id="cb343-5"><a href="simulating-multiple-scenarios.html#cb343-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##   test  K_rejection alpha rej_rate rej_rate_mcse
##   &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
## 1 ANOVA         100  0.01     0.04        0.0196
## 2 ANOVA         100  0.05     0.11        0.0313
## 3 Welch         100  0.01     0.04        0.0196
## 4 Welch         100  0.05     0.12        0.0325</code></pre>
<p>Setting <code>summarize = FALSE</code> will produce a dataset with the raw simulation output, with one row per replication, ignoring the additional inputs related to the performance calculations:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="simulating-multiple-scenarios.html#cb345-1" tabindex="-1"></a><span class="fu">sim_ANOVA_full</span>(</span>
<span id="cb345-2"><a href="simulating-multiple-scenarios.html#cb345-2" tabindex="-1"></a>  <span class="at">reps =</span> <span class="dv">4</span>, <span class="at">G =</span> <span class="dv">4</span>, <span class="at">max_diff =</span> <span class="fl">0.5</span>, </span>
<span id="cb345-3"><a href="simulating-multiple-scenarios.html#cb345-3" tabindex="-1"></a>  <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">N =</span> <span class="dv">40</span>, </span>
<span id="cb345-4"><a href="simulating-multiple-scenarios.html#cb345-4" tabindex="-1"></a>  <span class="at">summarize =</span> <span class="cn">FALSE</span></span>
<span id="cb345-5"><a href="simulating-multiple-scenarios.html#cb345-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   ANOVA Welch
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 0.515 0.525
## 2 0.155 0.148
## 3 0.917 0.941
## 4 0.439 0.286</code></pre>
<p>This more elaborate simulation driver makes execution of the simulations a bit more streamlined.
The full set of performance summaries can now be computed by calling <code>map()</code> with the full driver:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="simulating-multiple-scenarios.html#cb347-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20251031</span>)</span>
<span id="cb347-2"><a href="simulating-multiple-scenarios.html#cb347-2" tabindex="-1"></a></span>
<span id="cb347-3"><a href="simulating-multiple-scenarios.html#cb347-3" tabindex="-1"></a>power_levels <span class="ot">&lt;-</span> </span>
<span id="cb347-4"><a href="simulating-multiple-scenarios.html#cb347-4" tabindex="-1"></a>  Welch_design <span class="sc">%&gt;%</span></span>
<span id="cb347-5"><a href="simulating-multiple-scenarios.html#cb347-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb347-6"><a href="simulating-multiple-scenarios.html#cb347-6" tabindex="-1"></a>    <span class="at">res =</span> <span class="fu">map</span>(max_diff, sim_ANOVA_full, <span class="at">reps =</span> <span class="dv">500</span>, <span class="at">G =</span> <span class="dv">4</span>, </span>
<span id="cb347-7"><a href="simulating-multiple-scenarios.html#cb347-7" tabindex="-1"></a>                <span class="at">sigma_sq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">N =</span> <span class="dv">40</span>,</span>
<span id="cb347-8"><a href="simulating-multiple-scenarios.html#cb347-8" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">05</span>))</span>
<span id="cb347-9"><a href="simulating-multiple-scenarios.html#cb347-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb347-10"><a href="simulating-multiple-scenarios.html#cb347-10" tabindex="-1"></a>  <span class="fu">unnest</span>(res)</span></code></pre></div>
<p>The results are organized in a way that facilitates visualization of the power levels:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="simulating-multiple-scenarios.html#cb348-1" tabindex="-1"></a><span class="fu">ggplot</span>(power_levels) <span class="sc">+</span> </span>
<span id="cb348-2"><a href="simulating-multiple-scenarios.html#cb348-2" tabindex="-1"></a>  <span class="fu">aes</span>(max_diff, rej_rate, <span class="at">color =</span> test) <span class="sc">+</span> </span>
<span id="cb348-3"><a href="simulating-multiple-scenarios.html#cb348-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb348-4"><a href="simulating-multiple-scenarios.html#cb348-4" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>,<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>))) <span class="sc">+</span> </span>
<span id="cb348-5"><a href="simulating-multiple-scenarios.html#cb348-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> alpha, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> <span class="fu">label_bquote</span>(alpha <span class="sc">==</span> .(alpha))) <span class="sc">+</span> </span>
<span id="cb348-6"><a href="simulating-multiple-scenarios.html#cb348-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Maximum mean difference&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Power&quot;</span>) <span class="sc">+</span> </span>
<span id="cb348-7"><a href="simulating-multiple-scenarios.html#cb348-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb348-8"><a href="simulating-multiple-scenarios.html#cb348-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position  =</span><span class="st">&quot;inside&quot;</span>, <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="fl">0.08</span>,<span class="fl">0.85</span>))</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/hetero-ANOVA-power-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Under the conditions examined here, both tests appear to have similar power.
At the .05 <span class="math inline">\(\alpha\)</span> level, the power of the Welch test is nearly identical to that of the ANOVA <span class="math inline">\(F\)</span> test.
At the .01 <span class="math inline">\(\alpha\)</span> level, there may be a discrepancy at when <code>max_diff</code> is 0.8, but the apparent difference might be attributable to Monte Carlo error.
Although the tests appear to work similarly here, these results are based on a very specific set of conditions, including equally sized groups and a specific configuration of within-group variances.
A natural further question is whether this pattern holds under other configurations of sample allocations, total sample size, or within-group variances.
These questions can be examined by expanding the simulation design to further scenarios.</p>
</div>
</div>
<div id="simulating-across-multiple-factors" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Simulating across multiple factors<a href="simulating-multiple-scenarios.html#simulating-across-multiple-factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a simulation study examining the performance of confidence intervals for Pearson’s correlation coefficient under a bivariate Poisson distribution.
We examined this data-generating model in Section <a href="data-generating-processes.html#BVPois-example">6.1.2</a>, implementing it in the function <code>r_bivariate_Poisson()</code>. The model has three parameters (the means of each variate, <span class="math inline">\(\mu_1, \mu_2\)</span> and the correlation <span class="math inline">\(\rho\)</span>) and there is one design parameter (sample size, <span class="math inline">\(N\)</span>).
Thus, we could in principle examine up to four factors.</p>
<p>Using these parameters directly as factors in the simulation design will lead to considerable redundancy because of the symmetry of the model: generating data with <span class="math inline">\(\mu_1 = 10\)</span> and <span class="math inline">\(\mu_2 = 5\)</span> would lead to identical correlations as using <span class="math inline">\(\mu_1 = 5\)</span> and <span class="math inline">\(\mu_2 = 10\)</span>.
It is useful to re-parameterize to reduce redundancy and simplify things.
We will therefore define the simulation conditions by always treating <span class="math inline">\(\mu_1\)</span> as the larger variate and by specifying the ratio of the smaller to the larger mean as <span class="math inline">\(\lambda = \mu_2 / \mu_1\)</span>.
We might then examine the following factors:</p>
<ul>
<li>the sample size, with values of <span class="math inline">\(N = 10, 20\)</span>, or <span class="math inline">\(30\)</span></li>
<li>the mean of the larger variate, with values of <span class="math inline">\(\mu_1 = 4, 8\)</span>, or <span class="math inline">\(12\)</span></li>
<li>the ratio of means, with values of <span class="math inline">\(\lambda = 0.5\)</span> or <span class="math inline">\(1.0\)</span>.</li>
<li>the true correlation, with values ranging from <span class="math inline">\(\rho = 0.0\)</span> to <span class="math inline">\(0.7\)</span> in steps of <span class="math inline">\(0.1\)</span></li>
</ul>
<p>The above parameters describe a <span class="math inline">\(3 \times 3 \times 2 \times 8\)</span> factorial design, where each element is the number of levels for that factor. This is a four-factor experiment, because we have four different things we are varying.</p>
<p>To implement this design in code, we first save the simulation parameters as a list with one entry per factor, where each entry consists of the levels that we would like to explore.
We will run a simulation for every possible combination of these values.
Here is code that generates all of the scenarios given the above design, storing these combinations in a data frame, <code>params</code>, that represents the full experimental design:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="simulating-multiple-scenarios.html#cb349-1" tabindex="-1"></a>design_factors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb349-2"><a href="simulating-multiple-scenarios.html#cb349-2" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>),</span>
<span id="cb349-3"><a href="simulating-multiple-scenarios.html#cb349-3" tabindex="-1"></a>  <span class="at">mu1 =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>),</span>
<span id="cb349-4"><a href="simulating-multiple-scenarios.html#cb349-4" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>),</span>
<span id="cb349-5"><a href="simulating-multiple-scenarios.html#cb349-5" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fu">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>)</span>
<span id="cb349-6"><a href="simulating-multiple-scenarios.html#cb349-6" tabindex="-1"></a>)</span>
<span id="cb349-7"><a href="simulating-multiple-scenarios.html#cb349-7" tabindex="-1"></a></span>
<span id="cb349-8"><a href="simulating-multiple-scenarios.html#cb349-8" tabindex="-1"></a><span class="fu">lengths</span>(design_factors)</span></code></pre></div>
<pre><code>##      N    mu1 lambda    rho 
##      3      3      2      8</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="simulating-multiple-scenarios.html#cb351-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>( <span class="sc">!!!</span>design_factors )</span>
<span id="cb351-2"><a href="simulating-multiple-scenarios.html#cb351-2" tabindex="-1"></a>params</span></code></pre></div>
<pre><code>## # A tibble: 144 × 4
##        N   mu1 lambda   rho
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1    10     4    0.5   0  
##  2    10     4    0.5   0.1
##  3    10     4    0.5   0.2
##  4    10     4    0.5   0.3
##  5    10     4    0.5   0.4
##  6    10     4    0.5   0.5
##  7    10     4    0.5   0.6
##  8    10     4    0.5   0.7
##  9    10     4    1     0  
## 10    10     4    1     0.1
## # ℹ 134 more rows</code></pre>
<p>We use <code>expand_grid()</code> from the <code>tidyr</code> package to create all possible combinations of the four factors.<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>
We have a total of <span class="math inline">\(3 \times 3 \times 2 \times 8 = 144\)</span> rows, each row corresponding to a simulation scenario to explore.
With multifactor experiments, it is easy to end up running a lot of experiments!</p>
</div>
<div id="using-pmap-to-run-multifactor-simulations" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Using pmap to run multifactor simulations<a href="simulating-multiple-scenarios.html#using-pmap-to-run-multifactor-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once we have selected factors and levels for simulation, we now need to run the simulation code across all of our factor combinations.
Conceptually, each row of our <code>params</code> dataset represents a single simulation scenario, and we want to run our simulation code for each of these scenarios.
We would thus call our simulation function, using all the values in that row as parameters to pass to the function.</p>
<p>One way to call a function on each row of a dataset in this manner is by using <code>pmap()</code> from the <code>purrr</code> package.
<code>pmap()</code> marches down a set of lists, running a function on each <span class="math inline">\(p\)</span>-tuple of elements, taking the <span class="math inline">\(i^{th}\)</span> element from each list for iteration <span class="math inline">\(i\)</span>, and passing them as parameters to the specified function.
<code>pmap()</code> then returns the results of this sequence of function calls as a list of results.<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>
Because R’s <code>data.frame</code> objects are also sets of lists (where each variable is a vector, which is a simple form of list), <code>pmap()</code> also works seemlessly on <code>data.frame</code> or <code>tibble</code> objects.</p>
<p>Here is a small illustration of <code>pmap()</code> in action:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="simulating-multiple-scenarios.html#cb354-1" tabindex="-1"></a>some_function <span class="ot">&lt;-</span> <span class="cf">function</span>( a, b, theta, scale ) {</span>
<span id="cb354-2"><a href="simulating-multiple-scenarios.html#cb354-2" tabindex="-1"></a>    scale <span class="sc">*</span> (a <span class="sc">+</span> theta<span class="sc">*</span>(b<span class="sc">-</span>a))</span>
<span id="cb354-3"><a href="simulating-multiple-scenarios.html#cb354-3" tabindex="-1"></a>}</span>
<span id="cb354-4"><a href="simulating-multiple-scenarios.html#cb354-4" tabindex="-1"></a></span>
<span id="cb354-5"><a href="simulating-multiple-scenarios.html#cb354-5" tabindex="-1"></a>args_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>) )</span>
<span id="cb354-6"><a href="simulating-multiple-scenarios.html#cb354-6" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">pmap</span>( args_data, <span class="at">.f =</span> some_function, <span class="at">scale =</span> <span class="dv">10</span> )</span></code></pre></div>
<pre><code>## [[1]]
## [1] 18
## 
## [[2]]
## [1] 32
## 
## [[3]]
## [1] 58</code></pre>
<p>One important constraint of <code>pmap()</code> is that the variable names over which to iterate over must correspond <em>exactly</em> to arguments of the function to be evaluated.
In the above example, <code>args_data</code> must have column names that correspond to the arguments of <code>some_function</code>.
For functions with additional arguments that are not manipulated, extra parameters can be passed after the function name (as in the <code>scale</code> argument in this example).
These will also be passed to each function call, but will be the same for all calls.</p>
<p>Let’s now implement this technique for our simulation of confidence intervals for Pearson’s correlation coefficient.
In Section <a href="data-analysis-procedures.html#estimation-functions">7.1</a>, we developed a function called <code>r_and_z()</code> for computing confidence intervals for Pearson’s correlation using Fisher’s <span class="math inline">\(z\)</span> transformation;
then in Section <a href="building-good-visualization.html#assessing-confidence-intervals">13.7</a>, we wrote a function called <code>evaluate_CIs()</code> for evaluating confidence interval coverage and average width.
We can bundle <code>r_bivariate_Poisson()</code>, <code>r_and_z()</code>, and <code>evaluate_CIs()</code> into a simulation driver function by taking</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="simulating-multiple-scenarios.html#cb356-1" tabindex="-1"></a><span class="fu">library</span>(simhelpers)</span>
<span id="cb356-2"><a href="simulating-multiple-scenarios.html#cb356-2" tabindex="-1"></a></span>
<span id="cb356-3"><a href="simulating-multiple-scenarios.html#cb356-3" tabindex="-1"></a>Pearson_sim <span class="ot">&lt;-</span> <span class="fu">bundle_sim</span>(</span>
<span id="cb356-4"><a href="simulating-multiple-scenarios.html#cb356-4" tabindex="-1"></a>  <span class="at">f_generate =</span> r_bivariate_Poisson, <span class="at">f_analyze =</span> r_and_z, <span class="at">f_summarize =</span> evaluate_CIs</span>
<span id="cb356-5"><a href="simulating-multiple-scenarios.html#cb356-5" tabindex="-1"></a>)</span>
<span id="cb356-6"><a href="simulating-multiple-scenarios.html#cb356-6" tabindex="-1"></a><span class="fu">args</span>(Pearson_sim)</span></code></pre></div>
<pre><code>## function (reps, N, mu1, mu2, rho = 0, seed = NA_integer_, summarize = TRUE) 
## NULL</code></pre>
<p>This function will run a simulation for a given scenario:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="simulating-multiple-scenarios.html#cb358-1" tabindex="-1"></a><span class="fu">Pearson_sim</span>(<span class="dv">1000</span>, <span class="at">N =</span> <span class="dv">10</span>, <span class="at">mu1 =</span> <span class="dv">5</span>, <span class="at">mu2 =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   K_coverage coverage coverage_mcse width
##        &lt;int&gt;    &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
## 1       1000    0.945       0.00721  1.09
## # ℹ 1 more variable: width_mcse &lt;dbl&gt;</code></pre>
<p>In order to call <code>Pearson_sim()</code>, we will need to ensure that the columns of the <code>params</code> dataset correspond to the arguments of the function.
Because we re-parameterized the model in terms of <span class="math inline">\(\lambda\)</span>, we will first need to compute the parameter value for <span class="math inline">\(\mu_2\)</span> and remove the <code>lambda</code> variable because it is not an argument of <code>Pearson_sim()</code>:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="simulating-multiple-scenarios.html#cb360-1" tabindex="-1"></a>params_mod <span class="ot">&lt;-</span> </span>
<span id="cb360-2"><a href="simulating-multiple-scenarios.html#cb360-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb360-3"><a href="simulating-multiple-scenarios.html#cb360-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu2 =</span> mu1 <span class="sc">*</span> lambda) <span class="sc">%&gt;%</span></span>
<span id="cb360-4"><a href="simulating-multiple-scenarios.html#cb360-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lambda)</span></code></pre></div>
<p>Now we can use <code>pmap()</code> to run the simulation for all 144 parameter settings:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="simulating-multiple-scenarios.html#cb361-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> params</span>
<span id="cb361-2"><a href="simulating-multiple-scenarios.html#cb361-2" tabindex="-1"></a>sim_results<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">pmap</span>(params_mod, Pearson_sim, <span class="at">reps =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>The above code calls our <code>run_alpha_sim()</code> method for each row in the list of scenarios we want to explore.
Conveniently, we can store the results as a new variable in the same dataset.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="simulating-multiple-scenarios.html#cb362-1" tabindex="-1"></a>sim_results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 5
##        N   mu1   rho   mu2 res             
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;          
##  1    10     4   0       2 &lt;tibble [1 × 5]&gt;
##  2    10     4   0.1     2 &lt;tibble [1 × 5]&gt;
##  3    10     4   0.2     2 &lt;tibble [1 × 5]&gt;
##  4    10     4   0.3     2 &lt;tibble [1 × 5]&gt;
##  5    10     4   0.4     2 &lt;tibble [1 × 5]&gt;
##  6    10     4   0.5     2 &lt;tibble [1 × 5]&gt;
##  7    10     4   0.6     2 &lt;tibble [1 × 5]&gt;
##  8    10     4   0.7     2 &lt;tibble [1 × 5]&gt;
##  9    10     4   0       4 &lt;tibble [1 × 5]&gt;
## 10    10     4   0.1     4 &lt;tibble [1 × 5]&gt;
## # ℹ 134 more rows</code></pre>
<p>The above code may look a bit peculiar: we are storing a set of dataframes (our result) in our original dataframe.
This is actually ok in R: our results will be in what is called a <strong>list-column</strong>, where each element in our list column is the little summary of our simulation results for that scenario.
For instance, if we want to examine the results from the third scenario, we can pull it out as follows:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="simulating-multiple-scenarios.html#cb364-1" tabindex="-1"></a>sim_results<span class="sc">$</span>res[[<span class="dv">3</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   K_coverage coverage coverage_mcse width
##        &lt;int&gt;    &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
## 1       1000    0.947       0.00708  1.13
## # ℹ 1 more variable: width_mcse &lt;dbl&gt;</code></pre>
<p>List columns are neat, but hard to work with.
To turn the list-column into normal data, we can use <code>unnest()</code> to expand the <code>res</code> variable, replicating the values of the main variables once for each row in the nested dataset:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="simulating-multiple-scenarios.html#cb366-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">unnest</span>(sim_results, <span class="at">cols =</span> res)</span>
<span id="cb366-2"><a href="simulating-multiple-scenarios.html#cb366-2" tabindex="-1"></a>sim_results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 9
##        N   mu1   rho   mu2 K_coverage coverage
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;    &lt;dbl&gt;
##  1    10     4   0       2       1000    0.949
##  2    10     4   0.1     2       1000    0.954
##  3    10     4   0.2     2       1000    0.947
##  4    10     4   0.3     2       1000    0.94 
##  5    10     4   0.4     2       1000    0.953
##  6    10     4   0.5     2       1000    0.953
##  7    10     4   0.6     2       1000    0.938
##  8    10     4   0.7     2       1000    0.945
##  9    10     4   0       4       1000    0.956
## 10    10     4   0.1     4       1000    0.94 
## # ℹ 134 more rows
## # ℹ 3 more variables: coverage_mcse &lt;dbl&gt;,
## #   width &lt;dbl&gt;, width_mcse &lt;dbl&gt;</code></pre>
<p>Putting all of this together into a tidy workflow leads to the following:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="simulating-multiple-scenarios.html#cb368-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> </span>
<span id="cb368-2"><a href="simulating-multiple-scenarios.html#cb368-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb368-3"><a href="simulating-multiple-scenarios.html#cb368-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb368-4"><a href="simulating-multiple-scenarios.html#cb368-4" tabindex="-1"></a>    <span class="at">mu2 =</span> mu1 <span class="sc">*</span> lambda,</span>
<span id="cb368-5"><a href="simulating-multiple-scenarios.html#cb368-5" tabindex="-1"></a>    <span class="at">reps =</span> <span class="dv">1000</span></span>
<span id="cb368-6"><a href="simulating-multiple-scenarios.html#cb368-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb368-7"><a href="simulating-multiple-scenarios.html#cb368-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb368-8"><a href="simulating-multiple-scenarios.html#cb368-8" tabindex="-1"></a>    <span class="at">res =</span> <span class="fu">pmap</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(., <span class="sc">-</span>lambda), <span class="at">.f =</span> Pearson_sim)</span>
<span id="cb368-9"><a href="simulating-multiple-scenarios.html#cb368-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb368-10"><a href="simulating-multiple-scenarios.html#cb368-10" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> res)</span></code></pre></div>
<p>As an alternative approach, the <code>evaluate_by_row()</code> function from the <code>simhelpers</code> package accomplishes the same thing as the <code>pmap()</code> calculations inside the <code>mutate()</code> step of the above code. Its syntax is a bit more concise:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="simulating-multiple-scenarios.html#cb369-1" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> </span>
<span id="cb369-2"><a href="simulating-multiple-scenarios.html#cb369-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb369-3"><a href="simulating-multiple-scenarios.html#cb369-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mu2 =</span> mu1 <span class="sc">*</span> lambda ) <span class="sc">%&gt;%</span></span>
<span id="cb369-4"><a href="simulating-multiple-scenarios.html#cb369-4" tabindex="-1"></a>  <span class="fu">evaluate_by_row</span>( Pearson_sim, <span class="at">reps =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>An advantage of <code>evaluate_by_row()</code> is that the input dataset can include extra variables (such as <code>lambda</code>).
Another advantage is that it is easy to run the calculations in parallel; see Chapter <a href="parallel-processing.html#parallel-processing">18</a>.</p>
<p>As a final step, we save our results using tidyverse’s <code>write_rds()</code> (for background on this function, see <a href="https://r4ds.hadley.nz/data-import.html#sec-writing-to-a-file">R for Data Science, Section 7.5</a>).
We first ensure we have a directory by making one via <code>dir.create()</code> (see Chapter <a href="organizing-a-simulation-project.html#saving-files">17.3</a> for more on files):</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="simulating-multiple-scenarios.html#cb370-1" tabindex="-1"></a><span class="fu">dir.create</span>( <span class="st">&quot;results&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span> )</span>
<span id="cb370-2"><a href="simulating-multiple-scenarios.html#cb370-2" tabindex="-1"></a><span class="fu">write_rds</span>( sim_results, <span class="at">file =</span> <span class="st">&quot;results/Pearson_Poisson_results.rds&quot;</span> )</span></code></pre></div>
<p>We now have a complete set of simulation results for all of the scenarios we specified.</p>
</div>
<div id="when-to-calculate-performance-metrics" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> When to calculate performance metrics<a href="simulating-multiple-scenarios.html#when-to-calculate-performance-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For a single-scenario simulation, we repeatedly generate and analyze data, and then assess the performance across the repetitions.
When we extend this process to multifactor simulations, we have a choice: do we compute performance measures for each simulation scenario as we go (inside) or do we compute all of them after we get all of our individual results (outside)?
There are pros and cons to each approach.</p>
<div id="aggregate-as-you-simulate-inside" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Aggregate as you simulate (inside)<a href="simulating-multiple-scenarios.html#aggregate-as-you-simulate-inside" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <em>inside</em> approach runs a stand-alone simulation for each scenario of interest. For each combination of factors, we simulate data, apply our estimators, assess performance, and return a table with summary performance measures. We can then stack these tables to get a dataset with all of the results, ready for analysis.</p>
<p>This is the approach we illustrated above. It is straightforward and streamlined: we already have a method to run simulations for a single scenario, and we just repeat it across multiple scenarios and combine the outputs.
After calling <code>pmap()</code> (or <code>evaluate_by_row()</code>) and stacking the results, we end up with a dataset containing all the simulation conditions, one simulation context per row (or maybe we have sets of several rows for each simulation context, with one row for each method), with the columns consisting of the simulation factors and calculated performance measures.
This table of performance measures is exactly what we need to conduct further analysis and draw conclusions about how the estimators work.</p>
<p>The primary advantages of the inside strategy are that it is easy to modularize the simulation code and it produces a compact dataset of results, minimizing the number and size of files that need to be stored.
On the con side, calculating summary performance measures inside of the simulation driver limits our ability to add new performance measures on the fly or to examine the distribution of individual estimates.
For example, say we wanted to check if the distribution of Fisher-z estimates in a particular scenario was right-skewed, perhaps because we are worried that the estimator sometimes breaks down.
We might want to make a histogram of the point estimates, or calculate the skew of the estimates as a performance measure.
Because the individual estimates are not saved, we would have no way of investigating these questions without rerunning the simulation for that condition.
In short, the inside strategy minimizes disk space but constrains our ability to explore or revise performance calculations.</p>
</div>
<div id="keep-all-simulation-runs-outside" class="section level3 hasAnchor" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Keep all simulation runs (outside)<a href="simulating-multiple-scenarios.html#keep-all-simulation-runs-outside" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <em>outside</em> approach involves retaining the entire set of estimates from every replication, with each row corresponding to an estimate for a given simulated dataset.
The benefit of the outside approach is that it allows us to add or change how we calculate performance measures without re-running the entire simulation.
This is especially important if the simulation is time-intensive, such as when the estimators being evaluated are computationally expensive.
The primary disadvantage the outside approach is that it produces large amounts of data that need to be stored and further manipulated.
Thus, the outside strategy maximizes flexibility, at the cost of increased dataset size.</p>
<p>In our Pearson correlation simulation, we initially followed the inside strategy. To move to the outside strategy, we can set the <code>summarize</code> argument of <code>Pearson_sim()</code> to <code>FALSE</code> so that the simulation driver returns a row for every replication:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="simulating-multiple-scenarios.html#cb371-1" tabindex="-1"></a><span class="fu">Pearson_sim</span>(<span class="at">reps =</span> <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">15</span>, <span class="at">mu1 =</span> <span class="dv">5</span>, <span class="at">mu2 =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##           r          z      CI_lo     CI_hi
## 1 0.8317703 1.19385399  0.5567157 0.9424636
## 2 0.0838674 0.08406486 -0.4476264 0.5715742
## 3 0.6967119 0.86088212  0.2868122 0.8909832
## 4 0.6769642 0.82348856  0.2521390 0.8830127</code></pre>
<p>We then save the entire set of estimates, rather than the performance summaries.
This result file will have <span class="math inline">\(R\)</span> times as many rows as the older file. In practice, these results can quickly get to be extremely large.
On the other hand, disk space is cheap.
Here we run the same experiment as in Section <a href="simulating-multiple-scenarios.html#using-pmap-to-run-multifactor-simulations">10.3</a>, but storing the individual replications instead of just the summarized results:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="simulating-multiple-scenarios.html#cb373-1" tabindex="-1"></a>sim_results_full <span class="ot">&lt;-</span> </span>
<span id="cb373-2"><a href="simulating-multiple-scenarios.html#cb373-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb373-3"><a href="simulating-multiple-scenarios.html#cb373-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mu2 =</span> mu1 <span class="sc">*</span> lambda ) <span class="sc">%&gt;%</span></span>
<span id="cb373-4"><a href="simulating-multiple-scenarios.html#cb373-4" tabindex="-1"></a>  <span class="fu">evaluate_by_row</span>( Pearson_sim, <span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">summarize =</span> <span class="cn">FALSE</span> )</span>
<span id="cb373-5"><a href="simulating-multiple-scenarios.html#cb373-5" tabindex="-1"></a></span>
<span id="cb373-6"><a href="simulating-multiple-scenarios.html#cb373-6" tabindex="-1"></a><span class="fu">write_rds</span>( sim_results_full, <span class="at">file =</span> <span class="st">&quot;results/Pearson_Poisson_results_full.rds&quot;</span> )</span></code></pre></div>
<p>We end up with many more rows and a much larger file.
One small tweak to this workflow will reduce the file size by keeping the results from each replication in a list-column rather than unnesting them. Here we set <code>nest_results = TRUE</code> in the call to <code>evaluate_by_row()</code>:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="simulating-multiple-scenarios.html#cb374-1" tabindex="-1"></a>sim_results_nested <span class="ot">&lt;-</span> </span>
<span id="cb374-2"><a href="simulating-multiple-scenarios.html#cb374-2" tabindex="-1"></a>  params <span class="sc">%&gt;%</span></span>
<span id="cb374-3"><a href="simulating-multiple-scenarios.html#cb374-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">mu2 =</span> mu1 <span class="sc">*</span> lambda ) <span class="sc">%&gt;%</span></span>
<span id="cb374-4"><a href="simulating-multiple-scenarios.html#cb374-4" tabindex="-1"></a>  <span class="fu">evaluate_by_row</span>( Pearson_sim, <span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">summarize =</span> <span class="cn">FALSE</span>, <span class="at">nest_results =</span> <span class="cn">TRUE</span>)</span>
<span id="cb374-5"><a href="simulating-multiple-scenarios.html#cb374-5" tabindex="-1"></a></span>
<span id="cb374-6"><a href="simulating-multiple-scenarios.html#cb374-6" tabindex="-1"></a><span class="fu">write_rds</span>( sim_results_nested, <span class="at">file =</span> <span class="st">&quot;results/Pearson_Poisson_results_nested.rds&quot;</span> )</span></code></pre></div>
<p>Here is the number of rows for the outside vs inside approaches:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="simulating-multiple-scenarios.html#cb375-1" tabindex="-1"></a><span class="fu">c</span>(<span class="at">inside =</span> <span class="fu">nrow</span>( sim_results ), <span class="at">outside =</span> <span class="fu">nrow</span>( sim_results_full ), <span class="at">nested =</span> <span class="fu">nrow</span>( sim_results_nested ))</span></code></pre></div>
<pre><code>##  inside outside  nested 
##     144  144000     144</code></pre>
<p>Here is a comparison of the file sizes on the disk:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="simulating-multiple-scenarios.html#cb377-1" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb377-2"><a href="simulating-multiple-scenarios.html#cb377-2" tabindex="-1"></a>  <span class="at">inside =</span> <span class="fu">file.size</span>(<span class="st">&quot;results/Pearson_Poisson_results.rds&quot;</span>),</span>
<span id="cb377-3"><a href="simulating-multiple-scenarios.html#cb377-3" tabindex="-1"></a>  <span class="at">outside =</span> <span class="fu">file.size</span>(<span class="st">&quot;results/Pearson_Poisson_results_full.rds&quot;</span>),</span>
<span id="cb377-4"><a href="simulating-multiple-scenarios.html#cb377-4" tabindex="-1"></a>  <span class="at">nested =</span> <span class="fu">file.size</span>(<span class="st">&quot;results/Pearson_Poisson_results_nested.rds&quot;</span>)</span>
<span id="cb377-5"><a href="simulating-multiple-scenarios.html#cb377-5" tabindex="-1"></a>) <span class="sc">/</span> <span class="dv">2</span><span class="sc">^</span><span class="dv">10</span> <span class="co"># Kb</span></span></code></pre></div>
<pre><code>##     inside    outside     nested 
##   43.14551 9000.31055 4527.54102</code></pre>
<p>The first is several kilobytes, the second and third are several megabytes. If we follow the outside strategy, keeping the results nested reduces the file size by around 50%.</p>
</div>
<div id="getting-raw-results-ready-for-analysis" class="section level3 hasAnchor" number="10.4.3">
<h3><span class="header-section-number">10.4.3</span> Getting raw results ready for analysis<a href="simulating-multiple-scenarios.html#getting-raw-results-ready-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we generate raw results, we then need to do the performance calculations across replications within each simulation context so that we can explore the trends across simulation factors.</p>
<p>One way to do this is to use <code>group_by()</code> and <code>summarize()</code> to carry out the performance calculations on the unnested simulation results:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="simulating-multiple-scenarios.html#cb379-1" tabindex="-1"></a>sim_results_full <span class="sc">%&gt;%</span></span>
<span id="cb379-2"><a href="simulating-multiple-scenarios.html#cb379-2" tabindex="-1"></a>  <span class="fu">group_by</span>( N, mu1, mu2, rho ) <span class="sc">%&gt;%</span></span>
<span id="cb379-3"><a href="simulating-multiple-scenarios.html#cb379-3" tabindex="-1"></a>  <span class="fu">summarise</span>( </span>
<span id="cb379-4"><a href="simulating-multiple-scenarios.html#cb379-4" tabindex="-1"></a>    <span class="fu">calc_coverage</span>(<span class="at">lower_bound =</span> CI_lo, <span class="at">upper_bound =</span> CI_hi, <span class="at">true_param =</span> rho)</span>
<span id="cb379-5"><a href="simulating-multiple-scenarios.html#cb379-5" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 144 × 9
## # Groups:   N, mu1, mu2 [18]
##        N   mu1   mu2   rho K_coverage coverage
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;    &lt;dbl&gt;
##  1    10     4     2   0         1000    0.945
##  2    10     4     2   0.1       1000    0.936
##  3    10     4     2   0.2       1000    0.956
##  4    10     4     2   0.3       1000    0.944
##  5    10     4     2   0.4       1000    0.946
##  6    10     4     2   0.5       1000    0.935
##  7    10     4     2   0.6       1000    0.95 
##  8    10     4     2   0.7       1000    0.945
##  9    10     4     4   0         1000    0.946
## 10    10     4     4   0.1       1000    0.944
## # ℹ 134 more rows
## # ℹ 3 more variables: coverage_mcse &lt;dbl&gt;,
## #   width &lt;dbl&gt;, width_mcse &lt;dbl&gt;</code></pre>
<p>If we want to use our full performance measure function <code>evaluate_CIs()</code> to get additional metrics such as MCSEs, we would <em>nest</em> our data into a series of mini-datasets (one for each simulation), and then process each element.
As we saw above, nesting collapses a larger dataset into one where one of the variables consists of a list of datasets:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="simulating-multiple-scenarios.html#cb381-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> </span>
<span id="cb381-2"><a href="simulating-multiple-scenarios.html#cb381-2" tabindex="-1"></a>  sim_results_full <span class="sc">|&gt;</span></span>
<span id="cb381-3"><a href="simulating-multiple-scenarios.html#cb381-3" tabindex="-1"></a>  <span class="fu">group_by</span>( N, mu1, mu2, rho ) <span class="sc">%&gt;%</span></span>
<span id="cb381-4"><a href="simulating-multiple-scenarios.html#cb381-4" tabindex="-1"></a>  <span class="fu">nest</span>( <span class="at">.key =</span> <span class="st">&quot;res&quot;</span> )</span>
<span id="cb381-5"><a href="simulating-multiple-scenarios.html#cb381-5" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>## # A tibble: 144 × 5
## # Groups:   N, mu1, mu2, rho [144]
##        N   mu1   rho   mu2 res                 
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;              
##  1    10     4   0       2 &lt;tibble [1,000 × 4]&gt;
##  2    10     4   0.1     2 &lt;tibble [1,000 × 4]&gt;
##  3    10     4   0.2     2 &lt;tibble [1,000 × 4]&gt;
##  4    10     4   0.3     2 &lt;tibble [1,000 × 4]&gt;
##  5    10     4   0.4     2 &lt;tibble [1,000 × 4]&gt;
##  6    10     4   0.5     2 &lt;tibble [1,000 × 4]&gt;
##  7    10     4   0.6     2 &lt;tibble [1,000 × 4]&gt;
##  8    10     4   0.7     2 &lt;tibble [1,000 × 4]&gt;
##  9    10     4   0       4 &lt;tibble [1,000 × 4]&gt;
## 10    10     4   0.1     4 &lt;tibble [1,000 × 4]&gt;
## # ℹ 134 more rows</code></pre>
<p>Note how each row of our nested data has a little tibble containing the results for that context, with 1000 rows each.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>
Once nested, we can then use <code>map2()</code> to apply a function to each element of <code>res</code>:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="simulating-multiple-scenarios.html#cb383-1" tabindex="-1"></a>results_summary <span class="ot">&lt;-</span> </span>
<span id="cb383-2"><a href="simulating-multiple-scenarios.html#cb383-2" tabindex="-1"></a>  results <span class="sc">%&gt;%</span></span>
<span id="cb383-3"><a href="simulating-multiple-scenarios.html#cb383-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">performance =</span> <span class="fu">map2</span>( res, rho, evaluate_CIs ) ) <span class="sc">%&gt;%</span></span>
<span id="cb383-4"><a href="simulating-multiple-scenarios.html#cb383-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>res ) <span class="sc">%&gt;%</span></span>
<span id="cb383-5"><a href="simulating-multiple-scenarios.html#cb383-5" tabindex="-1"></a>  <span class="fu">unnest</span>( <span class="at">cols=</span><span class="st">&quot;performance&quot;</span> ) </span>
<span id="cb383-6"><a href="simulating-multiple-scenarios.html#cb383-6" tabindex="-1"></a>results_summary</span></code></pre></div>
<pre><code>## # A tibble: 144 × 9
## # Groups:   N, mu1, mu2, rho [144]
##        N   mu1   rho   mu2 K_coverage coverage
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;    &lt;dbl&gt;
##  1    10     4   0       2       1000    0.945
##  2    10     4   0.1     2       1000    0.936
##  3    10     4   0.2     2       1000    0.956
##  4    10     4   0.3     2       1000    0.944
##  5    10     4   0.4     2       1000    0.946
##  6    10     4   0.5     2       1000    0.935
##  7    10     4   0.6     2       1000    0.95 
##  8    10     4   0.7     2       1000    0.945
##  9    10     4   0       4       1000    0.946
## 10    10     4   0.1     4       1000    0.944
## # ℹ 134 more rows
## # ℹ 3 more variables: coverage_mcse &lt;dbl&gt;,
## #   width &lt;dbl&gt;, width_mcse &lt;dbl&gt;</code></pre>
<p>We have built our final performance table <em>after</em> running the entire simulation, rather than running it on each simulation scenario in turn.</p>
<p>Now, if we want to add a performance metric, we can simply change <code>evaluate_CIs</code> and recalculate, without having to recompute the entire simulation.
Summarizing during the simulation vs. after, as we just did, leads to the same set of results.<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>
Allowing yourself the flexibility to re-calculate performance measures can be very advantageous, and we tend to follow this outside strategy for any simulations involving more complex estimation procedures.</p>
</div>
</div>
<div id="summary" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Summary<a href="simulating-multiple-scenarios.html#summary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Multifactor simulations are simply a series of individual scenario simulations, where the set of scenarios are structured by systematically manipulating some of the parameters of the data-generating process.
The overall workflow for implementing a multifactor simulation begins with identifying which parameters and which specific values of those parameters to explore.
These parameters correspond to the factors of the simulation’s design; the specific values correspond to the levels (or settings) of each factor.
Following the principles of tidy simulation, we represent these decisions as a dataset consisting of all the combinations of the factors that we wish to explore.
Think of this as a menu, or checklist, of simulation scenarios to run.
The next step in the workflow is then to walk down the list, running a simulation of each scenario in turn.</p>
<p>After executing a multifactor simulation, we will have results from every simulation scenario.
These might be the raw results (estimates of quantities of interest from every individual iteration of the simulation) or summary results (performance measures calculated across iterations of the simulation for a given scenario).
In either form, the results will be connected to the parameter values (the factor levels) use to generate them.
Stacking all the results up will produce a single dataset, suitable for further analysis.</p>
<p>With the workflow that we have demonstrated, it is easy to specify multifactor simulations that involve hundreds or even thousands of distinct scenarios.
The amount of data generated by such simulations can quickly grow overwhelming, and making sense of the results will require further, careful analysis.
In the next several chapters, we will examine several strategies for exploring and presenting results from multifactor simulations.</p>
</div>
<div id="exercises-7" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Exercises<a href="simulating-multiple-scenarios.html#exercises-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="extending-Brown-Forsythe-power" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Extending Brown and Forsythe<a href="simulating-multiple-scenarios.html#extending-Brown-Forsythe-power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">@brown1974SmallSampleBehavior</span> evaluated the power of the ANOVA <span class="math inline">\(F\)</span> and Welch test under twenty different conditions, varying in the number of groups, sample sizes, and degree of heteroskedasticity (see Table <a href="case-ANOVA.html#tab:BF-Scenarios">5.2</a> of Chapter <a href="case-ANOVA.html#case-ANOVA">5</a>).</p>
<ol style="list-style-type: decimal">
<li><p>Extend their work by building a multifactor simulation design to compare the power of the tests when <span class="math inline">\(G = 4\)</span>, for three or more different sample sizes and for settings with either unbalanced group allocations (e.g., <code>allocation = c(0.1, 0.2, 0.3, 0.4)</code>) or equal group sizes.</p></li>
<li><p>Execute the multifactor simulations using <code>pmap()</code> or <code>evaluate_by_row()</code>.</p></li>
<li><p>Create a graph or graphs that depict the power levels of each test as a function of <code>mu_max</code>, sample size, and group allocations. How do the power levels of the tests compare to each other overall?</p></li>
</ol>
</div>
<div id="exercise:trimmed-mean" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Comparing the trimmed mean, median and mean<a href="simulating-multiple-scenarios.html#exercise:trimmed-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this extended exercise, you will develop a multifactor simulation to compare several different estimators of a common parameter under a range of scenarios.
The specific tasks in this process illustrate how we would approach programming a methodological simulation to compare different estimation strategies, as you might see in the “simulation” section of an article in a statistics journal.
In this example, though, both the data-generating process and the estimation strategies are very simple and quick to calculate, so that it is feasible to quickly execute a multifactor simulation.
Following tidy simulation principles, the steps described below will walk you through the steps of building and testing functions for each component of the simulation, assembling them into a simulation driver, specifying a simulation design, and executing a multifactor simulation.</p>
<p>The aim of this simulation is to investigate the performance of the mean, trimmed mean, and median as estimators of the center of a symmetric distribution (such that the mean and median parameters are identical).<br />
As the data-generation function, use a scaled <span class="math inline">\(t\)</span>-distribution so that the standard deviation will always be 1 but will have different fatness of tails (high chance of outliers):</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="simulating-multiple-scenarios.html#cb385-1" tabindex="-1"></a>gen_scaled_t <span class="ot">&lt;-</span> <span class="cf">function</span>( n, mu, df0 ) {</span>
<span id="cb385-2"><a href="simulating-multiple-scenarios.html#cb385-2" tabindex="-1"></a>    mu <span class="sc">+</span> <span class="fu">rt</span>( n, <span class="at">df=</span>df0 ) <span class="sc">/</span> <span class="fu">sqrt</span>( df0 <span class="sc">/</span> (df0<span class="dv">-2</span>) )</span>
<span id="cb385-3"><a href="simulating-multiple-scenarios.html#cb385-3" tabindex="-1"></a>}</span></code></pre></div>
<p>The variance of a <span class="math inline">\(t\)</span> distribution is <span class="math inline">\(df/(df-2)\)</span>, so when we divide our observations by the
square root of this, we standardize them so they have unit variance.
The estimand of interest here is <code>mu</code>, the center of the distribution.
The estimation methods of interest are the conventional (arithemetic) mean, a 10% trimmed mean, and the median of a sample of <span class="math inline">\(n\)</span> observations.
For performance measures, focus on bias, true standard error, and root mean squared error.</p>
<ol style="list-style-type: decimal">
<li><p>Verify that <code>gen_scaled_t()</code> produces data with mean <code>mu</code> and standard deviation 1 for various <code>df0</code> values.</p></li>
<li><p>Write a function to calculate the mean, trimmed mean, and median of a vector of data.
The trimmed mean should trim 10% of the data from each end.
The method should return a data frame with the three estimates, one row per estimator.</p></li>
<li><p>Verify your estimation method works by analyzing a dataset generated with <code>gen_scaled_t()</code>.
For example, you can generate a dataset of size 100 with <code>gen_scaled_t(100, 0, 3)</code> and then analyze it.</p></li>
<li><p>Use <code>bundle_sim()</code> to create a simulation function that generates data and then analyzes it.
The function should take <code>n</code> and <code>df0</code> as arguments, and return the estimates from your analysis method.
Use <code>id</code> to give each simulation run an ID.</p></li>
<li><p>Run your simulation function for 1000 datasets of size 10, with <code>mu=0</code> and <code>df0=5</code>.
Store the results in a variable called <code>raw_exps</code>.</p></li>
<li><p>Write a function to calculate the RMSE, bias, and standard error for your three estimators, given the results.</p></li>
<li><p>Make a single function that takes <code>df0</code> and <code>n</code>, and runs a simulation and returns the performances of your three methods.</p></li>
<li><p>Now make a grid of <span class="math inline">\(n = 10, 50, 250, 1250\)</span> and <span class="math inline">\(df_0 =  3, 5, 15, 30\)</span>, and generate results for your multifactor simulation.</p></li>
<li><p>Make a plot showing how SE changes as a function of sample size for each estimator. Do the three estimator seem to follow the same pattern? Or do they work differently?</p></li>
</ol>
</div>
<div id="exercise:multifactor-latent-correlation" class="section level3 hasAnchor" number="10.6.3">
<h3><span class="header-section-number">10.6.3</span> Estimating latent correlations<a href="simulating-multiple-scenarios.html#exercise:multifactor-latent-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise <a href="data-generating-processes.html#BVNB2">6.9.6</a> introduced a bivariate negative binomial model and asked you to write a data-generating function that implements the model. Exercise <a href="performance-measures.html#three-correlation-estimators">9.10.3</a> provided an estimation function (called <code>three_corrs</code>) that calculates three different types of correlation coefficients, and asked you to write a function for calculating the bias and RMSE of these measures.</p>
<ol style="list-style-type: decimal">
<li><p>Combine your data-generating function, <code>three_corrs()</code>, and your performance calculation into a simulation driver.</p></li>
<li><p>Propose a multifactor simulation design to examine the bias and RMSE of these three correlations. Write code to create a parameter grid for your proposed simulations.</p></li>
<li><p>Execute the simulations for your proposed design.</p></li>
<li><p>Create a graph or graphs that depict the bias and RMSE of each correlation as a function of <span class="math inline">\(\rho\)</span> and any other key parameters.</p></li>
</ol>
</div>
<div id="exercise:multifactor-meta-regression" class="section level3 hasAnchor" number="10.6.4">
<h3><span class="header-section-number">10.6.4</span> Meta-regression<a href="simulating-multiple-scenarios.html#exercise:multifactor-meta-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Exercise <a href="data-generating-processes.html#meta-regression-DGP">6.9.14</a> described the random effects meta-regression model.
List the focal, auxiliary, and structural parameters of this model, and propose a set of design factors to use in a multifactor simulation of the model.
Create a list with one entry per factor, then create a dataset with one row for each simulation context that you propose to evaluate.</p>
</div>
<div id="exercise:examine-a-multifactor-simulation-design" class="section level3 hasAnchor" number="10.6.5">
<h3><span class="header-section-number">10.6.5</span> Examine a multifactor simulation design<a href="simulating-multiple-scenarios.html#exercise:examine-a-multifactor-simulation-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Find a published article that reports a multifactor simulation study examining a methodological question.<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>
Write code to create a parameter grid for the scenarios examined in the study.
Write a few sentences explaining the overall design of the simulation study.
Summarize any justification that the authors provided for the choice of parameter values examined.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="18">
<li id="fn18"><p><code>expand_grid()</code> is set up to take one argument per factor of the design. A clearer example of its natural syntax is:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb353-2"><a href="#cb353-2" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>),</span>
<span id="cb353-3"><a href="#cb353-3" tabindex="-1"></a>  <span class="at">mu1 =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>),</span>
<span id="cb353-4"><a href="#cb353-4" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>),</span>
<span id="cb353-5"><a href="#cb353-5" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fu">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>)</span>
<span id="cb353-6"><a href="#cb353-6" tabindex="-1"></a>)</span></code></pre></div>
<p>However, we generally find it useful to create a list of design factors before creating the full grid of parameter values, so we prefer to make <code>design_factors</code> first. To use <code>expand_grid()</code> on a list, we need to use <code>!!!</code>, the splice operator from the <code>rlang</code> package, which treats <code>design_factors</code> as a set of arguments to be passed to <code>expand_grid</code>. The syntax does look a bit wacky, but it is succinct and useful.<a href="simulating-multiple-scenarios.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>Just like <code>map()</code> or <code>map2()</code>, <code>pmap()</code> has variants such as <code>_dbl</code> or <code>_dfr</code>.
These variants automatically stack or convert the list of things returned into a tidier collection (for <code>_dbl</code> it will convert to a vector of numbers, for <code>_dfr</code> it will stack the results to make a large tibble, assuming each returned item is a little tibble).<a href="simulating-multiple-scenarios.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Alternately, we could store the results in nested form (as in <code>sim_results_nested</code>), so that the <code>group_by()</code> and <code>nest()</code> steps are unnecessary.<a href="simulating-multiple-scenarios.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>In fact, if we use the same seed, we should obtain <em>exactly</em> the same results.<a href="simulating-multiple-scenarios.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Journals that regularly publish methodological simulation studies include <a href="https://www.apa.org/pubs/journals/met">Psychological Methods</a>, <a href="https://link-springer-com.ezproxy.library.wisc.edu/journal/11336">Psychometrika</a>, <a href="https://journals-sagepub-com.ezproxy.library.wisc.edu/home/jeb">Journal of Educational and Behavioral Statistics</a>, <a href="https://www-tandfonline-com.ezproxy.library.wisc.edu/journals/hmbr20">Multivariate Behavioral Research</a>, <a href="https://link.springer.com/journal/13428">Behavior Research Methods</a>, <a href="https://www.cambridge.org/core/journals/research-synthesis-methods">Research Synthesis Methods</a>, and <a href="https://onlinelibrary-wiley-com.ezproxy.library.wisc.edu/journal/10970258">Statistics in Medicine</a>.<a href="simulating-multiple-scenarios.html#fnref22" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="performance-measures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="designing-multifactor-simulations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/060-multiple-scenarios.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
