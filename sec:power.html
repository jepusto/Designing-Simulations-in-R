<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 19 Using simulation as a power calculator | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 19 Using simulation as a power calculator | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Using simulation as a power calculator | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2025-10-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="debugging-and-testing.html"/>
<link rel="next" href="potential-outcomes.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-alphas"><i class="fa fa-check"></i><b>5.5.1</b> Other <span class="math inline">\(\alpha\)</span>’s</a></li>
<li class="chapter" data-level="5.5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-compare-results"><i class="fa fa-check"></i><b>5.5.2</b> Compare results</a></li>
<li class="chapter" data-level="5.5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-power"><i class="fa fa-check"></i><b>5.5.3</b> Power</a></li>
<li class="chapter" data-level="5.5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-wide-long"><i class="fa fa-check"></i><b>5.5.4</b> Wide or long?</a></li>
<li class="chapter" data-level="5.5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-tests"><i class="fa fa-check"></i><b>5.5.5</b> Other tests</a></li>
<li class="chapter" data-level="5.5.6" data-path="case-ANOVA.html"><a href="case-ANOVA.html#methodological-extensions"><i class="fa fa-check"></i><b>5.5.6</b> Methodological extensions</a></li>
<li class="chapter" data-level="5.5.7" data-path="case-ANOVA.html"><a href="case-ANOVA.html#power-analysis"><i class="fa fa-check"></i><b>5.5.7</b> Power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>9</b> Performance metrics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Metrics for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-criteria.html"><a href="performance-criteria.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performance of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-criteria.html"><a href="performance-criteria.html#less-conventional-performance-metrics"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-standard-error-estimators"><i class="fa fa-check"></i><b>9.2</b> Metrics for Standard Error Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-criteria.html"><a href="performance-criteria.html#satterthwaite-degrees-of-freedom"><i class="fa fa-check"></i><b>9.2.1</b> Satterthwaite degrees of freedom</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-ses-for-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.2</b> Assessing SEs for the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-criteria.html"><a href="performance-criteria.html#metrics-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Metrics for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Metrics for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-criteria.html"><a href="performance-criteria.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-criteria.html"><a href="performance-criteria.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-criteria.html"><a href="performance-criteria.html#the-rejection-rate"><i class="fa fa-check"></i><b>9.4.3</b> The Rejection Rate</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-criteria.html"><a href="performance-criteria.html#inference-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-criteria.html"><a href="performance-criteria.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Selecting Relative vs. Absolute Metrics</a></li>
<li class="chapter" data-level="9.6" data-path="performance-criteria.html"><a href="performance-criteria.html#implicit-estimands"><i class="fa fa-check"></i><b>9.6</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.7" data-path="performance-criteria.html"><a href="performance-criteria.html#MCSE"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-for-relative-variance-estimators"><i class="fa fa-check"></i><b>9.7.1</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.2</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.3</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-criteria.html"><a href="performance-criteria.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.8</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.9" data-path="performance-criteria.html"><a href="performance-criteria.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.9</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.10" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-6"><i class="fa fa-check"></i><b>9.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="performance-criteria.html"><a href="performance-criteria.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.10.1</b> Brown and Forsythe (1974)</a></li>
<li class="chapter" data-level="9.10.2" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-t-confidence-intervals"><i class="fa fa-check"></i><b>9.10.2</b> Better confidence intervals</a></li>
<li class="chapter" data-level="9.10.3" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-rct-simulation-under-a-strong-null-hypothesis"><i class="fa fa-check"></i><b>9.10.3</b> Cluster RCT simulation under a strong null hypothesis</a></li>
<li class="chapter" data-level="9.10.4" data-path="performance-criteria.html"><a href="performance-criteria.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.10.4</b> Jackknife calculation of MCSEs</a></li>
<li class="chapter" data-level="9.10.5" data-path="performance-criteria.html"><a href="performance-criteria.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.10.5</b> Distribution theory for person-level average treatment effects</a></li>
<li class="chapter" data-level="9.10.6" data-path="performance-criteria.html"><a href="performance-criteria.html#multiple-scenario-performance"><i class="fa fa-check"></i><b>9.10.6</b> Multiple scenarios</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>10</b> Designing and executing multifactor simulations</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>10.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="10.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.3</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exp-design.html"><a href="exp-design.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="exp-design.html"><a href="exp-design.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>10.5</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>10.5.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="10.5.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>10.5.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="10.5.3" data-path="exp-design.html"><a href="exp-design.html#running-the-simulations"><i class="fa fa-check"></i><b>10.5.3</b> Running the simulations</a></li>
<li class="chapter" data-level="10.5.4" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>10.5.4</b> Calculating performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="exp-design.html"><a href="exp-design.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="exp-design.html"><a href="exp-design.html#brown-and-forsythe-redux"><i class="fa fa-check"></i><b>10.6.1</b> Brown and Forsythe redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="exp-design.html"><a href="exp-design.html#meta-regression"><i class="fa fa-check"></i><b>10.6.2</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.3" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.3</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>11</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="11.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>11.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>11.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>11.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>11.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="11.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="11.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>11.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="11.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>11.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="11.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>11.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>11.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>11.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="11.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>11.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>11.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>12</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>12.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="12.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>12.2</b> Bundling</a></li>
<li class="chapter" data-level="12.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>12.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-true-ses"><i class="fa fa-check"></i><b>12.4</b> Assessing true SEs</a></li>
<li class="chapter" data-level="12.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>12.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="12.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-estimated-ses"><i class="fa fa-check"></i><b>12.6</b> Assessing estimated SEs</a></li>
<li class="chapter" data-level="12.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>12.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="12.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>12.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="12.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>12.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="12.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>12.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="12.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>12.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>13</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="13.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>13.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>13.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="13.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>13.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>13.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="13.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>13.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>13.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>13.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>14.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>15</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="15.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>15.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>15.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="15.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>15.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="15.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>15.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="15.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>15.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="15.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>15.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="15.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>15.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>16</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="16.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>16.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>16.1.1</b> The source command</a></li>
<li class="chapter" data-level="16.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>16.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="16.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>16.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>16.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="16.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>16.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>16.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="16.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>16.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="16.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>16.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="16.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>16.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>17</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="17.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>17.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="17.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>17.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="17.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>17.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>17.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="17.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>17.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="17.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>17.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="17.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>17.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="17.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>17.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="17.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>17.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>18</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>18.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="18.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>18.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="18.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>18.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="18.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>18.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>18.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="19" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>19</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>19.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="19.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>19.2</b> The data generating process</a></li>
<li class="chapter" data-level="19.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>19.3</b> Running the simulation</a></li>
<li class="chapter" data-level="19.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>19.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>19.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="19.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>19.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="19.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>19.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="19.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>19.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>19.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>20</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="20.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>20.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="20.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>20.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="20.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>20.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="20.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>20.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>21</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="21.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>21.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:power" class="section level1 hasAnchor" number="19">
<h1><span class="header-section-number">Chapter 19</span> Using simulation as a power calculator<a href="sec:power.html#sec:power" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We can use simulation as a power calculator.
In particular, to estimate power, we generate data according to our best guess as to what we might find in a planned evaluation, and then analyze these synthetic data and see if we detect the effect we built into our DGP.
We then do this repeatedly, and see how often we detect our effect.
This is power.</p>
<p>Now, if we are generally right about our guesses about our DGP and the associated parameters we plugged into it, in terms of some planned study, then our power will be right on.
This is all a power analysis is, using simulation or otherwise.</p>
<p>Simulation has benefits over using power calculators because we can take into account odd aspects of our modeling, and also do non-standard approaches to evaluation that we might not find in a normal power calculator.</p>
<p>We illustrate this idea with a case study.
In this example, we are planning a school-level intervention to reduce rates of discipline via a socio-emotional targeting intervention on both teachers and students, where we have strongly predictive historic data and a time-series component.
This is a planned RCT, where we will treat entire schools (so a cluster-randomized study).
We are struggling because treating each school is very expensive (we have to run a large training and coaching of the staff), so each unit is a major decision.
We want something like 4, 5, or maybe 6 treated schools.
Our diving question is: Can we get away with this?</p>
<div id="getting-design-parameters-from-pilot-data" class="section level2 hasAnchor" number="19.1">
<h2><span class="header-section-number">19.1</span> Getting design parameters from pilot data<a href="sec:power.html#getting-design-parameters-from-pilot-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We had pilot data from school administrative records (in particular discipline rates for each school and year for a series of five years), and we use those to estimate parameters to plug into our simulation.
We assume our experimental sample will be on schools that have chronic issues
with discipline, so we filtered our historic data to get schools we imagined to likely be in our study.</p>
<p>We ended up with the following data, with log-transformed discipline rates for each year (we did this to put things on a multiplicative scale, and to make our data more normal given heavy skew in the original). Each row is a potential school in the district.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="sec:power.html#cb508-1" tabindex="-1"></a>datW <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="st">&quot;data/discipline_data.csv&quot;</span> )</span></code></pre></div>
<pre><code>## Rows: 27 Columns: 6
## ── Column specification ──────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Code
## dbl (5): 2015, 2016, 2017, 2018, 2019
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="sec:power.html#cb510-1" tabindex="-1"></a>datW</span></code></pre></div>
<pre><code>## # A tibble: 27 × 6
##    Code  `2015` `2016` `2017` `2018` `2019`
##    &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 S1     -2.87  -2.81  -2.93  -3.52  -4.90
##  2 S2     -3.60  -2.83  -2.56  -2.76  -3.32
##  3 S3     -3.00  -2.88  -2.81  -3.39  -4.91
##  4 S4     -3.90  -3.20  -2.53  -3.67  -4.34
##  5 S5     -2.46  -2.00  -3.34  -3.66  -4.71
##  6 S6     -2.86  -2.74  -2.51  -3.21  -3.80
##  7 S7     -2.47  -2.59  -2.69  -2.15  -2.43
##  8 S8     -2.13  -1.93  -1.82  -2.21  -2.95
##  9 S9     -3.36  -3.16  -3.06  -3.26  -3.10
## 10 S10    -2.89  -2.54  -2.26  -2.89  -3.25
## # ℹ 17 more rows</code></pre>
<p>We use these to calculate a mean and covariance structure for generating data:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="sec:power.html#cb512-1" tabindex="-1"></a>lpd_mns <span class="ot">=</span> <span class="fu">apply</span>( datW[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, mean )</span>
<span id="cb512-2"><a href="sec:power.html#cb512-2" tabindex="-1"></a>lpd_mns</span></code></pre></div>
<pre><code>##      2015      2016      2017      2018      2019 
## -3.076298 -2.868337 -2.931562 -3.337221 -4.011440</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="sec:power.html#cb514-1" tabindex="-1"></a>lpd_cov <span class="ot">=</span> <span class="fu">cov</span>( datW[,<span class="sc">-</span><span class="dv">1</span>] )</span>
<span id="cb514-2"><a href="sec:power.html#cb514-2" tabindex="-1"></a>lpd_cov</span></code></pre></div>
<pre><code>##           2015      2016      2017      2018
## 2015 0.4191843 0.2996073 0.2282627 0.3691894
## 2016 0.2996073 0.3656335 0.2014201 0.2511376
## 2017 0.2282627 0.2014201 0.3084799 0.2927782
## 2018 0.3691894 0.2511376 0.2927782 0.5767486
## 2019 0.1921622 0.1623542 0.2541191 0.2927812
##           2019
## 2015 0.1921622
## 2016 0.1623542
## 2017 0.2541191
## 2018 0.2927812
## 2019 0.5425783</code></pre>
</div>
<div id="the-data-generating-process" class="section level2 hasAnchor" number="19.2">
<h2><span class="header-section-number">19.2</span> The data generating process<a href="sec:power.html#the-data-generating-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We next write a data generator that, given a desired number of control and treatment schools, and a treatment effect, makes a dataset by sampling vectors of discipline rates, and then imposes a “treatment effect” of scaling the discipline rate by the treatment coefficient for the last two years.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="sec:power.html#cb516-1" tabindex="-1"></a>make_dat_param <span class="ot">=</span> <span class="cf">function</span>( n_c, n_t, <span class="at">tx=</span><span class="dv">1</span> ) {</span>
<span id="cb516-2"><a href="sec:power.html#cb516-2" tabindex="-1"></a>    n <span class="ot">=</span> n_c <span class="sc">+</span> n_t</span>
<span id="cb516-3"><a href="sec:power.html#cb516-3" tabindex="-1"></a>    lpdisc <span class="ot">=</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>( n, <span class="at">mu =</span> lpd_mns, <span class="at">Sigma =</span> lpd_cov )</span>
<span id="cb516-4"><a href="sec:power.html#cb516-4" tabindex="-1"></a>    lpdisc <span class="ot">=</span> <span class="fu">exp</span>( lpdisc )</span>
<span id="cb516-5"><a href="sec:power.html#cb516-5" tabindex="-1"></a>    <span class="fu">colnames</span>( lpdisc ) <span class="ot">=</span> <span class="fu">paste0</span>( <span class="st">&quot;pdisc_&quot;</span>, <span class="fu">colnames</span>( lpdisc ) )</span>
<span id="cb516-6"><a href="sec:power.html#cb516-6" tabindex="-1"></a>    lpdisc <span class="ot">=</span> <span class="fu">as_tibble</span>( lpdisc ) <span class="sc">%&gt;%</span></span>
<span id="cb516-7"><a href="sec:power.html#cb516-7" tabindex="-1"></a>        <span class="fu">mutate</span>( <span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb516-8"><a href="sec:power.html#cb516-8" tabindex="-1"></a>                <span class="at">Z =</span> <span class="dv">0</span> <span class="sc">+</span> ( <span class="fu">sample</span>( n ) <span class="sc">&lt;=</span> n_t ) )</span>
<span id="cb516-9"><a href="sec:power.html#cb516-9" tabindex="-1"></a>    </span>
<span id="cb516-10"><a href="sec:power.html#cb516-10" tabindex="-1"></a>    <span class="co"># Add in treatment effect</span></span>
<span id="cb516-11"><a href="sec:power.html#cb516-11" tabindex="-1"></a>    lpdisc <span class="ot">=</span> <span class="fu">mutate</span>( lpdisc, </span>
<span id="cb516-12"><a href="sec:power.html#cb516-12" tabindex="-1"></a>                     <span class="at">pdisc_2018 =</span> pdisc_2018 <span class="sc">*</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, tx, <span class="dv">1</span> ),</span>
<span id="cb516-13"><a href="sec:power.html#cb516-13" tabindex="-1"></a>                     <span class="at">pdisc_2019 =</span> pdisc_2019 <span class="sc">*</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, tx, <span class="dv">1</span> ) )</span>
<span id="cb516-14"><a href="sec:power.html#cb516-14" tabindex="-1"></a> </span>
<span id="cb516-15"><a href="sec:power.html#cb516-15" tabindex="-1"></a>    lpdisc <span class="sc">%&gt;%</span> </span>
<span id="cb516-16"><a href="sec:power.html#cb516-16" tabindex="-1"></a>      <span class="fu">relocate</span>( ID, Z )</span>
<span id="cb516-17"><a href="sec:power.html#cb516-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Our function generates schools with discipline given by the provided mean and covariance structure; we have calibrated our data generating process to give us data that looks very similar to the data we would see in the field.
For power, realism, in terms of the aspects impacting uncertainty, is key.</p>
<p>For our impact model, the treatment kicks in for the final two years, multiplying discipline rate by <code>tx</code> (so <code>tx = 1</code> means no treatment effect).</p>
<p>We test our function:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="sec:power.html#cb517-1" tabindex="-1"></a><span class="fu">set.seed</span>( <span class="dv">59585</span> )</span>
<span id="cb517-2"><a href="sec:power.html#cb517-2" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">make_dat_param</span>( <span class="dv">100</span>, <span class="dv">100</span>, <span class="fl">0.5</span> )  </span>
<span id="cb517-3"><a href="sec:power.html#cb517-3" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>## # A tibble: 200 × 7
##       ID     Z pdisc_2015 pdisc_2016 pdisc_2017
##    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     1     0.0312     0.0559     0.0328
##  2     2     1     0.0421     0.0172     0.0239
##  3     3     1     0.187      0.263      0.144 
##  4     4     0     0.0439     0.0457     0.0338
##  5     5     1     0.0378     0.0577     0.0635
##  6     6     1     0.0203     0.0326     0.0377
##  7     7     0     0.0794     0.0624     0.0427
##  8     8     0     0.0257     0.0354     0.0355
##  9     9     1     0.0513     0.0692     0.104 
## 10    10     0     0.0290     0.0840     0.0711
## # ℹ 190 more rows
## # ℹ 2 more variables: pdisc_2018 &lt;dbl&gt;,
## #   pdisc_2019 &lt;dbl&gt;</code></pre>
<p>We can group each treatment arm and look at discipline over the years:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="sec:power.html#cb519-1" tabindex="-1"></a>aL <span class="ot">=</span> a <span class="sc">%&gt;%</span> </span>
<span id="cb519-2"><a href="sec:power.html#cb519-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( pdisc_2015<span class="sc">:</span>pdisc_2019, </span>
<span id="cb519-3"><a href="sec:power.html#cb519-3" tabindex="-1"></a>                <span class="at">names_to =</span> <span class="fu">c</span>( <span class="st">&quot;.value&quot;</span>, <span class="st">&quot;year&quot;</span> ),</span>
<span id="cb519-4"><a href="sec:power.html#cb519-4" tabindex="-1"></a>                <span class="at">names_pattern =</span> <span class="st">&quot;(.*)_(.*)&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb519-5"><a href="sec:power.html#cb519-5" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">year =</span> <span class="fu">as.numeric</span>( year ) )</span>
<span id="cb519-6"><a href="sec:power.html#cb519-6" tabindex="-1"></a></span>
<span id="cb519-7"><a href="sec:power.html#cb519-7" tabindex="-1"></a>aLg <span class="ot">=</span> aL <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( year, Z ) <span class="sc">%&gt;%</span></span>
<span id="cb519-8"><a href="sec:power.html#cb519-8" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">pdisc =</span> <span class="fu">mean</span>( pdisc ) )</span>
<span id="cb519-9"><a href="sec:power.html#cb519-9" tabindex="-1"></a></span>
<span id="cb519-10"><a href="sec:power.html#cb519-10" tabindex="-1"></a><span class="fu">ggplot</span>( aLg, <span class="fu">aes</span>( year, pdisc, <span class="at">col=</span><span class="fu">as.factor</span>(Z) ) ) <span class="sc">+</span></span>
<span id="cb519-11"><a href="sec:power.html#cb519-11" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb519-12"><a href="sec:power.html#cb519-12" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color =</span> <span class="st">&quot;Tx?&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-301-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Our treatment group drops faster than the control. We see the nonlinear structure actually observed in our original data in terms of discipline over time has been replicated.</p>
<p>We next write some functions to analyze our data.
This should feel very familiar: we are just doing our simulation framework, as usual.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="sec:power.html#cb520-1" tabindex="-1"></a>eval_dat <span class="ot">=</span> <span class="cf">function</span>( sdat ) {</span>
<span id="cb520-2"><a href="sec:power.html#cb520-2" tabindex="-1"></a>    </span>
<span id="cb520-3"><a href="sec:power.html#cb520-3" tabindex="-1"></a>    <span class="co"># No covariate adjustment, average change model (on log outcome)</span></span>
<span id="cb520-4"><a href="sec:power.html#cb520-4" tabindex="-1"></a>    M_raw <span class="ot">=</span> <span class="fu">lm</span>( <span class="fu">log</span>( pdisc_2018 ) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z, <span class="at">data=</span>sdat )</span>
<span id="cb520-5"><a href="sec:power.html#cb520-5" tabindex="-1"></a></span>
<span id="cb520-6"><a href="sec:power.html#cb520-6" tabindex="-1"></a>    <span class="co"># Simple average change model using 2018 as outcome.</span></span>
<span id="cb520-7"><a href="sec:power.html#cb520-7" tabindex="-1"></a>    M_simple <span class="ot">=</span> <span class="fu">lm</span>( pdisc_2018 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z <span class="sc">+</span> pdisc_2017 <span class="sc">+</span> pdisc_2016 <span class="sc">+</span> pdisc_2015,</span>
<span id="cb520-8"><a href="sec:power.html#cb520-8" tabindex="-1"></a>                   <span class="at">data=</span>sdat )</span>
<span id="cb520-9"><a href="sec:power.html#cb520-9" tabindex="-1"></a></span>
<span id="cb520-10"><a href="sec:power.html#cb520-10" tabindex="-1"></a>    <span class="co"># Simple model on logged outcome</span></span>
<span id="cb520-11"><a href="sec:power.html#cb520-11" tabindex="-1"></a>    M_log <span class="ot">=</span> <span class="fu">lm</span>( <span class="fu">log</span>( pdisc_2018 ) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z <span class="sc">+</span> <span class="fu">log</span>( pdisc_2017) <span class="sc">+</span> </span>
<span id="cb520-12"><a href="sec:power.html#cb520-12" tabindex="-1"></a>                  <span class="fu">log</span>( pdisc_2016) <span class="sc">+</span> <span class="fu">log</span>( pdisc_2015 ),</span>
<span id="cb520-13"><a href="sec:power.html#cb520-13" tabindex="-1"></a>                <span class="at">data=</span>sdat )</span>
<span id="cb520-14"><a href="sec:power.html#cb520-14" tabindex="-1"></a>    </span>
<span id="cb520-15"><a href="sec:power.html#cb520-15" tabindex="-1"></a>    <span class="co"># Ratio of average disc to average prior disc as outcome</span></span>
<span id="cb520-16"><a href="sec:power.html#cb520-16" tabindex="-1"></a>    sdat <span class="ot">=</span> <span class="fu">mutate</span>( sdat,</span>
<span id="cb520-17"><a href="sec:power.html#cb520-17" tabindex="-1"></a>                   <span class="at">avg_disc =</span> (pdisc_2018 <span class="sc">+</span> pdisc_2019)<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb520-18"><a href="sec:power.html#cb520-18" tabindex="-1"></a>                   <span class="at">prior_disc =</span> (pdisc_2017 <span class="sc">+</span> pdisc_2016 <span class="sc">+</span> pdisc_2015 )<span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb520-19"><a href="sec:power.html#cb520-19" tabindex="-1"></a>                   <span class="at">disc =</span> pdisc_2018 <span class="sc">/</span> prior_disc,</span>
<span id="cb520-20"><a href="sec:power.html#cb520-20" tabindex="-1"></a>                   <span class="at">disc_two =</span> avg_disc <span class="sc">/</span> prior_disc )</span>
<span id="cb520-21"><a href="sec:power.html#cb520-21" tabindex="-1"></a>    M_ratio <span class="ot">=</span> <span class="fu">lm</span>( disc <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z, <span class="at">data =</span> sdat )</span>
<span id="cb520-22"><a href="sec:power.html#cb520-22" tabindex="-1"></a>    M_ratio_twopost <span class="ot">=</span> <span class="fu">lm</span>( disc_two <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z, <span class="at">data =</span> sdat )</span>
<span id="cb520-23"><a href="sec:power.html#cb520-23" tabindex="-1"></a>    </span>
<span id="cb520-24"><a href="sec:power.html#cb520-24" tabindex="-1"></a>    <span class="co"># Use average of two post-tx time periods, averaged to reduce noise</span></span>
<span id="cb520-25"><a href="sec:power.html#cb520-25" tabindex="-1"></a>    M_twopost <span class="ot">=</span> <span class="fu">lm</span>( <span class="fu">log</span>( avg_disc ) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Z <span class="sc">+</span> <span class="fu">log</span>( pdisc_2017 ) <span class="sc">+</span> </span>
<span id="cb520-26"><a href="sec:power.html#cb520-26" tabindex="-1"></a>                      <span class="fu">log</span>( pdisc_2016 ) <span class="sc">+</span> <span class="fu">log</span>( pdisc_2015 ), </span>
<span id="cb520-27"><a href="sec:power.html#cb520-27" tabindex="-1"></a>                    <span class="at">data=</span>sdat )</span>
<span id="cb520-28"><a href="sec:power.html#cb520-28" tabindex="-1"></a></span>
<span id="cb520-29"><a href="sec:power.html#cb520-29" tabindex="-1"></a>    <span class="co"># Time and unit fixed effects</span></span>
<span id="cb520-30"><a href="sec:power.html#cb520-30" tabindex="-1"></a>    sdatL <span class="ot">=</span> <span class="fu">pivot_longer</span>( sdat, <span class="at">cols =</span> pdisc_2015<span class="sc">:</span>pdisc_2019, </span>
<span id="cb520-31"><a href="sec:power.html#cb520-31" tabindex="-1"></a>                          <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb520-32"><a href="sec:power.html#cb520-32" tabindex="-1"></a>                          <span class="at">values_to =</span> <span class="st">&quot;pdisc&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb520-33"><a href="sec:power.html#cb520-33" tabindex="-1"></a>        <span class="fu">mutate</span>( <span class="at">Z =</span> Z <span class="sc">*</span> (year <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;pdisc_2018&quot;</span>, <span class="st">&quot;pdisc_2019&quot;</span> ) ),</span>
<span id="cb520-34"><a href="sec:power.html#cb520-34" tabindex="-1"></a>                <span class="at">ID =</span> <span class="fu">paste0</span>( <span class="st">&quot;S&quot;</span>, ID ) )</span>
<span id="cb520-35"><a href="sec:power.html#cb520-35" tabindex="-1"></a>    </span>
<span id="cb520-36"><a href="sec:power.html#cb520-36" tabindex="-1"></a>    M_2wfe <span class="ot">=</span> <span class="fu">lm</span>( <span class="fu">log</span>( pdisc ) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> ID <span class="sc">+</span> year <span class="sc">+</span> Z,</span>
<span id="cb520-37"><a href="sec:power.html#cb520-37" tabindex="-1"></a>                 <span class="at">data=</span>sdatL )</span>
<span id="cb520-38"><a href="sec:power.html#cb520-38" tabindex="-1"></a></span>
<span id="cb520-39"><a href="sec:power.html#cb520-39" tabindex="-1"></a>    <span class="co"># Bundle all our models by getting the estimated treatment impact</span></span>
<span id="cb520-40"><a href="sec:power.html#cb520-40" tabindex="-1"></a>    <span class="co"># from each.</span></span>
<span id="cb520-41"><a href="sec:power.html#cb520-41" tabindex="-1"></a>    models <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">raw=</span>M_raw, <span class="at">simple=</span>M_simple,</span>
<span id="cb520-42"><a href="sec:power.html#cb520-42" tabindex="-1"></a>                       <span class="at">log=</span>M_log, <span class="at">ratio =</span> M_ratio, </span>
<span id="cb520-43"><a href="sec:power.html#cb520-43" tabindex="-1"></a>                       <span class="at">ratio_twopost =</span> M_ratio_twopost,</span>
<span id="cb520-44"><a href="sec:power.html#cb520-44" tabindex="-1"></a>                       <span class="at">log_twopost =</span> M_twopost, </span>
<span id="cb520-45"><a href="sec:power.html#cb520-45" tabindex="-1"></a>                       <span class="at">FE =</span> M_2wfe )</span>
<span id="cb520-46"><a href="sec:power.html#cb520-46" tabindex="-1"></a>    rs <span class="ot">&lt;-</span> <span class="fu">map_df</span>( models, broom<span class="sc">::</span>tidy, <span class="at">.id=</span><span class="st">&quot;model&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb520-47"><a href="sec:power.html#cb520-47" tabindex="-1"></a>        <span class="fu">filter</span>( term<span class="sc">==</span><span class="st">&quot;Z&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb520-48"><a href="sec:power.html#cb520-48" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>term ) <span class="sc">%&gt;%</span></span>
<span id="cb520-49"><a href="sec:power.html#cb520-49" tabindex="-1"></a>      <span class="fu">arrange</span>( model )</span>
<span id="cb520-50"><a href="sec:power.html#cb520-50" tabindex="-1"></a>    </span>
<span id="cb520-51"><a href="sec:power.html#cb520-51" tabindex="-1"></a>    rs</span>
<span id="cb520-52"><a href="sec:power.html#cb520-52" tabindex="-1"></a>}</span></code></pre></div>
<p>Our method marches through a host of models; we weren’t sure what the gains would be from one model to another, so we decided to conduct power analyses on all of them.
Again, we look at what our evaluation function does:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="sec:power.html#cb521-1" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">make_dat_param</span>( <span class="at">n_c =</span> <span class="dv">4</span>, <span class="at">n_t =</span> <span class="dv">4</span>, <span class="at">tx =</span> <span class="fl">0.5</span> )</span>
<span id="cb521-2"><a href="sec:power.html#cb521-2" tabindex="-1"></a><span class="fu">eval_dat</span>( dat )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 5
##   model       estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 FE          -0.644      0.325     -1.98   0.0576
## 2 log         -0.841      0.478     -1.76   0.176 
## 3 log_twopost -1.22       0.437     -2.80   0.0680
## 4 ratio       -0.126      0.136     -0.923  0.392 
## 5 ratio_twop… -0.269      0.139     -1.93   0.102 
## 6 raw         -0.650      0.300     -2.17   0.0733
## 7 simple      -0.00983    0.0133    -0.742  0.512</code></pre>
<p>We have a nice set of estimates, one for each model.</p>
</div>
<div id="running-the-simulation-1" class="section level2 hasAnchor" number="19.3">
<h2><span class="header-section-number">19.3</span> Running the simulation<a href="sec:power.html#running-the-simulation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we put it all together in our classic simulator:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="sec:power.html#cb523-1" tabindex="-1"></a>sim_run <span class="ot">=</span> <span class="cf">function</span>( n_c, n_t, tx, R, <span class="at">seed =</span> <span class="cn">NULL</span> ) {</span>
<span id="cb523-2"><a href="sec:power.html#cb523-2" tabindex="-1"></a>    <span class="cf">if</span> ( <span class="sc">!</span><span class="fu">is.null</span>( seed ) ) {</span>
<span id="cb523-3"><a href="sec:power.html#cb523-3" tabindex="-1"></a>        <span class="fu">set.seed</span>(seed)</span>
<span id="cb523-4"><a href="sec:power.html#cb523-4" tabindex="-1"></a>    }</span>
<span id="cb523-5"><a href="sec:power.html#cb523-5" tabindex="-1"></a>    <span class="fu">cat</span>( <span class="st">&quot;Running n_c, n_t =&quot;</span>, n_c, n_t, <span class="st">&quot;tx =&quot;</span>, tx, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> )</span>
<span id="cb523-6"><a href="sec:power.html#cb523-6" tabindex="-1"></a>    rps <span class="ot">=</span> <span class="fu">rerun</span>( R, {</span>
<span id="cb523-7"><a href="sec:power.html#cb523-7" tabindex="-1"></a>        sdat <span class="ot">=</span> <span class="fu">make_dat_param</span>(<span class="at">n_c =</span> n_c, <span class="at">n_t =</span> n_t, <span class="at">tx =</span> tx)</span>
<span id="cb523-8"><a href="sec:power.html#cb523-8" tabindex="-1"></a>        <span class="fu">eval_dat</span>( sdat )</span>
<span id="cb523-9"><a href="sec:power.html#cb523-9" tabindex="-1"></a>    })</span>
<span id="cb523-10"><a href="sec:power.html#cb523-10" tabindex="-1"></a>    <span class="fu">bind_rows</span>( rps )</span>
<span id="cb523-11"><a href="sec:power.html#cb523-11" tabindex="-1"></a>}</span></code></pre></div>
<p>We then do the usual to run across a set of scenarios, running <code>sim_run</code> on each row of the following:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="sec:power.html#cb524-1" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">expand_grid</span>( <span class="at">tx =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span> ),</span>
<span id="cb524-2"><a href="sec:power.html#cb524-2" tabindex="-1"></a>                   <span class="at">n_c =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">20</span> ),</span>
<span id="cb524-3"><a href="sec:power.html#cb524-3" tabindex="-1"></a>                   <span class="at">n_t =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span> ) )</span>
<span id="cb524-4"><a href="sec:power.html#cb524-4" tabindex="-1"></a>res<span class="sc">$</span>R <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb524-5"><a href="sec:power.html#cb524-5" tabindex="-1"></a>res<span class="sc">$</span>seed <span class="ot">=</span> <span class="dv">1010203</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res)</span></code></pre></div>
<p>For evaluation, we load our saved results and calculate rejection rates (we use an alpha of 0.10 since we are doing one-sided testing):</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="sec:power.html#cb525-1" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">readRDS</span>( <span class="at">file=</span><span class="st">&quot;data/discipline_simulation.rds&quot;</span> )</span>
<span id="cb525-2"><a href="sec:power.html#cb525-2" tabindex="-1"></a></span>
<span id="cb525-3"><a href="sec:power.html#cb525-3" tabindex="-1"></a>sres <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( n_c, n_t, tx, model ) <span class="sc">%&gt;%</span></span>
<span id="cb525-4"><a href="sec:power.html#cb525-4" tabindex="-1"></a>    <span class="fu">summarise</span>( <span class="at">E_est =</span> <span class="fu">mean</span>( estimate ),</span>
<span id="cb525-5"><a href="sec:power.html#cb525-5" tabindex="-1"></a>               <span class="at">SE =</span> <span class="fu">sd</span>( estimate ),</span>
<span id="cb525-6"><a href="sec:power.html#cb525-6" tabindex="-1"></a>               <span class="at">E_SE_hat =</span> <span class="fu">mean</span>( std.error ),</span>
<span id="cb525-7"><a href="sec:power.html#cb525-7" tabindex="-1"></a>               <span class="at">pow =</span> <span class="fu">mean</span>( p.value <span class="sc">&lt;=</span> <span class="fl">0.10</span> ) ) <span class="co"># one-sided testing</span></span>
<span id="cb525-8"><a href="sec:power.html#cb525-8" tabindex="-1"></a>sres</span></code></pre></div>
<pre><code>## # A tibble: 378 × 8
## # Groups:   n_c, n_t, tx [54]
##      n_c   n_t    tx model   E_est     SE E_SE_hat
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1     4     4  0.5  FE    -0.693  0.313    0.277 
##  2     4     4  0.5  log   -0.694  0.476    0.430 
##  3     4     4  0.5  log_… -0.692  0.431    0.383 
##  4     4     4  0.5  ratio -0.374  0.219    0.203 
##  5     4     4  0.5  rati… -0.291  0.151    0.139 
##  6     4     4  0.5  raw   -0.719  0.535    0.515 
##  7     4     4  0.5  simp… -0.0195 0.0194   0.0157
##  8     4     4  0.75 FE    -0.292  0.310    0.274 
##  9     4     4  0.75 log   -0.295  0.488    0.435 
## 10     4     4  0.75 log_… -0.305  0.424    0.373 
## # ℹ 368 more rows
## # ℹ 1 more variable: pow &lt;dbl&gt;</code></pre>
</div>
<div id="evaluating-power" class="section level2 hasAnchor" number="19.4">
<h2><span class="header-section-number">19.4</span> Evaluating power<a href="sec:power.html#evaluating-power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once our simulation is run, we can explore power as a function of the design characteristics.
In particular, we eventually want to calculate the chance of noticing effects of different sizes, given various sample sizes we might employ.
Our driving question is how few schools on the treated side can we get away with?
Also, we want to know how much having more schools on the control side allows us to get away with fewer schools on the treated side.</p>
<div id="checking-validity-of-our-models" class="section level3 hasAnchor" number="19.4.1">
<h3><span class="header-section-number">19.4.1</span> Checking validity of our models<a href="sec:power.html#checking-validity-of-our-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before we look at power, we need to check on whether our different models are valid.
This is especiallt important as we are in a small <span class="math inline">\(n\)</span> context, so we know asymptotics may not hold as they should.
To check our models for validity we subset our trials to where <code>tx = 1</code>, and look at the rejection rates.</p>
<p>We first run a regression to see if rejection is a function of sample size (are smaller samples more invalid) and treatment-control imbalance.
We center both variables so our intercepts are overall average rejection rates for each model considered:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="sec:power.html#cb527-1" tabindex="-1"></a>sres <span class="ot">=</span> <span class="fu">mutate</span>( sres,</span>
<span id="cb527-2"><a href="sec:power.html#cb527-2" tabindex="-1"></a>               <span class="at">n =</span> n_c <span class="sc">+</span> n_t,</span>
<span id="cb527-3"><a href="sec:power.html#cb527-3" tabindex="-1"></a>               <span class="at">imbalance =</span> <span class="fu">pmax</span>( n_t <span class="sc">/</span> n_c, n_c <span class="sc">/</span> n_t ) <span class="sc">-</span> <span class="dv">1</span> )</span>
<span id="cb527-4"><a href="sec:power.html#cb527-4" tabindex="-1"></a>sres<span class="sc">$</span>n <span class="ot">=</span> (sres<span class="sc">$</span>n <span class="sc">-</span> <span class="fu">mean</span>(sres<span class="sc">$</span>n)) <span class="sc">/</span> <span class="fu">sd</span>(sres<span class="sc">$</span>n)</span>
<span id="cb527-5"><a href="sec:power.html#cb527-5" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">lm</span>( pow <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> (n <span class="sc">+</span> imbalance) <span class="sc">*</span> model <span class="sc">-</span> n <span class="sc">-</span> imbalance,</span>
<span id="cb527-6"><a href="sec:power.html#cb527-6" tabindex="-1"></a>          <span class="at">data =</span> <span class="fu">filter</span>( sres, tx <span class="sc">==</span> <span class="dv">1</span> ) )</span>
<span id="cb527-7"><a href="sec:power.html#cb527-7" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb527-8"><a href="sec:power.html#cb527-8" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>( <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">modelFE</td>
<td align="right">0.143</td>
<td align="right">0.006</td>
<td align="right">24.593</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">modellog</td>
<td align="right">0.099</td>
<td align="right">0.006</td>
<td align="right">16.999</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">modellog_twopost</td>
<td align="right">0.093</td>
<td align="right">0.006</td>
<td align="right">15.939</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">modelratio</td>
<td align="right">0.090</td>
<td align="right">0.006</td>
<td align="right">15.437</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">modelratio_twopost</td>
<td align="right">0.093</td>
<td align="right">0.006</td>
<td align="right">15.967</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">modelraw</td>
<td align="right">0.092</td>
<td align="right">0.006</td>
<td align="right">15.751</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">modelsimple</td>
<td align="right">0.091</td>
<td align="right">0.006</td>
<td align="right">15.571</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">n:modelFE</td>
<td align="right">-0.003</td>
<td align="right">0.006</td>
<td align="right">-0.459</td>
<td align="right">0.647</td>
</tr>
<tr class="odd">
<td align="left">n:modellog</td>
<td align="right">0.001</td>
<td align="right">0.006</td>
<td align="right">0.141</td>
<td align="right">0.888</td>
</tr>
<tr class="even">
<td align="left">n:modellog_twopost</td>
<td align="right">-0.005</td>
<td align="right">0.006</td>
<td align="right">-0.919</td>
<td align="right">0.360</td>
</tr>
<tr class="odd">
<td align="left">n:modelratio</td>
<td align="right">0.000</td>
<td align="right">0.006</td>
<td align="right">0.071</td>
<td align="right">0.944</td>
</tr>
<tr class="even">
<td align="left">n:modelratio_twopost</td>
<td align="right">0.002</td>
<td align="right">0.006</td>
<td align="right">0.414</td>
<td align="right">0.680</td>
</tr>
<tr class="odd">
<td align="left">n:modelraw</td>
<td align="right">-0.006</td>
<td align="right">0.006</td>
<td align="right">-1.008</td>
<td align="right">0.316</td>
</tr>
<tr class="even">
<td align="left">n:modelsimple</td>
<td align="right">0.001</td>
<td align="right">0.006</td>
<td align="right">0.191</td>
<td align="right">0.849</td>
</tr>
<tr class="odd">
<td align="left">imbalance:modelFE</td>
<td align="right">0.005</td>
<td align="right">0.005</td>
<td align="right">0.857</td>
<td align="right">0.394</td>
</tr>
<tr class="even">
<td align="left">imbalance:modellog</td>
<td align="right">-0.003</td>
<td align="right">0.005</td>
<td align="right">-0.587</td>
<td align="right">0.558</td>
</tr>
<tr class="odd">
<td align="left">imbalance:modellog_twopost</td>
<td align="right">0.004</td>
<td align="right">0.005</td>
<td align="right">0.708</td>
<td align="right">0.480</td>
</tr>
<tr class="even">
<td align="left">imbalance:modelratio</td>
<td align="right">0.000</td>
<td align="right">0.005</td>
<td align="right">-0.001</td>
<td align="right">0.999</td>
</tr>
<tr class="odd">
<td align="left">imbalance:modelratio_twopost</td>
<td align="right">0.001</td>
<td align="right">0.005</td>
<td align="right">0.249</td>
<td align="right">0.804</td>
</tr>
<tr class="even">
<td align="left">imbalance:modelraw</td>
<td align="right">0.006</td>
<td align="right">0.005</td>
<td align="right">1.154</td>
<td align="right">0.251</td>
</tr>
<tr class="odd">
<td align="left">imbalance:modelsimple</td>
<td align="right">0.001</td>
<td align="right">0.005</td>
<td align="right">0.180</td>
<td align="right">0.858</td>
</tr>
</tbody>
</table>
<p>We can also plot the nominal rejection rates under the null:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="sec:power.html#cb528-1" tabindex="-1"></a>sres <span class="sc">%&gt;%</span> <span class="fu">filter</span>( tx <span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb528-2"><a href="sec:power.html#cb528-2" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">aes</span>( n_c, pow, <span class="at">col=</span>model ) ) <span class="sc">+</span></span>
<span id="cb528-3"><a href="sec:power.html#cb528-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> n_t, <span class="at">nrow=</span><span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb528-4"><a href="sec:power.html#cb528-4" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb528-5"><a href="sec:power.html#cb528-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="fl">0.10</span> ) <span class="sc">+</span></span>
<span id="cb528-6"><a href="sec:power.html#cb528-6" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks=</span><span class="fu">unique</span>(sres<span class="sc">$</span>n_c) )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-307-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We see the fixed effect models have elevated rates of rejection.
Interestingly, these rates do not seem particularly dependent on sample size or treatment-control imbalance (note lack of significant coefficeints on our regression model).
The other models all appear valid.</p>
<p>We can also check for bias of our methods:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="sec:power.html#cb529-1" tabindex="-1"></a>sres <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( model, tx ) <span class="sc">%&gt;%</span></span>
<span id="cb529-2"><a href="sec:power.html#cb529-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">E_est =</span> <span class="fu">mean</span>( E_est ) ) <span class="sc">%&gt;%</span></span>
<span id="cb529-3"><a href="sec:power.html#cb529-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>( <span class="at">names_from=</span><span class="st">&quot;tx&quot;</span>, <span class="at">values_from=</span><span class="st">&quot;E_est&quot;</span> )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
## # Groups:   model [7]
##   model           `0.5`  `0.75`        `1`
##   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1 FE            -0.692  -0.290  -0.000703 
## 2 log           -0.692  -0.288   0.00120  
## 3 log_twopost   -0.692  -0.291   0.00241  
## 4 ratio         -0.372  -0.187  -0.000937 
## 5 ratio_twopost -0.289  -0.145  -0.00108  
## 6 raw           -0.694  -0.290   0.00327  
## 7 simple        -0.0206 -0.0104  0.0000998</code></pre>
<p>We see our models are estimating different things, none of which are the treatment effect as we parameterized it.
In particular, “FE,” “log,” “raw,” and “log_twopost” are all estimating the impact on the log scale.
Note that <span class="math inline">\(log( 0.5 ) \approx -0.69\)</span> and <span class="math inline">\(log( 0.75 ) \approx -0.29\)</span>.
Our “simple” estimator is estimating the impact on the absolute scale; reducing discipline rates by 50% corresponds to about a 2% reduction in actual cases.
Finally, “ratio” and “ratio_twopost” are estimating the change in the average ratio of post-policy discipline to pre; they are akin to a gain score as compared to the log regressions.</p>
</div>
<div id="assessing-precision-se" class="section level3 hasAnchor" number="19.4.2">
<h3><span class="header-section-number">19.4.2</span> Assessing Precision (SE)<a href="sec:power.html#assessing-precision-se" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, which methods are the most precise?
We look at the true standard errors across our methods (we drop “simple” and the “ratio” estimators since they are not on the ratio scale):</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="sec:power.html#cb531-1" tabindex="-1"></a>sres <span class="sc">%&gt;%</span> </span>
<span id="cb531-2"><a href="sec:power.html#cb531-2" tabindex="-1"></a>  <span class="fu">group_by</span>( model, n_c, n_t ) <span class="sc">%&gt;%</span></span>
<span id="cb531-3"><a href="sec:power.html#cb531-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">SE =</span> <span class="fu">mean</span>(SE ) ) <span class="sc">%&gt;%</span></span>
<span id="cb531-4"><a href="sec:power.html#cb531-4" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="sc">!</span>(model <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;simple&quot;</span>, <span class="st">&quot;ratio&quot;</span>, <span class="st">&quot;ratio_twopost&quot;</span> ) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb531-5"><a href="sec:power.html#cb531-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( n_c, SE, <span class="at">col=</span>model )) <span class="sc">+</span></span>
<span id="cb531-6"><a href="sec:power.html#cb531-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>( . <span class="sc">~</span> n_t ) <span class="sc">+</span></span>
<span id="cb531-7"><a href="sec:power.html#cb531-7" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb531-8"><a href="sec:power.html#cb531-8" tabindex="-1"></a>    <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb531-9"><a href="sec:power.html#cb531-9" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">colour =</span> <span class="st">&quot;Model&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/disc_precision-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>It looks like averaging two years for the outcome is helpful, and bumps up precision.
The two way fixed effects model seems to react to the number of control units differently than the other estimators; it is way more precise when the number of controls is few, but the other estimators catch up.
The “raw” estimator gives a baseline of no covariate adjustment; everything is substantially more precise than it.
The covariates matter a lot.</p>
</div>
<div id="assessing-power-1" class="section level3 hasAnchor" number="19.4.3">
<h3><span class="header-section-number">19.4.3</span> Assessing power<a href="sec:power.html#assessing-power-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We next look at power over our explored contexts, for the models that we find to be valid (i.e., not FE).</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="sec:power.html#cb532-1" tabindex="-1"></a>sres <span class="sc">%&gt;%</span> </span>
<span id="cb532-2"><a href="sec:power.html#cb532-2" tabindex="-1"></a>  <span class="fu">filter</span>( model <span class="sc">!=</span> <span class="st">&quot;FE&quot;</span>,tx <span class="sc">!=</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb532-3"><a href="sec:power.html#cb532-3" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( n_c, pow, <span class="at">col=</span>model )) <span class="sc">+</span></span>
<span id="cb532-4"><a href="sec:power.html#cb532-4" tabindex="-1"></a>    <span class="fu">facet_grid</span>(  . <span class="sc">~</span> tx <span class="sc">+</span> n_t, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb532-5"><a href="sec:power.html#cb532-5" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb532-6"><a href="sec:power.html#cb532-6" tabindex="-1"></a>    <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col=</span><span class="st">&quot;grey&quot;</span> ) <span class="sc">+</span></span>
<span id="cb532-7"><a href="sec:power.html#cb532-7" tabindex="-1"></a>    <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="fu">c</span>( <span class="fl">0.10</span>, <span class="fl">0.80</span> ), <span class="at">lty=</span><span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb532-8"><a href="sec:power.html#cb532-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span> <span class="fu">theme</span>( <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb532-9"><a href="sec:power.html#cb532-9" tabindex="-1"></a>                          <span class="at">legend.direction=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb532-10"><a href="sec:power.html#cb532-10" tabindex="-1"></a>                          <span class="at">legend.key.width=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb532-11"><a href="sec:power.html#cb532-11" tabindex="-1"></a>                          <span class="at">panel.border =</span> <span class="fu">element_blank</span>() ) <span class="sc">+</span></span>
<span id="cb532-12"><a href="sec:power.html#cb532-12" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title=</span><span class="st">&quot;Power for various methods vs number of controls.&quot;</span>,</span>
<span id="cb532-13"><a href="sec:power.html#cb532-13" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Power&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/disc_power-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We mark 80% power with a dashed line. For a 25% reduction in discipline, nothing reaches desired levels of power.
For 50% reduction, some designs do, but we need substantial numbers of control schools.
Averaging two years of outcomes post-treatment seems important: the “twopost” methods have a distinct power bump.
For a single year of outcome data, the log model seems our best bet.</p>
</div>
<div id="assessing-minimum-detectable-effects" class="section level3 hasAnchor" number="19.4.4">
<h3><span class="header-section-number">19.4.4</span> Assessing Minimum Detectable Effects<a href="sec:power.html#assessing-minimum-detectable-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes we want to know, given a design, what size effect we might be able to detect.
The usual measure for this is the Minimum Detectable Effect (MDE), which is usually the size of the smallest effect we could detect with power 80%.</p>
<p>To calculate Minimal Detectable Effects (MDEs) for the log-scale estimators,
we first average our SEs over our different designs, grouped by sample size, and then convert the SEs to MDEs by multiplying by 2.8.
We then have to convert to our treatment scale by flipping the sign and exponentiating, to get out of the log scale.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="sec:power.html#cb533-1" tabindex="-1"></a>sres2 <span class="ot">=</span> sres <span class="sc">%&gt;%</span> </span>
<span id="cb533-2"><a href="sec:power.html#cb533-2" tabindex="-1"></a>  <span class="fu">group_by</span>( model, n_c, n_t ) <span class="sc">%&gt;%</span></span>
<span id="cb533-3"><a href="sec:power.html#cb533-3" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">SE =</span> <span class="fu">mean</span>( SE ),</span>
<span id="cb533-4"><a href="sec:power.html#cb533-4" tabindex="-1"></a>             <span class="at">E_SE_hat =</span> <span class="fu">mean</span>( E_SE_hat ) ) <span class="sc">%&gt;%</span></span>
<span id="cb533-5"><a href="sec:power.html#cb533-5" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">MDE =</span> <span class="fu">exp</span>( <span class="sc">-</span> (<span class="fl">1.64</span> <span class="sc">+</span> <span class="fl">0.8</span>) <span class="sc">*</span> SE ) )</span>
<span id="cb533-6"><a href="sec:power.html#cb533-6" tabindex="-1"></a></span>
<span id="cb533-7"><a href="sec:power.html#cb533-7" tabindex="-1"></a>sres2 <span class="sc">%&gt;%</span> </span>
<span id="cb533-8"><a href="sec:power.html#cb533-8" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="sc">!</span>(model <span class="sc">%in%</span> <span class="fu">c</span>( <span class="st">&quot;simple&quot;</span>, <span class="st">&quot;ratio&quot;</span>, <span class="st">&quot;ratio_twopost&quot;</span> ) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb533-9"><a href="sec:power.html#cb533-9" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( n_c, MDE, <span class="at">col=</span>model ) ) <span class="sc">+</span></span>
<span id="cb533-10"><a href="sec:power.html#cb533-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> n_t, <span class="at">labeller =</span> label_both ) <span class="sc">+</span></span>
<span id="cb533-11"><a href="sec:power.html#cb533-11" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()  <span class="sc">+</span></span>
<span id="cb533-12"><a href="sec:power.html#cb533-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>( <span class="at">yintercept =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb533-13"><a href="sec:power.html#cb533-13" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb533-14"><a href="sec:power.html#cb533-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">breaks =</span> <span class="fu">unique</span>( sres<span class="sc">$</span>n_c ) ) <span class="sc">+</span></span>
<span id="cb533-15"><a href="sec:power.html#cb533-15" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb533-16"><a href="sec:power.html#cb533-16" tabindex="-1"></a>         <span class="at">legend.direction=</span><span class="st">&quot;horizontal&quot;</span>, <span class="at">legend.key.width=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</span>
<span id="cb533-17"><a href="sec:power.html#cb533-17" tabindex="-1"></a>         <span class="at">panel.border =</span> <span class="fu">element_blank</span>() ) <span class="sc">+</span></span>
<span id="cb533-18"><a href="sec:power.html#cb533-18" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;Number of control units&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MDE (proportion reduction of rate)&quot;</span>,</span>
<span id="cb533-19"><a href="sec:power.html#cb533-19" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;A MDE of 0.6 means a 60% reduction (more than half) in discipline rates&quot;</span>,</span>
<span id="cb533-20"><a href="sec:power.html#cb533-20" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;MDE vs number of control units for various methods&quot;</span> )</span></code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/disc_mde-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Corresponding with our findings regarding precision, above, the twopost estimator is the most sensitive, finding the smallest effects.</p>
</div>
</div>
<div id="power-for-multilevel-data" class="section level2 hasAnchor" number="19.5">
<h2><span class="header-section-number">19.5</span> Power for Multilevel Data<a href="sec:power.html#power-for-multilevel-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many power analyses are regarding fitting some sort of multilevel model to some type of structured data.
For example, researchers frequently want to calculate power for multisite randomized trials, where each of a series of sites has students randomized to treatment, or not.
Our earlier cluster RCT case study is another example of this.</p>
<p>We can use the same simulation framework to calculate power for these types of models.
We write a data generation function that generates our data given our target structure, and then repeatidly generate and analyze data to assess power, just as we have done.</p>
<p>As we saw earlier, however, it can be sometimes tricky to write code that properly has covariates that relate to the different levels of our model, or that divides variance appropriately across levels.
For example, in a multisite experiment, we might want a covariate that has a different mean value within each cluster, but also has variation within cluster.</p>
<p>Instead of immediately writing our own data generation function when faced with such a project, it might be worth looking to the literature to see what tools are available.
In this case, for example, we might come across <span class="citation">Enders, Keller, and Woller (<a href="#ref-enders2023simple">2023</a>)</span>, which showcases a package, <code>mlmpower</code>, designed to generate data according to a flexible range of multilevel models.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="sec:power.html#cb534-1" tabindex="-1"></a><span class="fu">library</span>( mlmpower )</span>
<span id="cb534-2"><a href="sec:power.html#cb534-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">outcome</span>(<span class="st">&#39;Y&#39;</span>) <span class="sc">+</span></span>
<span id="cb534-3"><a href="sec:power.html#cb534-3" tabindex="-1"></a>  <span class="fu">within_predictor</span>(<span class="st">&#39;X&#39;</span>) <span class="sc">+</span></span>
<span id="cb534-4"><a href="sec:power.html#cb534-4" tabindex="-1"></a>  <span class="fu">between_predictor</span>(<span class="st">&#39;W&#39;</span>) <span class="sc">+</span></span>
<span id="cb534-5"><a href="sec:power.html#cb534-5" tabindex="-1"></a>  <span class="fu">effect_size</span>(<span class="at">icc =</span> <span class="fl">0.1</span>,</span>
<span id="cb534-6"><a href="sec:power.html#cb534-6" tabindex="-1"></a>              <span class="at">within =</span> <span class="fl">0.2</span> )</span>
<span id="cb534-7"><a href="sec:power.html#cb534-7" tabindex="-1"></a></span>
<span id="cb534-8"><a href="sec:power.html#cb534-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4232345</span>)</span>
<span id="cb534-9"><a href="sec:power.html#cb534-9" tabindex="-1"></a></span>
<span id="cb534-10"><a href="sec:power.html#cb534-10" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">generate</span>( model, </span>
<span id="cb534-11"><a href="sec:power.html#cb534-11" tabindex="-1"></a>                 <span class="at">n_within =</span> <span class="dv">5</span>, </span>
<span id="cb534-12"><a href="sec:power.html#cb534-12" tabindex="-1"></a>                 <span class="at">n_between =</span> <span class="dv">3</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb534-13"><a href="sec:power.html#cb534-13" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb534-14"><a href="sec:power.html#cb534-14" tabindex="-1"></a>dat</span></code></pre></div>
<pre><code>## # A tibble: 15 × 4
##    `_id`     Y      X      W
##    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 15.9   1.02   0.110
##  2     1  8.70  0.168  0.110
##  3     1 16.9   0.579  0.110
##  4     1 19.4   1.64   0.110
##  5     1 12.9  -1.28   0.110
##  6     2  9.33 -0.948 -0.179
##  7     2 14.1   1.66  -0.179
##  8     2 13.7   0.541 -0.179
##  9     2  7.16 -0.503 -0.179
## 10     2  5.04 -1.12  -0.179
## 11     3 18.2   0.522  1.34 
## 12     3 14.1   0.485  1.34 
## 13     3  7.54 -0.471  1.34 
## 14     3 12.9   1.07   1.34 
## 15     3 18.6   0.518  1.34</code></pre>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="sec:power.html#cb536-1" tabindex="-1"></a><span class="fu">cor</span>( dat<span class="sc">$</span>X, dat<span class="sc">$</span>Y )</span></code></pre></div>
<pre><code>## [1] 0.6973513</code></pre>
<p>It even provides methods for calculating power, using a lmer for the estimator (it makes the estimator less visible to the user).
The method in fact runs a multifactor experiment:</p>
<pre><code>## → ICC = 0.10, n_within = 10, n_between = 5</code></pre>
<pre><code>##   Simulating ■                                0/1…</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■■■■■■■■■         78/…</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  100…</code></pre>
<pre><code>## </code></pre>
<pre><code>## → ICC = 0.10, n_within = 20, n_between = 5</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■                    40/…</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  100…</code></pre>
<pre><code>## </code></pre>
<pre><code>## → ICC = 0.10, n_within = 10, n_between = 10</code></pre>
<pre><code>##   Simulating ■■■■                             11/…</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  100…</code></pre>
<pre><code>## </code></pre>
<pre><code>## → ICC = 0.10, n_within = 20, n_between = 10</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■                 50/…</code></pre>
<pre><code>##   Simulating ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  100…</code></pre>
<pre><code>## </code></pre>
<pre><code>##                   value     mc_moe
## fixed.(Intercept)  1.00 0.00000000
## fixed.cgm(X)       0.93 0.05025983
## fixed.cgm(W)       0.03 0.03360292</code></pre>
<p>We have estimated 93% power for detecting the effect of the within-level predictor, <code>X</code>, with 10 students per site and 5 sites, given the parameters we set.
We refer the reader to the package documentation for how to use this specific package.
The broader point is it is sometimes worth digging into provided code to get material for generating data or even running simulations.
That said, each package is designed for a specific purpose, and has its own language.
Here, for example, the effect size defined as <code>within</code> is due to the package paying much attention to how covariates are centered and incorporated in the model.
Tying its parameterization to classic regression coefficients may be non-obvious.
It is thus sometimes easy to use a package to get data that looks like data, but does not actually have the structure you intend.
As always, do diagnostics and verification to ensure the tools are working as you expect.</p>
<p>Here, for example, we might generate a very large dataset to get estimated coefficients as a sanity check:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="sec:power.html#cb556-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">generate</span>( model, </span>
<span id="cb556-2"><a href="sec:power.html#cb556-2" tabindex="-1"></a>                 <span class="at">n_within =</span> <span class="dv">100</span>, </span>
<span id="cb556-3"><a href="sec:power.html#cb556-3" tabindex="-1"></a>                 <span class="at">n_between =</span> <span class="dv">100</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb556-4"><a href="sec:power.html#cb556-4" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb556-5"><a href="sec:power.html#cb556-5" tabindex="-1"></a>M <span class="ot">=</span> lme4<span class="sc">::</span><span class="fu">lmer</span>( Y <span class="sc">~</span> X <span class="sc">+</span> W <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span><span class="st">`</span><span class="at">_id</span><span class="st">`</span>), <span class="at">data=</span>dat )</span>
<span id="cb556-6"><a href="sec:power.html#cb556-6" tabindex="-1"></a>arm<span class="sc">::</span><span class="fu">display</span>(M)</span></code></pre></div>
<pre><code>## lme4::lmer(formula = Y ~ X + W + (1 | `_id`), data = dat)
##             coef.est coef.se
## (Intercept) 10.04     0.16  
## X            2.33     0.04  
## W            0.07     0.16  
## 
## Error terms:
##  Groups   Name        Std.Dev.
##  _id      (Intercept) 1.56    
##  Residual             4.18    
## ---
## number of obs: 10000, groups: _id, 100
## AIC = 57273, DIC = 57246.8
## deviance = 57254.9</code></pre>
<p>We can check our ICC:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="sec:power.html#cb558-1" tabindex="-1"></a>sigma2_2 <span class="ot">=</span> <span class="fu">VarCorr</span>(M)<span class="sc">$</span><span class="st">`</span><span class="at">_id</span><span class="st">`</span>[<span class="dv">1</span>]</span>
<span id="cb558-2"><a href="sec:power.html#cb558-2" tabindex="-1"></a>sigma2_1 <span class="ot">=</span> <span class="fu">attr</span>(<span class="fu">VarCorr</span>(M), <span class="st">&quot;sc&quot;</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb558-3"><a href="sec:power.html#cb558-3" tabindex="-1"></a>sigma2_2 <span class="sc">/</span> (sigma2_2 <span class="sc">+</span> sigma2_1)</span></code></pre></div>
<pre><code>## [1] 0.1215877</code></pre>
<p>Close to the listed 0.10. More testing is needed.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-enders2023simple" class="csl-entry">
Enders, Craig K, Brian T Keller, and Michael P Woller. 2023. <span>“A Simple Monte Carlo Method for Estimating Power in Multilevel Designs.”</span> <em>Psychological Methods</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="debugging-and-testing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="potential-outcomes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/140-simulation-for-power-analysis.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
