<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 20 Simulation under the Potential Outcomes Framework | Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 20 Simulation under the Potential Outcomes Framework | Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 20 Simulation under the Potential Outcomes Framework | Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="A text on designing, implementing, and reporting on Monte Carlo simulation studies" />
  

<meta name="author" content="Luke W. Miratrix and James E. Pustejovsky (Equal authors)" />


<meta name="date" content="2026-01-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec:power.html"/>
<link rel="next" href="the-parametric-bootstrap.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<span class="math inline">
\(\newcommand{\Prob}{\text{Pr}}\)
\(\newcommand{\E}{\mathbb{E}}\)
\(\newcommand{\M}{\mathbb{M}}\)
\(\newcommand{\Q}{\mathbb{Q}}\)
\(\newcommand{\Var}{\text{Var}}\)
\(\newcommand{\Bias}{\text{Bias}}\)
\(\newcommand{\RMSE}{\text{RMSE}}\)
\(\newcommand{\Cov}{\text{Cov}}\)
\(\newcommand{\cor}{\text{cor}}\)
\(\newcommand{\diag}{\text{diag}}\)
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
\(\newcommand{\bs}{\boldsymbol}\)
\(\newcommand{\trace}{\text{tr}}\)
</span>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I An Introductory Look</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#some-of-simulations-many-uses"><i class="fa fa-check"></i><b>1.1</b> Some of simulation’s many uses</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#comparing-statistical-approaches"><i class="fa fa-check"></i><b>1.1.1</b> Comparing statistical approaches</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#assessing-performance-of-complex-pipelines"><i class="fa fa-check"></i><b>1.1.2</b> Assessing performance of complex pipelines</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#assessing-performance-under-misspecification"><i class="fa fa-check"></i><b>1.1.3</b> Assessing performance under misspecification</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#assessing-the-finite-sample-performance-of-a-statistical-approach"><i class="fa fa-check"></i><b>1.1.4</b> Assessing the finite-sample performance of a statistical approach</a></li>
<li class="chapter" data-level="1.1.5" data-path="introduction.html"><a href="introduction.html#conducting-power-analyses"><i class="fa fa-check"></i><b>1.1.5</b> Conducting Power Analyses</a></li>
<li class="chapter" data-level="1.1.6" data-path="introduction.html"><a href="introduction.html#simulating-processess"><i class="fa fa-check"></i><b>1.1.6</b> Simulating processess</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-perils-of-simulation-as-evidence"><i class="fa fa-check"></i><b>1.2</b> The perils of simulation as evidence</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#simulating-to-learn"><i class="fa fa-check"></i><b>1.3</b> Simulating to learn</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.4</b> Why R?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#organization-of-the-text"><i class="fa fa-check"></i><b>1.5</b> Organization of the text</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html"><i class="fa fa-check"></i><b>2</b> Programming Preliminaries</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1</b> Welcome to the tidyverse</a></li>
<li class="chapter" data-level="2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#rolling-your-own"><i class="fa fa-check"></i><b>2.2.1</b> Rolling your own</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#a-dangerous-function"><i class="fa fa-check"></i><b>2.2.2</b> A dangerous function</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#using-named-arguments"><i class="fa fa-check"></i><b>2.2.3</b> Using Named Arguments</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#argument-defaults"><i class="fa fa-check"></i><b>2.2.4</b> Argument Defaults</a></li>
<li class="chapter" data-level="2.2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#function-skeletons"><i class="fa fa-check"></i><b>2.2.5</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#pipe-dreams"><i class="fa fa-check"></i><b>2.3</b> <code>\&gt;</code> (Pipe) dreams</a></li>
<li class="chapter" data-level="2.4" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#recipes-versus-patterns"><i class="fa fa-check"></i><b>2.4</b> Recipes versus Patterns</a></li>
<li class="chapter" data-level="2.5" data-path="programming-preliminaries.html"><a href="programming-preliminaries.html#exercises"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="t-test-simulation.html"><a href="t-test-simulation.html"><i class="fa fa-check"></i><b>3</b> An initial simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-a-single-scenario"><i class="fa fa-check"></i><b>3.1</b> Simulating a single scenario</a></li>
<li class="chapter" data-level="3.2" data-path="t-test-simulation.html"><a href="t-test-simulation.html#a-non-normal-population-distribution"><i class="fa fa-check"></i><b>3.2</b> A non-normal population distribution</a></li>
<li class="chapter" data-level="3.3" data-path="t-test-simulation.html"><a href="t-test-simulation.html#simulating-across-different-scenarios"><i class="fa fa-check"></i><b>3.3</b> Simulating across different scenarios</a></li>
<li class="chapter" data-level="3.4" data-path="t-test-simulation.html"><a href="t-test-simulation.html#extending-the-simulation-design"><i class="fa fa-check"></i><b>3.4</b> Extending the simulation design</a></li>
<li class="chapter" data-level="3.5" data-path="t-test-simulation.html"><a href="t-test-simulation.html#exercises-1"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Structure and Mechanics of a Simulation Study</b></span></li>
<li class="chapter" data-level="4" data-path="simulation-structure.html"><a href="simulation-structure.html"><i class="fa fa-check"></i><b>4</b> Structure of a simulation study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation-structure.html"><a href="simulation-structure.html#general-structure-of-a-simulation"><i class="fa fa-check"></i><b>4.1</b> General structure of a simulation</a></li>
<li class="chapter" data-level="4.2" data-path="simulation-structure.html"><a href="simulation-structure.html#tidy-modular-simulations"><i class="fa fa-check"></i><b>4.2</b> Tidy, modular simulations</a></li>
<li class="chapter" data-level="4.3" data-path="simulation-structure.html"><a href="simulation-structure.html#skeleton-of-a-simulation-study"><i class="fa fa-check"></i><b>4.3</b> Skeleton of a simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="simulation-structure.html"><a href="simulation-structure.html#data-generating-process"><i class="fa fa-check"></i><b>4.3.1</b> Data-Generating Process</a></li>
<li class="chapter" data-level="4.3.2" data-path="simulation-structure.html"><a href="simulation-structure.html#data-analysis-procedure"><i class="fa fa-check"></i><b>4.3.2</b> Data Analysis Procedure</a></li>
<li class="chapter" data-level="4.3.3" data-path="simulation-structure.html"><a href="simulation-structure.html#repetition"><i class="fa fa-check"></i><b>4.3.3</b> Repetition</a></li>
<li class="chapter" data-level="4.3.4" data-path="simulation-structure.html"><a href="simulation-structure.html#performance-summaries"><i class="fa fa-check"></i><b>4.3.4</b> Performance summaries</a></li>
<li class="chapter" data-level="4.3.5" data-path="simulation-structure.html"><a href="simulation-structure.html#multifactor-simulations"><i class="fa fa-check"></i><b>4.3.5</b> Multifactor simulations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="simulation-structure.html"><a href="simulation-structure.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-ANOVA.html"><a href="case-ANOVA.html"><i class="fa fa-check"></i><b>5</b> Case Study: Heteroskedastic ANOVA and Welch</a>
<ul>
<li class="chapter" data-level="5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#case-anova-DGP"><i class="fa fa-check"></i><b>5.1</b> The data-generating model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#now-make-a-function"><i class="fa fa-check"></i><b>5.1.1</b> Now make a function</a></li>
<li class="chapter" data-level="5.1.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#cautious-coding"><i class="fa fa-check"></i><b>5.1.2</b> Cautious coding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#the-hypothesis-testing-procedures"><i class="fa fa-check"></i><b>5.2</b> The hypothesis testing procedures</a></li>
<li class="chapter" data-level="5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#running-the-simulation"><i class="fa fa-check"></i><b>5.3</b> Running the simulation</a></li>
<li class="chapter" data-level="5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#summarizing-test-performance"><i class="fa fa-check"></i><b>5.4</b> Summarizing test performance</a></li>
<li class="chapter" data-level="5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#exAnovaExercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-alphas"><i class="fa fa-check"></i><b>5.5.1</b> Other <span class="math inline">\(\alpha\)</span>’s</a></li>
<li class="chapter" data-level="5.5.2" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-compare-results"><i class="fa fa-check"></i><b>5.5.2</b> Compare results</a></li>
<li class="chapter" data-level="5.5.3" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-power"><i class="fa fa-check"></i><b>5.5.3</b> Power</a></li>
<li class="chapter" data-level="5.5.4" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-wide-long"><i class="fa fa-check"></i><b>5.5.4</b> Wide or long?</a></li>
<li class="chapter" data-level="5.5.5" data-path="case-ANOVA.html"><a href="case-ANOVA.html#BF-other-tests"><i class="fa fa-check"></i><b>5.5.5</b> Other tests</a></li>
<li class="chapter" data-level="5.5.6" data-path="case-ANOVA.html"><a href="case-ANOVA.html#methodological-extensions"><i class="fa fa-check"></i><b>5.5.6</b> Methodological extensions</a></li>
<li class="chapter" data-level="5.5.7" data-path="case-ANOVA.html"><a href="case-ANOVA.html#power-analysis"><i class="fa fa-check"></i><b>5.5.7</b> Power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-generating-processes.html"><a href="data-generating-processes.html"><i class="fa fa-check"></i><b>6</b> Data-generating processes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-examples"><i class="fa fa-check"></i><b>6.1</b> Examples</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#ANOVA-example"><i class="fa fa-check"></i><b>6.1.1</b> Example 1: One-way analysis of variance</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVPois-example"><i class="fa fa-check"></i><b>6.1.2</b> Example 2: Bivariate Poisson model</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#CRT-example"><i class="fa fa-check"></i><b>6.1.3</b> Example 3: Hierarchical linear model for a cluster-randomized trial</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#components-of-a-dgp"><i class="fa fa-check"></i><b>6.2</b> Components of a DGP</a></li>
<li class="chapter" data-level="6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-functions"><i class="fa fa-check"></i><b>6.3</b> A statistical model is a recipe for data generation</a></li>
<li class="chapter" data-level="6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-plotting"><i class="fa fa-check"></i><b>6.4</b> Plot the artificial data</a></li>
<li class="chapter" data-level="6.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#check-the-data-generating-function"><i class="fa fa-check"></i><b>6.5</b> Check the data-generating function</a></li>
<li class="chapter" data-level="6.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#case-cluster"><i class="fa fa-check"></i><b>6.6</b> Example: Simulating clustered data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-design-decision-what-do-we-want-to-manipulate"><i class="fa fa-check"></i><b>6.6.1</b> A design decision: What do we want to manipulate?</a></li>
<li class="chapter" data-level="6.6.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#a-model-for-a-cluster-rct"><i class="fa fa-check"></i><b>6.6.2</b> A model for a cluster RCT</a></li>
<li class="chapter" data-level="6.6.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#from-equations-to-code"><i class="fa fa-check"></i><b>6.6.3</b> From equations to code</a></li>
<li class="chapter" data-level="6.6.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#DGP-standardization"><i class="fa fa-check"></i><b>6.6.4</b> Standardization in the DGP</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#three-parameter-IRT"><i class="fa fa-check"></i><b>6.7</b> Sometimes a DGP is all you need</a></li>
<li class="chapter" data-level="6.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#more-to-explore"><i class="fa fa-check"></i><b>6.8</b> More to explore</a></li>
<li class="chapter" data-level="6.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#exercises-3"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Welch-t-dgp"><i class="fa fa-check"></i><b>6.9.1</b> The Welch test on a shifted-and-scaled <span class="math inline">\(t\)</span> distribution</a></li>
<li class="chapter" data-level="6.9.2" data-path="data-generating-processes.html"><a href="data-generating-processes.html#plot-the-bivariate-poisson"><i class="fa fa-check"></i><b>6.9.2</b> Plot the bivariate Poisson</a></li>
<li class="chapter" data-level="6.9.3" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-check"><i class="fa fa-check"></i><b>6.9.3</b> Check the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.4" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVP-error"><i class="fa fa-check"></i><b>6.9.4</b> Add error-catching to the bivariate Poisson function</a></li>
<li class="chapter" data-level="6.9.5" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB1"><i class="fa fa-check"></i><b>6.9.5</b> A bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.6" data-path="data-generating-processes.html"><a href="data-generating-processes.html#BVNB2"><i class="fa fa-check"></i><b>6.9.6</b> Another bivariate negative binomial distribution</a></li>
<li class="chapter" data-level="6.9.7" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-plot"><i class="fa fa-check"></i><b>6.9.7</b> Plot the data from a cluster-randomized trial</a></li>
<li class="chapter" data-level="6.9.8" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-checks"><i class="fa fa-check"></i><b>6.9.8</b> Checking the Cluster RCT DGP</a></li>
<li class="chapter" data-level="6.9.9" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-heterogeneity"><i class="fa fa-check"></i><b>6.9.9</b> More school-level variation</a></li>
<li class="chapter" data-level="6.9.10" data-path="data-generating-processes.html"><a href="data-generating-processes.html#cluster-RCT-baseline"><i class="fa fa-check"></i><b>6.9.10</b> Cluster-randomized trial with baseline predictors</a></li>
<li class="chapter" data-level="6.9.11" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-parameters"><i class="fa fa-check"></i><b>6.9.11</b> 3-parameter IRT datasets</a></li>
<li class="chapter" data-level="6.9.12" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-checking"><i class="fa fa-check"></i><b>6.9.12</b> Check the 3-parameter IRT DGP</a></li>
<li class="chapter" data-level="6.9.13" data-path="data-generating-processes.html"><a href="data-generating-processes.html#IRT-DGP-breaking"><i class="fa fa-check"></i><b>6.9.13</b> Explore the 3-parameter IRT model</a></li>
<li class="chapter" data-level="6.9.14" data-path="data-generating-processes.html"><a href="data-generating-processes.html#meta-regression-DGP"><i class="fa fa-check"></i><b>6.9.14</b> Random effects meta-regression</a></li>
<li class="chapter" data-level="6.9.15" data-path="data-generating-processes.html"><a href="data-generating-processes.html#Vevea-Hedges-DGP"><i class="fa fa-check"></i><b>6.9.15</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html"><i class="fa fa-check"></i><b>7</b> Data analysis procedures</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#estimation-functions"><i class="fa fa-check"></i><b>7.1</b> Writing estimation functions</a></li>
<li class="chapter" data-level="7.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#multiple-estimation-procedures"><i class="fa fa-check"></i><b>7.2</b> Including Multiple Data Analysis Procedures</a></li>
<li class="chapter" data-level="7.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#validating-an-estimation-function"><i class="fa fa-check"></i><b>7.3</b> Validating an Estimation Function</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-against-existing-implementations"><i class="fa fa-check"></i><b>7.3.1</b> Checking against existing implementations</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-novel-procedures"><i class="fa fa-check"></i><b>7.3.2</b> Checking novel procedures</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#checking-with-simulations"><i class="fa fa-check"></i><b>7.3.3</b> Checking with simulations</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#handling-errors-warnings-and-other-hiccups"><i class="fa fa-check"></i><b>7.4</b> Handling errors, warnings, and other hiccups</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#capturing-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Capturing errors and warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#adapting-for-errors"><i class="fa fa-check"></i><b>7.4.2</b> Adapting estimation procedures for errors and warnings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#exercises-4"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#BFFs-forever"><i class="fa fa-check"></i><b>7.5.1</b> More Heteroskedastic ANOVA</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-testing"><i class="fa fa-check"></i><b>7.5.2</b> Contingent testing</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#cross-check-CRT-estimators"><i class="fa fa-check"></i><b>7.5.3</b> Check the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#CRT-ANCOVA-estimators"><i class="fa fa-check"></i><b>7.5.4</b> Extending the cluster-RCT functions</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#contingent-estimator-processing"><i class="fa fa-check"></i><b>7.5.5</b> Contingent estimator processing</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#IRT-3PL-estimation"><i class="fa fa-check"></i><b>7.5.6</b> Estimating 3-parameter item response theory models</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-analysis-procedures.html"><a href="data-analysis-procedures.html#Vevea-Hedges-estimation"><i class="fa fa-check"></i><b>7.5.7</b> Meta-regression with selective reporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html"><i class="fa fa-check"></i><b>8</b> Running the Simulation Process</a>
<ul>
<li class="chapter" data-level="8.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#repeating-oneself"><i class="fa fa-check"></i><b>8.1</b> Repeating oneself</a></li>
<li class="chapter" data-level="8.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-at-a-time"><i class="fa fa-check"></i><b>8.2</b> One run at a time</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#one-run-reparameterization"><i class="fa fa-check"></i><b>8.2.1</b> Reparameterizing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#bundle-sim-demo"><i class="fa fa-check"></i><b>8.3</b> Bundling simulations with <code>simhelpers</code></a></li>
<li class="chapter" data-level="8.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#seeds-and-pseudo-RNGs"><i class="fa fa-check"></i><b>8.4</b> Seeds and pseudo-random number generators</a></li>
<li class="chapter" data-level="8.5" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#exercises-5"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Welch-simulation"><i class="fa fa-check"></i><b>8.5.1</b> Welch simulations</a></li>
<li class="chapter" data-level="8.5.2" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#Pearson-sampling-distributions"><i class="fa fa-check"></i><b>8.5.2</b> Compare sampling distributions of Pearson’s correlation coefficients</a></li>
<li class="chapter" data-level="8.5.3" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#reparameterization-redux"><i class="fa fa-check"></i><b>8.5.3</b> Reparameterization, redux</a></li>
<li class="chapter" data-level="8.5.4" data-path="running-the-simulation-process.html"><a href="running-the-simulation-process.html#fancy-cluster-RCT-sims"><i class="fa fa-check"></i><b>8.5.4</b> Fancy clustered RCT simulations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="performance-measures.html"><a href="performance-measures.html"><i class="fa fa-check"></i><b>9</b> Performance Measures</a>
<ul>
<li class="chapter" data-level="9.1" data-path="performance-measures.html"><a href="performance-measures.html#assessing-point-estimators"><i class="fa fa-check"></i><b>9.1</b> Measures for Point Estimators</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="performance-measures.html"><a href="performance-measures.html#clusterRCTperformance"><i class="fa fa-check"></i><b>9.1.1</b> Comparing the Performance of the Cluster RCT Estimation Procedures</a></li>
<li class="chapter" data-level="9.1.2" data-path="performance-measures.html"><a href="performance-measures.html#less-conventional-measures"><i class="fa fa-check"></i><b>9.1.2</b> Less Conventional Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="performance-measures.html"><a href="performance-measures.html#measures-for-variance-estimators"><i class="fa fa-check"></i><b>9.2</b> Measures for Variance Estimators</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="performance-measures.html"><a href="performance-measures.html#satterthwaite-degrees-of-freedom"><i class="fa fa-check"></i><b>9.2.1</b> Satterthwaite degrees of freedom</a></li>
<li class="chapter" data-level="9.2.2" data-path="performance-measures.html"><a href="performance-measures.html#assessing-ses-for-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.2.2</b> Assessing SEs for the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="performance-measures.html"><a href="performance-measures.html#measures-for-confidence-intervals"><i class="fa fa-check"></i><b>9.3</b> Measures for Confidence Intervals</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-CI-coverage"><i class="fa fa-check"></i><b>9.3.1</b> Confidence Intervals in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="performance-measures.html"><a href="performance-measures.html#assessing-inferential-procedures"><i class="fa fa-check"></i><b>9.4</b> Measures for Inferential Procedures (Hypothesis Tests)</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="performance-measures.html"><a href="performance-measures.html#validity"><i class="fa fa-check"></i><b>9.4.1</b> Validity</a></li>
<li class="chapter" data-level="9.4.2" data-path="performance-measures.html"><a href="performance-measures.html#power"><i class="fa fa-check"></i><b>9.4.2</b> Power</a></li>
<li class="chapter" data-level="9.4.3" data-path="performance-measures.html"><a href="performance-measures.html#rejection-rates"><i class="fa fa-check"></i><b>9.4.3</b> Rejection Rates</a></li>
<li class="chapter" data-level="9.4.4" data-path="performance-measures.html"><a href="performance-measures.html#inference-in-the-cluster-rct-simulation"><i class="fa fa-check"></i><b>9.4.4</b> Inference in the Cluster RCT Simulation</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="performance-measures.html"><a href="performance-measures.html#sec-relative-performance"><i class="fa fa-check"></i><b>9.5</b> Relative or Absolute Measures?</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="performance-measures.html"><a href="performance-measures.html#performance-relative-to-a-benchmark-estimator"><i class="fa fa-check"></i><b>9.5.1</b> Performance relative to a benchmark estimator</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="performance-measures.html"><a href="performance-measures.html#implicit-estimands"><i class="fa fa-check"></i><b>9.6</b> Estimands Not Represented By a Parameter</a></li>
<li class="chapter" data-level="9.7" data-path="performance-measures.html"><a href="performance-measures.html#MCSE"><i class="fa fa-check"></i><b>9.7</b> Uncertainty in Performance Estimates (the Monte Carlo Standard Error)</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="performance-measures.html"><a href="performance-measures.html#conventional-measures-for-point-estimators"><i class="fa fa-check"></i><b>9.7.1</b> Conventional measures for point estimators</a></li>
<li class="chapter" data-level="9.7.2" data-path="performance-measures.html"><a href="performance-measures.html#less-conventional-measures-for-point-estimators"><i class="fa fa-check"></i><b>9.7.2</b> Less conventional measures for point estimators</a></li>
<li class="chapter" data-level="9.7.3" data-path="performance-measures.html"><a href="performance-measures.html#MCSE-for-relative-variance"><i class="fa fa-check"></i><b>9.7.3</b> MCSE for Relative Variance Estimators</a></li>
<li class="chapter" data-level="9.7.4" data-path="performance-measures.html"><a href="performance-measures.html#mcse-for-confidence-intervals-and-hypothesis-tests"><i class="fa fa-check"></i><b>9.7.4</b> MCSE for Confidence Intervals and Hypothesis Tests</a></li>
<li class="chapter" data-level="9.7.5" data-path="performance-measures.html"><a href="performance-measures.html#calculating-mcses-with-the-simhelpers-package"><i class="fa fa-check"></i><b>9.7.5</b> Calculating MCSEs With the <code>simhelpers</code> Package</a></li>
<li class="chapter" data-level="9.7.6" data-path="performance-measures.html"><a href="performance-measures.html#mcse-calculation-in-our-cluster-rct-example"><i class="fa fa-check"></i><b>9.7.6</b> MCSE Calculation in our Cluster RCT Example</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="performance-measures.html"><a href="performance-measures.html#summary-of-peformance-measures"><i class="fa fa-check"></i><b>9.8</b> Summary of Peformance Measures</a></li>
<li class="chapter" data-level="9.9" data-path="performance-measures.html"><a href="performance-measures.html#concluding-thoughts"><i class="fa fa-check"></i><b>9.9</b> Concluding thoughts</a></li>
<li class="chapter" data-level="9.10" data-path="performance-measures.html"><a href="performance-measures.html#exercises-6"><i class="fa fa-check"></i><b>9.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.10.1" data-path="performance-measures.html"><a href="performance-measures.html#Brown-Forsythe-performance"><i class="fa fa-check"></i><b>9.10.1</b> Brown and Forsythe (1974) results</a></li>
<li class="chapter" data-level="9.10.2" data-path="performance-measures.html"><a href="performance-measures.html#size-adjusted-power"><i class="fa fa-check"></i><b>9.10.2</b> Size-adjusted power</a></li>
<li class="chapter" data-level="9.10.3" data-path="performance-measures.html"><a href="performance-measures.html#three-correlation-estimators"><i class="fa fa-check"></i><b>9.10.3</b> Three correlation estimators</a></li>
<li class="chapter" data-level="9.10.4" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-confidence-intervals"><i class="fa fa-check"></i><b>9.10.4</b> Confidence interval comparison</a></li>
<li class="chapter" data-level="9.10.5" data-path="performance-measures.html"><a href="performance-measures.html#jackknife-MCSE"><i class="fa fa-check"></i><b>9.10.5</b> Jackknife calculation of MCSEs for RMSE</a></li>
<li class="chapter" data-level="9.10.6" data-path="performance-measures.html"><a href="performance-measures.html#jackknife-MCSE-ratio"><i class="fa fa-check"></i><b>9.10.6</b> Jackknife calculation of MCSEs for RMSE ratios</a></li>
<li class="chapter" data-level="9.10.7" data-path="performance-measures.html"><a href="performance-measures.html#cluster-RCT-SPATE"><i class="fa fa-check"></i><b>9.10.7</b> Distribution theory for person-level average treatment effects</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Multifactor Simulations</b></span></li>
<li class="chapter" data-level="10" data-path="exp-design.html"><a href="exp-design.html"><i class="fa fa-check"></i><b>10</b> Designing and executing multifactor simulations</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>10.1</b> Choosing parameter combinations</a></li>
<li class="chapter" data-level="10.2" data-path="exp-design.html"><a href="exp-design.html#using-pmap-to-run-multifactor-simulations"><i class="fa fa-check"></i><b>10.2</b> Using pmap to run multifactor simulations</a></li>
<li class="chapter" data-level="10.3" data-path="exp-design.html"><a href="exp-design.html#when-to-calculate-performance-metrics"><i class="fa fa-check"></i><b>10.3</b> When to calculate performance metrics</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="exp-design.html"><a href="exp-design.html#aggregate-as-you-simulate-inside"><i class="fa fa-check"></i><b>10.3.1</b> Aggregate as you simulate (inside)</a></li>
<li class="chapter" data-level="10.3.2" data-path="exp-design.html"><a href="exp-design.html#keep-all-simulation-runs-outside"><i class="fa fa-check"></i><b>10.3.2</b> Keep all simulation runs (outside)</a></li>
<li class="chapter" data-level="10.3.3" data-path="exp-design.html"><a href="exp-design.html#getting-raw-results-ready-for-analysis"><i class="fa fa-check"></i><b>10.3.3</b> Getting raw results ready for analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="exp-design.html"><a href="exp-design.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="exp-design.html"><a href="exp-design.html#case-study-a-multifactor-evaluation-of-cluster-rct-estimators"><i class="fa fa-check"></i><b>10.5</b> Case Study: A multifactor evaluation of cluster RCT estimators</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="exp-design.html"><a href="exp-design.html#choosing-parameters-for-the-clustered-rct"><i class="fa fa-check"></i><b>10.5.1</b> Choosing parameters for the Clustered RCT</a></li>
<li class="chapter" data-level="10.5.2" data-path="exp-design.html"><a href="exp-design.html#redundant-factor-combinations"><i class="fa fa-check"></i><b>10.5.2</b> Redundant factor combinations</a></li>
<li class="chapter" data-level="10.5.3" data-path="exp-design.html"><a href="exp-design.html#running-the-simulations"><i class="fa fa-check"></i><b>10.5.3</b> Running the simulations</a></li>
<li class="chapter" data-level="10.5.4" data-path="exp-design.html"><a href="exp-design.html#calculating-performance-metrics"><i class="fa fa-check"></i><b>10.5.4</b> Calculating performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="exp-design.html"><a href="exp-design.html#exercises-7"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="exp-design.html"><a href="exp-design.html#brown-and-forsythe-redux"><i class="fa fa-check"></i><b>10.6.1</b> Brown and Forsythe redux</a></li>
<li class="chapter" data-level="10.6.2" data-path="exp-design.html"><a href="exp-design.html#meta-regression"><i class="fa fa-check"></i><b>10.6.2</b> Meta-regression</a></li>
<li class="chapter" data-level="10.6.3" data-path="exp-design.html"><a href="exp-design.html#exercise:trimmed-mean"><i class="fa fa-check"></i><b>10.6.3</b> Comparing the trimmed mean, median and mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="presentation-of-results.html"><a href="presentation-of-results.html"><i class="fa fa-check"></i><b>11</b> Exploring and presenting simulation results</a>
<ul>
<li class="chapter" data-level="11.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#tabulation"><i class="fa fa-check"></i><b>11.1</b> Tabulation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-estimators-of-treatment-variation"><i class="fa fa-check"></i><b>11.1.1</b> Example: estimators of treatment variation</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#visualization"><i class="fa fa-check"></i><b>11.2</b> Visualization</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-0-rmse-in-cluster-rcts"><i class="fa fa-check"></i><b>11.2.1</b> Example 0: RMSE in Cluster RCTs</a></li>
<li class="chapter" data-level="11.2.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-correlation-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Example 1: Biserial correlation estimation</a></li>
<li class="chapter" data-level="11.2.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-variance-estimation-and-meta-regression"><i class="fa fa-check"></i><b>11.2.3</b> Example 2: Variance estimation and Meta-regression</a></li>
<li class="chapter" data-level="11.2.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-3-heat-maps-of-coverage"><i class="fa fa-check"></i><b>11.2.4</b> Example 3: Heat maps of coverage</a></li>
<li class="chapter" data-level="11.2.5" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-4-relative-performance-of-treatment-effect-estimators"><i class="fa fa-check"></i><b>11.2.5</b> Example 4: Relative performance of treatment effect estimators</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="presentation-of-results.html"><a href="presentation-of-results.html#modeling"><i class="fa fa-check"></i><b>11.3</b> Modeling</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-1-biserial-revisited"><i class="fa fa-check"></i><b>11.3.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="11.3.2" data-path="presentation-of-results.html"><a href="presentation-of-results.html#example-2-comparing-methods-for-cross-classified-data"><i class="fa fa-check"></i><b>11.3.2</b> Example 2: Comparing methods for cross-classified data</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="presentation-of-results.html"><a href="presentation-of-results.html#reporting"><i class="fa fa-check"></i><b>11.4</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="building-good-visualization.html"><a href="building-good-visualization.html"><i class="fa fa-check"></i><b>12</b> Building good visualizations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#subsetting-and-many-small-multiples"><i class="fa fa-check"></i><b>12.1</b> Subsetting and Many Small Multiples</a></li>
<li class="chapter" data-level="12.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#bundling"><i class="fa fa-check"></i><b>12.2</b> Bundling</a></li>
<li class="chapter" data-level="12.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#aggregation"><i class="fa fa-check"></i><b>12.3</b> Aggregation</a></li>
<li class="chapter" data-level="12.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#comparing-true-ses-with-standardization"><i class="fa fa-check"></i><b>12.4</b> Comparing true SEs with standardization</a></li>
<li class="chapter" data-level="12.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#the-bias-se-rmse-plot"><i class="fa fa-check"></i><b>12.5</b> The Bias-SE-RMSE plot</a></li>
<li class="chapter" data-level="12.6" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-the-quality-of-the-estimated-ses"><i class="fa fa-check"></i><b>12.6</b> Assessing the quality of the estimated SEs</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#stability-of-estimated-ses"><i class="fa fa-check"></i><b>12.6.1</b> Stability of estimated SEs</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-confidence-intervals"><i class="fa fa-check"></i><b>12.7</b> Assessing confidence intervals</a></li>
<li class="chapter" data-level="12.8" data-path="building-good-visualization.html"><a href="building-good-visualization.html#exercises-8"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-uncertainty"><i class="fa fa-check"></i><b>12.8.1</b> Assessing uncertainty</a></li>
<li class="chapter" data-level="12.8.2" data-path="building-good-visualization.html"><a href="building-good-visualization.html#assessing-power"><i class="fa fa-check"></i><b>12.8.2</b> Assessing power</a></li>
<li class="chapter" data-level="12.8.3" data-path="building-good-visualization.html"><a href="building-good-visualization.html#going-deeper-with-coverage"><i class="fa fa-check"></i><b>12.8.3</b> Going deeper with coverage</a></li>
<li class="chapter" data-level="12.8.4" data-path="building-good-visualization.html"><a href="building-good-visualization.html#pearson-correlations-with-a-bivariate-poisson-distribution"><i class="fa fa-check"></i><b>12.8.4</b> Pearson correlations with a bivariate Poisson distribution</a></li>
<li class="chapter" data-level="12.8.5" data-path="building-good-visualization.html"><a href="building-good-visualization.html#making-another-plot-for-assessing-ses"><i class="fa fa-check"></i><b>12.8.5</b> Making another plot for assessing SEs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html"><i class="fa fa-check"></i><b>13</b> Special Topics on Reporting Simulation Results</a>
<ul>
<li class="chapter" data-level="13.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-to-analyze-simulation-results"><i class="fa fa-check"></i><b>13.1</b> Using regression to analyze simulation results</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-1-biserial-revisited-1"><i class="fa fa-check"></i><b>13.1.1</b> Example 1: Biserial, revisited</a></li>
<li class="chapter" data-level="13.1.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-2-cluster-rct-example-revisited"><i class="fa fa-check"></i><b>13.1.2</b> Example 2: Cluster RCT example, revisited</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#using-regression-trees-to-find-important-factors"><i class="fa fa-check"></i><b>13.2</b> Using regression trees to find important factors</a></li>
<li class="chapter" data-level="13.3" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#analyzing-results-with-few-iterations-per-scenario"><i class="fa fa-check"></i><b>13.3</b> Analyzing results with few iterations per scenario</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#example-clusterrct-with-only-100-replicates-per-scenario"><i class="fa fa-check"></i><b>13.3.1</b> Example: ClusterRCT with only 100 replicates per scenario</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="special-topics-on-reporting-simulation-results.html"><a href="special-topics-on-reporting-simulation-results.html#what-to-do-with-warnings-in-simulations"><i class="fa fa-check"></i><b>13.4</b> What to do with warnings in simulations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html"><i class="fa fa-check"></i><b>14</b> Case study: Comparing different estimators</a>
<ul>
<li class="chapter" data-level="14.1" data-path="case-study-comparing-different-estimators.html"><a href="case-study-comparing-different-estimators.html#bias-variance-tradeoffs"><i class="fa fa-check"></i><b>14.1</b> Bias-variance tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html"><i class="fa fa-check"></i><b>15</b> Simulations as evidence</a>
<ul>
<li class="chapter" data-level="15.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#strategies-for-making-relevant-simulations"><i class="fa fa-check"></i><b>15.1</b> Strategies for making relevant simulations</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#break-symmetries-and-regularities"><i class="fa fa-check"></i><b>15.1.1</b> Break symmetries and regularities</a></li>
<li class="chapter" data-level="15.1.2" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#make-your-simulation-general-with-an-extensive-multi-factor-experiment"><i class="fa fa-check"></i><b>15.1.2</b> Make your simulation general with an extensive multi-factor experiment</a></li>
<li class="chapter" data-level="15.1.3" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-previously-published-simulations-to-beat-them-at-their-own-game"><i class="fa fa-check"></i><b>15.1.3</b> Use previously published simulations to beat them at their own game</a></li>
<li class="chapter" data-level="15.1.4" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#calibrate-simulation-factors-to-real-data"><i class="fa fa-check"></i><b>15.1.4</b> Calibrate simulation factors to real data</a></li>
<li class="chapter" data-level="15.1.5" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#use-real-data-to-obtain-directly"><i class="fa fa-check"></i><b>15.1.5</b> Use real data to obtain directly</a></li>
<li class="chapter" data-level="15.1.6" data-path="simulations-as-evidence.html"><a href="simulations-as-evidence.html#fully-calibrated-simulations"><i class="fa fa-check"></i><b>15.1.6</b> Fully calibrated simulations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Computational Considerations</b></span></li>
<li class="chapter" data-level="16" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html"><i class="fa fa-check"></i><b>16</b> Organizing a simulation project</a>
<ul>
<li class="chapter" data-level="16.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#well-structured-r-scripts"><i class="fa fa-check"></i><b>16.1</b> Well structured R scripts</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-source-command"><i class="fa fa-check"></i><b>16.1.1</b> The source command</a></li>
<li class="chapter" data-level="16.1.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#putting-headers-in-your-.r-file"><i class="fa fa-check"></i><b>16.1.2</b> Putting headers in your .R file</a></li>
<li class="chapter" data-level="16.1.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#about-keeping-tests-with-FALSE"><i class="fa fa-check"></i><b>16.1.3</b> Storing testing code in your scripts</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#principled-directory-structures"><i class="fa fa-check"></i><b>16.2</b> Principled directory structures</a></li>
<li class="chapter" data-level="16.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-files"><i class="fa fa-check"></i><b>16.3</b> Saving simulation results</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-in-general"><i class="fa fa-check"></i><b>16.3.1</b> Saving simulations in general</a></li>
<li class="chapter" data-level="16.3.2" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#saving-simulations-as-you-go"><i class="fa fa-check"></i><b>16.3.2</b> Saving simulations as you go</a></li>
<li class="chapter" data-level="16.3.3" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#dynamically-making-directories"><i class="fa fa-check"></i><b>16.3.3</b> Dynamically making directories</a></li>
<li class="chapter" data-level="16.3.4" data-path="organizing-a-simulation-project.html"><a href="organizing-a-simulation-project.html#loading-and-combining-files-of-simulation-results"><i class="fa fa-check"></i><b>16.3.4</b> Loading and combining files of simulation results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>17</b> Parallel Processing</a>
<ul>
<li class="chapter" data-level="17.1" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-your-computer"><i class="fa fa-check"></i><b>17.1</b> Parallel on your computer</a></li>
<li class="chapter" data-level="17.2" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-virtual-machine"><i class="fa fa-check"></i><b>17.2</b> Parallel on a virtual machine</a></li>
<li class="chapter" data-level="17.3" data-path="parallel-processing.html"><a href="parallel-processing.html#parallel-on-a-cluster"><i class="fa fa-check"></i><b>17.3</b> Parallel on a cluster</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="parallel-processing.html"><a href="parallel-processing.html#what-is-a-command-line-interface"><i class="fa fa-check"></i><b>17.3.1</b> What is a command-line interface?</a></li>
<li class="chapter" data-level="17.3.2" data-path="parallel-processing.html"><a href="parallel-processing.html#running-a-job-on-a-cluster"><i class="fa fa-check"></i><b>17.3.2</b> Running a job on a cluster</a></li>
<li class="chapter" data-level="17.3.3" data-path="parallel-processing.html"><a href="parallel-processing.html#checking-on-a-job"><i class="fa fa-check"></i><b>17.3.3</b> Checking on a job</a></li>
<li class="chapter" data-level="17.3.4" data-path="parallel-processing.html"><a href="parallel-processing.html#running-lots-of-jobs-on-a-cluster"><i class="fa fa-check"></i><b>17.3.4</b> Running lots of jobs on a cluster</a></li>
<li class="chapter" data-level="17.3.5" data-path="parallel-processing.html"><a href="parallel-processing.html#resources-for-harvards-odyssey"><i class="fa fa-check"></i><b>17.3.5</b> Resources for Harvard’s Odyssey</a></li>
<li class="chapter" data-level="17.3.6" data-path="parallel-processing.html"><a href="parallel-processing.html#acknowledgements-1"><i class="fa fa-check"></i><b>17.3.6</b> Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html"><i class="fa fa-check"></i><b>18</b> Debugging and Testing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-print"><i class="fa fa-check"></i><b>18.1</b> Debugging with <code>print()</code></a></li>
<li class="chapter" data-level="18.2" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-browser-debugging"><i class="fa fa-check"></i><b>18.2</b> Debugging with <code>browser()</code></a></li>
<li class="chapter" data-level="18.3" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#debugging-with-debug"><i class="fa fa-check"></i><b>18.3</b> Debugging with <code>debug()</code></a></li>
<li class="chapter" data-level="18.4" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#about-stopifnot"><i class="fa fa-check"></i><b>18.4</b> Protecting functions with <code>stop()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging-and-testing.html"><a href="debugging-and-testing.html#testing-code"><i class="fa fa-check"></i><b>18.5</b> Testing code</a></li>
</ul></li>
<li class="part"><span><b>V Complex Data Structures</b></span></li>
<li class="chapter" data-level="19" data-path="sec:power.html"><a href="sec:power.html"><i class="fa fa-check"></i><b>19</b> Using simulation as a power calculator</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec:power.html"><a href="sec:power.html#getting-design-parameters-from-pilot-data"><i class="fa fa-check"></i><b>19.1</b> Getting design parameters from pilot data</a></li>
<li class="chapter" data-level="19.2" data-path="sec:power.html"><a href="sec:power.html#the-data-generating-process"><i class="fa fa-check"></i><b>19.2</b> The data generating process</a></li>
<li class="chapter" data-level="19.3" data-path="sec:power.html"><a href="sec:power.html#running-the-simulation-1"><i class="fa fa-check"></i><b>19.3</b> Running the simulation</a></li>
<li class="chapter" data-level="19.4" data-path="sec:power.html"><a href="sec:power.html#evaluating-power"><i class="fa fa-check"></i><b>19.4</b> Evaluating power</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="sec:power.html"><a href="sec:power.html#checking-validity-of-our-models"><i class="fa fa-check"></i><b>19.4.1</b> Checking validity of our models</a></li>
<li class="chapter" data-level="19.4.2" data-path="sec:power.html"><a href="sec:power.html#assessing-precision-se"><i class="fa fa-check"></i><b>19.4.2</b> Assessing Precision (SE)</a></li>
<li class="chapter" data-level="19.4.3" data-path="sec:power.html"><a href="sec:power.html#assessing-power-1"><i class="fa fa-check"></i><b>19.4.3</b> Assessing power</a></li>
<li class="chapter" data-level="19.4.4" data-path="sec:power.html"><a href="sec:power.html#assessing-minimum-detectable-effects"><i class="fa fa-check"></i><b>19.4.4</b> Assessing Minimum Detectable Effects</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="sec:power.html"><a href="sec:power.html#power-for-multilevel-data"><i class="fa fa-check"></i><b>19.5</b> Power for Multilevel Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="potential-outcomes.html"><a href="potential-outcomes.html"><i class="fa fa-check"></i><b>20</b> Simulation under the Potential Outcomes Framework</a>
<ul>
<li class="chapter" data-level="20.1" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-vs.-superpopulation-inference"><i class="fa fa-check"></i><b>20.1</b> Finite vs. Superpopulation inference</a></li>
<li class="chapter" data-level="20.2" data-path="potential-outcomes.html"><a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes"><i class="fa fa-check"></i><b>20.2</b> Data generation processes for potential outcomes</a></li>
<li class="chapter" data-level="20.3" data-path="potential-outcomes.html"><a href="potential-outcomes.html#finite-sample-performance-measures"><i class="fa fa-check"></i><b>20.3</b> Finite sample performance measures</a></li>
<li class="chapter" data-level="20.4" data-path="potential-outcomes.html"><a href="potential-outcomes.html#nested-finite-simulation-procedure"><i class="fa fa-check"></i><b>20.4</b> Nested finite simulation procedure</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html"><i class="fa fa-check"></i><b>21</b> The Parametric bootstrap</a>
<ul>
<li class="chapter" data-level="21.1" data-path="the-parametric-bootstrap.html"><a href="the-parametric-bootstrap.html#air-conditioners-a-stolen-case-study"><i class="fa fa-check"></i><b>21.1</b> Air conditioners: a stolen case study</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="coding-tidbits.html"><a href="coding-tidbits.html"><i class="fa fa-check"></i><b>A</b> Coding Reference</a>
<ul>
<li class="chapter" data-level="A.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#more-repeating-oneself"><i class="fa fa-check"></i><b>A.1</b> How to repeat yourself</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-replicate"><i class="fa fa-check"></i><b>A.1.1</b> Using <code>replicate()</code></a></li>
<li class="chapter" data-level="A.1.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-map"><i class="fa fa-check"></i><b>A.1.2</b> Using <code>map()</code></a></li>
<li class="chapter" data-level="A.1.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#map-with-no-inputs"><i class="fa fa-check"></i><b>A.1.3</b> map with no inputs</a></li>
<li class="chapter" data-level="A.1.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#other-approaches-for-repetition"><i class="fa fa-check"></i><b>A.1.4</b> Other approaches for repetition</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#default-arguments"><i class="fa fa-check"></i><b>A.2</b> Default arguments for functions</a></li>
<li class="chapter" data-level="A.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-code"><i class="fa fa-check"></i><b>A.3</b> Profiling Code</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#using-sys.time-and-system.time"><i class="fa fa-check"></i><b>A.3.1</b> Using <code>Sys.time()</code> and <code>system.time()</code></a></li>
<li class="chapter" data-level="A.3.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-tictoc-package"><i class="fa fa-check"></i><b>A.3.2</b> The <code>tictoc</code> package</a></li>
<li class="chapter" data-level="A.3.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#the-bench-package"><i class="fa fa-check"></i><b>A.3.3</b> The <code>bench</code> package</a></li>
<li class="chapter" data-level="A.3.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#profiling-with-profvis"><i class="fa fa-check"></i><b>A.3.4</b> Profiling with <code>profvis</code></a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="coding-tidbits.html"><a href="coding-tidbits.html#optimize-code"><i class="fa fa-check"></i><b>A.4</b> Optimizing code (and why you often shouldn’t)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="coding-tidbits.html"><a href="coding-tidbits.html#hand-building-functions"><i class="fa fa-check"></i><b>A.4.1</b> Hand-building functions</a></li>
<li class="chapter" data-level="A.4.2" data-path="coding-tidbits.html"><a href="coding-tidbits.html#sec_comp_efficiency"><i class="fa fa-check"></i><b>A.4.2</b> Computational efficiency versus simplicity</a></li>
<li class="chapter" data-level="A.4.3" data-path="coding-tidbits.html"><a href="coding-tidbits.html#reusing-code-to-speed-up-computation"><i class="fa fa-check"></i><b>A.4.3</b> Reusing code to speed up computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="further-readings-and-resources.html"><a href="further-readings-and-resources.html"><i class="fa fa-check"></i><b>B</b> Further readings and resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="potential-outcomes" class="section level1 hasAnchor" number="20">
<h1><span class="header-section-number">Chapter 20</span> Simulation under the Potential Outcomes Framework<a href="potential-outcomes.html#potential-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>If we are in the business of evaluating how various methods such as matching or propensity score weighting work in practice, we would probably turn to the potential outcomes framework for our simulations.
The potential outcomes framework is a framework typically used in the causal inference literature to make very explicit statements regarding the mechanics of causality and the associated estimands one might target when estimating causal effects.
While we recommend reading, for a more thourough overview, either [CITE Raudenbush or Field Experiments textbook], we briefly outline this framework here to set out our notation.</p>
<p>Take a sample of experimental units, indexed by <span class="math inline">\(i\)</span>.
For each unit, we can treat it or not.
Denote treatment as <span class="math inline">\(Z_i = 1\)</span> for treated or <span class="math inline">\(Z_i = 0\)</span> for not treated.
Now we imagine each unit has two potential outcomes being the outcome we would see if we treated it (<span class="math inline">\(Y_i(1)\)</span>) or if we did not (<span class="math inline">\(Y_i(0)\)</span>).
Finally, our observed outcome is then
<span class="math display">\[ Y_i^{obs} = Z_i Y_i(1) + (1-Z_i)Y_i(0) .\]</span>
For a unit, the treatment effect is <span class="math inline">\(\tau_i = Y_i(1) - Y_i(0)\)</span>; it is how much our outcome changes if we treat vs. not treat.
Frustratingly, for each unit we can only see one of its two potential outcomes, so we can never get an estimate of these individual <span class="math inline">\(\tau_i\)</span>.
Under this view, causality is a missing data problem: if we only were able to impute the missing potential outcomes, we could have a dataset where we could calculate any estimands we wanted. E.g., the true average treatment effect <em>for the sample</em> <span class="math inline">\(\mathcal{S}\)</span> would be:</p>
<p><span class="math display">\[ ATE_{\mathcal{S}} = \frac{1}{N} \sum_{i} Y_i(1) - Y_i( 0 ) . \]</span>
The average proportion increase, by contrast, would be</p>
<p><span class="math display">\[ API_{\mathcal{S}} = \frac{1}{N} \sum_{i} \frac{Y_i(1)}{Y_i(0)} \]</span></p>
<div id="finite-vs.-superpopulation-inference" class="section level2 hasAnchor" number="20.1">
<h2><span class="header-section-number">20.1</span> Finite vs. Superpopulation inference<a href="potential-outcomes.html#finite-vs.-superpopulation-inference" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a sample of <span class="math inline">\(n\)</span> units, <span class="math inline">\(\mathcal{S}\)</span>, along with their set of potential outcomes.
We can talk about the true ATE of the sample, or, if we thought of the sample as being drawn from some larger population, we could talk about the true ATE of that larger population.</p>
<p>This is a tension that often arises in potential outcomes based simulations: if we are focused on <span class="math inline">\(ATE_{\mathcal{S}}\)</span> then for each sample we generate, our estimand could be (maybe only slightly) different, depending on whether our sample has more or fewer units with high <span class="math inline">\(\tau_i\)</span>.
If, on the other hand, we are focused on where the units came from (which is our data generating model), our estimand is a property of the DGP, and would be the same for each sample generated.</p>
<p>The catch is when we calculate our performance metrics, we now have two possible targets to pick from.
Furthermore, if we are targeting the superpopulation ATE, then our error in estimation may be due in part to the representativeness of the sample, <em>not</em> the estimation or uncertainty due to the random assignment.</p>
<p>We will follow this theme throughout this chapter.</p>
</div>
<div id="data-generation-processes-for-potential-outcomes" class="section level2 hasAnchor" number="20.2">
<h2><span class="header-section-number">20.2</span> Data generation processes for potential outcomes<a href="potential-outcomes.html#data-generation-processes-for-potential-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If we want to write a simulation using the potential outcomes framework, it is clear and transparent to first generate a complete set of potential outcomes, then generate a random assignment based on some assignment mechanism, and finally generate the observed outcomes as a function of assignment and original potential outcomes.</p>
<p>For example, we might say that our data generation process is as follows: First generate each unit <span class="math inline">\(i = 1, \ldots, n\)</span>, as
<span class="math display">\[
\begin{aligned}
X_i &amp;\sim exp( 1 ) - 1 \\
Y_i(0) &amp;= \beta_0 + \beta_1 X_i + \epsilon_i \mbox{ with } \epsilon_i \sim N( 0, \sigma^2 ) \\
\tau_i &amp;= \tau_0 + \tau_1 X_i + \alpha u_i \mbox{ with } u_i \sim t_{df} \\
Y_i(1) &amp;= Y_i(0) + \tau_i
\end{aligned}
\]</span>
with <span class="math inline">\(exp(1)\)</span> being the standard exponential distribution and <span class="math inline">\(t_{df}\)</span> being a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(df\)</span> degrees of freedom.
We subtract 1 from <span class="math inline">\(X_i\)</span> to zero-center it (it is often convenient to have zero-centered covariates so we can then, e.g., interpret <span class="math inline">\(\tau_0\)</span> as the true superpopulation ATE of our experiment).</p>
<p>The above model is saying that we first, for each unit, generate a covariate.
We then generate our two potential outcomes.
I.e., we are generating what the outcome would be for each unit if it were treated and if it were not treated.
We are driving both the level and the treatment effect with <span class="math inline">\(X_i\)</span>, assuming <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\tau_1\)</span> are non-zero.</p>
<p>One advantage of generating all the potential outcomes is we can then calculate the finite-sample estimands such as the true average treatment effect for the generated sample: we just take the average of <span class="math inline">\(Y_i(1) - Y_i(0)\)</span> for our sample.</p>
<p>Here is some code to illustrate the first part of the data generating process (we leave treatment assignment to later):</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="potential-outcomes.html#cb558-1" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">n =</span> <span class="dv">100</span>,</span>
<span id="cb558-2"><a href="potential-outcomes.html#cb558-2" tabindex="-1"></a>                      <span class="at">R2 =</span> <span class="fl">0.5</span>,</span>
<span id="cb558-3"><a href="potential-outcomes.html#cb558-3" tabindex="-1"></a>                      <span class="at">beta_0 =</span> <span class="dv">0</span>, <span class="at">beta_1 =</span> <span class="dv">1</span>,</span>
<span id="cb558-4"><a href="potential-outcomes.html#cb558-4" tabindex="-1"></a>                      <span class="at">tau_0 =</span> <span class="dv">1</span>, <span class="at">tau_1 =</span> <span class="dv">1</span>, </span>
<span id="cb558-5"><a href="potential-outcomes.html#cb558-5" tabindex="-1"></a>                      <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">df =</span> <span class="dv">3</span> ) {</span>
<span id="cb558-6"><a href="potential-outcomes.html#cb558-6" tabindex="-1"></a>  <span class="fu">stopifnot</span>( R2 <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> R2 <span class="sc">&lt;</span> <span class="dv">1</span> )</span>
<span id="cb558-7"><a href="potential-outcomes.html#cb558-7" tabindex="-1"></a>  X_i <span class="ot">=</span> <span class="fu">rexp</span>( n, <span class="at">rate =</span> <span class="dv">1</span> ) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb558-8"><a href="potential-outcomes.html#cb558-8" tabindex="-1"></a>  beta_1 <span class="ot">=</span> <span class="fu">sqrt</span>( <span class="dv">1</span> <span class="sc">-</span> R2 )</span>
<span id="cb558-9"><a href="potential-outcomes.html#cb558-9" tabindex="-1"></a>  sigma_e <span class="ot">=</span> <span class="fu">sqrt</span>( R2 )</span>
<span id="cb558-10"><a href="potential-outcomes.html#cb558-10" tabindex="-1"></a>  Y0_i <span class="ot">=</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> X_i <span class="sc">+</span> <span class="fu">rnorm</span>( n, <span class="at">sd=</span>sigma_e )</span>
<span id="cb558-11"><a href="potential-outcomes.html#cb558-11" tabindex="-1"></a>  tau_i <span class="ot">=</span> tau_0 <span class="sc">+</span> tau_1 <span class="sc">*</span> X_i <span class="sc">+</span> alpha <span class="sc">*</span> <span class="fu">rt</span>( n, <span class="at">df =</span> df )</span>
<span id="cb558-12"><a href="potential-outcomes.html#cb558-12" tabindex="-1"></a>  Y1_i <span class="ot">=</span> Y0_i <span class="sc">+</span> tau_i</span>
<span id="cb558-13"><a href="potential-outcomes.html#cb558-13" tabindex="-1"></a>  </span>
<span id="cb558-14"><a href="potential-outcomes.html#cb558-14" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">X =</span> X_i, <span class="at">Y0 =</span> Y0_i, <span class="at">Y1 =</span> Y1_i )</span>
<span id="cb558-15"><a href="potential-outcomes.html#cb558-15" tabindex="-1"></a>}</span></code></pre></div>
<p>And now we see our estimand can change:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="potential-outcomes.html#cb559-1" tabindex="-1"></a><span class="fu">set.seed</span>( <span class="dv">40454</span> )</span>
<span id="cb559-2"><a href="potential-outcomes.html#cb559-2" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">gen_data</span>( <span class="dv">50</span> )</span>
<span id="cb559-3"><a href="potential-outcomes.html#cb559-3" tabindex="-1"></a><span class="fu">mean</span>( d1<span class="sc">$</span>Y1 <span class="sc">-</span> d1<span class="sc">$</span>Y0 )</span></code></pre></div>
<pre><code>## [1] 0.6374925</code></pre>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="potential-outcomes.html#cb561-1" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">gen_data</span>( <span class="dv">50</span> )</span>
<span id="cb561-2"><a href="potential-outcomes.html#cb561-2" tabindex="-1"></a><span class="fu">mean</span>( d2<span class="sc">$</span>Y1 <span class="sc">-</span> d2<span class="sc">$</span>Y0 )</span></code></pre></div>
<pre><code>## [1] 0.5479788</code></pre>
<p>In reviewing our code, we know our superpopulation ATE should be <code>tau</code>, or 1 exactly.
If our estimate for <code>d1</code> is 0.6 do we say that is close or far from the target?
From a finite sample performance approach, we nailed it.
From superpopulation, less so.</p>
<p>Also in looking at the above, there are a few details to call out:</p>
<ul>
<li>We can store the latent, intermediate quantities (both potential outcomes, in particular) so we can calculate the estimands of interest or learn about our data generating process. When we hand the data to an estimator, we would not provide this “secret” information.</li>
<li>We are using a trick to index our DGP by an R2 value rather than coefficients on X so we can have a standardized control-side outcome (the expected variation of <span class="math inline">\(Y_i(0)\)</span> will be 1). The treatment outcomes will have more variation due to the heterogeniety of the treatment impacts.</li>
<li>If we were generating data with a constant treatment impact, then <span class="math inline">\(ATE_{\mathcal{S}} = ATE\)</span> always; this is typical for many similations in the literature. That being said, treatment variation is what causes a lot of methods to fail and so having simulations that have this variation is usually important.</li>
</ul>
<p>Once we have our <em>schedule of potential outcomes</em>, we would then generate the <em>observed outcomes</em> by assigning our (synthetic, randomly generated) <span class="math inline">\(n\)</span> units to treatment or control.
For example, say we wanted to simulate an observational context where treatment was a function of our covariate.
We could model each unit as flipping a weighted coin with some probability that was a function of <span class="math inline">\(X_i\)</span> as so:</p>
<p><span class="math display">\[
\begin{aligned}
p_i &amp;= logit^{-1}( \xi_0 + \xi_1 X_i ) \\
Z_i &amp;= Bern( p_i ) \\
Y_i &amp;= Z_i Y_i(1) + (1-Z_i) Y_i(0)
\end{aligned}
\]</span></p>
<p>Here is code for assigning our data to treatment and control:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="potential-outcomes.html#cb563-1" tabindex="-1"></a>assign_data <span class="ot">&lt;-</span> <span class="cf">function</span>( dat,</span>
<span id="cb563-2"><a href="potential-outcomes.html#cb563-2" tabindex="-1"></a>                         <span class="at">xi_0 =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xi_1 =</span> <span class="dv">1</span> ) {</span>
<span id="cb563-3"><a href="potential-outcomes.html#cb563-3" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb563-4"><a href="potential-outcomes.html#cb563-4" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">mutate</span>( dat,</span>
<span id="cb563-5"><a href="potential-outcomes.html#cb563-5" tabindex="-1"></a>                <span class="at">p =</span> arm<span class="sc">::</span><span class="fu">invlogit</span>( xi_0 <span class="sc">+</span> xi_1 <span class="sc">*</span> X ),</span>
<span id="cb563-6"><a href="potential-outcomes.html#cb563-6" tabindex="-1"></a>                <span class="at">Z =</span> <span class="fu">rbinom</span>( n, <span class="dv">1</span>, <span class="at">prob=</span>p ),</span>
<span id="cb563-7"><a href="potential-outcomes.html#cb563-7" tabindex="-1"></a>                <span class="at">Yobs =</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, Y1, Y0 ) )</span>
<span id="cb563-8"><a href="potential-outcomes.html#cb563-8" tabindex="-1"></a>  dat</span>
<span id="cb563-9"><a href="potential-outcomes.html#cb563-9" tabindex="-1"></a>}</span></code></pre></div>
<p>We can then add our assignment variable to our given data as so:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="potential-outcomes.html#cb564-1" tabindex="-1"></a><span class="fu">assign_data</span>( d2 )</span></code></pre></div>
<pre><code>## # A tibble: 50 × 6
##           X     Y0      Y1     p     Z    Yobs
##       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1  0.670    0.667   2.58  0.418     1   2.58 
##  2  0.371    0.314   4.57  0.348     1   4.57 
##  3  1.94     1.29    3.03  0.719     0   1.29 
##  4 -0.244    0.119 -10.0   0.224     1 -10.0  
##  5  0.00850  1.44    2.88  0.271     0   1.44 
##  6  1.41     1.14    5.02  0.600     1   5.02 
##  7 -0.864    0.461   0.802 0.134     1   0.802
##  8 -0.00533 -0.914  -1.17  0.268     0  -0.914
##  9 -0.907   -0.202   0.555 0.129     1   0.555
## 10 -0.363   -0.141   1.16  0.204     1   1.16 
## # ℹ 40 more rows</code></pre>
<p>Note how <code>Yobs</code> is, depending on <code>Z</code>, either <code>Y0</code> or <code>Y1</code>.
Separating our our DGP and our random assignment underscores the potential outcomes framework adage of the data are what they are, and we the experimenters (or nature) is randomly assigning these whole units to various conditions and observing the consequences.</p>
<p>In general, we might instead put the <code>p_i</code> part of the model in our code generating the outcomes, if we wanted to view the chance of treatment assignment as inherent to the unit (which is what we usually expect in an observational context).</p>
</div>
<div id="finite-sample-performance-measures" class="section level2 hasAnchor" number="20.3">
<h2><span class="header-section-number">20.3</span> Finite sample performance measures<a href="potential-outcomes.html#finite-sample-performance-measures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s generate a single dataset with our DGP from above, and run a small experiment where we actually randomize units to treatment and control:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="potential-outcomes.html#cb566-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb566-2"><a href="potential-outcomes.html#cb566-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">442423</span>)</span>
<span id="cb566-3"><a href="potential-outcomes.html#cb566-3" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">gen_data</span>(n, <span class="at">tau_1 =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb566-4"><a href="potential-outcomes.html#cb566-4" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">mutate</span>( dat,</span>
<span id="cb566-5"><a href="potential-outcomes.html#cb566-5" tabindex="-1"></a>              <span class="at">Z =</span> <span class="dv">0</span> <span class="sc">+</span> (<span class="fu">sample</span>( n ) <span class="sc">&lt;=</span> n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb566-6"><a href="potential-outcomes.html#cb566-6" tabindex="-1"></a>              <span class="at">Yobs =</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, Y1, Y0 ) )</span>
<span id="cb566-7"><a href="potential-outcomes.html#cb566-7" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">lm</span>( Yobs <span class="sc">~</span> Z, <span class="at">data=</span>dat )</span>
<span id="cb566-8"><a href="potential-outcomes.html#cb566-8" tabindex="-1"></a><span class="fu">coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.8914992</code></pre>
<p>We can compare this to the true finite-sample ATE:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="potential-outcomes.html#cb568-1" tabindex="-1"></a><span class="fu">mean</span>( dat<span class="sc">$</span>Y1 <span class="sc">-</span> dat<span class="sc">$</span>Y0 )</span></code></pre></div>
<pre><code>## [1] 1.154018</code></pre>
<p>Our finite-population simulation would be:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="potential-outcomes.html#cb570-1" tabindex="-1"></a>rps <span class="ot">&lt;-</span> <span class="fu">rerun</span>( <span class="dv">1000</span>, {</span>
<span id="cb570-2"><a href="potential-outcomes.html#cb570-2" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">mutate</span>( dat,</span>
<span id="cb570-3"><a href="potential-outcomes.html#cb570-3" tabindex="-1"></a>              <span class="at">Z =</span> <span class="dv">0</span> <span class="sc">+</span> (<span class="fu">sample</span>( n ) <span class="sc">&lt;=</span> n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb570-4"><a href="potential-outcomes.html#cb570-4" tabindex="-1"></a>              <span class="at">Yobs =</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, Y1, Y0 ) )</span>
<span id="cb570-5"><a href="potential-outcomes.html#cb570-5" tabindex="-1"></a>  mod <span class="ot">=</span> <span class="fu">lm</span>( Yobs <span class="sc">~</span> Z, <span class="at">data=</span>dat )</span>
<span id="cb570-6"><a href="potential-outcomes.html#cb570-6" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">ATE_hat =</span> <span class="fu">coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]],</span>
<span id="cb570-7"><a href="potential-outcomes.html#cb570-7" tabindex="-1"></a>          <span class="at">SE_hat =</span> arm<span class="sc">::</span><span class="fu">se.coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]] )</span>
<span id="cb570-8"><a href="potential-outcomes.html#cb570-8" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb570-9"><a href="potential-outcomes.html#cb570-9" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<pre><code>## Warning: `rerun()` was deprecated in purrr 1.0.0.
## ℹ Please use `map()` instead.
##   # Previously
## rerun(1000, {
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## 
##   # Now
## map(1:1000, ~ {
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to
## see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="potential-outcomes.html#cb572-1" tabindex="-1"></a>rps <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">EATE_hat =</span> <span class="fu">mean</span>( ATE_hat ),</span>
<span id="cb572-2"><a href="potential-outcomes.html#cb572-2" tabindex="-1"></a>                   <span class="at">SE =</span> <span class="fu">sd</span>( ATE_hat ),</span>
<span id="cb572-3"><a href="potential-outcomes.html#cb572-3" tabindex="-1"></a>                   <span class="at">ESE_hat =</span> <span class="fu">mean</span>( SE_hat ) )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   EATE_hat    SE ESE_hat
##      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1     1.16 0.248   0.307</code></pre>
<p>We are simulating on a single dataset.
In particular, our set of potential outcomes is entirely fixed; the only source of randomness (and thus the randomness behind our SE) is the random assignment.
Now this opens up some room for critique: what if our single dataset is non-standard?</p>
<p>Our super-population simulation would be, by contrast:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="potential-outcomes.html#cb574-1" tabindex="-1"></a>rps_sup <span class="ot">&lt;-</span> <span class="fu">rerun</span>( <span class="dv">1000</span>, {</span>
<span id="cb574-2"><a href="potential-outcomes.html#cb574-2" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">gen_data</span>(n)</span>
<span id="cb574-3"><a href="potential-outcomes.html#cb574-3" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">mutate</span>( dat,</span>
<span id="cb574-4"><a href="potential-outcomes.html#cb574-4" tabindex="-1"></a>              <span class="at">Z =</span> <span class="dv">0</span> <span class="sc">+</span> (<span class="fu">sample</span>( n ) <span class="sc">&lt;=</span> n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb574-5"><a href="potential-outcomes.html#cb574-5" tabindex="-1"></a>              <span class="at">Yobs =</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, Y1, Y0 ) )</span>
<span id="cb574-6"><a href="potential-outcomes.html#cb574-6" tabindex="-1"></a>  mod <span class="ot">=</span> <span class="fu">lm</span>( Yobs <span class="sc">~</span> Z, <span class="at">data=</span>dat )</span>
<span id="cb574-7"><a href="potential-outcomes.html#cb574-7" tabindex="-1"></a>  <span class="fu">tibble</span>( <span class="at">ATE_hat =</span> <span class="fu">coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]],</span>
<span id="cb574-8"><a href="potential-outcomes.html#cb574-8" tabindex="-1"></a>          <span class="at">SE_hat =</span> arm<span class="sc">::</span><span class="fu">se.coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]] )</span>
<span id="cb574-9"><a href="potential-outcomes.html#cb574-9" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb574-10"><a href="potential-outcomes.html#cb574-10" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<pre><code>## Warning: `rerun()` was deprecated in purrr 1.0.0.
## ℹ Please use `map()` instead.
##   # Previously
## rerun(1000, {
## dat = gen_data(n)
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## 
##   # Now
## map(1:1000, ~ {
## dat = gen_data(n)
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to
## see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="potential-outcomes.html#cb576-1" tabindex="-1"></a>rps_sup <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">EATE_hat =</span> <span class="fu">mean</span>( ATE_hat ),</span>
<span id="cb576-2"><a href="potential-outcomes.html#cb576-2" tabindex="-1"></a>                   <span class="at">SE =</span> <span class="fu">sd</span>( ATE_hat ),</span>
<span id="cb576-3"><a href="potential-outcomes.html#cb576-3" tabindex="-1"></a>                   <span class="at">ESE_hat =</span> <span class="fu">mean</span>( SE_hat ))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   EATE_hat    SE ESE_hat
##      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1    1.000 0.381   0.378</code></pre>
<p>First, note our superpopulation simulation is not biased for the superpopulation ATE.
Also note the true SE is larger than our finite-sample simulation; this is because part of the uncertainty in our estimator is the uncertainty of whether our sample is representative of the superpopulation.</p>
<p>Finally, this clarifies that our linear regression estimator is estimating standard errors assuming a superpopulation model.
The true finite sample standard error is less than the expected estimated error: from a finite sample perspective, our estimator is giving overly conservative uncertainty estimates.
(This discrepancy is often called the correlation of potential outcomes problem.)</p>
</div>
<div id="nested-finite-simulation-procedure" class="section level2 hasAnchor" number="20.4">
<h2><span class="header-section-number">20.4</span> Nested finite simulation procedure<a href="potential-outcomes.html#nested-finite-simulation-procedure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We just saw a difference between a specific, single, finite-sample dataset and a superpopulation.
What if we wanted to know if this phenomenon was more general across a set of datasets?
This question can be levied more broadly: if we run a simulation on a single dataset, this is even more narrow than running on a single scenario: if we compare methods and find one is superior to another for our single dataset, how do we know this is not an artifact of some specific characteristic of <em>that data</em> and not a general phenomonen at all?</p>
<p>One way forward is to run a nested simulation, where we generate a series of finite sample datasets, and then for each dataset run a small simulation.
We then calculate the expected finite sample performance across the datasets.
One could almost think of the datasets themselves as a “factor” in our multifactor experiment.
This is what we did in [CITE estimands paper]</p>
<p>Borrowing from the simulation appendix of [CITE estimands paper], repeat <span class="math inline">\(R\)</span> times:</p>
<ol style="list-style-type: decimal">
<li><p>Generate a dataset using a particular DGP. This data generation is the “sampling step” for a superpopulation (SP) framework. The DGP represents an inﬁnite superpopulation. Each dataset includes, for each observation, the potential outcome under treatment or control.</p></li>
<li><p>Record the true finite-sample ATE, both person and site weighted.</p></li>
<li><p>Then, three times, do a finite simulation as follows:</p></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Randomize units to treatment and control.</li>
<li>Calculate the corresponding observed outcomes.</li>
<li>Analyze the results using the methods of interest, recording both the point estimate and estimated standard error for each.</li>
</ol>
<p>Having only three trials will give a poor estimate of within-dataset variability for each dataset, but the average across the
<span class="math inline">\(R\)</span> datasets in a given scenario gives a reasonable estimate of expected variability across datasets of the type we would see given the scenario parameters.</p>
<p>To demonstrate we first make a mini-finite sample driver:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="potential-outcomes.html#cb578-1" tabindex="-1"></a>one_finite_run <span class="ot">&lt;-</span> <span class="cf">function</span>( <span class="at">R0 =</span> <span class="dv">3</span>, <span class="at">n =</span> <span class="dv">100</span>, ... ) {</span>
<span id="cb578-2"><a href="potential-outcomes.html#cb578-2" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">gen_data</span>( <span class="at">n =</span> n, ... )</span>
<span id="cb578-3"><a href="potential-outcomes.html#cb578-3" tabindex="-1"></a>  rps <span class="ot">&lt;-</span> <span class="fu">rerun</span>( R0, {</span>
<span id="cb578-4"><a href="potential-outcomes.html#cb578-4" tabindex="-1"></a>         dat <span class="ot">=</span> <span class="fu">mutate</span>( dat,</span>
<span id="cb578-5"><a href="potential-outcomes.html#cb578-5" tabindex="-1"></a>                    <span class="at">Z =</span> <span class="dv">0</span> <span class="sc">+</span> (<span class="fu">sample</span>( n ) <span class="sc">&lt;=</span> n<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb578-6"><a href="potential-outcomes.html#cb578-6" tabindex="-1"></a>                    <span class="at">Yobs =</span> <span class="fu">ifelse</span>( Z <span class="sc">==</span> <span class="dv">1</span>, Y1, Y0 ) )</span>
<span id="cb578-7"><a href="potential-outcomes.html#cb578-7" tabindex="-1"></a>        mod <span class="ot">=</span> <span class="fu">lm</span>( Yobs <span class="sc">~</span> Z, <span class="at">data=</span>dat )</span>
<span id="cb578-8"><a href="potential-outcomes.html#cb578-8" tabindex="-1"></a>        <span class="fu">tibble</span>( <span class="at">ATE_hat =</span> <span class="fu">coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]],</span>
<span id="cb578-9"><a href="potential-outcomes.html#cb578-9" tabindex="-1"></a>                <span class="at">SE_hat =</span> arm<span class="sc">::</span><span class="fu">se.coef</span>(mod)[[<span class="st">&quot;Z&quot;</span>]] )</span>
<span id="cb578-10"><a href="potential-outcomes.html#cb578-10" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb578-11"><a href="potential-outcomes.html#cb578-11" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb578-12"><a href="potential-outcomes.html#cb578-12" tabindex="-1"></a>  rps<span class="sc">$</span>ATE <span class="ot">=</span> <span class="fu">mean</span>( dat<span class="sc">$</span>Y1 <span class="sc">-</span> dat<span class="sc">$</span>Y0 )</span>
<span id="cb578-13"><a href="potential-outcomes.html#cb578-13" tabindex="-1"></a>  rps</span>
<span id="cb578-14"><a href="potential-outcomes.html#cb578-14" tabindex="-1"></a>}</span></code></pre></div>
<p>This driver also stores the finite sample ATE for future reference:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="potential-outcomes.html#cb579-1" tabindex="-1"></a><span class="fu">one_finite_run</span>()</span></code></pre></div>
<pre><code>## Warning: `rerun()` was deprecated in purrr 1.0.0.
## ℹ Please use `map()` instead.
##   # Previously
## rerun(3, {
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## 
##   # Now
## map(1:3, ~ {
## dat = mutate(dat, Z = 0 + (sample(n) &lt;= n / 2),
## Yobs = ifelse(Z == 1, Y1, Y0))
## mod = lm(Yobs ~ Z, data = dat)
## tibble(ATE_hat = coef(mod)[[&quot;Z&quot;]], SE_hat =
## arm::se.coef(
## mod)[[&quot;Z&quot;]])
## })
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to
## see where this warning was generated.</code></pre>
<pre><code>## # A tibble: 3 × 3
##   ATE_hat SE_hat   ATE
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1   0.348  0.421 0.768
## 2   1.32   0.472 0.768
## 3   1.17   0.549 0.768</code></pre>
<p>We then run a bunch of finite runs.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="potential-outcomes.html#cb582-1" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">rerun</span>( <span class="dv">500</span>, <span class="fu">one_finite_run</span>() ) <span class="sc">%&gt;%</span></span>
<span id="cb582-2"><a href="potential-outcomes.html#cb582-2" tabindex="-1"></a>  <span class="fu">bind_rows</span>( <span class="at">.id =</span> <span class="st">&quot;runID&quot;</span> )</span></code></pre></div>
<pre><code>## Warning: `rerun()` was deprecated in purrr 1.0.0.
## ℹ Please use `map()` instead.
##   # Previously
##   rerun(500, one_finite_run())
## 
##   # Now
##   map(1:500, ~ one_finite_run())
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to
## see where this warning was generated.</code></pre>
<p>We use <code>.id</code> because we will need to separate out each finite run and analyze separately, and then aggregate.</p>
<p>Each finite run is a very noisy simulation for a fixed dataset.
This means when we calculate performance measures we have to be careful to avoid bias in the calculations; in particular, we need to focus on estimating <span class="math inline">\(SE^2\)</span> across the finite runs, not <span class="math inline">\(SE\)</span>, to avoid the bias caused by having a few observations with every estimate.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="potential-outcomes.html#cb584-1" tabindex="-1"></a>fruns <span class="ot">&lt;-</span> runs <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( runID ) <span class="sc">%&gt;%</span></span>
<span id="cb584-2"><a href="potential-outcomes.html#cb584-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">EATE_hat =</span> <span class="fu">mean</span>( ATE_hat ),</span>
<span id="cb584-3"><a href="potential-outcomes.html#cb584-3" tabindex="-1"></a>             <span class="at">SE2 =</span> <span class="fu">var</span>( ATE_hat ),</span>
<span id="cb584-4"><a href="potential-outcomes.html#cb584-4" tabindex="-1"></a>             <span class="at">ESE_hat =</span> <span class="fu">mean</span>( SE_hat ),</span>
<span id="cb584-5"><a href="potential-outcomes.html#cb584-5" tabindex="-1"></a>             <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span> )</span></code></pre></div>
<p>And then we aggregate our finite sample runs:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="potential-outcomes.html#cb585-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> fruns <span class="sc">%&gt;%</span></span>
<span id="cb585-2"><a href="potential-outcomes.html#cb585-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">EEATE_hat =</span> <span class="fu">mean</span>( EATE_hat ),</span>
<span id="cb585-3"><a href="potential-outcomes.html#cb585-3" tabindex="-1"></a>             <span class="at">EESE_hat =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( ESE_hat<span class="sc">^</span><span class="dv">2</span> ) ),</span>
<span id="cb585-4"><a href="potential-outcomes.html#cb585-4" tabindex="-1"></a>             <span class="at">ESE =</span> <span class="fu">sqrt</span>( <span class="fu">mean</span>( SE2 ) ) ) <span class="sc">%&gt;%</span></span>
<span id="cb585-5"><a href="potential-outcomes.html#cb585-5" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">calib =</span> <span class="dv">100</span> <span class="sc">*</span> EESE_hat <span class="sc">/</span> ESE )</span>
<span id="cb585-6"><a href="potential-outcomes.html#cb585-6" tabindex="-1"></a></span>
<span id="cb585-7"><a href="potential-outcomes.html#cb585-7" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   EEATE_hat EESE_hat   ESE calib
##       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.996    0.380 0.331  115.</code></pre>
<p>We see our expected standard error estimate is, across the collection of finite sample scenarios all sharing a similar parent superpopulation DGP, 15% too large for the true expected finite-sample standard error.</p>
<p>We need to keep the squaring. If we look at the SEs themselves, we have further apparent bias due to our <em>estimated</em> <code>ESE_hat</code> being so unstable due to too few observations:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="potential-outcomes.html#cb587-1" tabindex="-1"></a><span class="fu">mean</span>( <span class="fu">sqrt</span>( fruns<span class="sc">$</span>SE2 ) )</span></code></pre></div>
<pre><code>## [1] 0.2944556</code></pre>
<p>We can use our collection of mini-finite-sample runs to estimate superpopulation quantities as well.
Given that the simulation datasets are i.i.d. draws, we can simply take expectations across all our simulations.
The only concern is our estimates of MCSE will be off due to the clustering in our simulation runs.</p>
<p>Here we calculate superpopulation performance measures (both with the squared SE and without; we prefer the squared version):</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="potential-outcomes.html#cb589-1" tabindex="-1"></a>runs <span class="sc">%&gt;%</span></span>
<span id="cb589-2"><a href="potential-outcomes.html#cb589-2" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="at">EATE_hat =</span> <span class="fu">mean</span>( ATE_hat ),</span>
<span id="cb589-3"><a href="potential-outcomes.html#cb589-3" tabindex="-1"></a>             <span class="at">SE_true =</span> <span class="fu">sd</span>( ATE_hat ),</span>
<span id="cb589-4"><a href="potential-outcomes.html#cb589-4" tabindex="-1"></a>             <span class="at">SE_hat =</span> <span class="fu">mean</span>( SE_hat ),</span>
<span id="cb589-5"><a href="potential-outcomes.html#cb589-5" tabindex="-1"></a>             <span class="at">SE2_true =</span> <span class="fu">var</span>( ATE_hat ),</span>
<span id="cb589-6"><a href="potential-outcomes.html#cb589-6" tabindex="-1"></a>             <span class="at">SE2_hat =</span> <span class="fu">mean</span>( SE_hat<span class="sc">^</span><span class="dv">2</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb589-7"><a href="potential-outcomes.html#cb589-7" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( <span class="at">cols =</span> <span class="fu">c</span>(SE_true<span class="sc">:</span>SE2_hat ),</span>
<span id="cb589-8"><a href="potential-outcomes.html#cb589-8" tabindex="-1"></a>                <span class="at">names_to =</span> <span class="fu">c</span>( <span class="st">&quot;estimand&quot;</span>, <span class="st">&quot;.value&quot;</span> ),</span>
<span id="cb589-9"><a href="potential-outcomes.html#cb589-9" tabindex="-1"></a>                <span class="at">names_sep =</span><span class="st">&quot;_&quot;</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb589-10"><a href="potential-outcomes.html#cb589-10" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">inflate =</span> <span class="dv">100</span> <span class="sc">*</span> hat <span class="sc">/</span> true )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   EATE_hat estimand  true   hat inflate
##      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1    0.996 SE       0.389 0.377    96.9
## 2    0.996 SE2      0.151 0.142    93.9</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec:power.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-parametric-bootstrap.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/jepusto/Designing-Simulations-in-R/edit/master/150-potential-outcomes-framework.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
  "search": {
    "engine": "lunr",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  },
  "toolbar": {
    "position": "fixed"
  },
  "info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
